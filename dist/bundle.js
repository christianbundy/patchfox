var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function o(e){return e()}function r(){return Object.create(null)}function a(e){e.forEach(o)}function s(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(e,t,n){const o=t.subscribe(n);e.$$.on_destroy.push(o.unsubscribe?()=>o.unsubscribe():o)}const i="undefined"!=typeof window;let u=i?()=>window.performance.now():()=>Date.now(),d=i?requestAnimationFrame:e;const m=new Set;let h,p=!1;function g(){m.forEach(e=>{e[0](u())||(m.delete(e),e[1]())}),(p=m.size>0)&&d(g)}function f(e){let t;return p||(p=!0,d(g)),{promise:new Promise(n=>{m.add(t=[e,n])}),abort(){m.delete(t)}}}function v(e,t){e.appendChild(t)}function b(e,t,n){e.insertBefore(t,n||null)}function y(e){e.parentNode.removeChild(e)}function k(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}function w(e){return document.createElement(e)}function $(e){return document.createTextNode(e)}function N(){return $(" ")}function x(){return $("")}function C(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function P(e){return function(t){return t.preventDefault(),e.call(this,t)}}function M(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function R(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function _(e,t){t=""+t,e.data!==t&&(e.data=t)}function T(e,t,n){e.classList[n?"add":"remove"](t)}let I,O=0,U={};function A(e,t,n,o,r,a,s,c=0){const l=16.666/o;let i="{\n";for(let e=0;e<=1;e+=l){const o=t+(n-t)*a(e);i+=100*e+`%{${s(o,1-o)}}\n`}const u=i+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${c}`;if(!U[d]){if(!h){const e=w("style");document.head.appendChild(e),h=e.sheet}U[d]=!0,h.insertRule(`@keyframes ${d} ${u}`,h.cssRules.length)}const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${o}ms linear ${r}ms 1 both`,O+=1,d}function L(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--O&&d(()=>{if(O)return;let e=h.cssRules.length;for(;e--;)h.deleteRule(e);U={}})}function F(e){I=e}function E(){if(!I)throw new Error("Function called outside component initialization");return I}function j(e){E().$$.on_mount.push(e)}function S(){const e=I;return(t,n)=>{const o=e.$$.callbacks[t];if(o){const r=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);o.slice().forEach(t=>{t.call(e,r)})}}}const H=[],D=Promise.resolve();let B=!1;const q=[],W=[],z=[];function V(e){W.push(e)}function Y(){const e=new Set;do{for(;H.length;){const e=H.shift();F(e),J(e.$$)}for(;q.length;)q.shift()();for(;W.length;){const t=W.pop();e.has(t)||(t(),e.add(t))}}while(H.length);for(;z.length;)z.pop()();B=!1}function J(e){e.fragment&&(e.update(e.dirty),a(e.before_render),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_render.forEach(V))}let K,G;function Q(){return K||(K=Promise.resolve()).then(()=>{K=null}),K}function X(){G={remaining:0,callbacks:[]}}function Z(){G.remaining||a(G.callbacks)}function ee(e){G.callbacks.push(e)}function te(e,t){const o=t.token={};function r(e,r,a,s){if(t.token!==o)return;t.resolved=a&&{[a]:s};const c=n(n({},t.ctx),t.resolved),l=e&&(t.current=e)(c);t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==r&&e&&(X(),ee(()=>{e.d(1),t.blocks[n]=null}),e.o(1),Z())}):t.block.d(1),l.c(),l.i&&l.i(1),l.m(t.mount(),t.anchor),Y()),t.block=l,t.blocks&&(t.blocks[r]=l)}if((a=e)&&"function"==typeof a.then){if(e.then(e=>{r(t.then,1,t.value,e)},e=>{r(t.catch,2,t.error,e)}),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved={[t.value]:e}}var a}function ne(e,t){ee(()=>{!function(e,t){e.d(1),t.delete(e.key)}(e,t)}),e.o(1)}function oe(e,t,n,o,r,a,s,c,l,i,u,d){let m=e.length,h=a.length,p=m;const g={};for(;p--;)g[e[p].key]=p;const f=[],v=new Map,b=new Map;for(p=h;p--;){const e=d(r,a,p),c=n(e);let l=s.get(c);l?o&&l.p(t,e):(l=i(c,e)).c(),v.set(c,f[p]=l),c in g&&b.set(c,Math.abs(p-g[c]))}const y=new Set,k=new Set;function w(e){e.i&&e.i(1),e.m(c,u),s.set(e.key,e),u=e.first,h--}for(;m&&h;){const t=f[h-1],n=e[m-1],o=t.key,r=n.key;t===n?(u=t.first,m--,h--):v.has(r)?!s.has(o)||y.has(o)?w(t):k.has(r)?m--:b.get(o)>b.get(r)?(k.add(o),w(t)):(y.add(r),m--):(l(n,s),m--)}for(;m--;){const t=e[m];v.has(t.key)||l(t,s)}for(;h;)w(f[h-1]);return f}function re(e,t,n){const{fragment:r,on_mount:c,on_destroy:l,after_render:i}=e.$$;r.m(t,n),V(()=>{const t=c.map(o).filter(s);l?l.push(...t):a(t),e.$$.on_mount=[]}),i.forEach(V)}function ae(e,t){e.$$.dirty||(H.push(e),B||(B=!0,D.then(Y)),e.$$.dirty=r()),e.$$.dirty[t]=!0}function se(t,n,o,s,c,l){const i=I;F(t);const u=n.props||{},d=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:c,bound:r(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(i?i.$$.context:[]),callbacks:r(),dirty:null};let m=!1;var h;d.ctx=o?o(t,u,(e,n)=>{d.ctx&&c(d.ctx[e],d.ctx[e]=n)&&(d.bound[e]&&d.bound[e](n),m&&ae(t,e))}):u,d.update(),m=!0,a(d.before_render),d.fragment=s(d.ctx),n.target&&(n.hydrate?d.fragment.l((h=n.target,Array.from(h.childNodes))):d.fragment.c(),n.intro&&t.$$.fragment.i&&t.$$.fragment.i(),re(t,n.target,n.anchor),Y()),F(i)}class ce{$destroy(){var t,n;n=!0,(t=this).$$&&(a(t.$$.on_destroy),t.$$.fragment.d(n),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={}),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function le(t,n=e){let o;const r=[];function a(e){if(c(t,e)){if(t=e,!o)return;r.forEach(e=>e[1]()),r.forEach(e=>e[0](t))}}return{set:a,update:function(e){a(e(t))},subscribe:function(s,c=e){const l=[s,c];return r.push(l),1===r.length&&(o=n(a)||e),s(t),()=>{const e=r.indexOf(l);-1!==e&&r.splice(e,1),0===r.length&&o()}}}}function ie(t,n,o){const r=!Array.isArray(t),c=r?[t]:t,l=n.length<2;return{subscribe:le(o,t=>{let o=!1;const i=[];let u=0,d=e;const m=()=>{if(u)return;d();const o=n(r?i[0]:i,t);l?t(o):d=s(o)?o:e},h=c.map((e,t)=>e.subscribe(e=>{i[t]=e,u&=~(1<<t),o&&m()},()=>{u|=1<<t}));return o=!0,m(),function(){a(h),d()}}).subscribe}}class ue{constructor(){this.name="Driver for Hermiebox"}log(e,t=""){console.log(`[Driver Hermiebox] - ${e}`,t)}async connect(e){var t=await hermiebox.api.connect(e);this.log("you are",t.id),this.feed=t.id}async public(e,t){return await hermiebox.api.pullPublic(e,t)}async thread(e){return await hermiebox.api.thread(e)}async profile(e){var t=await hermiebox.api.profile(e);return console.log(t),t}async get(e){return await hermiebox.api.get(e)}async setAvatarCache(e,t){let n={};return n[`avatar-${e}`]=t,browser.storage.local.set(n)}async getCachedAvatar(e){return browser.storage.local.get(`avatar-${e}`)}async avatar(e){try{let t=await hermiebox.api.avatar(e);return await this.setAvatarCache(e,t),t}catch(e){throw e}}async blurbFromMsg(e,t){let n=e;try{let o=await ssb.get(e);return"post"==o.content.type&&(n=this.plainTextFromMarkdown(o.content.text.slice(0,t)+"...")),n}catch(e){return n}}plainTextFromMarkdown(e){let t=this.markdown(e),n=document.createElement("div");return n.innerHTML=t,n.innerText}markdown(e){let t=hermiebox.modules.ssbMarkdown.block(e);return t=t.replace("<pre>",'<pre class="code">').replace(/<a href="#([^"]*)/gi,function(e,t,n,o){return`<a class="channel-link" href="?channel=${encodeURIComponent(t)}#/channel`}).replace(/<a href="@([^"]*)/gi,function(e,t,n,o){return'<a class="profile-link" href="?feed='+encodeURIComponent(`@${t}`)+"#/profile"}).replace(/target="_blank"/gi,"").replace(/<a href="%([^"]*)/gi,function(e,t,n,o){return`<a class="thread-link" href="?thread=${encodeURIComponent(`%${t}`)}#/thread`}).replace(/<img src="&([^"]*)/gi,function(e,t,n,o){return'<img class="is-image-from-blob" src="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)}).replace(/<a href="&([^"]*)/gi,function(e,t,n,o){return'<a class="image-link" target="_blank" href="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)})}ref(){return hermiebox.modules.ssbRef}getTimestamp(e){const t=e.timestamp,n=e.value.timestamp;return Math.min(t,n)}getRootMsgId(e){if(e&&e.value&&e.value.content){const t=e.value.content.root;if(hermiebox.modules.ssbRef.isMsgId(t))return t}}newPost(e){return new Promise((t,n)=>{const o=hermiebox.modules.ssbMsgSchemas,r=e.text,a=e.hasOwnProperty("root")?e.root:void 0,s=e.hasOwnProperty("branch")?e.branch:void 0,c=e.hasOwnProperty("mentions")?e.mentions:void 0,l=e.hasOwnProperty("recps")?e.recps:void 0,i=e.hasOwnProperty("channel")?e.channel:void 0,u=hermiebox.sbot||!1,d=o.post(r,a,s,c,l,i);u&&u.publish(d,function(e,o){e?n(e):t(o)})})}follow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1;o&&o.publish({type:"contact",contact:e,following:!0},(e,o)=>{e?n(e):t(o)})})}getBlob(e){return hermiebox.api.getBlob(e)}votes(e){return new Promise((t,n)=>{let o=hermiebox.modules.pullStream,r=hermiebox.sbot;r&&o(r.links({dest:e,rel:"vote",values:!0}),o.collect((e,o)=>{e?n(e):t(o)}))})}like(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:1,expression:"Like"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unlike(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:0,expression:"Unlike"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channels(){return new Promise((e,t)=>{let n=hermiebox.modules.pullStream,o=hermiebox.sbot||!1;o?(console.log("querying channels"),n(o.query.read({query:[{$filter:{value:{content:{channel:{$is:"string"},type:"post"}}}},{$reduce:{channel:["value","content","channel"],count:{$count:!0},timestamp:{$max:["value","timestamp"]}}},{$sort:[["timestamp"],["count"]]}],limit:20}),n.collect(function(n,o){console.log("channels",o),n?t(n):e(o)}))):t("no sbot")})}channel(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1,s={$filter:{value:{content:{channel:e}}}};t.lt&&(s.$filter.value.timestamp={$lt:t.lt}),console.dir(s),a?r(a.query.read({query:[s],limit:t.limit,reverse:!0}),r.collect(function(e,t){e?o(e):n(t)})):o("no sbot")})}channelSubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelUnsubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelSubscribed(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"channel",channel:e}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.subscribed||!1):n(!1)}))}else o("no sbot")})}}var de=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),me=new RegExp("%[a-f0-9]{2}","gi"),he=new RegExp("(%[a-f0-9]{2})+","gi");function pe(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],pe(n),pe(o))}function ge(e){try{return decodeURIComponent(e)}catch(o){for(var t=e.match(me),n=1;n<t.length;n++)t=(e=pe(t,n).join("")).match(me);return e}}var fe=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=he.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var o=ge(n[0]);o!==n[0]&&(t[n[0]]=o)}n=he.exec(e)}t["%C2"]="�";for(var r=Object.keys(t),a=0;a<r.length;a++){var s=r[a];e=e.replace(new RegExp(s,"g"),t[s])}return e}(e)}},ve=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]};function be(e,t){return t.encode?t.strict?de(e):encodeURIComponent(e):e}function ye(e,t){return t.decode?fe(e):e}function ke(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function we(e){const t=(e=ke(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function $e(e,t){const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,o)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===o[e]&&(o[e]={}),o[e][t[1]]=n):o[e]=n};case"bracket":return(e,n,o)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==o[e]?o[e]=[].concat(o[e],n):o[e]=[n]:o[e]=n};case"comma":return(e,t,n)=>{const o="string"==typeof t&&t.split("").indexOf(",")>-1?t.split(","):t;n[e]=o};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=Object.assign({decode:!0,arrayFormat:"none"},t)),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const r of e.split("&")){let[e,a]=ve(r.replace(/\+/g," "),"=");a=void 0===a?null:ye(a,t),n(ye(e,t),a,o)}return Object.keys(o).sort().reduce((e,t)=>{const n=o[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}var Ne={extract:we,parse:$e,stringify:(e,t)=>{if(!e)return"";const n=function(e){switch(e.arrayFormat){case"index":return t=>(n,o)=>{const r=n.length;return void 0===o?n:null===o?[...n,[be(t,e),"[",r,"]"].join("")]:[...n,[be(t,e),"[",be(r,e),"]=",be(o,e)].join("")]};case"bracket":return t=>(n,o)=>void 0===o?n:null===o?[...n,[be(t,e),"[]"].join("")]:[...n,[be(t,e),"[]=",be(o,e)].join("")];case"comma":return t=>(n,o,r)=>null==o||0===o.length?n:0===r?[[be(t,e),"=",be(o,e)].join("")]:[[n,be(o,e)].join(",")];default:return t=>(n,o)=>void 0===o?n:null===o?[...n,be(t,e)]:[...n,[be(t,e),"=",be(o,e)].join("")]}}(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),o=Object.keys(e);return!1!==t.sort&&o.sort(t.sort),o.map(o=>{const r=e[o];return void 0===r?"":null===r?be(o,t):Array.isArray(r)?r.reduce(n(o),[]).join("&"):be(o,t)+"="+be(r,t)}).filter(e=>e.length>0).join("&")},parseUrl:(e,t)=>({url:ke(e).split("?")[0]||"",query:$e(we(e),t)})};function xe(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=C(n,"click",P(e.goRoot))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function Ce(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=C(n,"click",P(e.goBranch))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function Pe(t){var n,o,r,s,c,l,i,u,d,m,h,p,g,f,k,x,P=t.msg.value.content.root&&xe(t),M=t.msg.value.content.branch&&Ce(t);return{c(){n=w("div"),o=N(),r=w("div"),s=w("div"),c=w("div"),l=w("label"),i=w("input"),u=N(),d=w("i"),m=$("\n        Like"),h=N(),P&&P.c(),p=N(),M&&M.c(),g=N(),f=w("div"),(k=w("button")).textContent="Reply",n.className="card-body svelte-10kjcnj",R(i,"type","checkbox"),i.checked=t.liked,d.className="form-icon",l.className="form-switch d-inline",c.className="column col-6",k.className="btn",f.className="column col-6 text-right",s.className="columns col-gapless",r.className="card-footer",x=[C(i,"change",t.likeChanged),C(k,"click",t.reply)]},m(e,a){b(e,n,a),n.innerHTML=t.content,b(e,o,a),b(e,r,a),v(r,s),v(s,c),v(c,l),v(l,i),v(l,u),v(l,d),v(l,m),v(c,h),P&&P.m(c,null),v(c,p),M&&M.m(c,null),v(s,g),v(s,f),v(f,k)},p(e,t){e.liked&&(i.checked=t.liked),t.msg.value.content.root?P?P.p(e,t):((P=xe(t)).c(),P.m(c,p)):P&&(P.d(1),P=null),t.msg.value.content.branch?M?M.p(e,t):((M=Ce(t)).c(),M.m(c,null)):M&&(M.d(1),M=null)},i:e,o:e,d(e){e&&(y(n),y(o),y(r)),P&&P.d(),M&&M.d(),a(x)}}}function Me(e,t,n){let{msg:o}=t,r=ssb.markdown(o.value.content.text),a=!1;ssb.votes(o.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",a=!0)})});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,content:r,liked:a,likeChanged:e=>{e.target.checked?ssb.like(o.key).then(()=>console.log("liked",o.key)).catch(()=>{const e=a=!1;return n("liked",a),e}):ssb.unlike(o.key).then(()=>console.log("unliked",o.key)).catch(()=>{const e=a=!0;return n("liked",a),e})},reply:e=>{let t=o.value.content.root||o.key,n=o.value.content.channel,r=o.value.author;jn("/compose",{root:t,branch:o.key,channel:n,replyfeed:r})},goRoot:e=>{let t=o.value.content.root||o.key;jn("/thread",{thread:t})},goBranch:e=>{let t=o.value.content.branch||o.key;jn("/thread",{thread:t})}}}class Re extends ce{constructor(e){super(),se(this,e,Me,Pe,c,["msg"])}}function _e(t){var n,o,r,a;return{c(){n=w("div"),o=w("pre"),r=w("code"),a=$(t.rawContent),o.className="code svelte-1c3kv1x",n.className="card-body"},m(e,t){b(e,n,t),v(n,o),v(o,r),v(r,a)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Te(e,t,n){let{msg:o}=t,r=JSON.stringify(o,null,2);return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,rawContent:r}}class Ie extends ce{constructor(e){super(),se(this,e,Te,_e,c,["msg"])}}function Oe(t){var n,o,r,a,s,c,l,i;return{c(){n=w("div"),o=$(t.person),r=N(),a=$(t.expression),s=N(),c=w("a"),l=$(t.label),c.href="/index.html?thread="+t.encodedid+"#/thread",n.className="card-body",i=C(c,"click",t.goThread)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a),v(n,s),v(n,c),v(c,l)},p(e,t){e.person&&_(o,t.person),e.label&&_(l,t.label)},i:e,o:e,d(e){e&&y(n),i()}}}function Ue(e,t,n){let{msg:o}=t,r=o.value.content.vote.expression,a=o.value.content.vote.link,s=encodeURIComponent(a),c=a,l=o.value.author;ssb.blurbFromMsg(a,100).then(e=>{n("label",c=e)}),ssb.avatar(o.value.author).then(e=>{const t=l=e.name;return n("person",l),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,expression:r,encodedid:s,label:c,person:l,goThread:e=>{e.stopPropagation(),e.preventDefault(),e.ctrlKey?window.open(`?thread=${encodeURIComponent(a)}#/thread`):jn("/thread",{thread:a})}}}class Ae extends ce{constructor(e){super(),se(this,e,Ue,Oe,c,["msg"])}}function Le(t){var n;return{c(){(n=w("div")).innerHTML="<p>🔒 PRIVATE</p>",n.className="card-body"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Fe(e,t,n){let{msg:o}=t;return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o}}class Ee extends ce{constructor(e){super(),se(this,e,Fe,Le,c,["msg"])}}function je(t){var n,o,r,a,s,c,l,i;return{c(){n=w("div"),o=$(t.person),r=N(),a=$(t.verb),s=N(),c=w("a"),l=$(t.otherPersonName),c.href="?feed="+t.otherPersonFeed+"#/profile",n.className="card-body",i=C(c,"click",t.goProfile)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a),v(n,s),v(n,c),v(c,l)},p(e,t){e.person&&_(o,t.person),e.verb&&_(a,t.verb),e.otherPersonName&&_(l,t.otherPersonName)},i:e,o:e,d(e){e&&y(n),i()}}}function Se(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.contact),s=a,c=o.value.content.following?"followed":"unfollowed";o.value.content.blocking&&n("verb",c="blocked"),ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),ssb.avatar(o.value.content.contact).then(e=>{n("otherPersonName",s=e.name)}).catch(e=>console.log(e));return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,otherPersonFeed:a,otherPersonName:s,verb:c,goProfile:e=>{e.stopPropagation(),e.preventDefault(),jn("/profile",{feed:o.value.content.contact})}}}class He extends ce{constructor(e){super(),se(this,e,Se,je,c,["msg"])}}function De(t){var n,o,r,a,s,c,l,i,u;return{c(){n=w("div"),o=$(t.person),r=N(),a=$(t.verb),s=N(),c=w("a"),l=$("#"),i=$(t.channel),c.href="?channel="+t.channel+"#/channel",n.className="card-body",u=C(c,"click",t.goChannel)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a),v(n,s),v(n,c),v(c,l),v(c,i)},p(e,t){e.person&&_(o,t.person)},i:e,o:e,d(e){e&&y(n),u()}}}function Be(e,t,n){let{msg:o}=t,r=o.value.author,a=o.value.content.subscribed?"subscribed":"unsubscribed",s=encodeURIComponent(o.value.content.channel);ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,verb:a,channel:s,goChannel:e=>{e.stopPropagation(),e.preventDefault(),jn("/channel",{channel:o.value.content.channel})}}}class qe extends ce{constructor(e){super(),se(this,e,Be,De,c,["msg"])}}function We(e){var t,n,o;return{c(){t=w("div"),n=$(e.person),o=$(" is doing something related to a gathering but gatherings are not\n      supported yet, sorry."),t.className="toast"},m(e,r){b(e,t,r),v(t,n),v(t,o)},p(e,t){e.person&&_(n,t.person)},d(e){e&&y(t)}}}function ze(e){var t,n,o,r,a,s,c;function l(e){return e.image?Ye:Ve}var i=l(e),u=i(e),d=e.msg.value.content.description&&Je(e);return{c(){t=$(e.person),n=N(),o=$(e.verb),r=N(),a=w("a"),u.c(),s=N(),d&&d.c(),c=x(),a.href="?feed="+e.otherLink+"#/profile"},m(e,l){b(e,t,l),b(e,n,l),b(e,o,l),b(e,r,l),b(e,a,l),u.m(a,null),b(e,s,l),d&&d.m(e,l),b(e,c,l)},p(e,n){e.person&&_(t,n.person),e.verb&&_(o,n.verb),i===(i=l(n))&&u?u.p(e,n):(u.d(1),(u=i(n))&&(u.c(),u.m(a,null))),n.msg.value.content.description?d?d.p(e,n):((d=Je(n)).c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null)},d(e){e&&(y(t),y(n),y(o),y(r),y(a)),u.d(),e&&y(s),d&&d.d(e),e&&y(c)}}}function Ve(e){var t,n;return{c(){t=w("span"),n=$(e.otherName),t.className="chip"},m(e,o){b(e,t,o),v(t,n)},p(e,t){e.otherName&&_(n,t.otherName)},d(e){e&&y(t)}}}function Ye(e){var t,n,o,r;return{c(){t=w("div"),n=w("img"),o=N(),r=$(e.otherName),n.src=e.image,n.className="avatar avatar-sm",n.alt=e.otherName,t.className="chip"},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(e,t){e.otherName&&(n.alt=t.otherName,_(r,t.otherName))},d(e){e&&y(t)}}}function Je(e){var t,n=e.ssb.markdown(e.msg.value.content.description);return{c(){t=w("blockquote")},m(e,o){b(e,t,o),t.innerHTML=n},p(e,o){e.msg&&n!==(n=o.ssb.markdown(o.msg.value.content.description))&&(t.innerHTML=n)},d(e){e&&y(t)}}}function Ke(t){var n;function o(e){return e.isThisAboutFeeds?ze:We}var r=o(t),a=r(t);return{c(){n=w("div"),a.c(),n.className="card-body"},m(e,t){b(e,n,t),a.m(n,null)},p(e,t){r===(r=o(t))&&a?a.p(e,t):(a.d(1),(a=r(t))&&(a.c(),a.m(n,null)))},i:e,o:e,d(e){e&&y(n),a.d()}}}function Ge(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.about),s=o.value.content.name||o.value.content.about,c=!0,l=o.value.content.about===o.value.author?"self-identifies":"identifies";ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),s===o.value.content.about&&ssb.avatar(o.value.content.about).then(e=>{const t=s=e.name;return n("otherName",s),t});let i=!!o.value.content.image&&`http://localhost:8989/blobs/get/${encodeURIComponent(o.value.content.image)}`;return o.value.content.description&&n("verb",l+=" with description"),o.value.content.about.startsWith("%")&&n("isThisAboutFeeds",c=!1),e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,person:r,otherLink:a,otherName:s,isThisAboutFeeds:c,verb:l,image:i,ssb:ssb}}class Qe extends ce{constructor(e){super(),se(this,e,Ge,Ke,c,["msg"])}}function Xe(t){var n,o,r,a,s,c,l,i;return{c(){n=w("div"),o=$(t.person),r=$(" announced pub\n  "),a=w("a"),s=$(t.host),c=$(":"),l=$(t.port),a.href="/index.html?feed="+t.encodedid+"#/profile",n.className="card-body",i=C(a,"click",t.goProfile)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a),v(a,s),v(a,c),v(a,l)},p(e,t){e.person&&_(o,t.person)},i:e,o:e,d(e){e&&y(n),i()}}}function Ze(e,t,n){let{msg:o}=t,r=encodeURIComponent(o.value.content.address.key),a=o.value.author,s=o.value.content.address.host,c=o.value.content.address.port;ssb.avatar(o.value.author).then(e=>{const t=a=e.name;return n("person",a),t});return e.$set=(e=>{"msg"in e&&n("msg",o=e.msg)}),{msg:o,encodedid:r,person:a,host:s,port:c,goProfile:e=>{e.stopPropagation(),e.preventDefault(),jn("/profile",{feed:o.value.content.address.key})}}}class et extends ce{constructor(e){super(),se(this,e,Ze,Xe,c,["msg"])}}function tt(t){var n,o;return{c(){n=w("div"),(o=w("img")).src="http://localhost:8989/blobs/get/"+encodeURIComponent(t.thumbnail),o.className="img-responsive",o.alt=t.title,n.className="card-image"},m(e,t){b(e,n,t),v(n,o)},p:e,d(e){e&&y(n)}}}function nt(t){var n,o;return{c(){n=w("h1"),o=$(t.title),n.className="card-title h5"},m(e,t){b(e,n,t),v(n,o)},p:e,d(e){e&&y(n)}}}function ot(e){var t,n,o;return{c(){t=w("div"),n=$("Can't load blogpost: "),o=$(e.toastMsg),t.className="toast toast-error"},m(e,r){b(e,t,r),v(t,n),v(t,o)},p(e,t){e.toastMsg&&_(o,t.toastMsg)},d(e){e&&y(t)}}}function rt(t){var n,o;return{c(){n=w("noscript"),o=w("noscript")},m(e,r){b(e,n,r),n.insertAdjacentHTML("afterend",t.summary),b(e,o,r)},p:e,d(e){e&&(k(n,o),y(n),y(o))}}}function at(e){var t,n;return{c(){t=w("noscript"),n=w("noscript")},m(o,r){b(o,t,r),t.insertAdjacentHTML("afterend",e.post),b(o,n,r)},p(e,o){e.post&&(k(t,n),t.insertAdjacentHTML("afterend",o.post))},d(e){e&&(k(t,n),y(t),y(n))}}}function st(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=C(n,"click",P(e.goRoot))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function ct(e){var t,n,o,r,a;return{c(){t=w("span"),n=w("a"),o=$("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=C(n,"click",P(e.goBranch))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&y(t),a()}}}function lt(e){var t,n;return{c(){(t=w("button")).textContent="Close Blogpost",t.className="btn btn-primary",T(t,"locating",e.loading),n=C(t,"click",e.click_handler)},m(e,n){b(e,t,n)},p(e,n){e.loading&&T(t,"locating",n.loading)},d(e){e&&y(t),n()}}}function it(e){var t,n;return{c(){(t=w("button")).textContent="Read Blogpost",t.className="btn btn-primary",T(t,"locating",e.loading),n=C(t,"click",e.displayBlogPost)},m(e,n){b(e,t,n)},p(e,n){e.loading&&T(t,"locating",n.loading)},d(e){e&&y(t),n()}}}function ut(t){var n,o,r,s,c,l,i,u,d,m,h,p,g,f,k,x,P,M,_,T,I=t.thumbnail&&tt(t),O=t.title&&nt(t),U=t.toast&&ot(t);function A(e){return e.showBlogpost?at:rt}var L=A(t),F=L(t),E=t.msg.value.content.root&&st(t),j=t.msg.value.content.branch&&ct(t);function S(e){return e.showBlogpost?lt:it}var H=S(t),D=H(t);return{c(){I&&I.c(),n=N(),o=w("div"),O&&O.c(),r=N(),U&&U.c(),s=N(),F.c(),c=N(),l=w("div"),i=w("div"),u=w("div"),d=w("label"),m=w("input"),h=N(),p=w("i"),g=$("\n        Like"),f=N(),E&&E.c(),k=N(),j&&j.c(),x=N(),P=w("div"),(M=w("button")).textContent="Reply",_=N(),D.c(),o.className="card-body",R(m,"type","checkbox"),m.checked=t.liked,p.className="form-icon",d.className="form-switch d-inline",u.className="column col-6",M.className="btn",P.className="column col-6 text-right",i.className="columns col-gapless",l.className="card-footer",T=[C(m,"change",t.likeChanged),C(M,"click",t.reply)]},m(e,t){I&&I.m(e,t),b(e,n,t),b(e,o,t),O&&O.m(o,null),v(o,r),U&&U.m(o,null),v(o,s),F.m(o,null),b(e,c,t),b(e,l,t),v(l,i),v(i,u),v(u,d),v(d,m),v(d,h),v(d,p),v(d,g),v(u,f),E&&E.m(u,null),v(u,k),j&&j.m(u,null),v(i,x),v(i,P),v(P,M),v(P,_),D.m(P,null)},p(e,t){t.thumbnail?I?I.p(e,t):((I=tt(t)).c(),I.m(n.parentNode,n)):I&&(I.d(1),I=null),t.title?O?O.p(e,t):((O=nt(t)).c(),O.m(o,r)):O&&(O.d(1),O=null),t.toast?U?U.p(e,t):((U=ot(t)).c(),U.m(o,s)):U&&(U.d(1),U=null),L===(L=A(t))&&F?F.p(e,t):(F.d(1),(F=L(t))&&(F.c(),F.m(o,null))),e.liked&&(m.checked=t.liked),t.msg.value.content.root?E?E.p(e,t):((E=st(t)).c(),E.m(u,k)):E&&(E.d(1),E=null),t.msg.value.content.branch?j?j.p(e,t):((j=ct(t)).c(),j.m(u,null)):j&&(j.d(1),j=null),H===(H=S(t))&&D?D.p(e,t):(D.d(1),(D=H(t))&&(D.c(),D.m(P,null)))},i:e,o:e,d(e){I&&I.d(e),e&&(y(n),y(o)),O&&O.d(),U&&U.d(),F.d(),e&&(y(c),y(l)),E&&E.d(),j&&j.d(),D.d(),a(T)}}}function dt(e,t,n){let o;l(e,En,e=>{n("$routeLocation",o=e)});let{msg:r}=t,a=r.value.content,s=ssb.markdown(a.summary),c=a.thumbnail||!1,i=a.title||!1,u=!1,d=!1,m=!1,h="",p=s,g=!1;ssb.votes(r.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",g=!0)})});const f=e=>{n("loading",d=!0),console.log("loading blogpost",a.blog),ssb.getBlob(a.blog).then(e=>{n("post",p=ssb.markdown(e)),n("showBlogpost",u=!0)}).catch(e=>{console.error("can't load blog post",e),n("toast",m=!0),n("toastMsg",h=e)})};return"/thread"==o&&setTimeout(f,100),e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,summary:s,thumbnail:c,title:i,showBlogpost:u,loading:d,toast:m,toastMsg:h,post:p,liked:g,likeChanged:e=>{e.target.checked?ssb.like(r.key).then(()=>console.log("liked",r.key)).catch(()=>{const e=g=!1;return n("liked",g),e}):ssb.unlike(r.key).then(()=>console.log("unliked",r.key)).catch(()=>{const e=g=!0;return n("liked",g),e})},displayBlogPost:f,reply:e=>{let t=r.value.content.root||r.key,n=r.value.content.channel;jn("/compose",{root:t,branch:r.key,channel:n})},goRoot:e=>{let t=r.value.content.root||r.key;jn("/thread",{thread:t})},goBranch:e=>{let t=r.value.content.branch||r.key;jn("/thread",{thread:t})},click_handler:function(){const e=u=!1;return n("showBlogpost",u),e}}}class mt extends ce{constructor(e){super(),se(this,e,dt,ut,c,["msg"])}}function ht(e){var t,n,o;return{c(){t=w("span"),n=$(e.name),t.className="chip",o=C(t,"click",e.avatarClick)},m(e,o){b(e,t,o),v(t,n)},p(e,t){e.name&&_(n,t.name)},d(e){e&&y(t),o()}}}function pt(e){var t,n,o,r,a;return{c(){t=w("div"),n=w("img"),o=N(),r=$(e.name),n.src=e.image,n.className="avatar avatar-sm",t.className="chip",a=C(t,"click",e.avatarClick)},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(e,t){e.image&&(n.src=t.image),e.name&&_(r,t.name)},d(e){e&&y(t),a()}}}function gt(t){var n;function o(e){return e.image?pt:ht}var r=o(t),a=r(t);return{c(){a.c(),n=x()},m(e,t){a.m(e,t),b(e,n,t)},p(e,t){r===(r=o(t))&&a?a.p(e,t):(a.d(1),(a=r(t))&&(a.c(),a.m(n.parentNode,n)))},i:e,o:e,d(e){a.d(e),e&&y(n)}}}function ft(e,t,n){let{feed:o}=t,r=!1,a=o;const s=S();return ssb.avatar(o).then(e=>{null!==e.image&&n("image",r=`http://localhost:8989/blobs/get/${e.image}`),n("name",a=e.name)}),e.$set=(e=>{"feed"in e&&n("feed",o=e.feed)}),{feed:o,image:r,name:a,avatarClick:function(){s("avatarClick",{feed:o,name:a})}}}class vt extends ce{constructor(e){super(),se(this,e,ft,gt,c,["feed"])}}var bt=function(){};bt.prototype.simple=function(e){var t=Date.now(),n=Date.parse(e);try{if(n!=n)throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e}catch(t){return console.error(t),e}return n-t<0?function(e){var t=Date.now();e=Date.parse(e);var n=(t-e)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?Math.round(n)+" second ago":Math.round(n)+" seconds ago";if(o<60&&r<1)return 1===o?Math.round(o)+" minute ago":Math.round(o)+" minutes ago";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?Math.ceil(c)+" year ago":Math.ceil(c)+" years ago"}return Math.round(s)+" month ago"}return 1===a?Math.round(a)+" day ago":Math.round(a)+" days ago"}return 1===r?Math.round(r)+" hour ago":Math.round(r)+" hours ago"}(e):function(e){var t=Date.now(),n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"}(e)},bt.prototype.future=function(e){console.warn("timeago-simple: .future function is depricated! Please use .simple for both past and future dates.");var t=Date.now();try{if(Date.parse(e)!=Date.parse(e))throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e;if(Date.parse(e)-t<0)throw"timeago-simple: Looks like it's more relevant case for timeago.simple"}catch(t){return console.error(t),e}var n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"};var yt=new bt;const kt=e=>yt.simple(new Date(e));function wt(e){var t,n,o=e.msg.value.content.channel;return{c(){t=$("#"),n=$(o)},m(e,o){b(e,t,o),b(e,n,o)},p(e,t){e.msg&&o!==(o=t.msg.value.content.channel)&&_(n,o)},d(e){e&&(y(t),y(n))}}}function $t(e){var t;return{c(){t=$("Close raw message")},m(e,n){b(e,t,n)},d(e){e&&y(t)}}}function Nt(e){var t;return{c(){t=$("Show raw message")},m(e,n){b(e,t,n)},d(e){e&&y(t)}}}function xt(t){var n,o,r,a,s,c,l,i,u,d,m,h,p,g,f,k,x,C,P,M,R;return{c(){n=w("div"),o=w("div"),r=w("div"),a=w("pre"),s=w("code"),c=$(t.rawContent),l=N(),i=w("div"),u=w("p"),d=$("This is a message of type\n            "),m=w("em"),h=$(t.type),p=$("\n            ."),g=N(),f=w("p"),k=$("To learn more about it, go to\n            "),x=w("a"),C=$("the documentation about messages with type "),P=$(t.type),R=$("\n            ."),a.className="code",r.className="column col-9",x.target="_blank",x.href=M="/docs/index.html#/message_types/"+t.type,i.className="column col-3",o.className="columns",n.className="card-body"},m(e,t){b(e,n,t),v(n,o),v(o,r),v(r,a),v(a,s),v(s,c),v(o,l),v(o,i),v(i,u),v(u,d),v(u,m),v(m,h),v(u,p),v(i,g),v(i,f),v(f,k),v(f,x),v(x,C),v(x,P),v(f,R)},p(e,t){e.type&&(_(h,t.type),_(P,t.type)),e.type&&M!==(M="/docs/index.html#/message_types/"+t.type)&&(x.href=M)},i:e,o:e,d(e){e&&y(n)}}}function Ct(e){var t,n,o=e.selectedRenderer;function r(e){return{props:{msg:e.msg}}}if(o)var a=new o(r(e));return{c(){a&&a.$$.fragment.c(),t=x()},m(e,o){a&&re(a,e,o),b(e,t,o),n=!0},p(e,n){var s={};if(e.msg&&(s.msg=n.msg),o!==(o=n.selectedRenderer)){if(a){X();const e=a;ee(()=>{e.$destroy()}),e.$$.fragment.o(1),Z()}o?((a=new o(r(n))).$$.fragment.c(),a.$$.fragment.i(1),re(a,t.parentNode,t)):a=null}else o&&a.$set(s)},i(e){n||(a&&a.$$.fragment.i(e),n=!0)},o(e){a&&a.$$.fragment.o(e),n=!1},d(e){e&&y(t),a&&a.$destroy(e)}}}function Pt(e){var t,n,o,r,s,c,l,i,u,d,m,h,p,g,f,k,x,M,R,I,O,U,A,L,F,E,j,S,H,D,B,q,W,z,V,Y,J,K,G,Q,te,ne,oe,re,ae,se,ce=kt(e.msg.value.timestamp),le=e.msg.value.content.channel&&wt(e);function ie(e){return e.showRaw?$t:Nt}var ue=ie(e),de=ue(e),me=[Ct,xt],he=[];function pe(e){return e.showRaw?1:0}return oe=pe(e),re=he[oe]=me[oe](e),{c(){t=w("div"),n=w("div"),o=w("div"),r=w("div"),s=w("div"),c=w("div"),l=w("div"),i=w("img"),u=N(),d=w("div"),m=w("div"),h=$(e.name),p=N(),g=w("small"),f=$(ce),k=N(),x=w("div"),M=w("span"),le&&le.c(),R=N(),I=w("div"),(O=w("span")).innerHTML='<i class="icon icon-more-vert"></i>',U=N(),A=w("ul"),L=w("li"),F=w("a"),E=w("i"),j=$("\n              Open in new tab"),H=N(),D=w("li"),(B=w("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy permalink to clipboard\n\t\t\t            ',q=N(),W=w("li"),(z=w("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy message id to clipboard\n\t\t\t            ',V=N(),Y=w("li"),J=N(),K=w("li"),G=w("a"),Q=w("i"),te=N(),de.c(),ne=N(),re.c(),i.src=e.image,i.className="avatar avatar-lg",i.alt=e.feed,l.className="example-tile-icon",c.className="tile-icon",m.className="tile-title",g.className="tile-subtitle text-gray",d.className="tile-content",s.className="tile tile-centered feed-display svelte-17ozi8u",r.className="card-title",o.className="float-left",M.className="text-gray channel-display svelte-17ozi8u",O.className="btn btn-link dropdown-toggle",O.tabIndex="0",T(O,"active",e.dropdownActive),E.className="icon icon-share",F.href=S="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",F.target="_blank",L.className="menu-item",B.href="#",D.className="menu-item",z.href="#",W.className="menu-item",Y.className="divider",Y.dataset.content="FOR THE CURIOUS",Q.className="icon icon-message",G.href="#",K.className="menu-item",A.className="menu menu-right svelte-17ozi8u",I.className="dropdown",x.className="float-right",n.className="card-header",t.className="card m-2",se=[C(s,"click",e.goProfile),C(M,"click",e.click_handler),C(O,"click",e.click_handler_1),C(B,"click",P(e.copyPermalink)),C(z,"click",P(e.copyHash)),C(G,"click",P(e.toggleRawMessage))]},m(e,a){b(e,t,a),v(t,n),v(n,o),v(o,r),v(r,s),v(s,c),v(c,l),v(l,i),v(s,u),v(s,d),v(d,m),v(m,h),v(d,p),v(d,g),v(g,f),v(n,k),v(n,x),v(x,M),le&&le.m(M,null),v(x,R),v(x,I),v(I,O),v(I,U),v(I,A),v(A,L),v(L,F),v(F,E),v(F,j),v(A,H),v(A,D),v(D,B),v(A,q),v(A,W),v(W,z),v(A,V),v(A,Y),v(A,J),v(A,K),v(K,G),v(G,Q),v(G,te),de.m(G,null),v(t,ne),he[oe].m(t,null),ae=!0},p(e,n){ae&&!e.image||(i.src=n.image),ae&&!e.name||_(h,n.name),ae&&!e.msg||ce===(ce=kt(n.msg.value.timestamp))||_(f,ce),n.msg.value.content.channel?le?le.p(e,n):((le=wt(n)).c(),le.m(M,null)):le&&(le.d(1),le=null),e.dropdownActive&&T(O,"active",n.dropdownActive),ae&&!e.msg||S===(S="?thread="+n.encodeURIComponent(n.msg.key)+"#/thread")||(F.href=S),ue!==(ue=ie(n))&&(de.d(1),(de=ue(n))&&(de.c(),de.m(G,null)));var o=oe;(oe=pe(n))===o?he[oe].p(e,n):(X(),ee(()=>{he[o].d(1),he[o]=null}),re.o(1),Z(),(re=he[oe])||(re=he[oe]=me[oe](n)).c(),re.i(1),re.m(t,null))},i(e){ae||(re&&re.i(),ae=!0)},o(e){re&&re.o(),ae=!1},d(e){e&&y(t),le&&le.d(),de.d(),he[oe].d(),a(se)}}}function Mt(e,t,n){let o,r,{msg:a}=t,s=a.value.author,c=!1,l=JSON.stringify(a,null,2),i=!1,u={"*":Ie,post:Re,vote:Ae,private:Ee,contact:He,channel:qe,about:Qe,pub:et,blog:mt};"string"==typeof a.value.content?n("type",o="private"):n("type",o=a.value.content.type),u.hasOwnProperty(o)?n("selectedRenderer",r=u[o]):n("selectedRenderer",r=u["*"]);let d="images/icon.png",m=s;ssb.avatar(s).then(e=>{null!==e.image&&n("image",d=`http://localhost:8989/blobs/get/${e.image}`),n("name",m=e.name)});return e.$set=(e=>{"msg"in e&&n("msg",a=e.msg)}),{msg:a,type:o,feed:s,showRaw:c,rawContent:l,dropdownActive:i,selectedRenderer:r,image:d,name:m,toggleRawMessage:()=>{n("showRaw",c=!c),n("dropdownActive",i=!1)},copyPermalink:()=>{navigator.clipboard.writeText(`ssb:${a.key}`).then(()=>console.log("permalink copied")).catch(e=>console.error("can't copy permalink",e)),n("dropdownActive",i=!1)},copyHash:()=>{navigator.clipboard.writeText(`${a.key}`).then(()=>console.log("hash copied")).catch(e=>console.error("can't copy hash",e)),n("dropdownActive",i=!1)},goProfile:e=>{e.ctrlKey?window.open(`?feed=${encodeURIComponent(s)}#/profile`):jn("/profile",{feed:s})},encodeURIComponent:encodeURIComponent,click_handler:function(){return jn("/channel",{channel:a.value.content.channel})},click_handler_1:function(){const e=i=!i;return n("dropdownActive",i),e}}}class Rt extends ce{constructor(e){super(),se(this,e,Mt,Pt,c,["msg"])}}function _t(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Tt(t){var n,o,r;return{c(){n=w("div"),o=$("Error: "),r=$(t.error),n.className="toast toast-error"},m(e,t){b(e,n,t),v(n,o),v(n,r)},p:e,d(e){e&&y(n)}}}function It(e){var t,n,o,r,s,c,l,i,u,d=[],m=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=_t(e,h,g),n=p(t);m.set(n,d[g]=Ut(n,t))}return{c(){for(g=0;g<d.length;g+=1)d[g].c();t=N(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=N(),c=w("li"),(l=w("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",l.href="#/public",c.className="page-item page-next",n.className="pagination",u=[C(r,"click",M(P(e.click_handler_1))),C(l,"click",M(P(e.click_handler_2)))]},m(e,a){for(g=0;g<d.length;g+=1)d[g].m(e,a);b(e,t,a),b(e,n,a),v(n,o),v(o,r),v(n,s),v(n,c),v(c,l),i=!0},p(e,n){const o=n.msgs;X(),d=oe(d,e,p,1,n,o,m,t.parentNode,ne,Ut,t,_t),Z()},i(e){if(!i){for(var t=0;t<h.length;t+=1)d[t].i();i=!0}},o(e){for(g=0;g<d.length;g+=1)d[g].o();i=!1},d(e){for(g=0;g<d.length;g+=1)d[g].d(e);e&&(y(t),y(n)),a(u)}}}function Ot(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Ut(e,t){var n,o,r=new Rt({props:{msg:t.msg}});return{key:e,first:null,c(){n=x(),r.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),re(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function At(e){var t,n,o,r,s,c,l,i,u,d,m,h,p,g,f,k,P,M,I,O,U,A,L,F,E,j,S,H,D,B,q=e.opts.limit,W=e.error&&Tt(e),z=[Ot,It],V=[];function Y(e){return e.msgs?1:0}return j=Y(e),S=V[j]=z[j](e),{c(){t=w("div"),n=w("div"),(o=w("h4")).textContent="Public Feed",r=N(),s=w("div"),c=w("div"),(l=w("span")).innerHTML='<i class="icon icon-more-horiz text-gray"></i>',i=N(),u=w("ul"),d=w("li"),m=w("label"),h=w("input"),p=N(),g=w("i"),f=$("\n              Show Only Roots"),k=N(),P=w("li"),M=w("label"),I=$("Fetch "),O=$(q),U=$(" messages"),A=N(),L=w("input"),F=N(),W&&W.c(),E=N(),S.c(),H=x(),o.className="column",l.className="btn btn-link dropdown-toggle",l.tabIndex="0",T(l,"active",e.dropdownActive),R(h,"type","checkbox"),g.className="form-icon",m.className="form-checkbox",d.className="menu-item",M.className="form-label",M.htmlFor="input-example-1",L.className="slider tooltip",R(L,"type","range"),L.min="10",L.max="100",L.value="50",P.className="menu-item",u.className="menu menu-right svelte-72ihda",c.className="dropdown float-right",s.className="column",n.className="columns",t.className="container",B=[C(l,"click",e.click_handler),C(h,"change",e.input0_change_handler),C(L,"change",e.input1_change_input_handler),C(L,"input",e.input1_change_input_handler)]},m(a,y){b(a,t,y),v(t,n),v(n,o),v(n,r),v(n,s),v(s,c),v(c,l),v(c,i),v(c,u),v(u,d),v(d,m),v(m,h),h.checked=e.onlyRoots,v(m,p),v(m,g),v(m,f),v(u,k),v(u,P),v(P,M),v(M,I),v(M,O),v(M,U),v(P,A),v(P,L),L.value=e.opts.limit,b(a,F,y),W&&W.m(a,y),b(a,E,y),V[j].m(a,y),b(a,H,y),D=!0},p(e,t){e.dropdownActive&&T(l,"active",t.dropdownActive),e.onlyRoots&&(h.checked=t.onlyRoots),D&&!e.opts||q===(q=t.opts.limit)||_(O,q),e.opts&&(L.value=t.opts.limit),t.error?W?W.p(e,t):((W=Tt(t)).c(),W.m(E.parentNode,E)):W&&(W.d(1),W=null);var n=j;(j=Y(t))===n?V[j].p(e,t):(X(),ee(()=>{V[n].d(1),V[n]=null}),S.o(1),Z(),(S=V[j])||(S=V[j]=z[j](t)).c(),S.i(1),S.m(H.parentNode,H))},i(e){D||(S&&S.i(),D=!0)},o(e){S&&S.o(),D=!1},d(e){e&&(y(t),y(F)),W&&W.d(e),e&&y(E),V[j].d(e),e&&y(H),a(B)}}}function Lt(e,t,n){let o;l(e,Fn,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s=!1,c={limit:o.limit||10,reverse:!0},i=o.onlyRoots||!1;return e.$$.update=((e={opts:1,$routeParams:1,onlyRoots:1,error:1})=>{if(e.opts||e.$routeParams||e.onlyRoots||e.error){Object.assign(c,o),document.title="Patchfox - Public",c.hasOwnProperty("lt")&&(c.lt=parseInt(c.lt),n("opts",c),n("$routeParams",o),n("onlyRoots",i),n("error",a)),c.hasOwnProperty("limit")&&(c.limit=parseInt(c.limit),n("opts",c),n("$routeParams",o),n("onlyRoots",i),n("error",a));ssb.public(c,{onlyRoots:i}).then(e=>{n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}}),{msgs:r,error:a,dropdownActive:s,opts:c,onlyRoots:i,click_handler:function(){const e=s=!s;return n("dropdownActive",s),e},input0_change_handler:function(){i=this.checked,n("onlyRoots",i)},input1_change_input_handler:function(){var e;c.limit=""===(e=this.value)?void 0:+e,n("opts",c),n("$routeParams",o),n("onlyRoots",i),n("error",a)},click_handler_1:function(){return history.back()},click_handler_2:function(){return jn("/public",{lt:r[r.length-1].rts,limit:c.limit,onlyRoots:c.onlyRoots})}}}function Ft(t){var n;return{c(){(n=w("div")).className="empty"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Et(e){return e.stopPropagation(),e.preventDefault(),!1}var jt=function(e,t){e.addEventListener("dragenter",Et,!1),e.addEventListener("dragover",Et,!1),e.addEventListener("drop",function(e,t){t.stopPropagation(),t.preventDefault(),e(Array.prototype.slice.call(t.dataTransfer.files))}.bind(void 0,t),!1)};function St(e){const t=e-1;return t*t*t+1}function Ht(e,{delay:t=0,duration:n=400,easing:o=St}){const r=getComputedStyle(e),a=+r.opacity,s=parseFloat(r.height),c=parseFloat(r.paddingTop),l=parseFloat(r.paddingBottom),i=parseFloat(r.marginTop),u=parseFloat(r.marginBottom),d=parseFloat(r.borderTopWidth),m=parseFloat(r.borderBottomWidth);return{delay:t,duration:n,easing:o,css:e=>"overflow: hidden;"+`opacity: ${Math.min(20*e,1)*a};`+`height: ${e*s}px;`+`padding-top: ${e*c}px;`+`padding-bottom: ${e*l}px;`+`margin-top: ${e*i}px;`+`margin-bottom: ${e*u}px;`+`border-top-width: ${e*d}px;`+`border-bottom-width: ${e*m}px;`}}function Dt(e){var t;function n(e){return e.error?qt:Bt}var o=n(e),r=o(e);return{c(){r.c(),t=x()},m(e,n){r.m(e,n),b(e,t,n)},p(e,a){o===(o=n(a))&&r?r.p(e,a):(r.d(1),(r=o(a))&&(r.c(),r.m(t.parentNode,t)))},d(e){r.d(e),e&&y(t)}}}function Bt(e){var t,n,o,r,a;return{c(){t=w("div"),n=$("Your message has been posted. Do you want to\n            "),o=w("a"),r=$("Check it out?"),o.target="_blank",o.href=a="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",t.className="toast toast-success"},m(e,a){b(e,t,a),v(t,n),v(t,o),v(o,r)},p(e,t){e.msg&&a!==(a="?thread="+t.encodeURIComponent(t.msg.key)+"#/thread")&&(o.href=a)},d(e){e&&y(t)}}}function qt(e){var t,n;return{c(){t=w("div"),n=$(e.msg),t.className="toast toast-error"},m(e,o){b(e,t,o),v(t,n)},p(e,t){e.msg&&_(n,t.msg)},d(e){e&&y(t)}}}function Wt(t){var n,o,r,s,c,l,i,u,d,m,h,p,g,f,$,x,P,M=t.ssb.markdown(t.content),R=(t.channel||t.root||t.branch)&&Vt(t);return{c(){n=w("div"),(o=w("h2")).textContent="Post preview",r=N(),R&&R.c(),s=N(),c=w("noscript"),l=w("noscript"),i=N(),u=w("div"),d=N(),m=w("div"),(h=w("div")).innerHTML='<span class="label label-warning">\n\t\t\t                This message will be public and can\'t be edited or deleted\n\t\t\t              </span>',p=N(),g=w("div"),(f=w("button")).textContent="Go Back",$=N(),(x=w("button")).textContent="Post",u.className="divider",h.className="column col-md-12 col-lg-10",f.className="btn",x.className="btn btn-primary",T(x,"loading",t.posting),g.className="column col-md-12 col-lg-2",m.className="columns",n.className="column col-md-12",P=[C(f,"click",t.click_handler),C(x,"click",t.post)]},m(e,t){b(e,n,t),v(n,o),v(n,r),R&&R.m(n,null),v(n,s),v(n,c),c.insertAdjacentHTML("afterend",M),v(n,l),v(n,i),v(n,u),v(n,d),v(n,m),v(m,h),v(m,p),v(m,g),v(g,f),v(g,$),v(g,x)},p(e,t){t.channel||t.root||t.branch?R?R.p(e,t):((R=Vt(t)).c(),R.m(n,s)):R&&(R.d(1),R=null),e.content&&M!==(M=t.ssb.markdown(t.content))&&(k(c,l),c.insertAdjacentHTML("afterend",M)),e.posting&&T(x,"loading",t.posting)},i:e,o:e,d(e){e&&y(n),R&&R.d(),a(P)}}}function zt(n){var o,r,s,c,l,i,d,m,h,p,g,k,$,x,_,I,O,U,F,E,j,S,H=n.branch&&Gt(n),D=n.replyfeed&&Qt(n);return{c(){o=w("div"),(r=w("label")).textContent="Channel",s=N(),c=w("input"),l=N(),H&&H.c(),i=N(),D&&D.c(),d=N(),(m=w("label")).textContent="Message",h=N(),p=w("textarea"),g=N(),k=w("br"),$=N(),x=w("input"),_=N(),(I=w("button")).textContent="Attach File",O=N(),(U=w("button")).textContent="Preview",r.className="form-label",r.htmlFor="channel",c.className="form-input",R(c,"type","text"),c.id="channel",c.placeholder="channel",m.className="form-label",m.htmlFor="content",p.className="form-input svelte-1kmc4x",p.id="content",p.placeholder="Type in your post",p.rows="10",T(p,"file-on-top",n.fileOnTop),R(x,"type","file"),x.id="fileInput",x.className="svelte-1kmc4x",I.className="btn",U.className="btn btn-primary float-right",o.className="form-group",S=[C(c,"input",n.input0_input_handler),C(p,"input",n.textarea_input_handler),C(p,"dragover",M(P(n.dragOver))),C(p,"dragleave",M(P(n.dragLeave))),C(x,"input",n.attachFile),C(I,"click",n.attachFileTrigger),C(U,"click",n.preview)]},m(e,t){b(e,o,t),v(o,r),v(o,s),v(o,c),c.value=n.channel,v(o,l),H&&H.m(o,null),v(o,i),D&&D.m(o,null),v(o,d),v(o,m),v(o,h),v(o,p),p.value=n.content,v(o,g),v(o,k),v(o,$),v(o,x),v(o,_),v(o,I),v(o,O),v(o,U),j=!0},p(e,t){e.channel&&c.value!==t.channel&&(c.value=t.channel),t.branch?H?H.p(e,t):((H=Gt(t)).c(),H.m(o,i)):H&&(H.d(1),H=null),t.replyfeed?D?(D.p(e,t),D.i(1)):((D=Qt(t)).c(),D.i(1),D.m(o,d)):D&&(X(),ee(()=>{D.d(1),D=null}),D.o(1),Z()),e.content&&(p.value=t.content),e.fileOnTop&&T(p,"file-on-top",t.fileOnTop)},i(n){j||(D&&D.i(),V(()=>{E&&E.end(1),F||(F=function(n,o,r){let a,s,c=o(n,r),l=!1,i=0;function d(){a&&L(n,a)}function m(){const{delay:o=0,duration:r=300,easing:m=t,tick:h=e,css:p}=c;p&&(a=A(n,0,1,r,o,m,p,i++)),h(0,1);const g=u()+o,v=g+r;s&&s.abort(),l=!0,s=f(e=>{if(l){if(e>=v)return h(1,0),d(),l=!1;if(e>=g){const t=m((e-g)/r);h(t,1-t)}}return l})}let h=!1;return{start(){h||(L(n),"function"==typeof c?(c=c(),Q().then(m)):m())},invalidate(){h=!1},end(){l&&(d(),l=!1)}}}(o,Ht,{})),F.start()}),j=!0)},o(n){D&&D.o(),F&&F.invalidate(),n&&(E=function(n,o,r){let s,c=o(n,r),l=!0;const i=G;function d(){const{delay:o=0,duration:r=300,easing:d=t,tick:m=e,css:h}=c;h&&(s=A(n,1,0,r,o,d,h));const p=u()+o,g=p+r;f(e=>{if(l){if(e>=g)return m(0,1),--i.remaining||a(i.callbacks),!1;if(e>=p){const t=d((e-p)/r);m(1-t,t)}}return l})}return i.remaining+=1,"function"==typeof c?Q().then(()=>{c=c(),d()}):d(),{end(e){e&&c.tick&&c.tick(1,0),l&&(s&&L(n,s),l=!1)}}}(o,Ht,{})),j=!1},d(e){e&&y(o),H&&H.d(),D&&D.d(),e&&E&&E.end(),a(S)}}}function Vt(e){var t,n,o,r=e.channel&&Yt(e),a=e.root&&Jt(e),s=e.branch&&Kt(e);return{c(){t=w("blockquote"),r&&r.c(),n=N(),a&&a.c(),o=N(),s&&s.c()},m(e,c){b(e,t,c),r&&r.m(t,null),v(t,n),a&&a.m(t,null),v(t,o),s&&s.m(t,null)},p(e,c){c.channel?r?r.p(e,c):((r=Yt(c)).c(),r.m(t,n)):r&&(r.d(1),r=null),c.root?a?a.p(e,c):((a=Jt(c)).c(),a.m(t,o)):a&&(a.d(1),a=null),c.branch?s?s.p(e,c):((s=Kt(c)).c(),s.m(t,null)):s&&(s.d(1),s=null)},d(e){e&&y(t),r&&r.d(),a&&a.d(),s&&s.d()}}}function Yt(e){var t,n,o,r,a=e.channel.startsWith("#")?e.channel.slice(1):e.channel;return{c(){t=w("p"),(n=w("b")).textContent="Channel:",o=N(),r=$(a)},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(e,t){e.channel&&a!==(a=t.channel.startsWith("#")?t.channel.slice(1):t.channel)&&_(r,a)},d(e){e&&y(t)}}}function Jt(t){var n,o,r,a;return{c(){n=w("p"),(o=w("b")).textContent="Root:",r=N(),a=$(t.root)},m(e,t){b(e,n,t),v(n,o),v(n,r),v(n,a)},p:e,d(e){e&&y(n)}}}function Kt(e){var t,n,o,r;return{c(){t=w("p"),(n=w("b")).textContent="In Reply To:",o=N(),r=$(e.branch)},m(e,a){b(e,t,a),v(t,n),v(t,o),v(t,r)},p(e,t){e.branch&&_(r,t.branch)},d(e){e&&y(t)}}}function Gt(e){var t,n,o,r;return{c(){(t=w("label")).textContent="In reply to",n=N(),o=w("input"),t.className="form-label",t.htmlFor="reply-to",o.className="form-input",R(o,"type","text"),o.id="reply-to",o.placeholder="in reply to",r=C(o,"input",e.input_input_handler)},m(r,a){b(r,t,a),b(r,n,a),b(r,o,a),o.value=e.branch},p(e,t){e.branch&&o.value!==t.branch&&(o.value=t.branch)},d(e){e&&(y(t),y(n),y(o)),r()}}}function Qt(e){var t,n,o,r,a=new vt({props:{feed:e.replyfeed}});return a.$on("avatarClick",e.avatarClick),{c(){t=w("div"),n=w("span"),o=$("Click the avatar to add a link to the message:\n                "),a.$$.fragment.c(),t.className="mt-2"},m(e,s){b(e,t,s),v(t,n),v(n,o),re(a,n,null),r=!0},p(e,t){var n={};e.replyfeed&&(n.feed=t.replyfeed),a.$set(n)},i(e){r||(a.$$.fragment.i(e),r=!0)},o(e){a.$$.fragment.o(e),r=!1},d(e){e&&y(t),a.$destroy()}}}function Xt(e){var t,n,o,r,a,s,c,l=e.msg&&Dt(e),i=[zt,Wt],u=[];function d(e){return e.showPreview?1:0}return a=d(e),s=u[a]=i[a](e),{c(){t=w("div"),n=w("div"),o=w("div"),l&&l.c(),r=N(),s.c(),o.className="column",n.className="columns",t.className="container"},m(e,s){b(e,t,s),v(t,n),v(n,o),l&&l.m(o,null),v(o,r),u[a].m(o,null),c=!0},p(e,t){t.msg?l?l.p(e,t):((l=Dt(t)).c(),l.m(o,r)):l&&(l.d(1),l=null);var n=a;(a=d(t))===n?u[a].p(e,t):(X(),ee(()=>{u[n].d(1),u[n]=null}),s.o(1),Z(),(s=u[a])||(s=u[a]=i[a](t)).c(),s.i(1),s.m(o,null))},i(e){c||(s&&s.i(),c=!0)},o(e){s&&s.o(),c=!1},d(e){e&&y(t),l&&l.d(),u[a].d()}}}function Zt(e,t,n){let o;l(e,Fn,e=>{n("$routeParams",o=e)});let r=!1,a=!1,s=!1,c=!1,i=o.root,u=o.branch,d=o.channel||"",m=o.content||"",h=o.replyfeed||!1,p=!1,g=hermiebox.modules.pullStream,f=hermiebox.modules.pullFileReader,v=hermiebox.sbot;document.title="Patchfox - compose",j(()=>{n("error",s=!1),n("msg",a=""),jt(document.getElementById("content"),e=>b(e))});const b=e=>{if(n("error",s=!1),n("msg",a=""),0==e.length)return n("fileOnTop",p=!1),console.log("this is not a file"),!1;var t=e[0];return console.log(t),t.type.startsWith("image")?t.size>=5e6?(n("error",s=!0),n("msg",a=`File too large: ${Math.floor(t.size/1048576,2)}mb when max size is 5mb`),!1):void g(f(t),v.blobs.add(function(e,o){e?(n("error",s=!0),n("msg",a="Couldn't attach file: "+e)):n("content",m+=` ![${t.name}](${o})`),n("fileOnTop",p=!1)})):(n("error",s=!0),n("msg",a=`You can only drag & drop image, this file is a ${t.type}`),!1)};return{showPreview:r,msg:a,error:s,posting:c,root:i,branch:u,channel:d,content:m,replyfeed:h,fileOnTop:p,post:async e=>{if(e.stopPropagation(),e.preventDefault(),!c){n("posting",c=!0),d.startsWith("#")&&n("channel",d=d.slice(1));try{n("msg",a=await ssb.newPost({text:m,channel:d,root:i,branch:u})),n("posting",c=!1),console.log("posted",a),window.scrollTo(0,0)}catch(e){n("error",s=!0),n("msg",a=`Couldn't post your message: ${e}`),window.scrollTo(0,0),"stream is closed"==a.message&&(n("msg",a+=". We lost connection to sbot. We'll try to restablish it..."),zn().then(()=>{n("showPreview",r=!1),n("posting",c=!1),n("error",s=!1),n("msg",a="Connection to sbot reestablished. Try posting again")}).catch(e=>{window.location.search=`?root=${encodeURIComponent(i)}&branch=${encodeURIComponent(u)}&content=${encodeURIComponent(m)}&channel=${encodeURIComponent(d)}`,n("msg",a=`Sorry, couldn't reconnect to sbot:${e}. Try reloading the page. Your content has been saved to the URL`)}))}}},preview:e=>{n("showPreview",r=!0)},avatarClick:e=>{let t=e.detail.feed,o=e.detail.name;m.length>0?n("content",m+=` [${o}](${t})`):n("content",m=`[${o}](${t})`)},dragOver:e=>{n("fileOnTop",p=!0)},dragLeave:e=>{n("fileOnTop",p=!1)},attachFileTrigger:()=>{document.getElementById("fileInput").click()},attachFile:e=>{const t=e.target.files;b(t)},ssb:ssb,encodeURIComponent:encodeURIComponent,input0_input_handler:function(){d=this.value,n("channel",d)},input_input_handler:function(){u=this.value,n("branch",u)},textarea_input_handler:function(){m=this.value,n("content",m)},click_handler:function(){const e=r=!1;return n("showPreview",r),e}}}function en(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function tn(e){var t,n,o,r,a,s,c;return{c(){t=w("div"),n=$("Couldn't load thead\n    "),o=w("a"),r=$(e.msgid),s=$("\n    : "),c=$(e.error),o.href=a="?thread="+e.msgid+"#/thread",t.className="toast toast-error"},m(e,a){b(e,t,a),v(t,n),v(t,o),v(o,r),v(t,s),v(t,c)},p(e,t){e.msgid&&_(r,t.msgid),e.msgid&&a!==(a="?thread="+t.msgid+"#/thread")&&(o.href=a),e.error&&_(c,t.error)},d(e){e&&y(t)}}}function nn(e){var t,n,o=[],r=new Map,a=e.msgs;const s=e=>e.msg.key;for(var c=0;c<a.length;c+=1){let t=en(e,a,c),n=s(t);r.set(n,o[c]=rn(n,t))}return{c(){for(c=0;c<o.length;c+=1)o[c].c();t=x()},m(e,r){for(c=0;c<o.length;c+=1)o[c].m(e,r);b(e,t,r),n=!0},p(e,n){const a=n.msgs;X(),o=oe(o,e,s,1,n,a,r,t.parentNode,ne,rn,t,en),Z()},i(e){if(!n){for(var t=0;t<a.length;t+=1)o[t].i();n=!0}},o(e){for(c=0;c<o.length;c+=1)o[c].o();n=!1},d(e){for(c=0;c<o.length;c+=1)o[c].d(e);e&&y(t)}}}function on(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function rn(e,t){var n,o,r=new Rt({props:{msg:t.msg}});return{key:e,first:null,c(){n=x(),r.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),re(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function an(e){var t,n,o,r,a,s,c,l,i,u,d,m=e.error&&tn(e),h=[on,nn],p=[];function g(e){return e.msgs||e.error?1:0}return l=g(e),i=p[l]=h[l](e),{c(){t=w("div"),n=w("h4"),o=$("Thread\n    "),r=w("small"),a=$(e.msgid),s=N(),m&&m.c(),c=N(),i.c(),u=x(),r.className="label hide-sm",t.className="container"},m(e,i){b(e,t,i),v(t,n),v(n,o),v(n,r),v(r,a),b(e,s,i),m&&m.m(e,i),b(e,c,i),p[l].m(e,i),b(e,u,i),d=!0},p(e,t){d&&!e.msgid||_(a,t.msgid),t.error?m?m.p(e,t):((m=tn(t)).c(),m.m(c.parentNode,c)):m&&(m.d(1),m=null);var n=l;(l=g(t))===n?p[l].p(e,t):(X(),ee(()=>{p[n].d(1),p[n]=null}),i.o(1),Z(),(i=p[l])||(i=p[l]=h[l](t)).c(),i.i(1),i.m(u.parentNode,u))},i(e){d||(i&&i.i(),d=!0)},o(e){i&&i.o(),d=!1},d(e){e&&(y(t),y(s)),m&&m.d(e),e&&y(c),p[l].d(e),e&&y(u)}}}function sn(e,t,n){let o;l(e,Fn,e=>{n("$routeParams",o=e)});let r,a=!1,s=!1;return e.$$.update=((e={$routeParams:1,msgid:1})=>{if(e.$routeParams||e.msgid){n("msgid",r=o.thread),r.startsWith("ssb:")&&n("msgid",r=r.replace("ssb:","")),document.title=`Patchfox - Thread: ${r}`;ssb.thread(r).then(e=>{n("msgs",a=e),window.scrollTo(0,0)}).catch(e=>{console.dir(e),n("error",s=e.message)})}}),{msgs:a,error:s,msgid:r}}function cn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function ln(t){var n,o,r,a=t.n.message;return{c(){n=w("p"),o=$("Error: "),r=$(a)},m(e,t){b(e,n,t),v(n,o),v(n,r)},p(e,t){(e.p1||e.p2)&&a!==(a=t.n.message)&&_(r,a)},i:e,o:e,d(e){e&&y(n)}}}function un(e){var t,n,o,r,a,s,c,l,i,u,d,m,h,p=e.ssb.markdown(e.description),g=[],f=new Map,k=e.lastMsgs;const x=e=>e.msg.key;for(var C=0;C<k.length;C+=1){let t=cn(e,k,C),n=x(t);f.set(n,g[C]=dn(n,t))}return{c(){for(t=w("div"),n=w("div"),o=w("img"),a=N(),s=w("div"),c=w("h1"),l=$(e.name),i=N(),u=w("p"),d=N(),m=w("div"),C=0;C<g.length;C+=1)g[C].c();o.className="img-responsive",o.src=r="http://localhost:8989/blobs/get/"+e.image,o.alt=e.feed,n.className="column col-6",s.className="column col-6",t.className="columns"},m(e,r){for(b(e,t,r),v(t,n),v(n,o),v(t,a),v(t,s),v(s,c),v(c,l),v(s,i),v(s,u),u.innerHTML=p,b(e,d,r),b(e,m,r),C=0;C<g.length;C+=1)g[C].m(m,null);h=!0},p(e,t){h&&!e.image||r===(r="http://localhost:8989/blobs/get/"+t.image)||(o.src=r),h&&!e.feed||(o.alt=t.feed),h&&!e.name||_(l,t.name),h&&!e.description||p===(p=t.ssb.markdown(t.description))||(u.innerHTML=p);const n=t.lastMsgs;X(),g=oe(g,e,x,1,t,n,f,m,ne,dn,null,cn),Z()},i(e){if(!h){for(var t=0;t<k.length;t+=1)g[t].i();h=!0}},o(e){for(C=0;C<g.length;C+=1)g[C].o();h=!1},d(e){for(e&&(y(t),y(d),y(m)),C=0;C<g.length;C+=1)g[C].d()}}}function dn(e,t){var n,o,r=new Rt({props:{msg:t.msg}});return{key:e,first:null,c(){n=x(),r.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),re(r,e,t),o=!0},p(e,t){var n={};e.lastMsgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function mn(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function hn(e){var t,o,r;let a={ctx:e,current:null,pending:mn,then:un,catch:ln,value:"null",error:"n",blocks:Array(3)};return te(o=e.p1&&e.p2,a),{c(){t=w("div"),a.block.c(),t.className="container"},m(e,n){b(e,t,n),a.block.m(t,a.anchor=null),a.mount=(()=>t),a.anchor=null,r=!0},p(t,r){e=r,a.ctx=e,("p1"in t||"p2"in t)&&o!==(o=e.p1&&e.p2)&&te(o,a)||a.block.p(t,n(n({},e),a.resolved))},i(e){r||(a.block.i(),r=!0)},o(e){for(let e=0;e<3;e+=1){const t=a.blocks[e];t&&t.o()}r=!1},d(e){e&&y(t),a.block.d(),a=null}}}function pn(e,t,n){let o;l(e,Fn,e=>{n("$routeParams",o=e)});let r,a,s,c,i,u,d=!1,m=[];return n("feed",s=o.feed),s||n("feed",s=ssb.feed),document.title=`Patchfox - Feed: ${s}`,console.log("fetching",s),n("p1",i=ssb.avatar(s).then(e=>{n("name",r=e.name),n("image",a=e.image),document.title=`Patchfox - Feed: ${r}`})),n("p2",u=ssb.profile(s).then(e=>{c=e.about.reverse().find(e=>{return e.value.content.hasOwnProperty("description")}),e.hasOwnProperty("msgs")&&n("lastMsgs",m=e.msgs);try{n("description",d=c.value.content.description)}catch(e){n("description",d="")}window.scrollTo(0,0)})),{description:d,name:r,image:a,feed:s,lastMsgs:m,p1:i,p2:u,ssb:ssb}}function gn(e){var t,n,o;return{c(){t=w("div"),n=$(e.msg),t.className=o="toast "+e.toastClass},m(e,o){b(e,t,o),v(t,n)},p(e,r){e.msg&&_(n,r.msg),e.toastClass&&o!==(o="toast "+r.toastClass)&&(t.className=o)},d(e){e&&y(t)}}}function fn(e){var t,n,o,r,a=e.cta.label;return{c(){t=w("li"),n=w("a"),o=$(a),n.href="#",r=C(n,"click",M(P(e.cta.action)))},m(e,r){b(e,t,r),v(t,n),v(n,o)},p(e,t){e.cta&&a!==(a=t.cta.label)&&_(o,a)},d(e){e&&y(t),r()}}}function vn(t){var n,o,r,a,s,c,l,i,u,d,m,h,p,g,f,k,x,C=t.toast&&gn(t),P=t.cta&&fn(t);return{c(){n=w("div"),(o=w("h1")).textContent="😿 An Error Has Occurred, sorry 😭",r=N(),C&&C.c(),a=N(),(s=w("h4")).textContent="This is what we know about it",c=N(),l=w("pre"),i=w("code"),u=$(t.error),d=N(),(m=w("p")).textContent="You might want to:",h=N(),p=w("ul"),P&&P.c(),g=N(),(f=w("li")).innerHTML='<a href="/docs/index.html#/troubleshooting/" target="_blank">\n\t\t\t        Open our troubleshooting documentation.\n\t\t\t      </a>',k=N(),(x=w("li")).innerHTML='<a href="https://github.com/soapdog/patchfox/issues" target="_blank">\n\t\t\t        Add an issue\n\t\t\t      </a>\n\t\t\t      to the Patchfox repository.\n\t\t\t    ',l.className="code",n.className="container"},m(e,t){b(e,n,t),v(n,o),v(n,r),C&&C.m(n,null),v(n,a),v(n,s),v(n,c),v(n,l),v(l,i),v(i,u),v(n,d),v(n,m),v(n,h),v(n,p),P&&P.m(p,null),v(p,g),v(p,f),v(p,k),v(p,x)},p(e,t){t.toast?C?C.p(e,t):((C=gn(t)).c(),C.m(n,a)):C&&(C.d(1),C=null),t.cta?P?P.p(e,t):((P=fn(t)).c(),P.m(p,g)):P&&(P.d(1),P=null)},i:e,o:e,d(e){e&&y(n),C&&C.d(),P&&P.d()}}}function bn(e,t,n){let o;l(e,Fn,e=>{n("$routeParams",o=e)});let r,a=o.error,s="",c=!1,i=!1;document.title="Patchfox - Error";let u={"Error: stream is closed":{label:"Want to try to reconnect?",action:()=>{n("toast",c=!0),n("toastClass",s="toast-warning"),n("msg",r="Attempting to reconnect to sbot..."),zn().then(()=>{n("toastClass",s="toast-success"),n("toast",c=!0),n("msg",r="Connection to sbot reestablished. Try going to your public feed.")}).catch(e=>{n("toastClass",s="toast-error"),n("toast",c=!0),n("msg",r="Couldn't reconnect. Try reloading the page.")})}}};return u.hasOwnProperty(a)&&n("cta",i=u[a]),{error:a,toastClass:s,toast:c,msg:r,cta:i}}function yn(e,t,n){const o=Object.create(e);return o.c=t[n],o}function kn(t){var n,o,r=t.err;return{c(){n=w("p"),o=$(r)},m(e,t){b(e,n,t),v(n,o)},p:e,d(e){e&&y(n)}}}function wn(e){for(var t,n=e.activeChannels,o=[],r=0;r<n.length;r+=1)o[r]=$n(yn(e,n,r));return{c(){for(var e=0;e<o.length;e+=1)o[e].c();t=x()},m(e,n){for(var r=0;r<o.length;r+=1)o[r].m(e,n);b(e,t,n)},p(e,r){if(e.activeChannels){n=r.activeChannels;for(var a=0;a<n.length;a+=1){const s=yn(r,n,a);o[a]?o[a].p(e,s):(o[a]=$n(s),o[a].c(),o[a].m(t.parentNode,t))}for(;a<o.length;a+=1)o[a].d(1);o.length=n.length}},d(e){!function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(o,e),e&&y(t)}}}function $n(e){var t,n,o,r,a=e.c.channel;return{c(){t=w("span"),n=$(a),o=N(),t.className="label label-rounded badge m-2",t.dataset.badge=r=e.c.count},m(e,r){b(e,t,r),v(t,n),v(t,o)},p(e,o){e.activeChannels&&a!==(a=o.c.channel)&&_(n,a),e.activeChannels&&r!==(r=o.c.count)&&(t.dataset.badge=r)},d(e){e&&y(t)}}}function Nn(t){var n;return{c(){(n=w("div")).className="loading"},m(e,t){b(e,n,t)},p:e,d(e){e&&y(n)}}}function xn(t){var o,r,a,s;let c={ctx:t,current:null,pending:Nn,then:wn,catch:kn,value:"data",error:"err"};return te(s=t.promise,c),{c(){(o=w("h4")).textContent="Active Channels",r=N(),a=x(),c.block.c()},m(e,t){b(e,o,t),b(e,r,t),b(e,a,t),c.block.m(e,c.anchor=t),c.mount=(()=>a.parentNode),c.anchor=a},p(e,o){t=o,c.ctx=t,s!==(s=t.promise)&&te(s,c)||c.block.p(e,n(n({},t),c.resolved))},i:e,o:e,d(e){e&&(y(o),y(r),y(a)),c.block.d(e),c=null}}}function Cn(e,t,n){let o=[];console.time("channels");let r=ssb.channels().then(e=>{console.timeEnd("channels",e),n("activeChannels",o=e)}).catch(e=>navigate("/error",{error:e}));return{activeChannels:o,promise:r}}function Pn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Mn(t){var n,o,r;return{c(){n=w("div"),o=$("Error: "),r=$(t.error),n.className="toast toast-error"},m(e,t){b(e,n,t),v(n,o),v(n,r)},p:e,d(e){e&&y(n)}}}function Rn(e){var t,n,o,r,s,c,l,i,u,d=[],m=new Map,h=e.msgs;const p=e=>e.msg.key;for(var g=0;g<h.length;g+=1){let t=Pn(e,h,g),n=p(t);m.set(n,d[g]=In(n,t))}var f=null;return h.length||(f=Tn(e)).c(),{c(){for(g=0;g<d.length;g+=1)d[g].c();t=N(),n=w("ul"),o=w("li"),(r=w("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=N(),c=w("li"),(l=w("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",l.href="#/public",c.className="page-item page-next",n.className="pagination",u=[C(r,"click",M(P(e.click_handler))),C(l,"click",M(P(e.click_handler_1)))]},m(e,a){for(g=0;g<d.length;g+=1)d[g].m(e,a);f&&f.m(e,null),b(e,t,a),b(e,n,a),v(n,o),v(o,r),v(n,s),v(n,c),v(c,l),i=!0},p(e,n){const o=n.msgs;X(),d=oe(d,e,p,1,n,o,m,t.parentNode,ne,In,t,Pn),Z(),o.length?f&&(f.d(1),f=null):f||((f=Tn(n)).c(),f.m(t.parentNode,t))},i(e){if(!i){for(var t=0;t<h.length;t+=1)d[t].i();i=!0}},o(e){for(g=0;g<d.length;g+=1)d[g].o();i=!1},d(e){for(g=0;g<d.length;g+=1)d[g].d(e);f&&f.d(e),e&&(y(t),y(n)),a(u)}}}function _n(t){var n;return{c(){(n=w("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Tn(e){var t;return{c(){(t=w("p")).textContent="No messages."},m(e,n){b(e,t,n)},d(e){e&&y(t)}}}function In(e,t){var n,o,r=new Rt({props:{msg:t.msg}});return{key:e,first:null,c(){n=x(),r.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),re(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&y(n),r.$destroy(e)}}}function On(e){var t,n,o,r,s,c,l,i,u,d,m,h,p,g,f,k,P,M,_,T=e.error&&Mn(e),I=[_n,Rn],O=[];function U(e){return e.msgs?1:0}return f=U(e),k=O[f]=I[f](e),{c(){t=w("div"),n=w("div"),o=w("h4"),r=$("Channel: #"),s=$(e.channel),c=N(),l=w("div"),i=w("label"),u=w("input"),d=N(),m=w("i"),h=$("\n        Subscribe"),p=N(),T&&T.c(),g=N(),k.c(),P=x(),o.className="column",R(u,"type","checkbox"),m.className="form-icon",i.className="form-switch float-right",l.className="column",n.className="columns",t.className="container",_=[C(u,"change",e.input_change_handler),C(u,"change",e.subscriptionChanged)]},m(a,y){b(a,t,y),v(t,n),v(n,o),v(o,r),v(o,s),v(n,c),v(n,l),v(l,i),v(i,u),u.checked=e.subscribed,v(i,d),v(i,m),v(i,h),b(a,p,y),T&&T.m(a,y),b(a,g,y),O[f].m(a,y),b(a,P,y),M=!0},p(e,t){e.subscribed&&(u.checked=t.subscribed),t.error?T?T.p(e,t):((T=Mn(t)).c(),T.m(g.parentNode,g)):T&&(T.d(1),T=null);var n=f;(f=U(t))===n?O[f].p(e,t):(X(),ee(()=>{O[n].d(1),O[n]=null}),k.o(1),Z(),(k=O[f])||(k=O[f]=I[f](t)).c(),k.i(1),k.m(P.parentNode,P))},i(e){M||(k&&k.i(),M=!0)},o(e){k&&k.o(),M=!1},d(e){e&&(y(t),y(p)),T&&T.d(e),e&&y(g),O[f].d(e),e&&y(P),a(_)}}}function Un(e,t,n){let o;l(e,Fn,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s=o.channel||!1,c=!1;s||(console.log("can't navigate to unnamed channel, going back to public"),location="index.html#/public");let i={limit:o.limit||10,reverse:!0};ssb.channelSubscribed(s).then(e=>{const t=c=e;return n("subscribed",c),t});return e.$$.update=((e={opts:1,$routeParams:1,channel:1,error:1})=>{if(e.opts||e.$routeParams||e.channel||e.error){Object.assign(i,o),document.title=`Patchfox - #${s}`,i.hasOwnProperty("lt")&&(i.lt=parseInt(i.lt),n("opts",i),n("$routeParams",o),n("channel",s),n("error",a)),i.hasOwnProperty("limit")&&(i.limit=parseInt(i.limit),n("opts",i),n("$routeParams",o),n("channel",s),n("error",a));ssb.channel(s,i).then(e=>{console.log("msg",e),n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}}),{msgs:r,error:a,channel:s,subscribed:c,opts:i,subscriptionChanged:e=>{e.target.checked?ssb.channelSubscribe(s).catch(()=>{const e=c=!1;return n("subscribed",c),e}):ssb.channelUnsubscribe(s).catch(()=>{const e=c=!0;return n("subscribed",c),e})},input_change_handler:function(){c=this.checked,n("subscribed",c)},click_handler:function(){return history.back()},click_handler_1:function(){return jn("/channel",{channel:s,lt:r[r.length-1].rts,limit:i.limit,onlyRoots:i.onlyRoots})}}}const An=le(!1),Ln=le({data:Ne.parse(window.location.search),location:window.location.hash.slice(1).replace("?","")}),Fn=ie(Ln,e=>e.data),En=ie(Ln,e=>e.location),jn=(e,t)=>{t=t||{},Ln.set({location:e,data:t});let n=Ne.stringify(t);history.pushState({location:e,data:t},`Patchfox - ${e}`,`/index.html?${n}#${e}`)},Sn={"/thread":class extends ce{constructor(e){super(),se(this,e,sn,an,c,[])}},"/public":class extends ce{constructor(e){super(),se(this,e,Lt,At,c,[])}},"/compose":class extends ce{constructor(e){super(),se(this,e,Zt,Xt,c,[])}},"/profile":class extends ce{constructor(e){super(),se(this,e,pn,hn,c,[])}},"/error":class extends ce{constructor(e){super(),se(this,e,bn,vn,c,[])}},"/channels":class extends ce{constructor(e){super(),se(this,e,Cn,xn,c,[])}},"/channel":class extends ce{constructor(e){super(),se(this,e,Un,On,c,[])}},"*":class extends ce{constructor(e){super(),se(this,e,null,Ft,c,[])}}},Hn=ie([An,Ln],([e,t])=>{let n=t.location;return e?Sn.hasOwnProperty(n)?Sn[n]:(console.log("didn't find",n),Sn["*"]):Sn["*"]}),Dn=e=>{(e=>e.hasOwnProperty("keys")||e.hasOwnProperty("keys")||e.hasOwnProperty("keys"))(e)?(e=>{window.ssb=new ue,ssb.connect(e.keys).then(e=>{console.log("connected"),An.set(!0)}).catch(e=>{console.error("can't connect",e),qn()})})(e):Bn()},Bn=()=>{console.log("config missing"),window.location="/docs/index.html#/troubleshooting/no-configuration"},qn=()=>{console.log("config missing"),window.location="/docs/index.html#/troubleshooting/no-connection"},Wn=()=>{browser.storage.local.get().then(Dn,Bn)},zn=()=>new Promise((e,t)=>{browser.storage.local.get().then(n=>{window.ssb=new ue,ssb.connect(n.keys).then(t=>{console.log("connected"),An.set(!0),e()}).catch(e=>{console.error("can't reconnect",e),t(e)})},t)});function Vn(t){var n,o,r,s,c,l,i,u,d,m,h,p,g,f,k,$,x,R,_,T,I,O,U,A,L,F,E,j,S,H,D,B,q,W,z,V,Y,J,K,G,Q,X,Z,ee,te,ne,oe,re,ae;return{c(){n=w("header"),o=w("section"),(r=w("a")).innerHTML='<i class="icon icon-minus text-black"></i>',s=N(),c=w("a"),l=w("figure"),i=w("img"),u=N(),d=w("i"),h=N(),(p=w("a")).textContent="New",g=N(),(f=w("a")).textContent="Public",k=N(),($=w("a")).textContent="Settings",x=N(),(R=w("a")).textContent="Help",_=N(),T=w("section"),(I=w("button")).innerHTML='<i class="icon icon-back"></i>',O=N(),U=w("a"),A=w("figure"),L=w("img"),F=N(),E=w("i"),S=N(),H=w("div"),(D=w("a")).innerHTML='\n\t\t\t        Menu\n\t\t\t        <i class="icon icon-caret"></i>',B=N(),q=w("ul"),W=w("li"),(z=w("a")).textContent="New",V=N(),Y=w("li"),(J=w("a")).textContent="Public",K=N(),G=w("li"),(Q=w("a")).textContent="Settings",X=N(),(Z=w("li")).innerHTML='<a href="/docs/index.html" class="btn btn-link">Help</a>',ee=N(),te=w("li"),(ne=w("a")).textContent="Open as a Tab",oe=N(),re=w("div"),r.href="#/sidebar",r.className="btn btn-link",i.src=t.avatar,i.alt="L",d.className=m="avatar-presence "+(t.$connected?"online":"offline")+" svelte-1ucmw71",l.className="avatar avatar-lg",c.href="#",c.className="navbar-brand mr-2 p-1",p.href="#/compose",p.className="btn btn-link",f.href="#/public",f.className="btn btn-link",$.href="#/settings",$.className="btn btn-link",R.href="/docs/index.html",R.className="btn btn-link",o.className="navbar-section hide-sm",I.className="btn btn-link",L.src=t.avatar,L.alt="L",E.className=j="avatar-presence "+(t.$connected?"online":"offline")+" svelte-1ucmw71",A.className="avatar",U.href="...",U.className="navbar-brand mr-2 p-1",D.href="?",D.className="btn btn-link dropdown-toggle",D.tabIndex="0",z.href="#/compose",z.className="btn btn-link",W.className="menu-item",J.href="#/public",J.className="btn btn-link",Y.className="menu-item",Q.href="#/settings",Q.className="btn btn-link",G.className="menu-item",Z.className="menu-item",ne.href="#/sidebar",ne.className="btn btn-link",te.className="menu-item",q.className="menu",H.className="dropdown float-right",T.className="navbar-section show-sm bg-gray above svelte-1ucmw71",re.className="blocker show-sm svelte-1ucmw71",n.className="navbar",ae=[C(r,"click",t.openSidebar),C(c,"click",t.openMyProfile),C(p,"click",M(P(t.goCompose))),C(f,"click",M(P(t.goPublic))),C($,"click",t.goSettings),C(I,"click",t.click_handler),C(D,"click",M(P(Yn))),C(z,"click",M(P(t.goCompose))),C(J,"click",M(P(t.goPublic))),C(Q,"click",t.goSettings),C(ne,"click",t.closeSidebar)]},m(e,t){b(e,n,t),v(n,o),v(o,r),v(o,s),v(o,c),v(c,l),v(l,i),v(l,u),v(l,d),v(o,h),v(o,p),v(o,g),v(o,f),v(o,k),v(o,$),v(o,x),v(o,R),v(n,_),v(n,T),v(T,I),v(T,O),v(T,U),v(U,A),v(A,L),v(A,F),v(A,E),v(T,S),v(T,H),v(H,D),v(H,B),v(H,q),v(q,W),v(W,z),v(q,V),v(q,Y),v(Y,J),v(q,K),v(q,G),v(G,Q),v(q,X),v(q,Z),v(q,ee),v(q,te),v(te,ne),v(n,oe),v(n,re)},p(e,t){e.avatar&&(i.src=t.avatar),e.$connected&&m!==(m="avatar-presence "+(t.$connected?"online":"offline")+" svelte-1ucmw71")&&(d.className=m),e.avatar&&(L.src=t.avatar),e.$connected&&j!==(j="avatar-presence "+(t.$connected?"online":"offline")+" svelte-1ucmw71")&&(E.className=j)},i:e,o:e,d(e){e&&y(n),a(ae)}}}function Yn(){return""}function Jn(e,t,n){let o;l(e,An,e=>{n("$connected",o=e)});let r="/images/icon.png";return e.$$.update=((e={$connected:1})=>{e.$connected&&o&&ssb.avatar(ssb.feed).then(e=>{n("avatar",r=`http://localhost:8989/blobs/get/${e.image}`)})}),{avatar:r,goSettings:e=>{browser.runtime.openOptionsPage()},goCompose:()=>jn("/compose"),goPublic:()=>jn("/public"),openSidebar:async e=>{let t=window.location.href;browser.sidebarAction.setPanel({panel:t}),browser.sidebarAction.open();let n=await browser.tabs.getCurrent();await browser.tabs.remove(n.id)},closeSidebar:async e=>{let t=await browser.sidebarAction.getPanel({});await browser.tabs.create({url:t}),await browser.sidebarAction.close()},openMyProfile:e=>{e.stopPropagation(),e.preventDefault(),ssb.feed&&jn("/profile",{feed:ssb.feed})},$connected:o,click_handler:function(){return history.back()}}}class Kn extends ce{constructor(e){super(),se(this,e,Jn,Vn,c,[])}}function Gn(e){var t,n,o,r,s,c,l=new Kn({}),i=e.$currentView;if(i)var u=new i({});return{c(){t=w("div"),n=w("div"),o=w("div"),l.$$.fragment.c(),r=N(),u&&u.$$.fragment.c(),o.className="column reduced-line-length svelte-6by8ah",n.className="columns",t.className="container bg-gray",c=[C(window,"popstate",e.popState),C(window,"error",e.handleUncaughtException),C(window,"hashchange",e.hashChange)]},m(e,a){b(e,t,a),v(t,n),v(n,o),re(l,o,null),v(o,r),u&&re(u,o,null),s=!0},p(e,t){if(i!==(i=t.$currentView)){if(u){X();const e=u;ee(()=>{e.$destroy()}),e.$$.fragment.o(1),Z()}i?((u=new i({})).$$.fragment.c(),u.$$.fragment.i(1),re(u,o,null)):u=null}},i(e){s||(l.$$.fragment.i(e),u&&u.$$.fragment.i(e),s=!0)},o(e){l.$$.fragment.o(e),u&&u.$$.fragment.o(e),s=!1},d(e){e&&y(t),l.$destroy(),u&&u.$destroy(),a(c)}}}function Qn(e,t,n){let o,r;var a;l(e,Hn,e=>{n("$currentView",o=e)}),window.ssb=!1,j(()=>{Wn(),r=setInterval(()=>{hermiebox.sbot&&hermiebox.sbot.whoami((e,t)=>{e&&(console.error("can't call whoami",e),zn().catch(e=>{console.error("can't reconnect"),clearInterval(r),jn("/error",{error:e})}))})},5e3)}),a=(()=>clearInterval(r)),E().$$.on_destroy.push(a);return{popState:e=>{if(null!==e.state){console.dir("pop",e.state);let{location:t,data:n}=e.state;Ln.set({location:t,data:n})}},handleUncaughtException:e=>{console.error("Uncaught exception",e),jn("/error",{error:e.message})},hashChange:e=>{console.dir("hash change",e)},$currentView:o}}return new class extends ce{constructor(e){super(),se(this,e,Qn,Gn,c,[])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
