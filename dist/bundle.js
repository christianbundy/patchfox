var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function r(e){return e()}function o(){return Object.create(null)}function a(e){e.forEach(r)}function s(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t,n){const r=t.subscribe(n);e.$$.on_destroy.push(r.unsubscribe?()=>r.unsubscribe():r)}const l="undefined"!=typeof window;let u=l?()=>window.performance.now():()=>Date.now(),d=l?requestAnimationFrame:e;const m=new Set;let p,f=!1;function h(){m.forEach(e=>{e[0](u())||(m.delete(e),e[1]())}),(f=m.size>0)&&d(h)}function g(e){let t;return f||(f=!0,d(h)),{promise:new Promise(n=>{m.add(t=[e,n])}),abort(){m.delete(t)}}}function v(e,t){e.appendChild(t)}function b(e,t,n){e.insertBefore(t,n||null)}function y(e){e.parentNode.removeChild(e)}function $(e){return document.createElement(e)}function w(e){return document.createTextNode(e)}function k(){return w(" ")}function N(){return w("")}function x(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function M(e){return function(t){return t.preventDefault(),e.call(this,t)}}function _(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function C(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function P(e,t){t=""+t,e.data!==t&&(e.data=t)}function R(e,t,n){e.classList[n?"add":"remove"](t)}let T,O=0,j={};function F(e,t,n,r,o,a,s,c=0){const i=16.666/r;let l="{\n";for(let e=0;e<=1;e+=i){const r=t+(n-t)*a(e);l+=100*e+`%{${s(r,1-r)}}\n`}const u=l+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${c}`;if(!j[d]){if(!p){const e=$("style");document.head.appendChild(e),p=e.sheet}j[d]=!0,p.insertRule(`@keyframes ${d} ${u}`,p.cssRules.length)}const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${r}ms linear ${o}ms 1 both`,O+=1,d}function I(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--O&&d(()=>{if(O)return;let e=p.cssRules.length;for(;e--;)p.deleteRule(e);j={}})}function A(e){T=e}function U(e){(function(){if(!T)throw new Error("Function called outside component initialization");return T})().$$.on_mount.push(e)}const L=[],E=Promise.resolve();let S=!1;const H=[],D=[],B=[];function V(e){D.push(e)}function W(){const e=new Set;do{for(;L.length;){const e=L.shift();A(e),q(e.$$)}for(;H.length;)H.shift()();for(;D.length;){const t=D.pop();e.has(t)||(t(),e.add(t))}}while(L.length);for(;B.length;)B.pop()();S=!1}function q(e){e.fragment&&(e.update(e.dirty),a(e.before_render),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_render.forEach(V))}let z,J;function G(){return z||(z=Promise.resolve()).then(()=>{z=null}),z}function Y(){J={remaining:0,callbacks:[]}}function K(){J.remaining||a(J.callbacks)}function Q(e){J.callbacks.push(e)}function X(e,t){const r=t.token={};function o(e,o,a,s){if(t.token!==r)return;t.resolved=a&&{[a]:s};const c=n(n({},t.ctx),t.resolved),i=e&&(t.current=e)(c);t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==o&&e&&(Y(),Q(()=>{e.d(1),t.blocks[n]=null}),e.o(1),K())}):t.block.d(1),i.c(),i.i&&i.i(1),i.m(t.mount(),t.anchor),W()),t.block=i,t.blocks&&(t.blocks[o]=i)}if((a=e)&&"function"==typeof a.then){if(e.then(e=>{o(t.then,1,t.value,e)},e=>{o(t.catch,2,t.error,e)}),t.current!==t.pending)return o(t.pending,0),!0}else{if(t.current!==t.then)return o(t.then,1,t.value,e),!0;t.resolved={[t.value]:e}}var a}function Z(e,t){Q(()=>{!function(e,t){e.d(1),t.delete(e.key)}(e,t)}),e.o(1)}function ee(e,t,n,r,o,a,s,c,i,l,u,d){let m=e.length,p=a.length,f=m;const h={};for(;f--;)h[e[f].key]=f;const g=[],v=new Map,b=new Map;for(f=p;f--;){const e=d(o,a,f),c=n(e);let i=s.get(c);i?r&&i.p(t,e):(i=l(c,e)).c(),v.set(c,g[f]=i),c in h&&b.set(c,Math.abs(f-h[c]))}const y=new Set,$=new Set;function w(e){e.i&&e.i(1),e.m(c,u),s.set(e.key,e),u=e.first,p--}for(;m&&p;){const t=g[p-1],n=e[m-1],r=t.key,o=n.key;t===n?(u=t.first,m--,p--):v.has(o)?!s.has(r)||y.has(r)?w(t):$.has(o)?m--:b.get(r)>b.get(o)?($.add(r),w(t)):(y.add(o),m--):(i(n,s),m--)}for(;m--;){const t=e[m];v.has(t.key)||i(t,s)}for(;p;)w(g[p-1]);return g}function te(e,t,n){const{fragment:o,on_mount:c,on_destroy:i,after_render:l}=e.$$;o.m(t,n),V(()=>{const t=c.map(r).filter(s);i?i.push(...t):a(t),e.$$.on_mount=[]}),l.forEach(V)}function ne(e,t){e.$$.dirty||(L.push(e),S||(S=!0,E.then(W)),e.$$.dirty=o()),e.$$.dirty[t]=!0}function re(t,n,r,s,c,i){const l=T;A(t);const u=n.props||{},d=t.$$={fragment:null,ctx:null,props:i,update:e,not_equal:c,bound:o(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(l?l.$$.context:[]),callbacks:o(),dirty:null};let m=!1;var p;d.ctx=r?r(t,u,(e,n)=>{d.ctx&&c(d.ctx[e],d.ctx[e]=n)&&(d.bound[e]&&d.bound[e](n),m&&ne(t,e))}):u,d.update(),m=!0,a(d.before_render),d.fragment=s(d.ctx),n.target&&(n.hydrate?d.fragment.l((p=n.target,Array.from(p.childNodes))):d.fragment.c(),n.intro&&t.$$.fragment.i&&t.$$.fragment.i(),te(t,n.target,n.anchor),W()),A(l)}class oe{$destroy(){var t,n;n=!0,(t=this).$$&&(a(t.$$.on_destroy),t.$$.fragment.d(n),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={}),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}class ae{constructor(){this.name="Driver for Hermiebox"}log(e,t=""){console.log(`[Driver Hermiebox] - ${e}`,t)}async connect(e){var t=await hermiebox.api.connect(e);this.log("you are",t.id),this.feed=t.id}async public(e){return await hermiebox.api.pullPublic(e)}async thread(e){return await hermiebox.api.thread(e)}async profile(e){var t=await hermiebox.api.profile(e);return console.log(t),t}async get(e){return await hermiebox.api.get(e)}async setAvatarCache(e,t){let n={};return n[`avatar-${e}`]=t,browser.storage.local.set(n)}async getCachedAvatar(e){return browser.storage.local.get(`avatar-${e}`)}async avatar(e){try{let t=await hermiebox.api.avatar(e);return await this.setAvatarCache(e,t),t}catch(e){throw e}}async blurbFromMsg(e,t){let n=e;try{let r=await ssb.get(e);return"post"==r.content.type&&(n=this.plainTextFromMarkdown(r.content.text.slice(0,t)+"...")),n}catch(e){return n}}plainTextFromMarkdown(e){let t=this.markdown(e),n=document.createElement("div");return n.innerHTML=t,n.innerText}markdown(e){let t=hermiebox.modules.ssbMarkdown.block(e);return t=t.replace("<pre>",'<pre class="code">').replace(/<a href="#([^"]*)/gi,function(e,t,n,r){return`<a class="channel-link" href="?channel=${encodeURIComponent(t)}#/channel`}).replace(/<a href="@([^"]*)/gi,function(e,t,n,r){return'<a class="profile-link" href="?feed='+encodeURIComponent(`@${t}`)+"#/profile"}).replace(/target="_blank"/gi,"").replace(/<a href="%([^"]*)/gi,function(e,t,n,r){return`<a class="thread-link" href="?thread=${encodeURIComponent(`%${t}`)}#/thread`}).replace(/<img src="&([^"]*)/gi,function(e,t,n,r){return'<img class="is-image-from-blob" src="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)}).replace(/<a href="&([^"]*)/gi,function(e,t,n,r){return'<a class="image-link" target="_blank" href="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)})}ref(){return hermiebox.modules.ssbRef}getTimestamp(e){const t=e.timestamp,n=e.value.timestamp;return Math.min(t,n)}getRootMsgId(e){if(e&&e.value&&e.value.content){const t=e.value.content.root;if(hermiebox.modules.ssbRef.isMsgId(t))return t}}newPost(e){return new Promise((t,n)=>{const r=hermiebox.modules.ssbMsgSchemas,o=e.text,a=e.hasOwnProperty("root")?e.root:void 0,s=e.hasOwnProperty("branch")?e.branch:void 0,c=e.hasOwnProperty("mentions")?e.mentions:void 0,i=e.hasOwnProperty("recps")?e.recps:void 0,l=e.hasOwnProperty("channel")?e.channel:void 0,u=hermiebox.sbot||!1,d=r.post(o,a,s,c,i,l);u&&u.publish(d,function(e,r){e?n(e):t(r)})})}}function se(t,n=e){let r;const o=[];function a(e){if(c(t,e)){if(t=e,!r)return;o.forEach(e=>e[1]()),o.forEach(e=>e[0](t))}}return{set:a,update:function(e){a(e(t))},subscribe:function(s,c=e){const i=[s,c];return o.push(i),1===o.length&&(r=n(a)||e),s(t),()=>{const e=o.indexOf(i);-1!==e&&o.splice(e,1),0===o.length&&r()}}}}function ce(t,n,r){const o=!Array.isArray(t),c=o?[t]:t,i=n.length<2;return{subscribe:se(r,t=>{let r=!1;const l=[];let u=0,d=e;const m=()=>{if(u)return;d();const r=n(o?l[0]:l,t);i?t(r):d=s(r)?r:e},p=c.map((e,t)=>e.subscribe(e=>{l[t]=e,u&=~(1<<t),r&&m()},()=>{u|=1<<t}));return r=!0,m(),function(){a(p),d()}}).subscribe}}var ie=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),le=new RegExp("%[a-f0-9]{2}","gi"),ue=new RegExp("(%[a-f0-9]{2})+","gi");function de(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],de(n),de(r))}function me(e){try{return decodeURIComponent(e)}catch(r){for(var t=e.match(le),n=1;n<t.length;n++)t=(e=de(t,n).join("")).match(le);return e}}var pe=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=ue.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var r=me(n[0]);r!==n[0]&&(t[n[0]]=r)}n=ue.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),a=0;a<o.length;a++){var s=o[a];e=e.replace(new RegExp(s,"g"),t[s])}return e}(e)}},fe=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]};function he(e,t){return t.encode?t.strict?ie(e):encodeURIComponent(e):e}function ge(e,t){return t.decode?pe(e):e}function ve(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function be(e){const t=(e=ve(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function ye(e,t){const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,r)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=n):r[e]=n};case"bracket":return(e,n,r)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"comma":return(e,t,n)=>{const r="string"==typeof t&&t.split("").indexOf(",")>-1?t.split(","):t;n[e]=r};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=Object.assign({decode:!0,arrayFormat:"none"},t)),r=Object.create(null);if("string"!=typeof e)return r;if(!(e=e.trim().replace(/^[?#&]/,"")))return r;for(const o of e.split("&")){let[e,a]=fe(o.replace(/\+/g," "),"=");a=void 0===a?null:ge(a,t),n(ge(e,t),a,r)}return Object.keys(r).sort().reduce((e,t)=>{const n=r[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}var $e={extract:be,parse:ye,stringify:(e,t)=>{if(!e)return"";const n=function(e){switch(e.arrayFormat){case"index":return t=>(n,r)=>{const o=n.length;return void 0===r?n:null===r?[...n,[he(t,e),"[",o,"]"].join("")]:[...n,[he(t,e),"[",he(o,e),"]=",he(r,e)].join("")]};case"bracket":return t=>(n,r)=>void 0===r?n:null===r?[...n,[he(t,e),"[]"].join("")]:[...n,[he(t,e),"[]=",he(r,e)].join("")];case"comma":return t=>(n,r,o)=>null==r||0===r.length?n:0===o?[[he(t,e),"=",he(r,e)].join("")]:[[n,he(r,e)].join(",")];default:return t=>(n,r)=>void 0===r?n:null===r?[...n,he(t,e)]:[...n,[he(t,e),"=",he(r,e)].join("")]}}(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),r=Object.keys(e);return!1!==t.sort&&r.sort(t.sort),r.map(r=>{const o=e[r];return void 0===o?"":null===o?he(r,t):Array.isArray(o)?o.reduce(n(r),[]).join("&"):he(r,t)+"="+he(o,t)}).filter(e=>e.length>0).join("&")},parseUrl:(e,t)=>({url:ve(e).split("?")[0]||"",query:ye(be(e),t)})};function we(e){var t,n,r,o;return{c(){t=$("span"),n=$("a"),r=w("(root)"),n.href=o="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread"},m(e,o){b(e,t,o),v(t,n),v(n,r)},p(e,t){e.msg&&o!==(o="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=o)},d(e){e&&y(t)}}}function ke(e){var t,n,r,o;return{c(){t=$("span"),n=$("a"),r=w("(in reply to)"),n.href=o="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread"},m(e,o){b(e,t,o),v(t,n),v(n,r)},p(e,t){e.msg&&o!==(o="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=o)},d(e){e&&y(t)}}}function Ne(t){var n,r,o,a,s,c,i,l,u,d,m,p,f=t.msg.value.content.root&&we(t),h=t.msg.value.content.branch&&ke(t);return{c(){n=$("div"),r=k(),o=$("div"),a=$("div"),s=$("div"),(c=$("label")).innerHTML='<input type="checkbox">\n\t\t\t        <i class="form-icon"></i>\n\t\t\t        Like\n\t\t\t      ',i=k(),f&&f.c(),l=k(),h&&h.c(),u=k(),d=$("div"),(m=$("button")).textContent="Reply",n.className="card-body",c.className="form-switch d-inline",s.className="column col-6",m.className="btn",d.className="column col-6 text-right",a.className="columns col-gapless",o.className="card-footer",p=x(m,"click",t.reply)},m(e,p){b(e,n,p),n.innerHTML=t.content,b(e,r,p),b(e,o,p),v(o,a),v(a,s),v(s,c),v(s,i),f&&f.m(s,null),v(s,l),h&&h.m(s,null),v(a,u),v(a,d),v(d,m)},p(e,t){t.msg.value.content.root?f?f.p(e,t):((f=we(t)).c(),f.m(s,l)):f&&(f.d(1),f=null),t.msg.value.content.branch?h?h.p(e,t):((h=ke(t)).c(),h.m(s,null)):h&&(h.d(1),h=null)},i:e,o:e,d(e){e&&(y(n),y(r),y(o)),f&&f.d(),h&&h.d(),p()}}}function xe(e,t,n){let{msg:r}=t,o=ssb.markdown(r.value.content.text);return e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,content:o,reply:e=>{let t=r.value.content.root||r.key,n=r.value.content.channel;Bt("/compose",{root:t,branch:r.key,channel:n})}}}class Me extends oe{constructor(e){super(),re(this,e,xe,Ne,c,["msg"])}}function _e(t){var n,r,o,a;return{c(){n=$("div"),r=$("pre"),o=$("code"),a=w(t.rawContent),r.className="code svelte-1c3kv1x",n.className="card-body"},m(e,t){b(e,n,t),v(n,r),v(r,o),v(o,a)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Ce(e,t,n){let{msg:r}=t,o=JSON.stringify(r,null,2);return e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,rawContent:o}}class Pe extends oe{constructor(e){super(),re(this,e,Ce,_e,c,["msg"])}}function Re(t){var n,r,o,a,s,c,i;return{c(){n=$("div"),r=w(t.person),o=k(),a=w(t.expression),s=k(),c=$("a"),i=w(t.label),c.href="/index.html?thread="+t.encodedid+"#/thread",n.className="card-body"},m(e,t){b(e,n,t),v(n,r),v(n,o),v(n,a),v(n,s),v(n,c),v(c,i)},p(e,t){e.person&&P(r,t.person),e.label&&P(i,t.label)},i:e,o:e,d(e){e&&y(n)}}}function Te(e,t,n){let{msg:r}=t,o=r.value.content.vote.expression,a=r.value.content.vote.link,s=encodeURIComponent(a),c=a,i=r.value.author;return ssb.blurbFromMsg(a,100).then(e=>{n("label",c=e)}),ssb.avatar(r.value.author).then(e=>{const t=i=e.name;return n("person",i),t}),e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,expression:o,encodedid:s,label:c,person:i}}class Oe extends oe{constructor(e){super(),re(this,e,Te,Re,c,["msg"])}}function je(t){var n;return{c(){(n=$("div")).innerHTML="<p>🔒 PRIVATE</p>",n.className="card-body"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Fe(e,t,n){let{msg:r}=t;return e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r}}class Ie extends oe{constructor(e){super(),re(this,e,Fe,je,c,["msg"])}}function Ae(t){var n,r,o,a,s,c,i;return{c(){n=$("div"),r=w(t.person),o=k(),a=w(t.verb),s=k(),c=$("a"),i=w(t.otherPersonName),c.href="?feed="+t.otherPersonFeed+"#/profile",n.className="card-body"},m(e,t){b(e,n,t),v(n,r),v(n,o),v(n,a),v(n,s),v(n,c),v(c,i)},p(e,t){e.person&&P(r,t.person),e.otherPersonName&&P(i,t.otherPersonName)},i:e,o:e,d(e){e&&y(n)}}}function Ue(e,t,n){let{msg:r}=t,o=r.value.author,a=encodeURIComponent(r.value.content.contact),s=a,c=r.value.content.following?"followed":"unfollowed";return ssb.avatar(r.value.author).then(e=>{const t=o=e.name;return n("person",o),t}),ssb.avatar(a).then(e=>{const t=s=e.name;return n("otherPersonName",s),t}),e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,person:o,otherPersonFeed:a,otherPersonName:s,verb:c}}class Le extends oe{constructor(e){super(),re(this,e,Ue,Ae,c,["msg"])}}function Ee(t){var n,r,o,a,s,c,i,l;return{c(){n=$("div"),r=w(t.person),o=k(),a=w(t.verb),s=k(),c=$("a"),i=w("#"),l=w(t.channel),c.href="?channel="+t.channel+"#/channel",n.className="card-body"},m(e,t){b(e,n,t),v(n,r),v(n,o),v(n,a),v(n,s),v(n,c),v(c,i),v(c,l)},p(e,t){e.person&&P(r,t.person)},i:e,o:e,d(e){e&&y(n)}}}function Se(e,t,n){let{msg:r}=t,o=r.value.author,a=r.value.content.subscribed?"subscribed":"unsubscribed",s=encodeURIComponent(r.value.content.channel);return ssb.avatar(r.value.author).then(e=>{const t=o=e.name;return n("person",o),t}),e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,person:o,verb:a,channel:s}}class He extends oe{constructor(e){super(),re(this,e,Se,Ee,c,["msg"])}}function De(e){var t,n,r;return{c(){t=$("div"),n=w(e.person),r=w(" is doing something related to a gathering but gatherings are not\n      supported yet, sorry."),t.className="toast"},m(e,o){b(e,t,o),v(t,n),v(t,r)},p(e,t){e.person&&P(n,t.person)},d(e){e&&y(t)}}}function Be(e){var t,n,r,o,a,s,c;function i(e){return e.image?We:Ve}var l=i(e),u=l(e),d=e.msg.value.content.description&&qe(e);return{c(){t=w(e.person),n=k(),r=w(e.verb),o=k(),a=$("a"),u.c(),s=k(),d&&d.c(),c=N(),a.href="?feed="+e.otherLink+"#/profile"},m(e,i){b(e,t,i),b(e,n,i),b(e,r,i),b(e,o,i),b(e,a,i),u.m(a,null),b(e,s,i),d&&d.m(e,i),b(e,c,i)},p(e,n){e.person&&P(t,n.person),e.verb&&P(r,n.verb),l===(l=i(n))&&u?u.p(e,n):(u.d(1),(u=l(n))&&(u.c(),u.m(a,null))),n.msg.value.content.description?d?d.p(e,n):((d=qe(n)).c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null)},d(e){e&&(y(t),y(n),y(r),y(o),y(a)),u.d(),e&&y(s),d&&d.d(e),e&&y(c)}}}function Ve(t){var n,r;return{c(){n=$("span"),r=w(t.otherName),n.className="chip"},m(e,t){b(e,n,t),v(n,r)},p:e,d(e){e&&y(n)}}}function We(t){var n,r,o,a;return{c(){n=$("div"),r=$("img"),o=k(),a=w(t.otherName),r.src=t.image,r.className="avatar avatar-sm",r.alt=t.otherName,n.className="chip"},m(e,t){b(e,n,t),v(n,r),v(n,o),v(n,a)},p:e,d(e){e&&y(n)}}}function qe(e){var t,n=e.ssb.markdown(e.msg.value.content.description);return{c(){t=$("blockquote")},m(e,r){b(e,t,r),t.innerHTML=n},p(e,r){e.msg&&n!==(n=r.ssb.markdown(r.msg.value.content.description))&&(t.innerHTML=n)},d(e){e&&y(t)}}}function ze(t){var n;function r(e){return e.isThisAboutFeeds?Be:De}var o=r(t),a=o(t);return{c(){n=$("div"),a.c(),n.className="card-body"},m(e,t){b(e,n,t),a.m(n,null)},p(e,t){o===(o=r(t))&&a?a.p(e,t):(a.d(1),(a=o(t))&&(a.c(),a.m(n,null)))},i:e,o:e,d(e){e&&y(n),a.d()}}}function Je(e,t,n){let{msg:r}=t,o=r.value.author,a=encodeURIComponent(r.value.content.about),s=r.value.content.name||a,c=!0,i=r.value.content.about===r.value.author?"self-identifies":"identifies";ssb.avatar(r.value.author).then(e=>{const t=o=e.name;return n("person",o),t});let l=!!r.value.content.image&&`http://localhost:8989/blobs/get/${encodeURIComponent(r.value.content.image)}`;return r.value.content.description&&n("verb",i+=" with description"),r.value.content.about.startsWith("%")&&n("isThisAboutFeeds",c=!1),e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,person:o,otherLink:a,otherName:s,isThisAboutFeeds:c,verb:i,image:l,ssb:ssb}}class Ge extends oe{constructor(e){super(),re(this,e,Je,ze,c,["msg"])}}function Ye(t){var n,r,o,a,s,c,i;return{c(){n=$("div"),r=w(t.person),o=w(" announced pub\n  "),a=$("a"),s=w(t.host),c=w(":"),i=w(t.port),a.href="/index.html?feed="+t.encodedid+"#/profile",n.className="card-body"},m(e,t){b(e,n,t),v(n,r),v(n,o),v(n,a),v(a,s),v(a,c),v(a,i)},p(e,t){e.person&&P(r,t.person)},i:e,o:e,d(e){e&&y(n)}}}function Ke(e,t,n){let{msg:r}=t,o=encodeURIComponent(r.value.content.address.key),a=r.value.author,s=r.value.content.address.host,c=r.value.content.address.port;return ssb.avatar(r.value.author).then(e=>{const t=a=e.name;return n("person",a),t}),e.$set=(e=>{"msg"in e&&n("msg",r=e.msg)}),{msg:r,encodedid:o,person:a,host:s,port:c}}class Qe extends oe{constructor(e){super(),re(this,e,Ke,Ye,c,["msg"])}}var Xe=function(){};Xe.prototype.simple=function(e){var t=Date.now(),n=Date.parse(e);try{if(n!=n)throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e}catch(t){return console.error(t),e}return n-t<0?function(e){var t=Date.now();e=Date.parse(e);var n=(t-e)/1e3,r=n/60,o=n/3600;if(n<60&&r<1)return 1===n?Math.round(n)+" second ago":Math.round(n)+" seconds ago";if(r<60&&o<1)return 1===r?Math.round(r)+" minute ago":Math.round(r)+" minutes ago";if(o>24){var a=o/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?Math.ceil(c)+" year ago":Math.ceil(c)+" years ago"}return Math.round(s)+" month ago"}return 1===a?Math.round(a)+" day ago":Math.round(a)+" days ago"}return 1===o?Math.round(o)+" hour ago":Math.round(o)+" hours ago"}(e):function(e){var t=Date.now(),n=((e=Date.parse(e))-t)/1e3,r=n/60,o=n/3600;if(n<60&&r<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(r<60&&o<1)return 1===r?"in "+Math.round(r)+" minute":"in "+Math.round(r)+" minutes";if(o>24){var a=o/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===o?"in "+Math.round(o)+" hour":"in "+Math.round(o)+" hours"}(e)},Xe.prototype.future=function(e){console.warn("timeago-simple: .future function is depricated! Please use .simple for both past and future dates.");var t=Date.now();try{if(Date.parse(e)!=Date.parse(e))throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e;if(Date.parse(e)-t<0)throw"timeago-simple: Looks like it's more relevant case for timeago.simple"}catch(t){return console.error(t),e}var n=((e=Date.parse(e))-t)/1e3,r=n/60,o=n/3600;if(n<60&&r<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(r<60&&o<1)return 1===r?"in "+Math.round(r)+" minute":"in "+Math.round(r)+" minutes";if(o>24){var a=o/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===o?"in "+Math.round(o)+" hour":"in "+Math.round(o)+" hours"};var Ze=new Xe;const et=e=>Ze.simple(new Date(e));function tt(e){var t,n,r=e.msg.value.content.channel;return{c(){t=w("#"),n=w(r)},m(e,r){b(e,t,r),b(e,n,r)},p(e,t){e.msg&&r!==(r=t.msg.value.content.channel)&&P(n,r)},d(e){e&&(y(t),y(n))}}}function nt(t){var n,r,o,a,s,c,i,l,u,d,m,p,f,h,g,N,x,M,_,C,R;return{c(){n=$("div"),r=$("div"),o=$("div"),a=$("pre"),s=$("code"),c=w(t.rawContent),i=k(),l=$("div"),u=$("p"),d=w("This is a message of type\n            "),m=$("em"),p=w(t.type),f=w("\n            ."),h=k(),g=$("p"),N=w("To learn more about it, go to\n            "),x=$("a"),M=w("the documentation about messages with type "),_=w(t.type),R=w("\n            ."),a.className="code",o.className="column col-9",x.target="_blank",x.href=C="/docs/index.html#/message_types/"+t.type,l.className="column col-3",r.className="columns",n.className="card-body"},m(e,t){b(e,n,t),v(n,r),v(r,o),v(o,a),v(a,s),v(s,c),v(r,i),v(r,l),v(l,u),v(u,d),v(u,m),v(m,p),v(u,f),v(l,h),v(l,g),v(g,N),v(g,x),v(x,M),v(x,_),v(g,R)},p(e,t){e.type&&(P(p,t.type),P(_,t.type)),e.type&&C!==(C="/docs/index.html#/message_types/"+t.type)&&(x.href=C)},i:e,o:e,d(e){e&&y(n)}}}function rt(e){var t,n,r=e.selectedRenderer;function o(e){return{props:{msg:e.msg}}}if(r)var a=new r(o(e));return{c(){a&&a.$$.fragment.c(),t=N()},m(e,r){a&&te(a,e,r),b(e,t,r),n=!0},p(e,n){var s={};if(e.msg&&(s.msg=n.msg),r!==(r=n.selectedRenderer)){if(a){Y();const e=a;Q(()=>{e.$destroy()}),e.$$.fragment.o(1),K()}r?((a=new r(o(n))).$$.fragment.c(),a.$$.fragment.i(1),te(a,t.parentNode,t)):a=null}else r&&a.$set(s)},i(e){n||(a&&a.$$.fragment.i(e),n=!0)},o(e){a&&a.$$.fragment.o(e),n=!1},d(e){e&&y(t),a&&a.$destroy(e)}}}function ot(e){var t,n,r,o,s,c,i,l,u,d,m,p,f,h,g,N,M,_,C,R,T,O,j,F,I,A,U=et(e.msg.value.timestamp),L=e.msg.value.content.channel&&tt(e),E=[rt,nt],S=[];function H(e){return e.showRaw?1:0}return j=H(e),F=S[j]=E[j](e),{c(){t=$("div"),n=$("div"),r=$("div"),o=$("div"),s=$("div"),c=$("div"),i=$("div"),l=$("img"),u=k(),d=$("div"),m=$("div"),p=w(e.name),f=k(),h=$("small"),g=w(U),N=k(),M=$("div"),_=$("span"),L&&L.c(),C=k(),R=$("span"),T=$("i"),O=k(),F.c(),l.src=e.image,l.className="avatar avatar-lg",l.alt=e.feed,i.className="example-tile-icon",c.className="tile-icon",m.className="tile-title",h.className="tile-subtitle text-gray",d.className="tile-content",s.className="tile tile-centered feed-display svelte-1bmt2jj",o.className="card-title",r.className="float-left",_.className="text-gray channel-display svelte-1bmt2jj",T.className="icon icon-more-vert",R.className="text-gray",M.className="float-right",n.className="card-header",t.className="card m-2",A=[x(s,"click",e.click_handler),x(_,"click",e.click_handler_1),x(T,"click",e.click_handler_2)]},m(e,a){b(e,t,a),v(t,n),v(n,r),v(r,o),v(o,s),v(s,c),v(c,i),v(i,l),v(s,u),v(s,d),v(d,m),v(m,p),v(d,f),v(d,h),v(h,g),v(n,N),v(n,M),v(M,_),L&&L.m(_,null),v(M,C),v(M,R),v(R,T),v(t,O),S[j].m(t,null),I=!0},p(e,n){I&&!e.image||(l.src=n.image),I&&!e.name||P(p,n.name),I&&!e.msg||U===(U=et(n.msg.value.timestamp))||P(g,U),n.msg.value.content.channel?L?L.p(e,n):((L=tt(n)).c(),L.m(_,null)):L&&(L.d(1),L=null);var r=j;(j=H(n))===r?S[j].p(e,n):(Y(),Q(()=>{S[r].d(1),S[r]=null}),F.o(1),K(),(F=S[j])||(F=S[j]=E[j](n)).c(),F.i(1),F.m(t,null))},i(e){I||(F&&F.i(),I=!0)},o(e){F&&F.o(),I=!1},d(e){e&&y(t),L&&L.d(),S[j].d(),a(A)}}}function at(e,t,n){let r,o,{msg:a}=t,s=a.value.author,c=!1,i=JSON.stringify(a,null,2),l={"*":Pe,post:Me,vote:Oe,private:Ie,contact:Le,channel:He,about:Ge,pub:Qe};"string"==typeof a.value.content?n("type",r="private"):n("type",r=a.value.content.type),l.hasOwnProperty(r)?n("selectedRenderer",o=l[r]):n("selectedRenderer",o=l["*"]);let u="images/icon.png",d=s;return ssb.avatar(s).then(e=>{null!==e.image&&n("image",u=`http://localhost:8989/blobs/get/${e.image}`),n("name",d=e.name)}),e.$set=(e=>{"msg"in e&&n("msg",a=e.msg)}),{msg:a,type:r,feed:s,showRaw:c,rawContent:i,selectedRenderer:o,image:u,name:d,click_handler:function(){return Bt("/profile",{feed:s})},click_handler_1:function(){return Bt("/channel",{channel:a.value.content.channel})},click_handler_2:function(){const e=c=!c;return n("showRaw",c),e}}}class st extends oe{constructor(e){super(),re(this,e,at,ot,c,["msg"])}}function ct(e,t,n){const r=Object.create(e);return r.msg=t[n],r}function it(t){var n,r,o;return{c(){n=$("div"),r=w("Error: "),o=w(t.error),n.className="toast toast-error"},m(e,t){b(e,n,t),v(n,r),v(n,o)},p:e,d(e){e&&y(n)}}}function lt(e){var t,n,r,o,s,c,i,l,u,d=[],m=new Map,p=e.msgs;const f=e=>e.msg.key;for(var h=0;h<p.length;h+=1){let t=ct(e,p,h),n=f(t);m.set(n,d[h]=dt(n,t))}return{c(){for(h=0;h<d.length;h+=1)d[h].c();t=k(),n=$("ul"),r=$("li"),(o=$("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',s=k(),c=$("li"),(i=$("a")).innerHTML='<div class="page-item-subtitle">Next</div>',o.href="#/public",r.className="page-item page-previous",i.href="#/public",c.className="page-item page-next",n.className="pagination",u=[x(o,"click",_(M(e.click_handler))),x(i,"click",_(M(e.click_handler_1)))]},m(e,a){for(h=0;h<d.length;h+=1)d[h].m(e,a);b(e,t,a),b(e,n,a),v(n,r),v(r,o),v(n,s),v(n,c),v(c,i),l=!0},p(e,n){const r=n.msgs;Y(),d=ee(d,e,f,1,n,r,m,t.parentNode,Z,dt,t,ct),K()},i(e){if(!l){for(var t=0;t<p.length;t+=1)d[t].i();l=!0}},o(e){for(h=0;h<d.length;h+=1)d[h].o();l=!1},d(e){for(h=0;h<d.length;h+=1)d[h].d(e);e&&(y(t),y(n)),a(u)}}}function ut(t){var n;return{c(){(n=$("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function dt(e,t){var n,r,o=new st({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),o.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),te(o,e,t),r=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),o.$set(n)},i(e){r||(o.$$.fragment.i(e),r=!0)},o(e){o.$$.fragment.o(e),r=!1},d(e){e&&y(n),o.$destroy(e)}}}function mt(e){var t,n,r,o,a,s=e.error&&it(e),c=[ut,lt],i=[];function l(e){return e.msgs?1:0}return n=l(e),r=i[n]=c[n](e),{c(){s&&s.c(),t=k(),r.c(),o=N()},m(e,r){s&&s.m(e,r),b(e,t,r),i[n].m(e,r),b(e,o,r),a=!0},p(e,a){a.error?s?s.p(e,a):((s=it(a)).c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null);var u=n;(n=l(a))===u?i[n].p(e,a):(Y(),Q(()=>{i[u].d(1),i[u]=null}),r.o(1),K(),(r=i[n])||(r=i[n]=c[n](a)).c(),r.i(1),r.m(o.parentNode,o))},i(e){a||(r&&r.i(),a=!0)},o(e){r&&r.o(),a=!1},d(e){s&&s.d(e),e&&y(t),i[n].d(e),e&&y(o)}}}function pt(e,t,n){let r;i(e,Dt,e=>{n("$routeParams",r=e)});let o=!1,a=r.error||!1;return e.$$.update=((e={$routeParams:1,error:1})=>{if(e.$routeParams||e.error){let e={limit:10,reverse:!0};Object.assign(e,r),console.dir("opts",e),e.hasOwnProperty("lt")&&(e.lt=parseInt(e.lt));ssb.public(e).then(e=>{console.log("messages arrived",e),n("msgs",o=e),window.scrollTo(0,0)}).catch(e=>{a||Bt("/public",{error:e})})}}),{msgs:o,error:a,click_handler:function(){return history.back()},click_handler_1:function(){return Bt("/public",{lt:o[o.length-1].rts})}}}function ft(t){var n;return{c(){(n=$("div")).className="empty"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function ht(e){const t=e-1;return t*t*t+1}function gt(e,{delay:t=0,duration:n=400,easing:r=ht}){const o=getComputedStyle(e),a=+o.opacity,s=parseFloat(o.height),c=parseFloat(o.paddingTop),i=parseFloat(o.paddingBottom),l=parseFloat(o.marginTop),u=parseFloat(o.marginBottom),d=parseFloat(o.borderTopWidth),m=parseFloat(o.borderBottomWidth);return{delay:t,duration:n,easing:r,css:e=>"overflow: hidden;"+`opacity: ${Math.min(20*e,1)*a};`+`height: ${e*s}px;`+`padding-top: ${e*c}px;`+`padding-bottom: ${e*i}px;`+`margin-top: ${e*l}px;`+`margin-bottom: ${e*u}px;`+`border-top-width: ${e*d}px;`+`border-bottom-width: ${e*m}px;`}}function vt(e){var t;function n(e){return e.error?yt:bt}var r=n(e),o=r(e);return{c(){o.c(),t=N()},m(e,n){o.m(e,n),b(e,t,n)},p(e,a){r===(r=n(a))&&o?o.p(e,a):(o.d(1),(o=r(a))&&(o.c(),o.m(t.parentNode,t)))},d(e){o.d(e),e&&y(t)}}}function bt(e){var t,n,r,o,a;return{c(){t=$("div"),n=w("Your message has been posted. Do you want to\n            "),r=$("a"),o=w("Check it out?"),r.target="_blank",r.href=a="?thread="+encodeURIComponent(e.msg.key)+"#/thread",t.className="toast toast-success"},m(e,a){b(e,t,a),v(t,n),v(t,r),v(r,o)},p(e,t){e.msg&&a!==(a="?thread="+encodeURIComponent(t.msg.key)+"#/thread")&&(r.href=a)},d(e){e&&y(t)}}}function yt(e){var t,n,r;return{c(){t=$("div"),n=w("Couldn't post your message: "),r=w(e.msg),t.className="toast toast-error"},m(e,o){b(e,t,o),v(t,n),v(t,r)},p(e,t){e.msg&&P(r,t.msg)},d(e){e&&y(t)}}}function $t(t){var n,r,o,s,c,i,l,u,d,m,p,f,h,g=t.ssb.markdown(t.content);return{c(){n=$("div"),r=$("noscript"),o=k(),s=$("div"),c=k(),i=$("div"),(l=$("div")).innerHTML='<span class="label label-warning">\n\t\t\t                This message will be public and can\'t be edited or deleted\n\t\t\t              </span>',u=k(),d=$("div"),(m=$("button")).textContent="Go Back",p=k(),(f=$("button")).textContent="Post",s.className="divider",l.className="column col-md-12 col-lg-10",m.className="btn",f.className="btn btn-primary",R(f,"loading",t.posting),d.className="column col-md-12 col-lg-2",i.className="columns",n.className="column col-md-12",h=[x(m,"click",t.click_handler),x(f,"click",t.post)]},m(e,t){b(e,n,t),v(n,r),r.insertAdjacentHTML("beforebegin",g),v(n,o),v(n,s),v(n,c),v(n,i),v(i,l),v(i,u),v(i,d),v(d,m),v(d,p),v(d,f)},p(e,t){e.content&&g!==(g=t.ssb.markdown(t.content))&&(!function(e){for(;e.previousSibling;)e.parentNode.removeChild(e.previousSibling)}(r),r.insertAdjacentHTML("beforebegin",g)),e.posting&&R(f,"loading",t.posting)},i:e,o:e,d(e){e&&y(n),a(h)}}}function wt(n){var r,o,s,c,i,l,d,m,p,f,h,w,N,M,_,P,R,T=n.branch&&kt(n);return{c(){r=$("div"),(o=$("label")).textContent="Channel",s=k(),c=$("input"),i=k(),T&&T.c(),l=k(),(d=$("label")).textContent="Message",m=k(),p=$("textarea"),f=k(),h=$("br"),w=k(),(N=$("button")).textContent="Preview",o.className="form-label",o.htmlFor="channel",c.className="form-input",C(c,"type","text"),c.id="channel",c.placeholder="channel",d.className="form-label",d.htmlFor="content",p.className="form-input",p.id="content",p.placeholder="Type in your post",p.rows="10",N.className="btn btn-primary float-right",r.className="form-group",R=[x(c,"input",n.input_input_handler),x(p,"input",n.textarea_input_handler),x(N,"click",n.preview)]},m(e,t){b(e,r,t),v(r,o),v(r,s),v(r,c),c.value=n.channel,v(r,i),T&&T.m(r,null),v(r,l),v(r,d),v(r,m),v(r,p),p.value=n.content,v(r,f),v(r,h),v(r,w),v(r,N),P=!0},p(e,t){e.channel&&c.value!==t.channel&&(c.value=t.channel),t.branch?T?T.p(e,t):((T=kt(t)).c(),T.m(r,l)):T&&(T.d(1),T=null),e.content&&(p.value=t.content)},i(n){P||(V(()=>{_&&_.end(1),M||(M=function(n,r,o){let a,s,c=r(n,o),i=!1,l=0;function d(){a&&I(n,a)}function m(){const{delay:r=0,duration:o=300,easing:m=t,tick:p=e,css:f}=c;f&&(a=F(n,0,1,o,r,m,f,l++)),p(0,1);const h=u()+r,v=h+o;s&&s.abort(),i=!0,s=g(e=>{if(i){if(e>=v)return p(1,0),d(),i=!1;if(e>=h){const t=m((e-h)/o);p(t,1-t)}}return i})}let p=!1;return{start(){p||(I(n),"function"==typeof c?(c=c(),G().then(m)):m())},invalidate(){p=!1},end(){i&&(d(),i=!1)}}}(r,gt,{})),M.start()}),P=!0)},o(n){M&&M.invalidate(),n&&(_=function(n,r,o){let s,c=r(n,o),i=!0;const l=J;function d(){const{delay:r=0,duration:o=300,easing:d=t,tick:m=e,css:p}=c;p&&(s=F(n,1,0,o,r,d,p));const f=u()+r,h=f+o;g(e=>{if(i){if(e>=h)return m(0,1),--l.remaining||a(l.callbacks),!1;if(e>=f){const t=d((e-f)/o);m(1-t,t)}}return i})}return l.remaining+=1,"function"==typeof c?G().then(()=>{c=c(),d()}):d(),{end(e){e&&c.tick&&c.tick(1,0),i&&(s&&I(n,s),i=!1)}}}(r,gt,{})),P=!1},d(e){e&&y(r),T&&T.d(),e&&_&&_.end(),a(R)}}}function kt(e){var t,n,r,o;return{c(){(t=$("label")).textContent="In reply to",n=k(),r=$("input"),t.className="form-label",t.htmlFor="reply-to",r.className="form-input",C(r,"type","text"),r.id="reply-to",r.placeholder="in reply to",o=x(r,"input",e.input_input_handler_1)},m(o,a){b(o,t,a),b(o,n,a),b(o,r,a),r.value=e.branch},p(e,t){e.branch&&r.value!==t.branch&&(r.value=t.branch)},d(e){e&&(y(t),y(n),y(r)),o()}}}function Nt(e){var t,n,r,o,a,s,c,i=e.msg&&vt(e),l=[wt,$t],u=[];function d(e){return e.showPreview?1:0}return a=d(e),s=u[a]=l[a](e),{c(){t=$("div"),n=$("div"),r=$("div"),i&&i.c(),o=k(),s.c(),r.className="column",n.className="columns",t.className="container"},m(e,s){b(e,t,s),v(t,n),v(n,r),i&&i.m(r,null),v(r,o),u[a].m(r,null),c=!0},p(e,t){t.msg?i?i.p(e,t):((i=vt(t)).c(),i.m(r,o)):i&&(i.d(1),i=null);var n=a;(a=d(t))===n?u[a].p(e,t):(Y(),Q(()=>{u[n].d(1),u[n]=null}),s.o(1),K(),(s=u[a])||(s=u[a]=l[a](t)).c(),s.i(1),s.m(r,null))},i(e){c||(s&&s.i(),c=!0)},o(e){s&&s.o(),c=!1},d(e){e&&y(t),i&&i.d(),u[a].d()}}}function xt(e,t,n){let r;i(e,Dt,e=>{n("$routeParams",r=e)});let o=!1,a=!1,s=!1,c=!1,l=r.root,u=r.branch,d=r.channel||"",m=r.content||"";return{showPreview:o,msg:a,error:s,posting:c,branch:u,channel:d,content:m,post:async e=>{if(e.stopPropagation(),e.preventDefault(),!c){n("posting",c=!0);try{n("msg",a=await ssb.newPost({text:m,channel:d,root:l,branch:u})),n("posting",c=!1),console.log("posted",a)}catch(e){n("error",s=!0),n("msg",a=e),"stream is closed"==a.message&&(n("msg",a+="We lost connection to sbot. We'll reload the page in 3 seconds and try to restablish it..."),setTimeout(()=>{Bt("/compose",{channel:d,content:m})},3e3))}}},preview:e=>{n("showPreview",o=!0)},ssb:ssb,input_input_handler:function(){d=this.value,n("channel",d)},input_input_handler_1:function(){u=this.value,n("branch",u)},textarea_input_handler:function(){m=this.value,n("content",m)},click_handler:function(){const e=o=!1;return n("showPreview",o),e}}}function Mt(e,t,n){const r=Object.create(e);return r.msg=t[n],r}function _t(e){var t,n,r,o,a,s,c;return{c(){t=$("div"),n=w("Couldn't load thead "),r=$("a"),o=w(e.msgid),s=w(": "),c=w(e.error),r.href=a="?thread="+e.msgid+"#/thread",t.className="toast toast-error"},m(e,a){b(e,t,a),v(t,n),v(t,r),v(r,o),v(t,s),v(t,c)},p(e,t){e.msgid&&P(o,t.msgid),e.msgid&&a!==(a="?thread="+t.msgid+"#/thread")&&(r.href=a),e.error&&P(c,t.error)},d(e){e&&y(t)}}}function Ct(e){var t,n,r=[],o=new Map,a=e.msgs;const s=e=>e.msg.key;for(var c=0;c<a.length;c+=1){let t=Mt(e,a,c),n=s(t);o.set(n,r[c]=Rt(n,t))}return{c(){for(c=0;c<r.length;c+=1)r[c].c();t=N()},m(e,o){for(c=0;c<r.length;c+=1)r[c].m(e,o);b(e,t,o),n=!0},p(e,n){const a=n.msgs;Y(),r=ee(r,e,s,1,n,a,o,t.parentNode,Z,Rt,t,Mt),K()},i(e){if(!n){for(var t=0;t<a.length;t+=1)r[t].i();n=!0}},o(e){for(c=0;c<r.length;c+=1)r[c].o();n=!1},d(e){for(c=0;c<r.length;c+=1)r[c].d(e);e&&y(t)}}}function Pt(t){var n;return{c(){(n=$("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Rt(e,t){var n,r,o=new st({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),o.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),te(o,e,t),r=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),o.$set(n)},i(e){r||(o.$$.fragment.i(e),r=!0)},o(e){o.$$.fragment.o(e),r=!1},d(e){e&&y(n),o.$destroy(e)}}}function Tt(e){var t,n,r,o,a,s=e.error&&_t(e),c=[Pt,Ct],i=[];function l(e){return e.msgs||e.error?1:0}return n=l(e),r=i[n]=c[n](e),{c(){s&&s.c(),t=k(),r.c(),o=N()},m(e,r){s&&s.m(e,r),b(e,t,r),i[n].m(e,r),b(e,o,r),a=!0},p(e,a){a.error?s?s.p(e,a):((s=_t(a)).c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null);var u=n;(n=l(a))===u?i[n].p(e,a):(Y(),Q(()=>{i[u].d(1),i[u]=null}),r.o(1),K(),(r=i[n])||(r=i[n]=c[n](a)).c(),r.i(1),r.m(o.parentNode,o))},i(e){a||(r&&r.i(),a=!0)},o(e){r&&r.o(),a=!1},d(e){s&&s.d(e),e&&y(t),i[n].d(e),e&&y(o)}}}function Ot(e,t,n){let r;i(e,Dt,e=>{n("$routeParams",r=e)});let o,a=!1,s=!1;return e.$$.update=((e={$routeParams:1,msgid:1})=>{if(e.$routeParams||e.msgid){n("msgid",o=r.thread),o.startsWith("ssb:")&&n("msgid",o=o.replace("ssb:","")),console.log("fetching",o);ssb.thread(o).then(e=>{console.log("messages arrived",e),n("msgs",a=e),window.scrollTo(0,0)}).catch(e=>{console.dir(e),n("error",s=e.message)})}}),{msgs:a,error:s,msgid:o}}function jt(e,t,n){const r=Object.create(e);return r.msg=t[n],r}function Ft(t){var n,r,o,a=t.n.message;return{c(){n=$("p"),r=w("Error: "),o=w(a)},m(e,t){b(e,n,t),v(n,r),v(n,o)},p:e,i:e,o:e,d(e){e&&y(n)}}}function It(e){var t,n,r,o,a,s,c,i,l,u,d,m,p,f=e.ssb.markdown(e.description),h=[],g=new Map,N=e.lastMsgs;const x=e=>e.msg.key;for(var M=0;M<N.length;M+=1){let t=jt(e,N,M),n=x(t);g.set(n,h[M]=At(n,t))}return{c(){for(t=$("div"),n=$("div"),r=$("img"),a=k(),s=$("div"),c=$("h1"),i=w(e.name),l=k(),u=$("p"),d=k(),m=$("div"),M=0;M<h.length;M+=1)h[M].c();r.className="img-responsive",r.src=o="http://localhost:8989/blobs/get/"+e.image,r.alt=e.feed,n.className="column col-6",s.className="column col-6",t.className="columns"},m(e,o){for(b(e,t,o),v(t,n),v(n,r),v(t,a),v(t,s),v(s,c),v(c,i),v(s,l),v(s,u),u.innerHTML=f,b(e,d,o),b(e,m,o),M=0;M<h.length;M+=1)h[M].m(m,null);p=!0},p(e,t){p&&!e.image||o===(o="http://localhost:8989/blobs/get/"+t.image)||(r.src=o),p&&!e.feed||(r.alt=t.feed),p&&!e.name||P(i,t.name),p&&!e.description||f===(f=t.ssb.markdown(t.description))||(u.innerHTML=f);const n=t.lastMsgs;Y(),h=ee(h,e,x,1,t,n,g,m,Z,At,null,jt),K()},i(e){if(!p){for(var t=0;t<N.length;t+=1)h[t].i();p=!0}},o(e){for(M=0;M<h.length;M+=1)h[M].o();p=!1},d(e){for(e&&(y(t),y(d),y(m)),M=0;M<h.length;M+=1)h[M].d()}}}function At(e,t){var n,r,o=new st({props:{msg:t.msg}});return{key:e,first:null,c(){n=N(),o.$$.fragment.c(),this.first=n},m(e,t){b(e,n,t),te(o,e,t),r=!0},p(e,t){var n={};e.lastMsgs&&(n.msg=t.msg),o.$set(n)},i(e){r||(o.$$.fragment.i(e),r=!0)},o(e){o.$$.fragment.o(e),r=!1},d(e){e&&y(n),o.$destroy(e)}}}function Ut(t){var n;return{c(){(n=$("div")).className="loading loading-lg"},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&y(n)}}}function Lt(e){var t,r,o;let a={ctx:e,current:null,pending:Ut,then:It,catch:Ft,value:"null",error:"n",blocks:Array(3)};return X(r=e.p1&&e.p2,a),{c(){t=$("div"),a.block.c(),t.className="container"},m(e,n){b(e,t,n),a.block.m(t,a.anchor=null),a.mount=(()=>t),a.anchor=null,o=!0},p(t,o){e=o,a.ctx=e,r!==(r=e.p1&&e.p2)&&X(r,a)||a.block.p(t,n(n({},e),a.resolved))},i(e){o||(a.block.i(),o=!0)},o(e){for(let e=0;e<3;e+=1){const t=a.blocks[e];t&&t.o()}o=!1},d(e){e&&y(t),a.block.d(),a=null}}}function Et(e,t,n){let r;i(e,Dt,e=>{n("$routeParams",r=e)});let o,a,s,c,l=!1,u=[];n("feed",s=r.feed),console.log("fetching",s);let d=ssb.avatar(s).then(e=>{n("name",o=e.name),n("image",a=e.image)}),m=ssb.profile(s).then(e=>{c=e.about.reverse().find(e=>{return e.value.content.hasOwnProperty("description")}),e.hasOwnProperty("msgs")&&n("lastMsgs",u=e.msgs);try{n("description",l=c.value.content.description),console.log("d",l)}catch(t){console.log("err",t),console.log("profile",e),n("description",l="")}window.scrollTo(0,0)});return{description:l,name:o,image:a,feed:s,lastMsgs:u,p1:d,p2:m,ssb:ssb}}const St=se(!1),Ht=se({data:$e.parse(window.location.search),location:window.location.hash.slice(1).replace("?","")}),Dt=ce(Ht,e=>e.data),Bt=(ce(Ht,e=>e.location),(e,t)=>{t=t||{},console.log("Navigating to",e),console.dir("Data:",t),Ht.set({location:e,data:t});let n=$e.stringify(t);history.pushState({location:e,data:t},`Patchfox - ${e}`,`/index.html?${n}#${e}`)}),Vt={"/thread":class extends oe{constructor(e){super(),re(this,e,Ot,Tt,c,[])}},"/public":class extends oe{constructor(e){super(),re(this,e,pt,mt,c,[])}},"/compose":class extends oe{constructor(e){super(),re(this,e,xt,Nt,c,[])}},"/profile":class extends oe{constructor(e){super(),re(this,e,Et,Lt,c,[])}},"*":class extends oe{constructor(e){super(),re(this,e,null,ft,c,[])}}},Wt=ce([St,Ht],([e,t])=>{let n=t.location;return e?(console.log("currentView, searching for",n),Vt.hasOwnProperty(n)?(console.log("found!",n),Vt[n]):(console.log("didn't find",n),Vt["*"])):Vt["*"]});function qt(t){var n,r,o,s,c,i,l,u,d,m,p,f,h,g,w,N,C,P,R,T,O,j,F,I,A,U,L,E,S,H,D,B,V,W,q,z,J,G,Y,K,Q,X,Z,ee,te;return{c(){n=$("header"),r=$("section"),(o=$("a")).innerHTML='<i class="icon icon-minus text-black"></i>',s=k(),c=$("a"),i=$("figure"),l=$("img"),u=k(),d=$("i"),p=k(),(f=$("a")).textContent="New",h=k(),(g=$("a")).textContent="Public",w=k(),(N=$("a")).textContent="Settings",C=k(),(P=$("a")).textContent="Help",R=k(),T=$("section"),O=$("a"),j=$("figure"),F=$("img"),I=k(),A=$("i"),L=k(),E=$("div"),(S=$("a")).innerHTML='\n\t\t\t        Menu\n\t\t\t        <i class="icon icon-caret"></i>',H=k(),D=$("ul"),(B=$("li")).innerHTML='<a href="#/compose" class="btn btn-link">New</a>',V=k(),(W=$("li")).innerHTML='<a href="#/public" class="btn btn-link">Public</a>',q=k(),z=$("li"),(J=$("a")).textContent="Settings",G=k(),(Y=$("li")).innerHTML='<a href="/docs/index.html" class="btn btn-link">Help</a>',K=k(),Q=$("li"),(X=$("a")).textContent="Open as a Tab",Z=k(),ee=$("div"),o.href="#/sidebar",o.className="btn btn-link",l.src=t.avatar,l.alt="L",d.className=m="avatar-presence "+(t.$connected?"online":"offline")+" svelte-bx117p",i.className="avatar avatar-lg",c.href="#",c.className="navbar-brand mr-2 p-1",f.href="#/compose",f.className="btn btn-link",g.href="#/public",g.className="btn btn-link",N.href="#/settings",N.className="btn btn-link",P.href="/docs/index.html",P.className="btn btn-link",r.className="navbar-section hide-sm",F.src=t.avatar,F.alt="L",A.className=U="avatar-presence "+(t.$connected?"online":"offline")+" svelte-bx117p",j.className="avatar",O.href="...",O.className="navbar-brand mr-2 p-1",S.href="?",S.className="btn btn-link dropdown-toggle",S.tabIndex="0",B.className="menu-item",W.className="menu-item",J.href="#/settings",J.className="btn btn-link",z.className="menu-item",Y.className="menu-item",X.href="#/sidebar",X.className="btn btn-link",Q.className="menu-item",D.className="menu",E.className="dropdown float-right",T.className="navbar-section show-sm bg-gray above svelte-bx117p",ee.className="blocker show-sm svelte-bx117p",n.className="navbar",te=[x(o,"click",t.openSidebar),x(c,"click",t.openMyProfile),x(f,"click",_(M(t.goCompose))),x(g,"click",_(M(t.goPublic))),x(N,"click",t.goSettings),x(S,"click",_(M(zt))),x(J,"click",t.goSettings),x(X,"click",t.closeSidebar)]},m(e,t){b(e,n,t),v(n,r),v(r,o),v(r,s),v(r,c),v(c,i),v(i,l),v(i,u),v(i,d),v(r,p),v(r,f),v(r,h),v(r,g),v(r,w),v(r,N),v(r,C),v(r,P),v(n,R),v(n,T),v(T,O),v(O,j),v(j,F),v(j,I),v(j,A),v(T,L),v(T,E),v(E,S),v(E,H),v(E,D),v(D,B),v(D,V),v(D,W),v(D,q),v(D,z),v(z,J),v(D,G),v(D,Y),v(D,K),v(D,Q),v(Q,X),v(n,Z),v(n,ee)},p(e,t){e.avatar&&(l.src=t.avatar),e.$connected&&m!==(m="avatar-presence "+(t.$connected?"online":"offline")+" svelte-bx117p")&&(d.className=m),e.avatar&&(F.src=t.avatar),e.$connected&&U!==(U="avatar-presence "+(t.$connected?"online":"offline")+" svelte-bx117p")&&(A.className=U)},i:e,o:e,d(e){e&&y(n),a(te)}}}function zt(){return""}function Jt(e,t,n){let r;i(e,St,e=>{n("$connected",r=e)});let o="/images/icon.png";return e.$$.update=((e={$connected:1})=>{e.$connected&&r&&ssb.avatar(ssb.feed).then(e=>{n("avatar",o=`http://localhost:8989/blobs/get/${e.image}`)})}),{avatar:o,goSettings:e=>{browser.runtime.openOptionsPage()},goCompose:()=>Bt("/compose"),goPublic:()=>Bt("/public"),openSidebar:async e=>{let t=window.location.href;browser.sidebarAction.setPanel({panel:t}),browser.sidebarAction.open();let n=await browser.tabs.getCurrent();await browser.tabs.remove(n.id)},closeSidebar:async e=>{let t=await browser.sidebarAction.getPanel({});await browser.tabs.create({url:t}),await browser.sidebarAction.close()},openMyProfile:e=>{e.stopPropagation(),e.preventDefault(),ssb.feed&&Bt("/profile",{feed:ssb.feed})},$connected:r}}class Gt extends oe{constructor(e){super(),re(this,e,Jt,qt,c,[])}}function Yt(e){var t,n,r,o,a=new Gt({}),s=e.$currentView;if(s)var c=new s({});return{c(){t=$("div"),a.$$.fragment.c(),n=k(),c&&c.$$.fragment.c(),t.className="container bg-gray",o=x(window,"popstate",e.popState)},m(e,o){b(e,t,o),te(a,t,null),v(t,n),c&&te(c,t,null),r=!0},p(e,n){if(s!==(s=n.$currentView)){if(c){Y();const e=c;Q(()=>{e.$destroy()}),e.$$.fragment.o(1),K()}s?((c=new s({})).$$.fragment.c(),c.$$.fragment.i(1),te(c,t,null)):c=null}},i(e){r||(a.$$.fragment.i(e),c&&c.$$.fragment.i(e),r=!0)},o(e){a.$$.fragment.o(e),c&&c.$$.fragment.o(e),r=!1},d(e){e&&y(t),a.$destroy(),c&&c.$destroy(),o()}}}function Kt(e,t,n){let r;i(e,Wt,e=>{n("$currentView",r=e)});const o=e=>{(e=>e.hasOwnProperty("keys")||e.hasOwnProperty("keys")||e.hasOwnProperty("keys"))(e)?(e=>{window.ssb=new ae,ssb.connect(e.keys).then(e=>{console.log("connected"),St.set(!0)}).catch(e=>{console.error("can't connect",e),configurationIsMissing()})})(e):a()},a=()=>{console.log("config missing"),window.location="/docs/index.html#/troubleshooting?id=no-configuration"};U(()=>{browser.storage.local.get().then(o,a)}),window.ssb=!1;return{popState:e=>{if(null!==e.state){console.dir("pop",e.state);let{location:t,data:n}=e.state;Ht.set({location:t,data:n})}},$currentView:r}}return new class extends oe{constructor(e){super(),re(this,e,Kt,Yt,c,[])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
