!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";const o=n(4),r=n(5),a=n(6);function s(e,t){return t.encode?t.strict?o(e):encodeURIComponent(e):e}function c(e,t){return t.decode?r(e):e}function i(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function l(e){const t=(e=i(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function u(e,t){const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,o)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===o[e]&&(o[e]={}),o[e][t[1]]=n):o[e]=n};case"bracket":return(e,n,o)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==o[e]?o[e]=[].concat(o[e],n):o[e]=[n]:o[e]=n};case"comma":return(e,t,n)=>{const o="string"==typeof t&&t.split("").indexOf(",")>-1?t.split(","):t;n[e]=o};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=Object.assign({decode:!0,arrayFormat:"none"},t)),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const r of e.split("&")){let[e,s]=a(r.replace(/\+/g," "),"=");s=void 0===s?null:c(s,t),n(c(e,t),s,o)}return Object.keys(o).sort().reduce((e,t)=>{const n=o[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}t.extract=l,t.parse=u,t.stringify=(e,t)=>{if(!e)return"";const n=function(e){switch(e.arrayFormat){case"index":return t=>(n,o)=>{const r=n.length;return void 0===o?n:null===o?[...n,[s(t,e),"[",r,"]"].join("")]:[...n,[s(t,e),"[",s(r,e),"]=",s(o,e)].join("")]};case"bracket":return t=>(n,o)=>void 0===o?n:null===o?[...n,[s(t,e),"[]"].join("")]:[...n,[s(t,e),"[]=",s(o,e)].join("")];case"comma":return t=>(n,o,r)=>null==o||0===o.length?n:0===r?[[s(t,e),"=",s(o,e)].join("")]:[[n,s(o,e)].join(",")];default:return t=>(n,o)=>void 0===o?n:null===o?[...n,s(t,e)]:[...n,[s(t,e),"=",s(o,e)].join("")]}}(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),o=Object.keys(e);return!1!==t.sort&&o.sort(t.sort),o.map(o=>{const r=e[o];return void 0===r?"":null===r?s(o,t):Array.isArray(r)?r.reduce(n(o),[]).join("&"):s(o,t)+"="+s(r,t)}).filter(e=>e.length>0).join("&")},t.parseUrl=(e,t)=>({url:i(e).split("?")[0]||"",query:u(l(e),t)})},function(e,t){var n=function(){};n.prototype.simple=function(e){var t=Date.now(),n=Date.parse(e);try{if(n!=n)throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e}catch(t){return console.error(t),e}return n-t<0?function(e){var t=Date.now();e=Date.parse(e);var n=(t-e)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?Math.round(n)+" second ago":Math.round(n)+" seconds ago";if(o<60&&r<1)return 1===o?Math.round(o)+" minute ago":Math.round(o)+" minutes ago";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?Math.ceil(c)+" year ago":Math.ceil(c)+" years ago"}return Math.round(s)+" month ago"}return 1===a?Math.round(a)+" day ago":Math.round(a)+" days ago"}return 1===r?Math.round(r)+" hour ago":Math.round(r)+" hours ago"}(e):function(e){var t=Date.now(),n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"}(e)},n.prototype.future=function(e){console.warn("timeago-simple: .future function is depricated! Please use .simple for both past and future dates.");var t=Date.now();try{if(Date.parse(e)!=Date.parse(e))throw"timeago-simple: Please check date and time format! Unable to parse the date & time: "+e;if(Date.parse(e)-t<0)throw"timeago-simple: Looks like it's more relevant case for timeago.simple"}catch(t){return console.error(t),e}var n=((e=Date.parse(e))-t)/1e3,o=n/60,r=n/3600;if(n<60&&o<1)return 1===n?"in "+Math.round(n)+" second":"in "+Math.round(n)+" seconds";if(o<60&&r<1)return 1===o?"in "+Math.round(o)+" minute":"in "+Math.round(o)+" minutes";if(r>24){var a=r/24;if(a>30){var s=a/30;if(s>12){var c=s/12;if(c>0)return 1===c?"in "+Math.ceil(c)+" year":"in "+Math.ceil(c)+" years"}return"in "+Math.round(s)+" month"}return 1===a?"in "+Math.round(a)+" day":"in "+Math.round(a)+" days"}return 1===r?"in "+Math.round(r)+" hour":"in "+Math.round(r)+" hours"},e.exports=new n},function(e,t,n){"use strict";function o(e){return e.stopPropagation(),e.preventDefault(),!1}e.exports=function(e,t){e.addEventListener("dragenter",o,!1),e.addEventListener("dragover",o,!1),e.addEventListener("drop",function(e,t){t.stopPropagation(),t.preventDefault(),e(Array.prototype.slice.call(t.dataTransfer.files))}.bind(void 0,t),!1)}},function(e,t,n){e.exports=n(15)},function(e,t,n){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)},function(e,t,n){"use strict";var o=new RegExp("%[a-f0-9]{2}","gi"),r=new RegExp("(%[a-f0-9]{2})+","gi");function a(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],a(n),a(o))}function s(e){try{return decodeURIComponent(e)}catch(r){for(var t=e.match(o),n=1;n<t.length;n++)t=(e=a(t,n).join("")).match(o);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=r.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var o=s(n[0]);o!==n[0]&&(t[n[0]]=o)}n=r.exec(e)}t["%C2"]="�";for(var a=Object.keys(t),c=0;c<a.length;c++){var i=a[c];e=e.replace(new RegExp(i,"g"),t[i])}return e}(e)}}},function(e,t,n){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";function o(){}n.r(t);const r=e=>e;function a(e,t){for(const n in t)e[n]=t[n];return e}function s(e){return e()}function c(){return Object.create(null)}function i(e){e.forEach(s)}function l(e){return"function"==typeof e}function u(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function d(e,t,n){const o=t.subscribe(n);e.$$.on_destroy.push(o.unsubscribe?()=>o.unsubscribe():o)}const m="undefined"!=typeof window;let h=m?()=>window.performance.now():()=>Date.now(),p=m?requestAnimationFrame:o;const f=new Set;let g,b=!1;function v(){f.forEach(e=>{e[0](h())||(f.delete(e),e[1]())}),(b=f.size>0)&&p(v)}function y(e){let t;return b||(b=!0,p(v)),{promise:new Promise(n=>{f.add(t=[e,n])}),abort(){f.delete(t)}}}function k(e,t){e.appendChild(t)}function w(e,t,n){e.insertBefore(t,n||null)}function x(e){e.parentNode.removeChild(e)}function $(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}function N(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function _(e){return document.createElement(e)}function C(e){return document.createTextNode(e)}function P(){return C(" ")}function T(){return C("")}function M(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function F(e){return function(t){return t.preventDefault(),e.call(this,t)}}function S(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function R(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function I(e,t){t=""+t,e.data!==t&&(e.data=t)}function U(e,t,n){e.classList[n?"add":"remove"](t)}function A(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}let O,L=0,j={};function E(e,t,n,o,r,a,s,c=0){const i=16.666/o;let l="{\n";for(let e=0;e<=1;e+=i){const o=t+(n-t)*a(e);l+=100*e+`%{${s(o,1-o)}}\n`}const u=l+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${c}`;if(!j[d]){if(!g){const e=_("style");document.head.appendChild(e),g=e.sheet}j[d]=!0,g.insertRule(`@keyframes ${d} ${u}`,g.cssRules.length)}const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${o}ms linear ${r}ms 1 both`,L+=1,d}function W(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--L&&p(()=>{if(L)return;let e=g.cssRules.length;for(;e--;)g.deleteRule(e);j={}})}function H(e){O=e}function q(){if(!O)throw new Error("Function called outside component initialization");return O}function B(e){q().$$.on_mount.push(e)}const D=[],z=Promise.resolve();let Y=!1;const V=[],K=[],J=[];function G(){Y||(Y=!0,z.then(X))}function Q(e){K.push(e)}function X(){const e=new Set;do{for(;D.length;){const e=D.shift();H(e),Z(e.$$)}for(;V.length;)V.shift()();for(;K.length;){const t=K.pop();e.has(t)||(t(),e.add(t))}}while(D.length);for(;J.length;)J.pop()();Y=!1}function Z(e){e.fragment&&(e.update(e.dirty),i(e.before_render),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_render.forEach(Q))}let ee,te;function ne(){return ee||(ee=Promise.resolve()).then(()=>{ee=null}),ee}function oe(){te={remaining:0,callbacks:[]}}function re(){te.remaining||i(te.callbacks)}function ae(e){te.callbacks.push(e)}function se(e,t){const n=t.token={};function o(e,o,r,s){if(t.token!==n)return;t.resolved=r&&{[r]:s};const c=a(a({},t.ctx),t.resolved),i=e&&(t.current=e)(c);t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==o&&e&&(oe(),ae(()=>{e.d(1),t.blocks[n]=null}),e.o(1),re())}):t.block.d(1),i.c(),i.i&&i.i(1),i.m(t.mount(),t.anchor),X()),t.block=i,t.blocks&&(t.blocks[o]=i)}if((r=e)&&"function"==typeof r.then){if(e.then(e=>{o(t.then,1,t.value,e)},e=>{o(t.catch,2,t.error,e)}),t.current!==t.pending)return o(t.pending,0),!0}else{if(t.current!==t.then)return o(t.then,1,t.value,e),!0;t.resolved={[t.value]:e}}var r}function ce(e,t){ae(()=>{!function(e,t){e.d(1),t.delete(e.key)}(e,t)}),e.o(1)}function ie(e,t,n,o,r,a,s,c,i,l,u,d){let m=e.length,h=a.length,p=m;const f={};for(;p--;)f[e[p].key]=p;const g=[],b=new Map,v=new Map;for(p=h;p--;){const e=d(r,a,p),c=n(e);let i=s.get(c);i?o&&i.p(t,e):(i=l(c,e)).c(),b.set(c,g[p]=i),c in f&&v.set(c,Math.abs(p-f[c]))}const y=new Set,k=new Set;function w(e){e.i&&e.i(1),e.m(c,u),s.set(e.key,e),u=e.first,h--}for(;m&&h;){const t=g[h-1],n=e[m-1],o=t.key,r=n.key;t===n?(u=t.first,m--,h--):b.has(r)?!s.has(o)||y.has(o)?w(t):k.has(r)?m--:v.get(o)>v.get(r)?(k.add(o),w(t)):(y.add(r),m--):(i(n,s),m--)}for(;m--;){const t=e[m];b.has(t.key)||i(t,s)}for(;h;)w(g[h-1]);return g}let le;function ue(e,t,n){const{fragment:o,on_mount:r,on_destroy:a,after_render:c}=e.$$;o.m(t,n),Q(()=>{const t=r.map(s).filter(l);a?a.push(...t):i(t),e.$$.on_mount=[]}),c.forEach(Q)}function de(e,t){e.$$&&(i(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function me(e,t,n,r,a,s){const l=O;H(e);const u=t.props||{},d=e.$$={fragment:null,ctx:null,props:s,update:o,not_equal:a,bound:c(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(l?l.$$.context:[]),callbacks:c(),dirty:null};let m=!1;var h;d.ctx=n?n(e,u,(t,n)=>{d.ctx&&a(d.ctx[t],d.ctx[t]=n)&&(d.bound[t]&&d.bound[t](n),m&&function(e,t){e.$$.dirty||(D.push(e),G(),e.$$.dirty=c()),e.$$.dirty[t]=!0}(e,t))}):u,d.update(),m=!0,i(d.before_render),d.fragment=r(d.ctx),t.target&&(t.hydrate?d.fragment.l((h=t.target,Array.from(h.childNodes))):d.fragment.c(),t.intro&&e.$$.fragment.i&&e.$$.fragment.i(),ue(e,t.target,t.anchor),X()),H(l)}"undefined"!=typeof HTMLElement&&(le=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}$destroy(){de(this,!0),this.$destroy=o}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}});class he{$destroy(){de(this,!0),this.$destroy=o}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function pe(e,t=o){let n;const r=[];function a(t){if(u(e,t)){if(e=t,!n)return;r.forEach(e=>e[1]()),r.forEach(t=>t[0](e))}}return{set:a,update:function(t){a(t(e))},subscribe:function(s,c=o){const i=[s,c];return r.push(i),1===r.length&&(n=t(a)||o),s(e),()=>{const e=r.indexOf(i);-1!==e&&r.splice(e,1),0===r.length&&n()}}}}function fe(e,t,n){const r=!Array.isArray(e),a=r?[e]:e,s=t.length<2;return{subscribe:pe(n,e=>{let n=!1;const c=[];let u=0,d=o;const m=()=>{if(u)return;d();const n=t(r?c[0]:c,e);s?e(n):d=l(n)?n:o},h=a.map((e,t)=>e.subscribe(e=>{c[t]=e,u&=~(1<<t),n&&m()},()=>{u|=1<<t}));return n=!0,m(),function(){i(h),d()}}).subscribe}}const ge=()=>Oo("filters",[]),be=e=>{let t=ge();t.push(e),jo("filters",t)},ve=e=>{let t=ge();jo("filters",t.filter(t=>t!==e))},ye=e=>{let t=ge().filter(e=>"blur"==e.action);if(t.length>0){return!t.map(t=>we(e,t,"blur")).some(e=>e)}return!1},ke=e=>{let t=ge().filter(e=>"hide"==e.action);if(t.length>0){return t.map(t=>we(e,t,"hide")).some(e=>e)}return!0},we=(e,t,n)=>{let o=[];if(t.action!==n)return!0;if(t.expires){let e=new Date(t.expires);if(new Date>e)return!0}if(t.feed&&(t.feed==e.value.author?(console.log("filtered due to feed"),o.push(!0)):o.push(!1)),t.channel&&(console.log("filtered due to channel"),e.value.content.channel&&t.channel==e.value.content.channel?o.push(!0):o.push(!1)),t.keywords.length>0&&"post"==e.value.content.type&&e.value.content.text){let n=t.keywords,r=e.value.content.text.toLowerCase(),a=n.map(e=>r.includes(e.toLowerCase())).some(e=>e);a&&console.log("filtered due to keywords"),o.push(a)}return console.log("res",!o.some(e=>1==e)),!o.some(e=>1==e)},xe=hermiebox.modules.pullStream,$e=hermiebox.modules.ssbSort;let Ne=!1,_e={};class Ce{log(e,t=""){console.log(`[SSB API] - ${e}`,t)}async connect(e){var t=await hermiebox.api.connect(e);this.log("you are",t.id),this.feed=t.id,Ne=t}filterLimit(){let e=Oo("limit",10);return xe.take(e)}filterWithUserFilters(){return xe.filter(e=>ke(e))}filterTypes(){let e={post:"showTypePost",about:"showTypeAbout",vote:"showTypeVote",contact:"showTypeContact",pub:"showTypePub",blog:"showTypeBlog",channel:"showTypeChannel"};return Oo("showTypeUnknown",!1)?xe.filter(()=>!0):xe.filter(t=>{let n=t.value.content.type;return"string"==typeof n&&e[n]?Oo(e[n],!0):Oo("showTypeUnknown",!1)})}public(e){return new Promise((t,n)=>{(e=e||{}).reverse=e.reverse||!0,console.log("opts",e),xe(Ne.createFeedStream(e),xe.filter(e=>e&&e.value&&e.value.content),this.filterTypes(),this.filterWithUserFilters(),this.filterLimit(),xe.collect((e,o)=>{console.log("msgs",o),e&&n(e),t(o)}))})}thread(e){return new Promise((t,n)=>{Ne.get(e,(o,r)=>{if(o)return cb(o);var a={key:e,value:r};xe(Ne.backlinks&&Ne.backlinks.read?Ne.backlinks.read({query:[{$filter:{dest:e,value:{content:{root:e}}}}]}):xe(Ne.links({dest:e,values:!0,rel:"root"}),xe.filter(function(t){var n=t&&t.value&&t.value.content;return n&&"post"===n.type&&n.root===e}),xe.unique("key")),this.filterTypes(),this.filterWithUserFilters(),this.filterLimit(),xe.collect((e,o)=>{e&&n(e),t($e([a].concat(o)))}))})})}mentions(e,t){return new Promise((e,n)=>{xe((e=>{var n={$filter:{dest:e}};return t&&(n.$filter.value={timestamp:{$lt:t}}),Ne.backlinks.read({query:[n],index:"DTA",reverse:!0})})(Ne.id),this.filterTypes(),this.filterWithUserFilters(),this.filterLimit(),xe.collect((t,o)=>{t?n(t):e(o)}))})}async profile(e){try{return await hermiebox.api.profile(e)}catch(e){return console.error(e),!1}}async get(e){return await hermiebox.api.get(e)}async setAvatarCache(e,t){let n={};return n[`avatar-${e}`]=t,browser.storage.local.set(n)}async getCachedAvatar(e){return browser.storage.local.get(`avatar-${e}`)}async avatar(e){if(_e[e])return _e[e];try{let t=await hermiebox.api.avatar(e);return _e[e]=t,t}catch(e){throw e}}async blurbFromMsg(e,t){let n=e;try{let o=await ssb.get(e);return"post"==o.content.type&&(n=this.plainTextFromMarkdown(o.content.text.slice(0,t)+"...")),n}catch(e){return n}}plainTextFromMarkdown(e){let t=this.markdown(e),n=document.createElement("div");return n.innerHTML=t,n.innerText}markdown(e){let t=hermiebox.modules.ssbMarkdown.block(e);return t=t.replace(/<pre>/gi,'<pre class="code">').replace(/<a href="#([^"]*)/gi,function(e,t,n,o){return`<a class="channel-link" href="?channel=${encodeURIComponent(t)}#/channel`}).replace(/<a href="@([^"]*)/gi,function(e,t,n,o){return'<a class="profile-link" href="?feed='+encodeURIComponent(`@${t}`)+"#/profile"}).replace(/target="_blank"/gi,"").replace(/<a href="%([^"]*)/gi,function(e,t,n,o){return`<a class="thread-link" href="?thread=${encodeURIComponent(`%${t}`)}#/thread`}).replace(/<img src="&([^"]*)/gi,function(e,t,n,o){return'<img class="is-image-from-blob" src="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)}).replace(/<a href="&([^"]*)/gi,function(e,t,n,o){return'<a class="image-link" target="_blank" href="http://localhost:8989/blobs/get/&'+encodeURIComponent(t)})}ref(){return hermiebox.modules.ssbRef}getTimestamp(e){const t=e.timestamp,n=e.value.timestamp;return Math.min(t,n)}getRootMsgId(e){if(e&&e.value&&e.value.content){const t=e.value.content.root;if(hermiebox.modules.ssbRef.isMsgId(t))return t}}newPost(e){return new Promise((t,n)=>{let o={type:"post",text:e.text};["root","branch","channel","fork","contentWarning"].forEach(t=>{void 0!==e[t]&&(o[t]=e[t])}),o.mentions=hermiebox.modules.ssbMentions(o.text)||[],o.mentions=o.mentions.filter(e=>e);const r=hermiebox.sbot||!1;console.log("post",o),r?r.publish(o,function(e,o){e?n(e):t(o)}):n("There is no sbot connection")})}follow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1;o&&o.publish({type:"contact",contact:e,following:!0},(e,o)=>{e?n(e):t(o)})})}getBlob(e){return hermiebox.api.getBlob(e)}votes(e){return new Promise((t,n)=>{let o=hermiebox.modules.pullStream,r=hermiebox.sbot;r&&o(r.links({dest:e,rel:"vote",values:!0}),o.collect((e,o)=>{e?n(e):t(o)}))})}like(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:1,expression:"Like"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unlike(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"vote",vote:{link:e,value:0,expression:"Unlike"}};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channels(){return new Promise((e,t)=>{let n=hermiebox.modules.pullStream,o=hermiebox.sbot||!1;o?(console.log("querying channels"),n(o.query.read({query:[{$filter:{value:{content:{channel:{$is:"string"},type:"post"}}}},{$reduce:{channel:["value","content","channel"],count:{$count:!0},timestamp:{$max:["value","timestamp"]}}},{$sort:[["timestamp"],["count"]]}],limit:20}),n.collect(function(n,o){console.log("channels",o),n?t(n):e(o)}))):t("no sbot")})}channel(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1,s={$filter:{value:{content:{channel:e}}}};t.lt&&(s.$filter.value.timestamp={$lt:t.lt}),a?r(a.query.read({query:[s],reverse:!0}),this.filterTypes(),this.filterWithUserFilters(),this.filterLimit(),r.collect(function(e,t){e?o(e):n(t)})):o("no sbot")})}channelSubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelUnsubscribe(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"channel",channel:e,subscribed:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}channelSubscribed(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"channel",channel:e}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.subscribed||!1):n(!1)}))}else o("no sbot")})}subscribedChannels(e,t){return new Promise((e,n)=>{let o=hermiebox.modules.pullStream,r=hermiebox.sbot||!1;if(r){t||(t=r.id);let a={$filter:{value:{author:t,content:{type:"channel"}}},$map:{channel:["value","content","channel"],subscribed:["value","content","subscribed"]},$sort:[["value","timestamp"]]};o(r.query.read({query:[a],reverse:!0}),o.collect(function(t,o){t?n(t):e(o)}))}else n("no sbot")})}follow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,following:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unfollow(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,following:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}block(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,blocking:!0};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}unblock(e){return new Promise((t,n)=>{const o=hermiebox.sbot||!1,r={type:"contact",contact:e,blocking:!1};o&&o.publish(r,function(e,o){e?n(e):t(o)})})}following(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"contact",contact:e,following:{$is:"boolean"}}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.following||!1):n(!1)}))}else o("no sbot")})}blocking(e,t){return new Promise((n,o)=>{let r=hermiebox.modules.pullStream,a=hermiebox.sbot||!1;if(a){t||(t=a.id);let s={$filter:{value:{author:t,content:{type:"contact",contact:e,blocking:{$is:"boolean"}}}}};r(a.query.read({query:[s],reverse:!0}),r.collect(function(e,t){e?o(e):t.length>0?n(t[0].value.content.blocking||!1):n(!1)}))}else o("no sbot")})}query(e,t,n,o){return new Promise((r,a)=>{if(Ne){let s={$filter:e};n&&(s.$map=n),o&&(s.$reduce=o),void 0===t&&(t=!0),xe(Ne.query.read({query:[s],reverse:t}),this.filterTypes(),this.filterLimit(),xe.collect((e,t)=>{e?a(e):r(t)}))}else a("no sbot")})}}var Pe=n(0),Te=n.n(Pe);n(7);function Me(e){var t,n,o,r=e.hasContentWarning&&Se(e);return{c(){r&&r.c(),t=P(),n=_("noscript"),o=_("noscript")},m(a,s){r&&r.m(a,s),w(a,t,s),w(a,n,s),n.insertAdjacentHTML("afterend",e.content),w(a,o,s)},p(e,n){n.hasContentWarning?r?r.p(e,n):((r=Se(n)).c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null)},d(e){r&&r.d(e),e&&(x(t),$(n,o),x(n),x(o))}}}function Fe(e){var t,n,o,r,a,s=e.msg.value.content.contentWarning;return{c(){t=_("p"),n=C(s),o=P(),(r=_("button")).textContent="Show Message",r.className="btn",a=M(r,"click",e.click_handler)},m(e,a){w(e,t,a),k(t,n),w(e,o,a),w(e,r,a)},p(e,t){e.msg&&s!==(s=t.msg.value.content.contentWarning)&&I(n,s)},d(e){e&&(x(t),x(o),x(r)),a()}}}function Se(e){var t,n,o,r,a,s,c,i,l=e.msg.value.content.contentWarning;return{c(){t=_("div"),n=_("p"),(o=_("b")).textContent="Content Warning:",r=P(),a=C(l),s=P(),(c=_("button")).textContent="Hide Message",c.className="btn btn-sm float-right",t.className="toast toast-warning",i=M(c,"click",e.click_handler_1)},m(e,i){w(e,t,i),k(t,n),k(n,o),k(n,r),k(n,a),k(n,s),k(n,c)},p(e,t){e.msg&&l!==(l=t.msg.value.content.contentWarning)&&I(a,l)},d(e){e&&x(t),i()}}}function Re(e){var t,n,o,r,a;return{c(){t=_("span"),n=_("a"),o=C("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=M(n,"click",F(e.goRoot))},m(e,r){w(e,t,r),k(t,n),k(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&x(t),a()}}}function Ie(e){var t,n,o,r,a;return{c(){t=_("span"),n=_("a"),o=C("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=M(n,"click",F(e.goBranch))},m(e,r){w(e,t,r),k(t,n),k(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&x(t),a()}}}function Ue(e){var t,n,r,a,s;return{c(){t=_("div"),(n=_("button")).textContent="Fork",r=P(),(a=_("button")).textContent="Reply",n.className="btn",a.className="btn",t.className="column col-6 text-right",s=[M(n,"click",e.fork),M(a,"click",e.reply)]},m(e,o){w(e,t,o),k(t,n),k(t,r),k(t,a)},p:o,d(e){e&&x(t),i(s)}}}function Ae(e){var t,n,r,a,s,c,i,l,u,d,m,h,p,f;function g(e){return e.hasContentWarning&&e.showContentWarning?Fe:Me}var b=g(e),v=b(e),y=e.msg.value.content.root&&Re(e),$=e.msg.value.content.branch&&Ie(e),N=!e.msg.value.private&&Ue(e);return{c(){t=_("div"),v.c(),n=P(),r=_("div"),a=_("div"),s=_("div"),c=_("label"),i=_("input"),l=P(),u=_("i"),d=C("\r\n        Like"),m=P(),y&&y.c(),h=P(),$&&$.c(),p=P(),N&&N.c(),t.className="card-body svelte-1ftdgav",R(i,"type","checkbox"),i.checked=e.liked,u.className="form-icon",c.className="form-switch d-inline",s.className="column col-6",a.className="columns col-gapless",r.className="card-footer",f=M(i,"change",e.likeChanged)},m(e,o){w(e,t,o),v.m(t,null),w(e,n,o),w(e,r,o),k(r,a),k(a,s),k(s,c),k(c,i),k(c,l),k(c,u),k(c,d),k(s,m),y&&y.m(s,null),k(s,h),$&&$.m(s,null),k(a,p),N&&N.m(a,null)},p(e,n){b===(b=g(n))&&v?v.p(e,n):(v.d(1),(v=b(n))&&(v.c(),v.m(t,null))),e.liked&&(i.checked=n.liked),n.msg.value.content.root?y?y.p(e,n):((y=Re(n)).c(),y.m(s,h)):y&&(y.d(1),y=null),n.msg.value.content.branch?$?$.p(e,n):(($=Ie(n)).c(),$.m(s,null)):$&&($.d(1),$=null),n.msg.value.private?N&&(N.d(1),N=null):N?N.p(e,n):((N=Ue(n)).c(),N.m(a,null))},i:o,o:o,d(e){e&&x(t),v.d(),e&&(x(n),x(r)),y&&y.d(),$&&$.d(),N&&N.d(),f()}}}function Oe(e,t,n){let{msg:o}=t,r=ssb.markdown(o.value.content.text),a=!1,s=o.value.content.contentWarning||!1,c=!0;ssb.votes(o.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",a=!0)})});return e.$set=e=>{"msg"in e&&n("msg",o=e.msg)},{msg:o,content:r,liked:a,hasContentWarning:s,showContentWarning:c,likeChanged:e=>{e.target.checked?ssb.like(o.key).then(()=>console.log("liked",o.key)).catch(()=>{const e=a=!1;return n("liked",a),e}):ssb.unlike(o.key).then(()=>console.log("unliked",o.key)).catch(()=>{const e=a=!0;return n("liked",a),e})},reply:e=>{let t=o.value.content.root||o.key,n=o.value.content.channel,r=o.value.author;Fo("/compose",{root:t,branch:o.key,channel:n,replyfeed:r})},fork:e=>{let t=o.value.content.root||o.key,n=o.value.content.channel,r=o.value.author;Fo("/compose",{root:o.key,branch:o.key,fork:t,channel:n,replyfeed:r})},goRoot:e=>{let t=o.value.content.root||o.key;Fo("/thread",{thread:t})},goBranch:e=>{let t=o.value.content.branch||o.key;Fo("/thread",{thread:t})},click_handler:function(){const e=c=!c;return n("showContentWarning",c),e},click_handler_1:function(){const e=c=!c;return n("showContentWarning",c),e}}}var Le=class extends he{constructor(e){super(),me(this,e,Oe,Ae,u,["msg"])}};n(8);function je(e){var t,n,r,a;return{c(){t=_("div"),n=_("pre"),r=_("code"),a=C(e.rawContent),n.className="code svelte-mp70wj",t.className="card-body"},m(e,o){w(e,t,o),k(t,n),k(n,r),k(r,a)},p:o,i:o,o:o,d(e){e&&x(t)}}}function Ee(e,t,n){let{msg:o}=t,r=JSON.stringify(o,null,2);return e.$set=e=>{"msg"in e&&n("msg",o=e.msg)},{msg:o,rawContent:r}}var We=class extends he{constructor(e){super(),me(this,e,Ee,je,u,["msg"])}};function He(e){var t,n,r,a,s,c,i,l;return{c(){t=_("div"),n=C(e.person),r=P(),a=C(e.expression),s=P(),c=_("a"),i=C(e.label),c.href="/index.html?thread="+e.encodedid+"#/thread",t.className="card-body",l=M(c,"click",e.goThread)},m(e,o){w(e,t,o),k(t,n),k(t,r),k(t,a),k(t,s),k(t,c),k(c,i)},p(e,t){e.person&&I(n,t.person),e.label&&I(i,t.label)},i:o,o:o,d(e){e&&x(t),l()}}}function qe(e,t,n){let{msg:o}=t,r=o.value.content.vote.expression,a=o.value.content.vote.link,s=encodeURIComponent(a),c=a,i=o.value.author;ssb.blurbFromMsg(a,100).then(e=>{n("label",c=e)}),ssb.avatar(o.value.author).then(e=>{const t=i=e.name;return n("person",i),t});return e.$set=e=>{"msg"in e&&n("msg",o=e.msg)},{msg:o,expression:r,encodedid:s,label:c,person:i,goThread:e=>{e.stopPropagation(),e.preventDefault(),e.ctrlKey?window.open(`?thread=${encodeURIComponent(a)}#/thread`):Fo("/thread",{thread:a})}}}var Be=class extends he{constructor(e){super(),me(this,e,qe,He,u,["msg"])}};function De(e){var t;return{c(){(t=_("div")).innerHTML="<p>🔒 PRIVATE</p>",t.className="card-body"},m(e,n){w(e,t,n)},p:o,i:o,o:o,d(e){e&&x(t)}}}function ze(e,t,n){let{msg:o}=t;return e.$set=e=>{"msg"in e&&n("msg",o=e.msg)},{msg:o}}var Ye=class extends he{constructor(e){super(),me(this,e,ze,De,u,["msg"])}};function Ve(e){var t,n,r,a,s,c,i,l;return{c(){t=_("div"),n=C(e.person),r=P(),a=C(e.verb),s=P(),c=_("a"),i=C(e.otherPersonName),c.href="?feed="+e.otherPersonFeed+"#/profile",t.className="card-body",l=M(c,"click",e.goProfile)},m(e,o){w(e,t,o),k(t,n),k(t,r),k(t,a),k(t,s),k(t,c),k(c,i)},p(e,t){e.person&&I(n,t.person),e.verb&&I(a,t.verb),e.otherPersonName&&I(i,t.otherPersonName)},i:o,o:o,d(e){e&&x(t),l()}}}function Ke(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.contact),s=a,c=o.value.content.following?"followed":"unfollowed";o.value.content.blocking&&n("verb",c="blocked"),ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),ssb.avatar(o.value.content.contact).then(e=>{n("otherPersonName",s=e.name)}).catch(e=>console.log(e));return e.$set=e=>{"msg"in e&&n("msg",o=e.msg)},{msg:o,person:r,otherPersonFeed:a,otherPersonName:s,verb:c,goProfile:e=>{e.stopPropagation(),e.preventDefault(),Fo("/profile",{feed:o.value.content.contact})}}}var Je=class extends he{constructor(e){super(),me(this,e,Ke,Ve,u,["msg"])}};function Ge(e){var t,n,r,a,s,c,i,l,u;return{c(){t=_("div"),n=C(e.person),r=P(),a=C(e.verb),s=P(),c=_("a"),i=C("#"),l=C(e.channel),c.href="?channel="+e.channel+"#/channel",t.className="card-body",u=M(c,"click",e.goChannel)},m(e,o){w(e,t,o),k(t,n),k(t,r),k(t,a),k(t,s),k(t,c),k(c,i),k(c,l)},p(e,t){e.person&&I(n,t.person)},i:o,o:o,d(e){e&&x(t),u()}}}function Qe(e,t,n){let{msg:o}=t,r=o.value.author,a=o.value.content.subscribed?"subscribed":"unsubscribed",s=encodeURIComponent(o.value.content.channel);ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t});return e.$set=e=>{"msg"in e&&n("msg",o=e.msg)},{msg:o,person:r,verb:a,channel:s,goChannel:e=>{e.stopPropagation(),e.preventDefault(),Fo("/channel",{channel:o.value.content.channel})}}}var Xe=class extends he{constructor(e){super(),me(this,e,Qe,Ge,u,["msg"])}};function Ze(e){var t,n,o;return{c(){t=_("div"),n=C(e.person),o=C(" is doing something related to a gathering but gatherings are not\r\n      supported yet, sorry."),t.className="toast"},m(e,r){w(e,t,r),k(t,n),k(t,o)},p(e,t){e.person&&I(n,t.person)},d(e){e&&x(t)}}}function et(e){var t,n,o,r,a,s,c;function i(e){return e.image?nt:tt}var l=i(e),u=l(e),d=e.msg.value.content.description&&ot(e);return{c(){t=C(e.person),n=P(),o=C(e.verb),r=P(),a=_("a"),u.c(),s=P(),d&&d.c(),c=T(),a.href="?feed="+e.otherLink+"#/profile"},m(e,i){w(e,t,i),w(e,n,i),w(e,o,i),w(e,r,i),w(e,a,i),u.m(a,null),w(e,s,i),d&&d.m(e,i),w(e,c,i)},p(e,n){e.person&&I(t,n.person),e.verb&&I(o,n.verb),l===(l=i(n))&&u?u.p(e,n):(u.d(1),(u=l(n))&&(u.c(),u.m(a,null))),n.msg.value.content.description?d?d.p(e,n):((d=ot(n)).c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null)},d(e){e&&(x(t),x(n),x(o),x(r),x(a)),u.d(),e&&x(s),d&&d.d(e),e&&x(c)}}}function tt(e){var t,n;return{c(){t=_("span"),n=C(e.otherName),t.className="chip"},m(e,o){w(e,t,o),k(t,n)},p(e,t){e.otherName&&I(n,t.otherName)},d(e){e&&x(t)}}}function nt(e){var t,n,o,r;return{c(){t=_("div"),n=_("img"),o=P(),r=C(e.otherName),n.src=e.image,n.className="avatar avatar-sm",n.alt=e.otherName,t.className="chip"},m(e,a){w(e,t,a),k(t,n),k(t,o),k(t,r)},p(e,t){e.otherName&&(n.alt=t.otherName,I(r,t.otherName))},d(e){e&&x(t)}}}function ot(e){var t,n=e.ssb.markdown(e.msg.value.content.description);return{c(){t=_("blockquote")},m(e,o){w(e,t,o),t.innerHTML=n},p(e,o){e.msg&&n!==(n=o.ssb.markdown(o.msg.value.content.description))&&(t.innerHTML=n)},d(e){e&&x(t)}}}function rt(e){var t;function n(e){return e.isThisAboutFeeds?et:Ze}var r=n(e),a=r(e);return{c(){t=_("div"),a.c(),t.className="card-body"},m(e,n){w(e,t,n),a.m(t,null)},p(e,o){r===(r=n(o))&&a?a.p(e,o):(a.d(1),(a=r(o))&&(a.c(),a.m(t,null)))},i:o,o:o,d(e){e&&x(t),a.d()}}}function at(e,t,n){let{msg:o}=t,r=o.value.author,a=encodeURIComponent(o.value.content.about),s=o.value.content.name||o.value.content.about,c=!0,i=o.value.content.about===o.value.author?"self-identifies":"identifies";ssb.avatar(o.value.author).then(e=>{const t=r=e.name;return n("person",r),t}),s===o.value.content.about&&ssb.avatar(o.value.content.about).then(e=>{const t=s=e.name;return n("otherName",s),t});let l=!!o.value.content.image&&`http://localhost:8989/blobs/get/${encodeURIComponent(o.value.content.image)}`;return o.value.content.description&&n("verb",i+=" with description"),o.value.content.about.startsWith("%")&&n("isThisAboutFeeds",c=!1),e.$set=e=>{"msg"in e&&n("msg",o=e.msg)},{msg:o,person:r,otherLink:a,otherName:s,isThisAboutFeeds:c,verb:i,image:l,ssb:ssb}}var st=class extends he{constructor(e){super(),me(this,e,at,rt,u,["msg"])}};function ct(e){var t,n,r,a,s,c,i,l;return{c(){t=_("div"),n=C(e.person),r=C(" announced pub\r\n  "),a=_("a"),s=C(e.host),c=C(":"),i=C(e.port),a.href="/index.html?feed="+e.encodedid+"#/profile",t.className="card-body",l=M(a,"click",e.goProfile)},m(e,o){w(e,t,o),k(t,n),k(t,r),k(t,a),k(a,s),k(a,c),k(a,i)},p(e,t){e.person&&I(n,t.person)},i:o,o:o,d(e){e&&x(t),l()}}}function it(e,t,n){let{msg:o}=t,r=encodeURIComponent(o.value.content.address.key),a=o.value.author,s=o.value.content.address.host,c=o.value.content.address.port;ssb.avatar(o.value.author).then(e=>{const t=a=e.name;return n("person",a),t});return e.$set=e=>{"msg"in e&&n("msg",o=e.msg)},{msg:o,encodedid:r,person:a,host:s,port:c,goProfile:e=>{e.stopPropagation(),e.preventDefault(),Fo("/profile",{feed:o.value.content.address.key})}}}var lt=class extends he{constructor(e){super(),me(this,e,it,ct,u,["msg"])}};function ut(e){var t,n;return{c(){t=_("div"),(n=_("img")).src="http://localhost:8989/blobs/get/"+encodeURIComponent(e.thumbnail),n.className="img-responsive",n.alt=e.title,t.className="card-image"},m(e,o){w(e,t,o),k(t,n)},p:o,d(e){e&&x(t)}}}function dt(e){var t,n;return{c(){t=_("h1"),n=C(e.title),t.className="card-title h5"},m(e,o){w(e,t,o),k(t,n)},p:o,d(e){e&&x(t)}}}function mt(e){var t,n,o;return{c(){t=_("div"),n=C("Can't load blogpost: "),o=C(e.toastMsg),t.className="toast toast-error"},m(e,r){w(e,t,r),k(t,n),k(t,o)},p(e,t){e.toastMsg&&I(o,t.toastMsg)},d(e){e&&x(t)}}}function ht(e){var t,n;return{c(){t=_("noscript"),n=_("noscript")},m(o,r){w(o,t,r),t.insertAdjacentHTML("afterend",e.summary),w(o,n,r)},p:o,d(e){e&&($(t,n),x(t),x(n))}}}function pt(e){var t,n;return{c(){t=_("noscript"),n=_("noscript")},m(o,r){w(o,t,r),t.insertAdjacentHTML("afterend",e.post),w(o,n,r)},p(e,o){e.post&&($(t,n),t.insertAdjacentHTML("afterend",o.post))},d(e){e&&($(t,n),x(t),x(n))}}}function ft(e){var t,n,o,r,a;return{c(){t=_("span"),n=_("a"),o=C("(root)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.root)+"#/thread",a=M(n,"click",F(e.goRoot))},m(e,r){w(e,t,r),k(t,n),k(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.root)+"#/thread")&&(n.href=r)},d(e){e&&x(t),a()}}}function gt(e){var t,n,o,r,a;return{c(){t=_("span"),n=_("a"),o=C("(in reply to)"),n.href=r="?thread="+encodeURIComponent(e.msg.value.content.branch)+"#/thread",a=M(n,"click",F(e.goBranch))},m(e,r){w(e,t,r),k(t,n),k(n,o)},p(e,t){e.msg&&r!==(r="?thread="+encodeURIComponent(t.msg.value.content.branch)+"#/thread")&&(n.href=r)},d(e){e&&x(t),a()}}}function bt(e){var t,n;return{c(){(t=_("button")).textContent="Close Blogpost",t.className="btn btn-primary",U(t,"locating",e.loading),n=M(t,"click",e.click_handler)},m(e,n){w(e,t,n)},p(e,n){e.loading&&U(t,"locating",n.loading)},d(e){e&&x(t),n()}}}function vt(e){var t,n;return{c(){(t=_("button")).textContent="Read Blogpost",t.className="btn btn-primary",U(t,"locating",e.loading),n=M(t,"click",e.displayBlogPost)},m(e,n){w(e,t,n)},p(e,n){e.loading&&U(t,"locating",n.loading)},d(e){e&&x(t),n()}}}function yt(e){var t,n,r,a,s,c,l,u,d,m,h,p,f,g,b,v,y,$,N,T,F=e.thumbnail&&ut(e),S=e.title&&dt(e),I=e.toast&&mt(e);function U(e){return e.showBlogpost?pt:ht}var A=U(e),O=A(e),L=e.msg.value.content.root&&ft(e),j=e.msg.value.content.branch&&gt(e);function E(e){return e.showBlogpost?bt:vt}var W=E(e),H=W(e);return{c(){F&&F.c(),t=P(),n=_("div"),S&&S.c(),r=P(),I&&I.c(),a=P(),O.c(),s=P(),c=_("div"),l=_("div"),u=_("div"),d=_("label"),m=_("input"),h=P(),p=_("i"),f=C("\r\n        Like"),g=P(),L&&L.c(),b=P(),j&&j.c(),v=P(),y=_("div"),($=_("button")).textContent="Reply",N=P(),H.c(),n.className="card-body",R(m,"type","checkbox"),m.checked=e.liked,p.className="form-icon",d.className="form-switch d-inline",u.className="column col-6",$.className="btn",y.className="column col-6 text-right",l.className="columns col-gapless",c.className="card-footer",T=[M(m,"change",e.likeChanged),M($,"click",e.reply)]},m(e,o){F&&F.m(e,o),w(e,t,o),w(e,n,o),S&&S.m(n,null),k(n,r),I&&I.m(n,null),k(n,a),O.m(n,null),w(e,s,o),w(e,c,o),k(c,l),k(l,u),k(u,d),k(d,m),k(d,h),k(d,p),k(d,f),k(u,g),L&&L.m(u,null),k(u,b),j&&j.m(u,null),k(l,v),k(l,y),k(y,$),k(y,N),H.m(y,null)},p(e,o){o.thumbnail?F?F.p(e,o):((F=ut(o)).c(),F.m(t.parentNode,t)):F&&(F.d(1),F=null),o.title?S?S.p(e,o):((S=dt(o)).c(),S.m(n,r)):S&&(S.d(1),S=null),o.toast?I?I.p(e,o):((I=mt(o)).c(),I.m(n,a)):I&&(I.d(1),I=null),A===(A=U(o))&&O?O.p(e,o):(O.d(1),(O=A(o))&&(O.c(),O.m(n,null))),e.liked&&(m.checked=o.liked),o.msg.value.content.root?L?L.p(e,o):((L=ft(o)).c(),L.m(u,b)):L&&(L.d(1),L=null),o.msg.value.content.branch?j?j.p(e,o):((j=gt(o)).c(),j.m(u,null)):j&&(j.d(1),j=null),W===(W=E(o))&&H?H.p(e,o):(H.d(1),(H=W(o))&&(H.c(),H.m(y,null)))},i:o,o:o,d(e){F&&F.d(e),e&&(x(t),x(n)),S&&S.d(),I&&I.d(),O.d(),e&&(x(s),x(c)),L&&L.d(),j&&j.d(),H.d(),i(T)}}}function kt(e,t,n){let o;d(e,Mo,e=>{n("$routeLocation",o=e)});let{msg:r}=t,a=r.value.content,s=ssb.markdown(a.summary),c=a.thumbnail||!1,i=a.title||!1,l=!1,u=!1,m=!1,h="",p=s,f=!1;ssb.votes(r.key).then(e=>{e.forEach(e=>{e.value.author===ssb.feed&&1===e.value.content.vote.value&&n("liked",f=!0)})});const g=e=>{n("loading",u=!0),console.log("loading blogpost",a.blog),ssb.getBlob(a.blog).then(e=>{n("post",p=ssb.markdown(e)),n("showBlogpost",l=!0)}).catch(e=>{console.error("can't load blog post",e),n("toast",m=!0),n("toastMsg",h=e)})};return"/thread"==o&&setTimeout(g,100),e.$set=e=>{"msg"in e&&n("msg",r=e.msg)},{msg:r,summary:s,thumbnail:c,title:i,showBlogpost:l,loading:u,toast:m,toastMsg:h,post:p,liked:f,likeChanged:e=>{e.target.checked?ssb.like(r.key).then(()=>console.log("liked",r.key)).catch(()=>{const e=f=!1;return n("liked",f),e}):ssb.unlike(r.key).then(()=>console.log("unliked",r.key)).catch(()=>{const e=f=!0;return n("liked",f),e})},displayBlogPost:g,reply:e=>{let t=r.value.content.root||r.key,n=r.value.content.channel;Fo("/compose",{root:t,branch:r.key,channel:n})},goRoot:e=>{let t=r.value.content.root||r.key;Fo("/thread",{thread:t})},goBranch:e=>{let t=r.value.content.branch||r.key;Fo("/thread",{thread:t})},click_handler:function(){const e=l=!1;return n("showBlogpost",l),e}}}var wt=class extends he{constructor(e){super(),me(this,e,kt,yt,u,["msg"])}};function xt(e){var t,n,o;return{c(){t=_("span"),n=C(e.name),t.className="chip",o=M(t,"click",e.avatarClick)},m(e,o){w(e,t,o),k(t,n)},p(e,t){e.name&&I(n,t.name)},d(e){e&&x(t),o()}}}function $t(e){var t,n,o,r,a;return{c(){t=_("div"),n=_("img"),o=P(),r=C(e.name),n.src=e.image,n.className="avatar avatar-sm",t.className="chip",a=M(t,"click",e.avatarClick)},m(e,a){w(e,t,a),k(t,n),k(t,o),k(t,r)},p(e,t){e.image&&(n.src=t.image),e.name&&I(r,t.name)},d(e){e&&x(t),a()}}}function Nt(e){var t;function n(e){return e.image?$t:xt}var r=n(e),a=r(e);return{c(){a.c(),t=T()},m(e,n){a.m(e,n),w(e,t,n)},p(e,o){r===(r=n(o))&&a?a.p(e,o):(a.d(1),(a=r(o))&&(a.c(),a.m(t.parentNode,t)))},i:o,o:o,d(e){a.d(e),e&&x(t)}}}function _t(e,t,n){let{feed:o}=t,r=!1,a=o;const s=function(){const e=O;return(t,n)=>{const o=e.$$.callbacks[t];if(o){const r=A(t,n);o.slice().forEach(t=>{t.call(e,r)})}}}();return ssb.avatar(o).then(e=>{null!==e.image&&n("image",r=`http://localhost:8989/blobs/get/${e.image}`),n("name",a=e.name)}),e.$set=e=>{"feed"in e&&n("feed",o=e.feed)},{feed:o,image:r,name:a,avatarClick:function(){s("avatarClick",{feed:o,name:a})}}}var Ct=class extends he{constructor(e){super(),me(this,e,_t,Nt,u,["feed"])}},Pt=n(1),Tt=n.n(Pt);var Mt=e=>Tt.a.simple(new Date(e));n(9);function Ft(e){var t;return{c(){(t=_("span")).textContent="PRIVATE",t.className="label"},m(e,n){w(e,t,n)},d(e){e&&x(t)}}}function St(e){var t,n,o=e.msg.value.content.channel;return{c(){t=C("#"),n=C(o)},m(e,o){w(e,t,o),w(e,n,o)},p(e,t){e.msg&&o!==(o=t.msg.value.content.channel)&&I(n,o)},d(e){e&&(x(t),x(n))}}}function Rt(e){var t;return{c(){t=C("Close raw message")},m(e,n){w(e,t,n)},d(e){e&&x(t)}}}function It(e){var t;return{c(){t=C("Show raw message")},m(e,n){w(e,t,n)},d(e){e&&x(t)}}}function Ut(e){var t,n,r,a,s,c,i,l,u,d,m,h,p,f,g,b,v,y,$,N,T;return{c(){t=_("div"),n=_("div"),r=_("div"),a=_("pre"),s=_("code"),c=C(e.rawContent),i=P(),l=_("div"),u=_("p"),d=C("This is a message of type\r\n            "),m=_("em"),h=C(e.type),p=C("\r\n            ."),f=P(),g=_("p"),b=C("To learn more about it, go to\r\n            "),v=_("a"),y=C("the documentation about messages with type "),$=C(e.type),T=C("\r\n            ."),a.className="code",r.className="column col-9",v.target="_blank",v.href=N="/docs/index.html#/message_types/"+e.type,l.className="column col-3",n.className="columns",t.className="card-body"},m(e,o){w(e,t,o),k(t,n),k(n,r),k(r,a),k(a,s),k(s,c),k(n,i),k(n,l),k(l,u),k(u,d),k(u,m),k(m,h),k(u,p),k(l,f),k(l,g),k(g,b),k(g,v),k(v,y),k(v,$),k(g,T)},p(e,t){e.type&&(I(h,t.type),I($,t.type)),e.type&&N!==(N="/docs/index.html#/message_types/"+t.type)&&(v.href=N)},i:o,o:o,d(e){e&&x(t)}}}function At(e){var t,n,o=e.selectedRenderer;function r(e){return{props:{msg:e.msg}}}if(o)var a=new o(r(e));return{c(){a&&a.$$.fragment.c(),t=T()},m(e,o){a&&ue(a,e,o),w(e,t,o),n=!0},p(e,n){var s={};if(e.msg&&(s.msg=n.msg),o!==(o=n.selectedRenderer)){if(a){oe();const e=a;ae(()=>{e.$destroy()}),e.$$.fragment.o(1),re()}o?((a=new o(r(n))).$$.fragment.c(),a.$$.fragment.i(1),ue(a,t.parentNode,t)):a=null}else o&&a.$set(s)},i(e){n||(a&&a.$$.fragment.i(e),n=!0)},o(e){a&&a.$$.fragment.o(e),n=!1},d(e){e&&x(t),a&&a.$destroy(e)}}}function Ot(e){var t,n,o,r,a,s,c,l,u,d,m,h,p,f,g,b,v,y,$,N,T,S,R,A,O,L,j,E,W,H,q,B,D,z,Y,V,K,J,G,Q,X,Z,ee,te,ne,se,ce,ie=Mt(e.msg.value.timestamp),le=e.privateMsgForYou&&Ft(),ue=e.msg.value.content.channel&&St(e);function de(e){return e.showRaw?Rt:It}var me=de(e),he=me(e),pe=[At,Ut],fe=[];function ge(e){return e.showRaw?1:0}return te=ge(e),ne=fe[te]=pe[te](e),{c(){t=_("div"),n=_("div"),o=_("div"),r=_("div"),a=_("div"),s=_("div"),c=_("div"),l=_("img"),u=P(),d=_("div"),m=_("div"),h=C(e.name),p=P(),f=_("small"),g=C(ie),b=P(),le&&le.c(),v=P(),y=_("div"),$=_("span"),ue&&ue.c(),N=P(),T=_("div"),(S=_("span")).innerHTML='<i class="icon icon-more-vert"></i>',R=P(),A=_("ul"),O=_("li"),L=_("a"),j=_("i"),E=C("\r\n              Open in new tab"),H=P(),q=_("li"),(B=_("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy permalink to clipboard\n\t\t\t            ',D=P(),z=_("li"),(Y=_("a")).innerHTML='<i class="icon icon-copy"></i>\n\t\t\t              Copy message id to clipboard\n\t\t\t            ',V=P(),K=_("li"),J=P(),G=_("li"),Q=_("a"),X=_("i"),Z=P(),he.c(),ee=P(),ne.c(),l.src=e.image,l.className="avatar avatar-lg svelte-1jn1wek",l.alt=e.feed,c.className="example-tile-icon",s.className="tile-icon",m.className="tile-title",f.className="tile-subtitle text-gray",d.className="tile-content",a.className="tile tile-centered feed-display svelte-1jn1wek",r.className="card-title",o.className="float-left",$.className="text-gray channel-display svelte-1jn1wek",S.className="btn btn-link dropdown-toggle",S.tabIndex="0",U(S,"active",e.dropdownActive),j.className="icon icon-share",L.href=W="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",L.target="_blank",O.className="menu-item",B.href="#",q.className="menu-item",Y.href="#",z.className="menu-item",K.className="divider",K.dataset.content="FOR THE CURIOUS",X.className="icon icon-message",Q.href="#",G.className="menu-item",A.className="menu menu-right svelte-1jn1wek",T.className="dropdown",y.className="float-right",n.className="card-header",t.className="card m-2 svelte-1jn1wek",U(t,"private",e.privateMsgForYou),U(t,"blured",e.blured),ce=[M(a,"click",e.goProfile),M($,"click",e.click_handler),M(S,"click",e.click_handler_1),M(B,"click",F(e.copyPermalink)),M(Y,"click",F(e.copyHash)),M(Q,"click",F(e.toggleRawMessage))]},m(e,i){w(e,t,i),k(t,n),k(n,o),k(o,r),k(r,a),k(a,s),k(s,c),k(c,l),k(a,u),k(a,d),k(d,m),k(m,h),k(d,p),k(d,f),k(f,g),k(n,b),le&&le.m(n,null),k(n,v),k(n,y),k(y,$),ue&&ue.m($,null),k(y,N),k(y,T),k(T,S),k(T,R),k(T,A),k(A,O),k(O,L),k(L,j),k(L,E),k(A,H),k(A,q),k(q,B),k(A,D),k(A,z),k(z,Y),k(A,V),k(A,K),k(A,J),k(A,G),k(G,Q),k(Q,X),k(Q,Z),he.m(Q,null),k(t,ee),fe[te].m(t,null),se=!0},p(e,o){se&&!e.image||(l.src=o.image),se&&!e.name||I(h,o.name),se&&!e.msg||ie===(ie=Mt(o.msg.value.timestamp))||I(g,ie),o.privateMsgForYou?le||((le=Ft()).c(),le.m(n,v)):le&&(le.d(1),le=null),o.msg.value.content.channel?ue?ue.p(e,o):((ue=St(o)).c(),ue.m($,null)):ue&&(ue.d(1),ue=null),e.dropdownActive&&U(S,"active",o.dropdownActive),se&&!e.msg||W===(W="?thread="+o.encodeURIComponent(o.msg.key)+"#/thread")||(L.href=W),me!==(me=de(o))&&(he.d(1),(he=me(o))&&(he.c(),he.m(Q,null)));var r=te;(te=ge(o))===r?fe[te].p(e,o):(oe(),ae(()=>{fe[r].d(1),fe[r]=null}),ne.o(1),re(),(ne=fe[te])||(ne=fe[te]=pe[te](o)).c(),ne.i(1),ne.m(t,null)),e.privateMsgForYou&&U(t,"private",o.privateMsgForYou),e.blured&&U(t,"blured",o.blured)},i(e){se||(ne&&ne.i(),se=!0)},o(e){ne&&ne.o(),se=!1},d(e){e&&x(t),le&&le.d(),ue&&ue.d(),he.d(),fe[te].d(),i(ce)}}}function Lt(e,t,n){let o,r,{msg:a}=t,s=a.value.author,c=!1,i=JSON.stringify(a,null,2),l=!1,u=!1,d={"*":We,post:Le,vote:Be,private:Ye,contact:Je,channel:Xe,about:st,pub:lt,blog:wt};"string"==typeof a.value.content?n("type",o="private"):n("type",o=a.value.content.type),a.value.private&&n("privateMsgForYou",u=!0),d.hasOwnProperty(o)?n("selectedRenderer",r=d[o]):n("selectedRenderer",r=d["*"]);let m="images/icon.png",h=s,p=ye(a);ssb.avatar(s).then(e=>{null!==e.image&&n("image",m=`http://localhost:8989/blobs/get/${e.image}`),n("name",h=e.name)});return e.$set=e=>{"msg"in e&&n("msg",a=e.msg)},{msg:a,type:o,feed:s,showRaw:c,rawContent:i,dropdownActive:l,privateMsgForYou:u,selectedRenderer:r,image:m,name:h,blured:p,toggleRawMessage:()=>{n("showRaw",c=!c),n("dropdownActive",l=!1)},copyPermalink:()=>{navigator.clipboard.writeText(`ssb:${a.key}`).then(()=>console.log("permalink copied")).catch(e=>console.error("can't copy permalink",e)),n("dropdownActive",l=!1)},copyHash:()=>{navigator.clipboard.writeText(`${a.key}`).then(()=>console.log("hash copied")).catch(e=>console.error("can't copy hash",e)),n("dropdownActive",l=!1)},goProfile:e=>{e.ctrlKey?window.open(`?feed=${encodeURIComponent(s)}#/profile`):Fo("/profile",{feed:s})},encodeURIComponent:encodeURIComponent,click_handler:function(){return Fo("/channel",{channel:a.value.content.channel})},click_handler_1:function(){const e=l=!l;return n("dropdownActive",l),e}}}var jt=class extends he{constructor(e){super(),me(this,e,Lt,Ot,u,["msg"])}};function Et(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Wt(e){var t,n,r;return{c(){t=_("div"),n=C("Error: "),r=C(e.error),t.className="toast toast-error"},m(e,o){w(e,t,o),k(t,n),k(t,r)},p:o,d(e){e&&x(t)}}}function Ht(e){var t,n,o,r,a,s,c,l,u,d=[],m=new Map,h=e.msgs;const p=e=>e.msg.key;for(var f=0;f<h.length;f+=1){let t=Et(e,h,f),n=p(t);m.set(n,d[f]=Bt(n,t))}return{c(){for(f=0;f<d.length;f+=1)d[f].c();t=P(),n=_("ul"),o=_("li"),(r=_("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',a=P(),s=_("li"),(c=_("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",c.href="#/public",s.className="page-item page-next",n.className="pagination",u=[M(r,"click",S(F(e.goPrevious))),M(c,"click",S(F(e.goNext)))]},m(e,i){for(f=0;f<d.length;f+=1)d[f].m(e,i);w(e,t,i),w(e,n,i),k(n,o),k(o,r),k(n,a),k(n,s),k(s,c),l=!0},p(e,n){const o=n.msgs;oe(),d=ie(d,e,p,1,n,o,m,t.parentNode,ce,Bt,t,Et),re()},i(e){if(!l){for(var t=0;t<h.length;t+=1)d[t].i();l=!0}},o(e){for(f=0;f<d.length;f+=1)d[f].o();l=!1},d(e){for(f=0;f<d.length;f+=1)d[f].d(e);e&&(x(t),x(n)),i(u)}}}function qt(e){var t;return{c(){(t=_("div")).className="loading loading-lg"},m(e,n){w(e,t,n)},p:o,i:o,o:o,d(e){e&&x(t)}}}function Bt(e,t){var n,o,r=new jt({props:{msg:t.msg}});return{key:e,first:null,c(){n=T(),r.$$.fragment.c(),this.first=n},m(e,t){w(e,n,t),ue(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&x(n),r.$destroy(e)}}}function Dt(e){var t,n,o,r,a,s,c,i=e.error&&Wt(e),l=[qt,Ht],u=[];function d(e){return e.msgs?1:0}return r=d(e),a=u[r]=l[r](e),{c(){(t=_("div")).innerHTML='<div class="columns"><h4 class="column">Public Feed</h4>\n\t\t\t    <div class="column"></div></div>',n=P(),i&&i.c(),o=P(),a.c(),s=T(),t.className="container"},m(e,a){w(e,t,a),w(e,n,a),i&&i.m(e,a),w(e,o,a),u[r].m(e,a),w(e,s,a),c=!0},p(e,t){t.error?i?i.p(e,t):((i=Wt(t)).c(),i.m(o.parentNode,o)):i&&(i.d(1),i=null);var n=r;(r=d(t))===n?u[r].p(e,t):(oe(),ae(()=>{u[n].d(1),u[n]=null}),a.o(1),re(),(a=u[r])||(a=u[r]=l[r](t)).c(),a.i(1),a.m(s.parentNode,s))},i(e){c||(a&&a.i(),c=!0)},o(e){a&&a.o(),c=!1},d(e){e&&(x(t),x(n)),i&&i.d(e),e&&x(o),u[r].d(e),e&&x(s)}}}function zt(e,t,n){let o;d(e,To,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s={};return e.$$.update=(e={opts:1,$routeParams:1,error:1})=>{if(e.opts||e.$routeParams||e.error){Object.assign(s,o),document.title="Patchfox - Public",s.hasOwnProperty("lt")&&(s.lt=parseInt(s.lt),n("opts",s),n("$routeParams",o),n("error",a)),s.hasOwnProperty("limit")&&(s.limit=parseInt(s.limit),n("opts",s),n("$routeParams",o),n("error",a));ssb.public(s).then(e=>{n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}},{msgs:r,error:a,goNext:()=>{Fo("/public",{lt:r[r.length-1].value.timestamp})},goPrevious:()=>{history.back()}}}var Yt=class extends he{constructor(e){super(),me(this,e,zt,Dt,u,[])}};function Vt(e){var t;return{c(){(t=_("div")).className="empty"},m(e,n){w(e,t,n)},p:o,i:o,o:o,d(e){e&&x(t)}}}var Kt=class extends he{constructor(e){super(),me(this,e,null,Vt,u,[])}},Jt=n(2),Gt=n.n(Jt);function Qt(e){const t=e-1;return t*t*t+1}function Xt(e,{delay:t=0,duration:n=400,easing:o=Qt}){const r=getComputedStyle(e),a=+r.opacity,s=parseFloat(r.height),c=parseFloat(r.paddingTop),i=parseFloat(r.paddingBottom),l=parseFloat(r.marginTop),u=parseFloat(r.marginBottom),d=parseFloat(r.borderTopWidth),m=parseFloat(r.borderBottomWidth);return{delay:t,duration:n,easing:o,css:e=>"overflow: hidden;"+`opacity: ${Math.min(20*e,1)*a};`+`height: ${e*s}px;`+`padding-top: ${e*c}px;`+`padding-bottom: ${e*i}px;`+`margin-top: ${e*l}px;`+`margin-bottom: ${e*u}px;`+`border-top-width: ${e*d}px;`+`border-bottom-width: ${e*m}px;`}}n(10);function Zt(e){var t,n,r;return{c(){t=_("div"),n=C("You are forking: "),r=C(e.fork),t.className="toast toast-warning"},m(e,o){w(e,t,o),k(t,n),k(t,r)},p:o,d(e){e&&x(t)}}}function en(e){var t;function n(e){return e.error?nn:tn}var o=n(e),r=o(e);return{c(){r.c(),t=T()},m(e,n){r.m(e,n),w(e,t,n)},p(e,a){o===(o=n(a))&&r?r.p(e,a):(r.d(1),(r=o(a))&&(r.c(),r.m(t.parentNode,t)))},d(e){r.d(e),e&&x(t)}}}function tn(e){var t,n,o,r,a;return{c(){t=_("div"),n=C("Your message has been posted. Do you want to\r\n            "),o=_("a"),r=C("Check it out?"),o.target="_blank",o.href=a="?thread="+e.encodeURIComponent(e.msg.key)+"#/thread",t.className="toast toast-success"},m(e,a){w(e,t,a),k(t,n),k(t,o),k(o,r)},p(e,t){e.msg&&a!==(a="?thread="+t.encodeURIComponent(t.msg.key)+"#/thread")&&(o.href=a)},d(e){e&&x(t)}}}function nn(e){var t,n;return{c(){t=_("div"),n=C(e.msg),t.className="toast toast-error"},m(e,o){w(e,t,o),k(t,n)},p(e,t){e.msg&&I(n,t.msg)},d(e){e&&x(t)}}}function on(e){var t,n,r,a,s,c,l,u,d,m,h,p,f,g,b,v,y,N=e.ssb.markdown(e.content),C=(e.channel||e.root||e.branch||e.contentWarning.length>0)&&an(e);return{c(){t=_("div"),(n=_("h2")).textContent="Post preview",r=P(),C&&C.c(),a=P(),s=_("noscript"),c=_("noscript"),l=P(),u=_("div"),d=P(),m=_("div"),(h=_("div")).innerHTML='<span class="label label-warning">\n\t\t\t                This message will be public and can\'t be edited or deleted\n\t\t\t              </span>',p=P(),f=_("div"),(g=_("button")).textContent="Go Back",b=P(),(v=_("button")).textContent="Post",u.className="divider",h.className="column col-md-12 col-lg-10",g.className="btn",v.className="btn btn-primary",U(v,"loading",e.posting),f.className="column col-md-12 col-lg-2",m.className="columns",t.className="column col-md-12",y=[M(g,"click",e.click_handler),M(v,"click",e.post)]},m(e,o){w(e,t,o),k(t,n),k(t,r),C&&C.m(t,null),k(t,a),k(t,s),s.insertAdjacentHTML("afterend",N),k(t,c),k(t,l),k(t,u),k(t,d),k(t,m),k(m,h),k(m,p),k(m,f),k(f,g),k(f,b),k(f,v)},p(e,n){n.channel||n.root||n.branch||n.contentWarning.length>0?C?C.p(e,n):((C=an(n)).c(),C.m(t,a)):C&&(C.d(1),C=null),e.content&&N!==(N=n.ssb.markdown(n.content))&&($(s,c),s.insertAdjacentHTML("afterend",N)),e.posting&&U(v,"loading",n.posting)},i:o,o:o,d(e){e&&x(t),C&&C.d(),i(y)}}}function rn(e){var t,n,a,s,c,l,u,d,m,p,f,g,b,v,$,N,C,T,I,A,O,L,j,H,q,B=e.branch&&dn(e),D=e.replyfeed&&mn(e),z=e.showContentWarningField&&hn(e),Y=e.ipfsDaemonRunning&&pn(e);return{c(){t=_("div"),(n=_("label")).textContent="Channel",a=P(),s=_("input"),c=P(),B&&B.c(),l=P(),D&&D.c(),u=P(),(d=_("label")).textContent="Message",m=P(),p=_("textarea"),f=P(),g=_("div"),(b=_("button")).textContent="CW",v=P(),z&&z.c(),$=P(),N=_("input"),C=P(),(T=_("button")).textContent="Attach File",I=P(),Y&&Y.c(),A=P(),(O=_("button")).textContent="Preview",n.className="form-label",n.htmlFor="channel",s.className="form-input",R(s,"type","text"),s.id="channel",s.placeholder="channel",d.className="form-label",d.htmlFor="content",p.className="form-input svelte-olsuyr",p.id="content",p.placeholder="Type in your post",p.rows="10",U(p,"file-on-top",e.fileOnTop),b.className="btn btn-link",g.className="d-block m-2",R(N,"type","file"),N.id="fileInput",N.className="svelte-olsuyr",T.className="btn",O.className="btn btn-primary float-right",t.className="form-group",q=[M(s,"input",e.input0_input_handler),M(p,"input",e.textarea_input_handler),M(p,"dragover",S(F(e.dragOver))),M(p,"dragleave",S(F(e.dragLeave))),M(b,"click",e.toggleContentWarning),M(N,"input",e.attachFile),M(T,"click",e.attachFileTrigger),M(O,"click",e.preview)]},m(o,r){w(o,t,r),k(t,n),k(t,a),k(t,s),s.value=e.channel,k(t,c),B&&B.m(t,null),k(t,l),D&&D.m(t,null),k(t,u),k(t,d),k(t,m),k(t,p),p.value=e.content,k(t,f),k(t,g),k(g,b),k(g,v),z&&z.m(g,null),k(t,$),k(t,N),k(t,C),k(t,T),k(t,I),Y&&Y.m(t,null),k(t,A),k(t,O),H=!0},p(e,n){e.channel&&s.value!==n.channel&&(s.value=n.channel),n.branch?B?B.p(e,n):((B=dn(n)).c(),B.m(t,l)):B&&(B.d(1),B=null),n.replyfeed?D?(D.p(e,n),D.i(1)):((D=mn(n)).c(),D.i(1),D.m(t,u)):D&&(oe(),ae(()=>{D.d(1),D=null}),D.o(1),re()),e.content&&(p.value=n.content),e.fileOnTop&&U(p,"file-on-top",n.fileOnTop),n.showContentWarningField?z?z.p(e,n):((z=hn(n)).c(),z.m(g,null)):z&&(z.d(1),z=null),n.ipfsDaemonRunning?Y?Y.p(e,n):((Y=pn(n)).c(),Y.m(t,A)):Y&&(Y.d(1),Y=null)},i(e){H||(D&&D.i(),Q(()=>{j&&j.end(1),L||(L=function(e,t,n){let a,s,c=t(e,n),i=!1,l=0;function u(){a&&W(e,a)}function d(){const{delay:t=0,duration:n=300,easing:d=r,tick:m=o,css:p}=c;p&&(a=E(e,0,1,n,t,d,p,l++)),m(0,1);const f=h()+t,g=f+n;s&&s.abort(),i=!0,s=y(e=>{if(i){if(e>=g)return m(1,0),u(),i=!1;if(e>=f){const t=d((e-f)/n);m(t,1-t)}}return i})}let m=!1;return{start(){m||(W(e),"function"==typeof c?(c=c(),ne().then(d)):d())},invalidate(){m=!1},end(){i&&(u(),i=!1)}}}(t,Xt,{})),L.start()}),H=!0)},o(e){D&&D.o(),L&&L.invalidate(),e&&(j=function(e,t,n){let a,s=t(e,n),c=!0;const l=te;function u(){const{delay:t=0,duration:n=300,easing:u=r,tick:d=o,css:m}=s;m&&(a=E(e,1,0,n,t,u,m));const p=h()+t,f=p+n;y(e=>{if(c){if(e>=f)return d(0,1),--l.remaining||i(l.callbacks),!1;if(e>=p){const t=u((e-p)/n);d(1-t,t)}}return c})}return l.remaining+=1,"function"==typeof s?ne().then(()=>{s=s(),u()}):u(),{end(t){t&&s.tick&&s.tick(1,0),c&&(a&&W(e,a),c=!1)}}}(t,Xt,{})),H=!1},d(e){e&&x(t),B&&B.d(),D&&D.d(),z&&z.d(),Y&&Y.d(),e&&j&&j.end(),i(q)}}}function an(e){var t,n,o,r,a=e.channel&&sn(e),s=e.root&&cn(e),c=e.branch&&ln(e),i=e.contentWarning.length>0&&un(e);return{c(){t=_("blockquote"),a&&a.c(),n=P(),s&&s.c(),o=P(),c&&c.c(),r=P(),i&&i.c()},m(e,l){w(e,t,l),a&&a.m(t,null),k(t,n),s&&s.m(t,null),k(t,o),c&&c.m(t,null),k(t,r),i&&i.m(t,null)},p(e,l){l.channel?a?a.p(e,l):((a=sn(l)).c(),a.m(t,n)):a&&(a.d(1),a=null),l.root?s?s.p(e,l):((s=cn(l)).c(),s.m(t,o)):s&&(s.d(1),s=null),l.branch?c?c.p(e,l):((c=ln(l)).c(),c.m(t,r)):c&&(c.d(1),c=null),l.contentWarning.length>0?i?i.p(e,l):((i=un(l)).c(),i.m(t,null)):i&&(i.d(1),i=null)},d(e){e&&x(t),a&&a.d(),s&&s.d(),c&&c.d(),i&&i.d()}}}function sn(e){var t,n,o,r,a=e.channel.startsWith("#")?e.channel.slice(1):e.channel;return{c(){t=_("p"),(n=_("b")).textContent="Channel:",o=P(),r=C(a)},m(e,a){w(e,t,a),k(t,n),k(t,o),k(t,r)},p(e,t){e.channel&&a!==(a=t.channel.startsWith("#")?t.channel.slice(1):t.channel)&&I(r,a)},d(e){e&&x(t)}}}function cn(e){var t,n,r,a;return{c(){t=_("p"),(n=_("b")).textContent="Root:",r=P(),a=C(e.root)},m(e,o){w(e,t,o),k(t,n),k(t,r),k(t,a)},p:o,d(e){e&&x(t)}}}function ln(e){var t,n,o,r;return{c(){t=_("p"),(n=_("b")).textContent="In Reply To:",o=P(),r=C(e.branch)},m(e,a){w(e,t,a),k(t,n),k(t,o),k(t,r)},p(e,t){e.branch&&I(r,t.branch)},d(e){e&&x(t)}}}function un(e){var t,n,o,r;return{c(){t=_("p"),(n=_("b")).textContent="Content Warning:",o=P(),r=C(e.contentWarning)},m(e,a){w(e,t,a),k(t,n),k(t,o),k(t,r)},p(e,t){e.contentWarning&&I(r,t.contentWarning)},d(e){e&&x(t)}}}function dn(e){var t,n,o,r;return{c(){(t=_("label")).textContent="In reply to",n=P(),o=_("input"),t.className="form-label",t.htmlFor="reply-to",o.className="form-input",R(o,"type","text"),o.id="reply-to",o.placeholder="in reply to",r=M(o,"input",e.input_input_handler)},m(r,a){w(r,t,a),w(r,n,a),w(r,o,a),o.value=e.branch},p(e,t){e.branch&&o.value!==t.branch&&(o.value=t.branch)},d(e){e&&(x(t),x(n),x(o)),r()}}}function mn(e){var t,n,o,r,a=new Ct({props:{feed:e.replyfeed}});return a.$on("avatarClick",e.avatarClick),{c(){t=_("div"),n=_("span"),o=C("Click the avatar to add a link to the message:\r\n                "),a.$$.fragment.c(),t.className="mt-2"},m(e,s){w(e,t,s),k(t,n),k(n,o),ue(a,n,null),r=!0},p(e,t){var n={};e.replyfeed&&(n.feed=t.replyfeed),a.$set(n)},i(e){r||(a.$$.fragment.i(e),r=!0)},o(e){a.$$.fragment.o(e),r=!1},d(e){e&&x(t),a.$destroy()}}}function hn(e){var t,n;return{c(){R(t=_("input"),"type","text"),t.size="50",t.placeholder="Describe your content warning (leave empty to no use it)",n=M(t,"input",e.input_input_handler_1)},m(n,o){w(n,t,o),t.value=e.contentWarning},p(e,n){e.contentWarning&&t.value!==n.contentWarning&&(t.value=n.contentWarning)},d(e){e&&x(t),n()}}}function pn(e){var t,n,r,a;return{c(){t=_("input"),n=P(),(r=_("button")).textContent="Attach File using IPFS",R(t,"type","file"),t.id="fileInputIPFS",t.className="svelte-olsuyr",r.className="btn",a=[M(t,"input",e.attachFileIPFS),M(r,"click",e.attachFileIPFSTrigger)]},m(e,o){w(e,t,o),w(e,n,o),w(e,r,o)},p:o,d(e){e&&(x(t),x(n),x(r)),i(a)}}}function fn(e){var t,n,o,r,a,s,c,i,l=e.fork&&Zt(e),u=e.msg&&en(e),d=[rn,on],m=[];function h(e){return e.showPreview?1:0}return s=h(e),c=m[s]=d[s](e),{c(){t=_("div"),n=_("div"),o=_("div"),l&&l.c(),r=P(),u&&u.c(),a=P(),c.c(),o.className="column",n.className="columns",t.className="container"},m(e,c){w(e,t,c),k(t,n),k(n,o),l&&l.m(o,null),k(o,r),u&&u.m(o,null),k(o,a),m[s].m(o,null),i=!0},p(e,t){t.fork?l?l.p(e,t):((l=Zt(t)).c(),l.m(o,r)):l&&(l.d(1),l=null),t.msg?u?u.p(e,t):((u=en(t)).c(),u.m(o,a)):u&&(u.d(1),u=null);var n=s;(s=h(t))===n?m[s].p(e,t):(oe(),ae(()=>{m[n].d(1),m[n]=null}),c.o(1),re(),(c=m[s])||(c=m[s]=d[s](t)).c(),c.i(1),c.m(o,null))},i(e){i||(c&&c.i(),i=!0)},o(e){c&&c.o(),i=!1},d(e){e&&x(t),l&&l.d(),u&&u.d(),m[s].d()}}}function gn(e,t,n){let o;d(e,To,e=>{n("$routeParams",o=e)});let r=!1,a=!1,s=!1,c=!1,i=o.root,l=o.branch,u=o.channel||"",m=o.content||"",h=o.replyfeed||!1,p=o.fork,f=!1,g=hermiebox.modules.pullStream,b=hermiebox.modules.pullFileReader,v=hermiebox.sbot,y=!1;document.title="Patchfox - compose",B(()=>{n("error",s=!1),n("msg",a=""),Gt()(document.getElementById("content"),e=>w(e)),k()});const k=()=>{let e=Oo("ipfsPort",5001);fetch(`http://127.0.0.1:${e}/api/v0/config/show`).then(e=>{n("ipfsDaemonRunning",y=!0)})},w=e=>{if(n("error",s=!1),n("msg",a=""),0==e.length)return n("fileOnTop",f=!1),console.log("this is not a file"),!1;var t=e[0];return console.log(t),t.type.startsWith("image")?t.size>=5e6?(n("error",s=!0),n("msg",a=`File too large: ${Math.floor(t.size/1048576,2)}mb when max size is 5mb`),!1):void g(b(t),v.blobs.add(function(e,o){e?(n("error",s=!0),n("msg",a="Couldn't attach file: "+e)):n("content",m+=` ![${t.name}](${o})`),n("fileOnTop",f=!1)})):(n("error",s=!0),n("msg",a=`You can only drag & drop image, this file is a ${t.type}`),!1)},x=async e=>{n("error",s=!1),n("msg",a="");var t=window.IpfsHttpClient("127.0.0.1","5001");const o=await t.add(e[0]);console.log("added via IPFS",o),n("content",m+=` [${o[0].path}](ipfs://${o[0].hash})`)};let $=!1;let N="";return{showPreview:r,msg:a,error:s,posting:c,root:i,branch:l,channel:u,content:m,replyfeed:h,fork:p,fileOnTop:f,ipfsDaemonRunning:y,post:async e=>{if(e.stopPropagation(),e.preventDefault(),!c){n("posting",c=!0),u.startsWith("#")&&n("channel",u=u.slice(1));try{n("msg",a=await ssb.newPost({text:m,channel:u,root:i,branch:l,fork:p,contentWarning:N.length>0?N:void 0})),n("posting",c=!1),console.log("posted",a),window.scrollTo(0,0)}catch(e){n("error",s=!0),n("msg",a=`Couldn't post your message: ${e}`),window.scrollTo(0,0),"stream is closed"==a.message&&(n("msg",a+=". We lost connection to sbot. We'll try to restablish it..."),Uo().then(()=>{n("showPreview",r=!1),n("posting",c=!1),n("error",s=!1),n("msg",a="Connection to sbot reestablished. Try posting again")}).catch(e=>{window.location.search=`?root=${encodeURIComponent(i)}&branch=${encodeURIComponent(l)}&content=${encodeURIComponent(m)}&channel=${encodeURIComponent(u)}`,n("msg",a=`Sorry, couldn't reconnect to sbot:${e}. Try reloading the page. Your content has been saved to the URL`)}))}}},preview:e=>{n("showPreview",r=!0)},avatarClick:e=>{let t=e.detail.feed,o=e.detail.name;m.length>0?n("content",m+=` [${o}](${t})`):n("content",m=`[${o}](${t})`)},dragOver:e=>{n("fileOnTop",f=!0)},dragLeave:e=>{n("fileOnTop",f=!1)},attachFileTrigger:()=>{document.getElementById("fileInput").click()},attachFileIPFSTrigger:()=>{document.getElementById("fileInputIPFS").click()},attachFile:e=>{const t=e.target.files;w(t)},attachFileIPFS:e=>{const t=e.target.files;x(t)},showContentWarningField:$,toggleContentWarning:()=>{const e=$=!$;return n("showContentWarningField",$),e},contentWarning:N,ssb:ssb,encodeURIComponent:encodeURIComponent,input0_input_handler:function(){u=this.value,n("channel",u)},input_input_handler:function(){l=this.value,n("branch",l)},textarea_input_handler:function(){m=this.value,n("content",m)},input_input_handler_1:function(){N=this.value,n("contentWarning",N)},click_handler:function(){const e=r=!1;return n("showPreview",r),e}}}var bn=class extends he{constructor(e){super(),me(this,e,gn,fn,u,[])}};function vn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function yn(e){var t,n,o,r,a,s,c;return{c(){t=_("div"),n=C("Couldn't load thead\r\n    "),o=_("a"),r=C(e.msgid),s=C("\r\n    : "),c=C(e.error),o.href=a="?thread="+e.msgid+"#/thread",t.className="toast toast-error"},m(e,a){w(e,t,a),k(t,n),k(t,o),k(o,r),k(t,s),k(t,c)},p(e,t){e.msgid&&I(r,t.msgid),e.msgid&&a!==(a="?thread="+t.msgid+"#/thread")&&(o.href=a),e.error&&I(c,t.error)},d(e){e&&x(t)}}}function kn(e){var t,n,o=[],r=new Map,a=e.msgs;const s=e=>e.msg.key;for(var c=0;c<a.length;c+=1){let t=vn(e,a,c),n=s(t);r.set(n,o[c]=xn(n,t))}return{c(){for(c=0;c<o.length;c+=1)o[c].c();t=T()},m(e,r){for(c=0;c<o.length;c+=1)o[c].m(e,r);w(e,t,r),n=!0},p(e,n){const a=n.msgs;oe(),o=ie(o,e,s,1,n,a,r,t.parentNode,ce,xn,t,vn),re()},i(e){if(!n){for(var t=0;t<a.length;t+=1)o[t].i();n=!0}},o(e){for(c=0;c<o.length;c+=1)o[c].o();n=!1},d(e){for(c=0;c<o.length;c+=1)o[c].d(e);e&&x(t)}}}function wn(e){var t;return{c(){(t=_("div")).className="loading loading-lg"},m(e,n){w(e,t,n)},p:o,i:o,o:o,d(e){e&&x(t)}}}function xn(e,t){var n,o,r=new jt({props:{msg:t.msg}});return{key:e,first:null,c(){n=T(),r.$$.fragment.c(),this.first=n},m(e,t){w(e,n,t),ue(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&x(n),r.$destroy(e)}}}function $n(e){var t,n,o,r,a,s,c,i,l,u,d,m=e.error&&yn(e),h=[wn,kn],p=[];function f(e){return e.msgs||e.error?1:0}return i=f(e),l=p[i]=h[i](e),{c(){t=_("div"),n=_("h4"),o=C("Thread\r\n    "),r=_("small"),a=C(e.msgid),s=P(),m&&m.c(),c=P(),l.c(),u=T(),r.className="label hide-sm",t.className="container"},m(e,l){w(e,t,l),k(t,n),k(n,o),k(n,r),k(r,a),w(e,s,l),m&&m.m(e,l),w(e,c,l),p[i].m(e,l),w(e,u,l),d=!0},p(e,t){d&&!e.msgid||I(a,t.msgid),t.error?m?m.p(e,t):((m=yn(t)).c(),m.m(c.parentNode,c)):m&&(m.d(1),m=null);var n=i;(i=f(t))===n?p[i].p(e,t):(oe(),ae(()=>{p[n].d(1),p[n]=null}),l.o(1),re(),(l=p[i])||(l=p[i]=h[i](t)).c(),l.i(1),l.m(u.parentNode,u))},i(e){d||(l&&l.i(),d=!0)},o(e){l&&l.o(),d=!1},d(e){e&&(x(t),x(s)),m&&m.d(e),e&&x(c),p[i].d(e),e&&x(u)}}}function Nn(e,t,n){let o;d(e,To,e=>{n("$routeParams",o=e)});let r,a=!1,s=!1;return e.$$.update=(e={$routeParams:1,msgid:1})=>{if(e.$routeParams||e.msgid){n("msgid",r=o.thread),r.startsWith("ssb:")&&n("msgid",r=r.replace("ssb:","")),document.title=`Patchfox - Thread: ${r}`;ssb.thread(r).then(e=>{n("msgs",a=e),window.scrollTo(0,0)}).catch(e=>{console.dir(e),n("error",s=e.message)})}},{msgs:a,error:s,msgid:r}}var _n=class extends he{constructor(e){super(),me(this,e,Nn,$n,u,[])}};function Cn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Pn(e){var t,n,r,a=e.n.message;return{c(){t=_("p"),n=C("Error: "),r=C(a)},m(e,o){w(e,t,o),k(t,n),k(t,r)},p:o,i:o,o:o,d(e){e&&x(t)}}}function Tn(e){var t,n,o,r,s,c,i,l,u,d,m,h,p,f,g,b,v,y,$,N=e.ssb.markdown(e.description),T=e.feed!==e.ssb.feed&&Mn(e);let M={ctx:e,current:null,pending:In,then:Sn,catch:Fn,value:"data",error:"n",blocks:Array(3)};return se(y=e.messagePromise,M),{c(){t=_("div"),n=_("div"),o=_("div"),r=_("img"),c=P(),i=_("div"),l=_("h1"),u=C(e.name),d=P(),m=_("pre"),h=C(e.feed),p=P(),T&&T.c(),f=P(),g=_("p"),b=P(),v=_("div"),M.block.c(),r.className="img-responsive",r.src=s="http://localhost:8989/blobs/get/"+e.image,r.alt=e.feed,o.className="container",n.className="column col-6",i.className="column col-6",t.className="columns"},m(e,a){w(e,t,a),k(t,n),k(n,o),k(o,r),k(t,c),k(t,i),k(i,l),k(l,u),k(i,d),k(i,m),k(m,h),k(i,p),T&&T.m(i,null),k(i,f),k(i,g),g.innerHTML=N,w(e,b,a),w(e,v,a),M.block.m(v,M.anchor=null),M.mount=()=>v,M.anchor=null,$=!0},p(t,n){e=n,$&&!t.image||s===(s="http://localhost:8989/blobs/get/"+e.image)||(r.src=s),$&&!t.feed||(r.alt=e.feed),$&&!t.name||I(u,e.name),$&&!t.feed||I(h,e.feed),e.feed!==e.ssb.feed?T?T.p(t,e):((T=Mn(e)).c(),T.m(i,f)):T&&(T.d(1),T=null),$&&!t.description||N===(N=e.ssb.markdown(e.description))||(g.innerHTML=N),M.ctx=e,"messagePromise"in t&&y!==(y=e.messagePromise)&&se(y,M)||M.block.p(t,a(a({},e),M.resolved))},i(e){$||(M.block.i(),$=!0)},o(e){for(let e=0;e<3;e+=1){const t=M.blocks[e];t&&t.o()}$=!1},d(e){e&&x(t),T&&T.d(),e&&(x(b),x(v)),M.block.d(),M=null}}}function Mn(e){var t,n,o,r,a,s,c,l,u,d,m,h,p,f,g,b,v,y;return{c(){t=_("div"),n=_("div"),o=P(),r=_("div"),a=_("label"),s=_("input"),c=P(),l=_("i"),u=C("\r\n                following"),d=P(),m=_("label"),h=_("input"),p=P(),f=_("i"),g=C("\r\n                blocking"),b=P(),v=_("div"),n.className="divider",R(s,"type","checkbox"),l.className="form-icon",a.className="form-switch form-inline",R(h,"type","checkbox"),f.className="form-icon",m.className="form-switch form-inline",r.className="form-group",v.className="divider",t.className="container",y=[M(s,"change",e.input0_change_handler),M(s,"change",e.followingChanged),M(h,"change",e.input1_change_handler),M(h,"change",e.blockingChanged)]},m(i,y){w(i,t,y),k(t,n),k(t,o),k(t,r),k(r,a),k(a,s),s.checked=e.following,k(a,c),k(a,l),k(a,u),k(r,d),k(r,m),k(m,h),h.checked=e.blocking,k(m,p),k(m,f),k(m,g),k(t,b),k(t,v)},p(e,t){e.following&&(s.checked=t.following),e.blocking&&(h.checked=t.blocking)},d(e){e&&x(t),i(y)}}}function Fn(e){var t,n,r,a=e.n.message;return{c(){t=_("p"),n=C("Error fetching messages: "),r=C(a)},m(e,o){w(e,t,o),k(t,n),k(t,r)},p(e,t){e.messagePromise&&a!==(a=t.n.message)&&I(r,a)},i:o,o:o,d(e){e&&x(t)}}}function Sn(e){var t,n,o,r,a,s,c=[],i=new Map,l=e.lastMsgs;const u=e=>e.msg.key;for(var d=0;d<l.length;d+=1){let t=Cn(e,l,d),n=u(t);i.set(n,c[d]=Rn(n,t))}return{c(){for(d=0;d<c.length;d+=1)c[d].c();t=P(),n=_("ul"),o=_("li"),(r=_("a")).innerHTML='<div class="page-item-subtitle">Load More</div>',r.href="#/public",o.className="page-item page-next",n.className="pagination",s=M(r,"click",S(F(e.click_handler)))},m(e,s){for(d=0;d<c.length;d+=1)c[d].m(e,s);w(e,t,s),w(e,n,s),k(n,o),k(o,r),a=!0},p(e,n){const o=n.lastMsgs;oe(),c=ie(c,e,u,1,n,o,i,t.parentNode,ce,Rn,t,Cn),re()},i(e){if(!a){for(var t=0;t<l.length;t+=1)c[t].i();a=!0}},o(e){for(d=0;d<c.length;d+=1)c[d].o();a=!1},d(e){for(d=0;d<c.length;d+=1)c[d].d(e);e&&(x(t),x(n)),s()}}}function Rn(e,t){var n,o,r=new jt({props:{msg:t.msg}});return{key:e,first:null,c(){n=T(),r.$$.fragment.c(),this.first=n},m(e,t){w(e,n,t),ue(r,e,t),o=!0},p(e,t){var n={};e.lastMsgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&x(n),r.$destroy(e)}}}function In(e){var t;return{c(){(t=_("div")).className="loading"},m(e,n){w(e,t,n)},p:o,i:o,o:o,d(e){e&&x(t)}}}function Un(e){var t;return{c(){(t=_("div")).className="loading loading-lg"},m(e,n){w(e,t,n)},p:o,i:o,o:o,d(e){e&&x(t)}}}function An(e){var t,n,o;let r={ctx:e,current:null,pending:Un,then:Tn,catch:Pn,value:"null",error:"n",blocks:Array(3)};return se(n=e.aboutPromise&&e.avatarPromise,r),{c(){t=_("div"),r.block.c(),t.className="container"},m(e,n){w(e,t,n),r.block.m(t,r.anchor=null),r.mount=()=>t,r.anchor=null,o=!0},p(t,o){e=o,r.ctx=e,n!==(n=e.aboutPromise&&e.avatarPromise)&&se(n,r)||r.block.p(t,a(a({},e),r.resolved))},i(e){o||(r.block.i(),o=!0)},o(e){for(let e=0;e<3;e+=1){const t=r.blocks[e];t&&t.o()}o=!1},d(e){e&&x(t),r.block.d(),r=null}}}function On(e,t,n){let o;d(e,To,e=>{n("$routeParams",o=e)});let r,a,s,c=!1,i=!1,l=!1,u=[];n("feed",a=o.feed),a||n("feed",a=ssb.feed);let m=a;document.title=`Patchfox - Feed: ${a}`,console.log("fetching",a);let h=ssb.avatar(a).then(e=>{n("name",m=e.name),n("image",r=e.image),document.title=`Patchfox - Feed: ${m}`}),p=ssb.profile(a).then(e=>{s=e.about.reverse().find(e=>{return e.value.content.hasOwnProperty("description")});try{n("description",c=s.value.content.description)}catch(e){n("description",c="")}window.scrollTo(0,0)}),f=ssb.query({value:{author:a}},10).then(e=>{n("lastMsgs",u=e),window.scrollTo(0,0)});a!==ssb.feed&&(ssb.following(a).then(e=>{const t=i=e;return n("following",i),t}),ssb.blocking(a).then(e=>{const t=l=e;return n("blocking",l),t}));const g=e=>{n("messagePromise",f=ssb.query({value:{author:a,timestamp:{$lt:e}}}).then(e=>{n("lastMsgs",u=e),window.scrollTo(0,0)}))};return{description:c,following:i,blocking:l,image:r,feed:a,lastMsgs:u,name:m,avatarPromise:h,aboutPromise:p,messagePromise:f,blockingChanged:e=>{e.target.checked?ssb.block(a).catch(()=>{const e=l=!1;return n("blocking",l),e}):ssb.unblock(a).catch(()=>{const e=l=!0;return n("blocking",l),e})},followingChanged:e=>{e.target.checked?ssb.follow(a).catch(()=>{const e=i=!1;return n("following",i),e}):ssb.unfollow(a).catch(()=>{const e=i=!0;return n("following",i),e})},loadMoreMessages:g,ssb:ssb,input0_change_handler:function(){i=this.checked,n("following",i)},input1_change_handler:function(){l=this.checked,n("blocking",l)},click_handler:function(){g(u[u.length-1].value.timestamp)}}}var Ln=class extends he{constructor(e){super(),me(this,e,On,An,u,[])}};function jn(e){var t,n,o;return{c(){t=_("div"),n=C(e.msg),t.className=o="toast "+e.toastClass},m(e,o){w(e,t,o),k(t,n)},p(e,r){e.msg&&I(n,r.msg),e.toastClass&&o!==(o="toast "+r.toastClass)&&(t.className=o)},d(e){e&&x(t)}}}function En(e){var t,n,o,r,a=e.cta.label;return{c(){t=_("li"),n=_("a"),o=C(a),n.href="#",r=M(n,"click",S(F(e.cta.action)))},m(e,r){w(e,t,r),k(t,n),k(n,o)},p(e,t){e.cta&&a!==(a=t.cta.label)&&I(o,a)},d(e){e&&x(t),r()}}}function Wn(e){var t,n,r,a,s,c,i,l,u,d,m,h,p,f,g,b,v,y=e.toast&&jn(e),$=e.cta&&En(e);return{c(){t=_("div"),(n=_("h1")).textContent="😿 An Error Has Occurred, sorry 😭",r=P(),y&&y.c(),a=P(),(s=_("h4")).textContent="This is what we know about it",c=P(),i=_("pre"),l=_("code"),u=C(e.error),d=P(),(m=_("p")).textContent="You might want to:",h=P(),p=_("ul"),$&&$.c(),f=P(),(g=_("li")).innerHTML='<a href="/docs/index.html#/troubleshooting/" target="_blank">\n\t\t\t        Open our troubleshooting documentation.\n\t\t\t      </a>',b=P(),(v=_("li")).innerHTML='<a href="https://github.com/soapdog/patchfox/issues" target="_blank">\n\t\t\t        Add an issue\n\t\t\t      </a>\n\t\t\t      to the Patchfox repository.\n\t\t\t    ',i.className="code",t.className="container"},m(e,o){w(e,t,o),k(t,n),k(t,r),y&&y.m(t,null),k(t,a),k(t,s),k(t,c),k(t,i),k(i,l),k(l,u),k(t,d),k(t,m),k(t,h),k(t,p),$&&$.m(p,null),k(p,f),k(p,g),k(p,b),k(p,v)},p(e,n){n.toast?y?y.p(e,n):((y=jn(n)).c(),y.m(t,a)):y&&(y.d(1),y=null),e.error&&I(u,n.error),n.cta?$?$.p(e,n):(($=En(n)).c(),$.m(p,f)):$&&($.d(1),$=null)},i:o,o:o,d(e){e&&x(t),y&&y.d(),$&&$.d()}}}function Hn(e,t,n){let o;d(e,To,e=>{n("$routeParams",o=e)}),document.title="Patchfox - Error";let r,a=o.error,s={},c="",i=!1,l=!1;console.dir(a),"object"==typeof a&&n("error",a=(s=a).message);let u={"Error: stream is closed":{label:"Want to try to reconnect?",action:()=>{n("toast",i=!0),n("toastClass",c="toast-warning"),n("msg",r="Attempting to reconnect to sbot..."),Uo().then(()=>{n("toastClass",c="toast-success"),n("toast",i=!0),n("msg",r="Connection to sbot reestablished. Try going to your public feed.")}).catch(e=>{n("toastClass",c="toast-error"),n("toast",i=!0),n("msg",r="Couldn't reconnect. Try reloading the page.")})}}};return u.hasOwnProperty(a)&&n("cta",l=u[a]),{error:a,toastClass:c,toast:i,msg:r,cta:l}}var qn=class extends he{constructor(e){super(),me(this,e,Hn,Wn,u,[])}};n(11);function Bn(e,t,n){const o=Object.create(e);return o.c=t[n],o}function Dn(e){for(var t,n=e.subscribedChannels,o=[],r=0;r<n.length;r+=1)o[r]=Yn(Bn(e,n,r));return{c(){for(var e=0;e<o.length;e+=1)o[e].c();t=T()},m(e,n){for(var r=0;r<o.length;r+=1)o[r].m(e,n);w(e,t,n)},p(e,r){if(e.subscribedChannels){n=r.subscribedChannels;for(var a=0;a<n.length;a+=1){const s=Bn(r,n,a);o[a]?o[a].p(e,s):(o[a]=Yn(s),o[a].c(),o[a].m(t.parentNode,t))}for(;a<o.length;a+=1)o[a].d(1);o.length=n.length}},d(e){N(o,e),e&&x(t)}}}function zn(e){var t,n,r;return{c(){t=_("div"),n=P(),(r=_("p")).textContent="This is a complex query, it might take a while... Channels will appear as we find them",t.className="loading"},m(e,o){w(e,t,o),w(e,n,o),w(e,r,o)},p:o,d(e){e&&(x(t),x(n),x(r))}}}function Yn(e){var t,n,o,r,a,s=e.c;function c(){return e.click_handler(e)}return{c(){t=_("span"),n=C("#"),o=C(s),r=P(),t.className="channel label label-secondary m-1 svelte-1or0a5q",a=M(t,"click",c)},m(e,a){w(e,t,a),k(t,n),k(t,o),k(t,r)},p(t,n){e=n,t.subscribedChannels&&s!==(s=e.c)&&I(o,s)},d(e){e&&x(t),a()}}}function Vn(e){var t,n,r;function a(e){return 0==e.subscribedChannels.length?zn:Dn}var s=a(e),c=s(e);return{c(){(t=_("h4")).textContent="Subscribed Channels",n=P(),c.c(),r=T()},m(e,o){w(e,t,o),w(e,n,o),c.m(e,o),w(e,r,o)},p(e,t){s===(s=a(t))&&c?c.p(e,t):(c.d(1),(c=s(t))&&(c.c(),c.m(r.parentNode,r)))},i:o,o:o,d(e){e&&(x(t),x(n)),c.d(e),e&&x(r)}}}function Kn(e,t,n){let o=[],r=!0,a=hermiebox.modules.pullStream,s=hermiebox.sbot;return(()=>{let e={$filter:{value:{author:s.id,content:{type:"channel"}}},$sort:[["value","timestamp"]]};a(s.query.read({query:[e],live:!0,reverse:!0,limit:500}),a.drain(e=>{e.sync?(console.log("finished loading"),r=!1):e.value.content.subscribed&&(o.push(e.value.content.channel),n("subscribedChannels",o))}))})(),{subscribedChannels:o,click_handler:function({c:e}){return Fo("/channel",{channel:e})}}}var Jn=class extends he{constructor(e){super(),me(this,e,Kn,Vn,u,[])}};function Gn(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function Qn(e){var t,n,r;return{c(){t=_("div"),n=C("Error: "),r=C(e.error),t.className="toast toast-error"},m(e,o){w(e,t,o),k(t,n),k(t,r)},p:o,d(e){e&&x(t)}}}function Xn(e){var t,n,o,r,a,s,c,l,u,d=[],m=new Map,h=e.msgs;const p=e=>e.msg.key;for(var f=0;f<h.length;f+=1){let t=Gn(e,h,f),n=p(t);m.set(n,d[f]=to(n,t))}var g=null;return h.length||(g=eo(e)).c(),{c(){for(f=0;f<d.length;f+=1)d[f].c();t=P(),n=_("ul"),o=_("li"),(r=_("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',a=P(),s=_("li"),(c=_("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",c.href="#/public",s.className="page-item page-next",n.className="pagination",u=[M(r,"click",S(F(e.goPrevious))),M(c,"click",S(F(e.goNext)))]},m(e,i){for(f=0;f<d.length;f+=1)d[f].m(e,i);g&&g.m(e,null),w(e,t,i),w(e,n,i),k(n,o),k(o,r),k(n,a),k(n,s),k(s,c),l=!0},p(e,n){const o=n.msgs;oe(),d=ie(d,e,p,1,n,o,m,t.parentNode,ce,to,t,Gn),re(),o.length?g&&(g.d(1),g=null):g||((g=eo(n)).c(),g.m(t.parentNode,t))},i(e){if(!l){for(var t=0;t<h.length;t+=1)d[t].i();l=!0}},o(e){for(f=0;f<d.length;f+=1)d[f].o();l=!1},d(e){for(f=0;f<d.length;f+=1)d[f].d(e);g&&g.d(e),e&&(x(t),x(n)),i(u)}}}function Zn(e){var t;return{c(){(t=_("div")).className="loading loading-lg"},m(e,n){w(e,t,n)},p:o,i:o,o:o,d(e){e&&x(t)}}}function eo(e){var t;return{c(){(t=_("p")).textContent="No messages."},m(e,n){w(e,t,n)},d(e){e&&x(t)}}}function to(e,t){var n,o,r=new jt({props:{msg:t.msg}});return{key:e,first:null,c(){n=T(),r.$$.fragment.c(),this.first=n},m(e,t){w(e,n,t),ue(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&x(n),r.$destroy(e)}}}function no(e){var t,n,o,r,a,s,c,l,u,d,m,h,p,f,g,b,v,y,$,N,S,I,U,A=e.error&&Qn(e),O=[Zn,Xn],L=[];function j(e){return e.msgs?1:0}return $=j(e),N=L[$]=O[$](e),{c(){t=_("div"),n=_("div"),o=_("div"),r=_("h4"),a=C("Channel: #"),s=C(e.channel),c=P(),l=_("div"),u=_("label"),d=_("input"),m=P(),h=_("i"),p=C("\r\n        Subscribe"),f=P(),g=_("button"),b=C("New Post"),v=P(),A&&A.c(),y=P(),N.c(),S=T(),o.className="column",R(d,"type","checkbox"),h.className="form-icon",u.className="form-switch float-right",g.className="btn btn-link float-right",R(g,"href","?channel="+e.channel+"#/compose"),l.className="column",n.className="columns",t.className="container",U=[M(d,"change",e.input_change_handler),M(d,"change",e.subscriptionChanged),M(g,"click",F(e.click_handler))]},m(i,x){w(i,t,x),k(t,n),k(n,o),k(o,r),k(r,a),k(r,s),k(n,c),k(n,l),k(l,u),k(u,d),d.checked=e.subscribed,k(u,m),k(u,h),k(u,p),k(l,f),k(l,g),k(g,b),w(i,v,x),A&&A.m(i,x),w(i,y,x),L[$].m(i,x),w(i,S,x),I=!0},p(e,t){e.subscribed&&(d.checked=t.subscribed),t.error?A?A.p(e,t):((A=Qn(t)).c(),A.m(y.parentNode,y)):A&&(A.d(1),A=null);var n=$;($=j(t))===n?L[$].p(e,t):(oe(),ae(()=>{L[n].d(1),L[n]=null}),N.o(1),re(),(N=L[$])||(N=L[$]=O[$](t)).c(),N.i(1),N.m(S.parentNode,S))},i(e){I||(N&&N.i(),I=!0)},o(e){N&&N.o(),I=!1},d(e){e&&(x(t),x(v)),A&&A.d(e),e&&x(y),L[$].d(e),e&&x(S),i(U)}}}function oo(e,t,n){let o;d(e,To,e=>{n("$routeParams",o=e)});let r=!1,a=o.error||!1,s=o.channel||!1,c=!1;s||(console.log("can't navigate to unnamed channel, going back to public"),location="index.html#/public");let i={limit:o.limit||Oo("limit",10),reverse:!0};ssb.channelSubscribed(s).then(e=>{const t=c=e;return n("subscribed",c),t});return e.$$.update=(e={opts:1,$routeParams:1,channel:1,error:1})=>{if(e.opts||e.$routeParams||e.channel||e.error){Object.assign(i,o),document.title=`Patchfox - #${s}`,i.hasOwnProperty("lt")&&(i.lt=parseInt(i.lt),n("opts",i),n("$routeParams",o),n("channel",s),n("error",a)),i.hasOwnProperty("limit")&&(i.limit=parseInt(i.limit),n("opts",i),n("$routeParams",o),n("channel",s),n("error",a));ssb.channel(s,i).then(e=>{console.log("msg",e),n("msgs",r=e),window.scrollTo(0,0)}).catch(e=>{a||console.error("errrrooooor",e)})}},{msgs:r,error:a,channel:s,subscribed:c,subscriptionChanged:e=>{e.target.checked?ssb.channelSubscribe(s).catch(()=>{const e=c=!1;return n("subscribed",c),e}):ssb.channelUnsubscribe(s).catch(()=>{const e=c=!0;return n("subscribed",c),e})},goNext:()=>{Fo("/channel",{channel:s,lt:r[r.length-1].rts})},goPrevious:()=>{history.back()},input_change_handler:function(){c=this.checked,n("subscribed",c)},click_handler:function(){return Fo("/compose",{channel:s})}}}var ro=class extends he{constructor(e){super(),me(this,e,oo,no,u,[])}};n(12);function ao(e,t,n){const o=Object.create(e);return o.filter=t[n],o}function so(e){var t;return{c(){(t=_("div")).innerHTML='<p class="label">You don\'t have any filter yet.</p>',t.className="column col-12"},m(e,n){w(e,t,n)},d(e){e&&x(t)}}}function co(e){var t,n,o,r,a,s=e.filter.feed;return{c(){t=_("li"),n=C("From "),o=_("a"),r=C(s),o.href=a="?feed="+e.filter.feed+"#/profile",o.target="_blank",o.className="feed svelte-1e0jkdi"},m(e,a){w(e,t,a),k(t,n),k(t,o),k(o,r)},p(e,t){e.currentFilters&&s!==(s=t.filter.feed)&&I(r,s),e.currentFilters&&a!==(a="?feed="+t.filter.feed+"#/profile")&&(o.href=a)},d(e){e&&x(t)}}}function io(e){var t,n,o,r,a,s,c=e.filter.channel;return{c(){t=_("li"),n=C("On channel "),o=_("a"),r=C("#"),a=C(c),o.href=s="?channel="+e.filter.feed+"#/channel",o.target="_blank",o.className="feed svelte-1e0jkdi"},m(e,s){w(e,t,s),k(t,n),k(t,o),k(o,r),k(o,a)},p(e,t){e.currentFilters&&c!==(c=t.filter.channel)&&I(a,c),e.currentFilters&&s!==(s="?channel="+t.filter.feed+"#/channel")&&(o.href=s)},d(e){e&&x(t)}}}function lo(e){var t,n,o,r,a=e.filter.keywords.join(", ");return{c(){t=_("i"),n=_("li"),o=C("Containing: "),r=C(a)},m(e,a){w(e,t,a),k(t,n),k(n,o),k(n,r)},p(e,t){e.currentFilters&&a!==(a=t.filter.keywords.join(", "))&&I(r,a)},d(e){e&&x(t)}}}function uo(e){var t,n,o,r=e.filter.expires;return{c(){t=_("li"),n=C("Expiring in "),o=C(r)},m(e,r){w(e,t,r),k(t,n),k(t,o)},p(e,t){e.currentFilters&&r!==(r=t.filter.expires)&&I(o,r)},d(e){e&&x(t)}}}function mo(e){var t,n,o,r,a,s,c,i,l,u,d,m,h,p,f,g=e.filter.action,b=e.filter.feed&&co(e),v=e.filter.channel&&io(e),y=e.filter.keywords.length>0&&lo(e),$=e.filter.expires&&uo(e);function N(){return e.click_handler(e)}return{c(){t=_("div"),n=_("div"),o=_("div"),r=_("div"),a=C(g),s=P(),c=_("div"),i=_("ul"),b&&b.c(),l=P(),v&&v.c(),u=P(),y&&y.c(),d=P(),$&&$.c(),m=P(),h=_("div"),(p=_("button")).textContent="Delete",r.className="card-title h5",o.className="card-header",c.className="card-body",p.className="btn",R(p,"aria-label","Delete"),h.className="card-footer",n.className="card filter svelte-1e0jkdi",t.className="column col-6",f=M(p,"click",N)},m(e,f){w(e,t,f),k(t,n),k(n,o),k(o,r),k(r,a),k(n,s),k(n,c),k(c,i),b&&b.m(i,null),k(i,l),v&&v.m(i,null),k(i,u),y&&y.m(i,null),k(i,d),$&&$.m(i,null),k(n,m),k(n,h),k(h,p)},p(t,n){e=n,t.currentFilters&&g!==(g=e.filter.action)&&I(a,g),e.filter.feed?b?b.p(t,e):((b=co(e)).c(),b.m(i,l)):b&&(b.d(1),b=null),e.filter.channel?v?v.p(t,e):((v=io(e)).c(),v.m(i,u)):v&&(v.d(1),v=null),e.filter.keywords.length>0?y?y.p(t,e):((y=lo(e)).c(),y.m(i,d)):y&&(y.d(1),y=null),e.filter.expires?$?$.p(t,e):(($=uo(e)).c(),$.m(i,null)):$&&($.d(1),$=null)},d(e){e&&x(t),b&&b.d(),v&&v.d(),y&&y.d(),$&&$.d(),f()}}}function ho(e){for(var t,n,r,a,s,c,l,u,d,m,h,p,f,g,b,v,y,$,T,F,S,I,U,A,O,L,j,E,W,H,q,B,D,z,Y,V,K,J,G,Q,X,Z,ee,te,ne,oe,re,ae,se,ce,ie,le,ue,de,me,he,pe,fe,ge,be,ve,ye,ke,we,xe,$e,Ne,_e,Ce,Pe,Te,Me,Fe,Se,Re,Ie,Ue,Ae,Oe,Le,je,Ee,We,He,qe,Be,De,ze,Ye,Ve,Ke,Je,Ge,Qe,Xe,Ze,et,tt,nt,ot,rt,at,st,ct,it,lt,ut,dt,mt,ht,pt,ft,gt,bt,vt,yt,kt,wt,xt,$t,Nt,_t,Ct,Pt,Tt,Mt,Ft,St,Rt,It,Ut,At,Ot,Lt,jt,Et,Wt,Ht,qt,Bt,Dt,zt,Yt,Vt,Kt,Jt,Gt,Qt,Xt,Zt,en,tn,nn,on,rn,an,sn,cn,ln,un,dn,mn,hn,pn,fn,gn,bn,vn,yn,kn,wn,xn,$n,Nn,_n,Cn,Pn,Tn,Mn=e.currentFilters,Fn=[],Sn=0;Sn<Mn.length;Sn+=1)Fn[Sn]=mo(ao(e,Mn,Sn));var Rn=null;return Mn.length||(Rn=so()).c(),{c(){(t=_("h1")).textContent="Settings",n=P(),(r=_("p")).innerHTML="\n\t\t\t  Settings changes are saved as you make them except for identity and connection\n\t\t\t  changes, those require a full page reload and thus you need to press a save\n\t\t\t  button. The reason behind this is that Patchfox needs to disconnect and\n\t\t\t  reconnect to the\n\t\t\t  <i>ssb-server</i>\n\t\t\t  using the new info.\n\t\t\t",a=P(),(s=_("p")).innerHTML='<b>\n\t\t\t    You can\'t use Patchfox until you fill your\n\t\t\t    <i>Connection &amp; Identity</i>\n\t\t\t    information.\n\t\t\t    <a href="/docs/index.html#/troubleshooting/no-configuration" target="_blank">\n\t\t\t      If you want more help regarding connection and configuration click here\n\t\t\t    </a>\n\t\t\t    .\n\t\t\t  </b>',c=P(),(l=_("h4")).textContent="Connection & Identity",u=P(),d=_("form"),(m=_("label")).innerHTML="\n\t\t\t    Patchfox can infer the values for both\n\t\t\t    <i>remote</i>\n\t\t\t    and\n\t\t\t    <i>secret</i>\n\t\t\t    from your\n\t\t\t    <code>~/.ssb/secret</code>\n\t\t\t    file. You can use the button below to browse for it.\n\t\t\t  ",h=P(),p=_("input"),f=P(),(g=_("label")).textContent="Remote",b=P(),v=_("input"),y=P(),($=_("label")).textContent="Secret",T=P(),F=_("textarea"),S=P(),I=_("br"),U=P(),(A=_("button")).textContent="Save Identity & Remote",O=P(),(L=_("p")).textContent="Saving identity and remote will cause a full page refresh.",j=P(),(E=_("h4")).textContent="Vieweing Experience",W=P(),H=_("form"),(q=_("label")).textContent="Messages per page",B=P(),D=_("input"),z=P(),Y=_("br"),V=P(),(K=_("span")).innerHTML='\n\t\t\t    Which message types you want to see?\n\t\t\t    <a target="_blank" href="/docs/index.html#/message_types/">\n\t\t\t      Click here for more information about\n\t\t\t      <i>Message Types</i></a>',J=P(),G=_("label"),Q=_("input"),X=P(),Z=_("i"),ee=P(),(te=_("b")).textContent="About",ne=C("\r\n    (aka people setting avatars and descriptions; gatherings)"),oe=P(),re=_("label"),ae=_("input"),se=P(),ce=_("i"),ie=P(),(le=_("b")).textContent="Blog",ue=C("\r\n    (Longform text posts)"),de=P(),me=_("label"),he=_("input"),pe=P(),fe=_("i"),ge=P(),(be=_("b")).textContent="Channel",ve=C("\r\n    (People subscribing to channels)"),ye=P(),ke=_("label"),we=_("input"),xe=P(),$e=_("i"),Ne=P(),(_e=_("b")).textContent="Contact",Ce=C("\r\n    (People following each other)"),Pe=P(),Te=_("label"),Me=_("input"),Fe=P(),Se=_("i"),Re=P(),(Ie=_("b")).textContent="Posts",Ue=C("\r\n    (Common content post, leave this on or it is not that fun)"),Ae=P(),Oe=_("label"),Le=_("input"),je=P(),Ee=_("i"),We=P(),(He=_("b")).textContent="Pub",qe=C("\r\n    (Pub servers announcements)"),Be=P(),De=_("label"),ze=_("input"),Ye=P(),Ve=_("i"),Ke=P(),(Je=_("b")).textContent="Private",Ge=C("\r\n    (Private messages; You won't be able to read them, but you'll see their\r\n    encrypted content passing by)"),Qe=P(),Xe=_("label"),Ze=_("input"),et=P(),tt=_("i"),nt=P(),(ot=_("b")).textContent="Vote",rt=C("\r\n    (People liking/digging stuff)"),at=P(),st=_("div"),ct=P(),it=_("label"),lt=_("input"),ut=P(),dt=_("i"),mt=P(),(ht=_("b")).textContent="Unknown",pt=C("\r\n    (Show messages Patchfox doesn't understand as their raw content)"),ft=P(),gt=_("br"),bt=P(),(vt=_("label")).textContent="Feed column size. There is research that says that a short column size makes\r\n    for a more pleasant reading experience, still some users prefer to use the\r\n    full screen space. Your choice is between reading through long text lines or\r\n    short ones.",yt=P(),kt=_("label"),wt=_("input"),xt=P(),$t=_("i"),Nt=C("\r\n    Short column"),_t=P(),Ct=_("label"),Pt=_("input"),Tt=P(),Mt=_("i"),Ft=C("\r\n    Long column"),St=P(),(Rt=_("h4")).textContent="Abuse Prevention",It=P(),(Ut=_("p")).textContent="Use the features from this section to tailor your Patchfox experience to suit\r\n  your needs.",At=P(),(Ot=_("h5")).textContent="Filters",Lt=P(),(jt=_("p")).innerHTML="\n\t\t\t  Use filters to hide messages and blur images. Use any combination of channel,\n\t\t\t  feeds and keywords (separated by commas) to create your triggers and make SSB\n\t\t\t  the platform you want. Be aware that these filters are saved to your browser,\n\t\t\t  they are not shared on the feed, they don't affect gossiping, they only affect\n\t\t\t  the displaying of messages and images in Patchfox itself. If you create a\n\t\t\t  filter and open a different client, they won't be working there. If you want\n\t\t\t  to learn more about\n\t\t\t  <a href=\"/docs/index.html#/features/filter\">\n\t\t\t    filters, click here to go to the documentation.\n\t\t\t  </a>\n\t\t\t  You can create as many filters as you want.\n\t\t\t",Et=P(),Wt=_("div"),Ht=_("div");for(var o=0;o<Fn.length;o+=1)Fn[o].c();qt=P(),(Bt=_("h5")).textContent="New Filter",Dt=P(),zt=_("form-group"),Yt=_("label"),Vt=_("input"),Kt=P(),Jt=_("i"),Gt=C("\r\n    Hide Message"),Qt=P(),Xt=_("label"),Zt=_("input"),en=P(),tn=_("i"),nn=C("\r\n    Blur Images"),on=P(),(rn=_("label")).textContent="Channel",an=P(),sn=_("input"),cn=P(),(ln=_("label")).textContent="Feed",un=P(),dn=_("input"),mn=P(),(hn=_("label")).textContent="Keywords",pn=P(),fn=_("input"),gn=P(),(bn=_("label")).textContent="Expiration Date",vn=P(),yn=_("input"),kn=P(),wn=_("br"),xn=P(),($n=_("button")).textContent="Add Filter",Nn=P(),_n=_("br"),Cn=P(),Pn=_("br"),m.className="form-label",m.htmlFor="secret-file",R(p,"type","file"),p.className="form-input",p.id="secret-file",g.className="form-label",g.htmlFor="remote",v.className="form-input",R(v,"type","text"),v.id="remote",v.placeholder="remote",$.className="form-label",$.htmlFor="secret",F.className="form-input",F.id="secret",F.placeholder="Your secret",F.rows="8",A.className="btn btn-primary float-right",d.className="form-group",q.className="form-label",q.htmlFor="limit",D.className="form-input",R(D,"type","number"),R(Q,"type","checkbox"),Z.className="form-icon",G.className="form-switch",R(ae,"type","checkbox"),ce.className="form-icon",re.className="form-switch",R(he,"type","checkbox"),fe.className="form-icon",me.className="form-switch",R(we,"type","checkbox"),$e.className="form-icon",ke.className="form-switch",R(Me,"type","checkbox"),Se.className="form-icon",Te.className="form-switch",R(Le,"type","checkbox"),Ee.className="form-icon",Oe.className="form-switch",R(ze,"type","checkbox"),Ve.className="form-icon",De.className="form-switch",R(Ze,"type","checkbox"),tt.className="form-icon",Xe.className="form-switch",st.className="divider",R(lt,"type","checkbox"),dt.className="form-icon",it.className="form-switch",vt.className="form-label",e.$$binding_groups[1].push(wt),R(wt,"type","radio"),wt.name="column-size",wt.__value="short",wt.value=wt.__value,$t.className="form-icon",kt.className="form-radio",e.$$binding_groups[1].push(Pt),R(Pt,"type","radio"),Pt.name="column-size",Pt.__value="long",Pt.value=Pt.__value,Mt.className="form-icon",Ct.className="form-radio",H.className="form-group",Ht.className="columns",Wt.className="container",e.$$binding_groups[0].push(Vt),R(Vt,"type","radio"),Vt.name="filter-action",Vt.__value="hide",Vt.value=Vt.__value,Jt.className="form-icon",Yt.className="form-radio",e.$$binding_groups[0].push(Zt),R(Zt,"type","radio"),Zt.name="filter-action",Zt.__value="blur",Zt.value=Zt.__value,tn.className="form-icon",Xt.className="form-radio",rn.className="form-label",rn.htmlFor="remote",sn.className="form-input",R(sn,"type","text"),sn.placeholder="Channel",ln.className="form-label",ln.htmlFor="remote",dn.className="form-input",R(dn,"type","text"),dn.placeholder="Feed",hn.className="form-label",hn.htmlFor="remote",fn.className="form-input",R(fn,"type","text"),fn.placeholder="Keywords separated by commas",bn.className="form-label",bn.htmlFor="remote",yn.className="form-input",R(yn,"type","date"),yn.placeholder="When should this filter expiry",$n.className="btn btn-primary",Tn=[M(p,"change",e.selectedFile),M(v,"input",e.input1_input_handler),M(F,"input",e.textarea_input_handler),M(A,"click",e.saveConfiguration),M(D,"input",e.input2_input_handler),M(D,"change",e.change_handler),M(Q,"change",e.input3_change_handler),M(Q,"change",e.change_handler_1),M(ae,"change",e.input4_change_handler),M(ae,"change",e.change_handler_2),M(he,"change",e.input5_change_handler),M(he,"change",e.change_handler_3),M(we,"change",e.input6_change_handler),M(we,"change",e.change_handler_4),M(Me,"change",e.input7_change_handler),M(Me,"change",e.change_handler_5),M(Le,"change",e.input8_change_handler),M(Le,"change",e.change_handler_6),M(ze,"change",e.input9_change_handler),M(ze,"change",e.change_handler_7),M(Ze,"change",e.input10_change_handler),M(Ze,"change",e.change_handler_8),M(lt,"change",e.input11_change_handler),M(lt,"change",e.change_handler_9),M(wt,"change",e.input12_change_handler),M(wt,"change",e.change_handler_10),M(Pt,"change",e.input13_change_handler),M(Pt,"change",e.change_handler_11),M(Vt,"change",e.input14_change_handler),M(Zt,"change",e.input15_change_handler),M(sn,"input",e.input16_input_handler),M(dn,"input",e.input17_input_handler),M(fn,"input",e.input18_input_handler),M(yn,"input",e.input19_input_handler),M($n,"click",e.addNewFilter)]},m(o,i){w(o,t,i),w(o,n,i),w(o,r,i),w(o,a,i),w(o,s,i),w(o,c,i),w(o,l,i),w(o,u,i),w(o,d,i),k(d,m),k(d,h),k(d,p),k(d,f),k(d,g),k(d,b),k(d,v),v.value=e.remote,k(d,y),k(d,$),k(d,T),k(d,F),F.value=e.keys,k(d,S),k(d,I),k(d,U),k(d,A),k(d,O),k(d,L),w(o,j,i),w(o,E,i),w(o,W,i),w(o,H,i),k(H,q),k(H,B),k(H,D),D.value=e.limit,k(H,z),k(H,Y),k(H,V),k(H,K),k(H,J),k(H,G),k(G,Q),Q.checked=e.showTypeAbout,k(G,X),k(G,Z),k(G,ee),k(G,te),k(G,ne),k(H,oe),k(H,re),k(re,ae),ae.checked=e.showTypeBlog,k(re,se),k(re,ce),k(re,ie),k(re,le),k(re,ue),k(H,de),k(H,me),k(me,he),he.checked=e.showTypeChannel,k(me,pe),k(me,fe),k(me,ge),k(me,be),k(me,ve),k(H,ye),k(H,ke),k(ke,we),we.checked=e.showTypeContact,k(ke,xe),k(ke,$e),k(ke,Ne),k(ke,_e),k(ke,Ce),k(H,Pe),k(H,Te),k(Te,Me),Me.checked=e.showTypePost,k(Te,Fe),k(Te,Se),k(Te,Re),k(Te,Ie),k(Te,Ue),k(H,Ae),k(H,Oe),k(Oe,Le),Le.checked=e.showTypePub,k(Oe,je),k(Oe,Ee),k(Oe,We),k(Oe,He),k(Oe,qe),k(H,Be),k(H,De),k(De,ze),ze.checked=e.showTypePrivate,k(De,Ye),k(De,Ve),k(De,Ke),k(De,Je),k(De,Ge),k(H,Qe),k(H,Xe),k(Xe,Ze),Ze.checked=e.showTypeVote,k(Xe,et),k(Xe,tt),k(Xe,nt),k(Xe,ot),k(Xe,rt),k(H,at),k(H,st),k(H,ct),k(H,it),k(it,lt),lt.checked=e.showTypeUnknown,k(it,ut),k(it,dt),k(it,mt),k(it,ht),k(it,pt),k(H,ft),k(H,gt),k(H,bt),k(H,vt),k(H,yt),k(H,kt),k(kt,wt),wt.checked=wt.__value===e.columnSize,k(kt,xt),k(kt,$t),k(kt,Nt),k(H,_t),k(H,Ct),k(Ct,Pt),Pt.checked=Pt.__value===e.columnSize,k(Ct,Tt),k(Ct,Mt),k(Ct,Ft),w(o,St,i),w(o,Rt,i),w(o,It,i),w(o,Ut,i),w(o,At,i),w(o,Ot,i),w(o,Lt,i),w(o,jt,i),w(o,Et,i),w(o,Wt,i),k(Wt,Ht);for(var x=0;x<Fn.length;x+=1)Fn[x].m(Ht,null);Rn&&Rn.m(Ht,null),w(o,qt,i),w(o,Bt,i),w(o,Dt,i),w(o,zt,i),k(zt,Yt),k(Yt,Vt),Vt.checked=Vt.__value===e.filterAction,k(Yt,Kt),k(Yt,Jt),k(Yt,Gt),k(zt,Qt),k(zt,Xt),k(Xt,Zt),Zt.checked=Zt.__value===e.filterAction,k(Xt,en),k(Xt,tn),k(Xt,nn),k(zt,on),k(zt,rn),k(zt,an),k(zt,sn),sn.value=e.filterChannel,k(zt,cn),k(zt,ln),k(zt,un),k(zt,dn),dn.value=e.filterFeed,k(zt,mn),k(zt,hn),k(zt,pn),k(zt,fn),fn.value=e.filterKeywords,k(zt,gn),k(zt,bn),k(zt,vn),k(zt,yn),yn.value=e.filterExpiry,w(o,kn,i),w(o,wn,i),w(o,xn,i),w(o,$n,i),w(o,Nn,i),w(o,_n,i),w(o,Cn,i),w(o,Pn,i)},p(e,t){if(e.remote&&v.value!==t.remote&&(v.value=t.remote),e.keys&&(F.value=t.keys),e.limit&&(D.value=t.limit),e.showTypeAbout&&(Q.checked=t.showTypeAbout),e.showTypeBlog&&(ae.checked=t.showTypeBlog),e.showTypeChannel&&(he.checked=t.showTypeChannel),e.showTypeContact&&(we.checked=t.showTypeContact),e.showTypePost&&(Me.checked=t.showTypePost),e.showTypePub&&(Le.checked=t.showTypePub),e.showTypePrivate&&(ze.checked=t.showTypePrivate),e.showTypeVote&&(Ze.checked=t.showTypeVote),e.showTypeUnknown&&(lt.checked=t.showTypeUnknown),e.columnSize&&(wt.checked=wt.__value===t.columnSize),e.columnSize&&(Pt.checked=Pt.__value===t.columnSize),e.currentFilters){Mn=t.currentFilters;for(var n=0;n<Mn.length;n+=1){const o=ao(t,Mn,n);Fn[n]?Fn[n].p(e,o):(Fn[n]=mo(o),Fn[n].c(),Fn[n].m(Ht,null))}for(;n<Fn.length;n+=1)Fn[n].d(1);Fn.length=Mn.length}Mn.length?Rn&&(Rn.d(1),Rn=null):Rn||((Rn=so()).c(),Rn.m(Ht,null)),e.filterAction&&(Vt.checked=Vt.__value===t.filterAction),e.filterAction&&(Zt.checked=Zt.__value===t.filterAction),e.filterChannel&&sn.value!==t.filterChannel&&(sn.value=t.filterChannel),e.filterFeed&&dn.value!==t.filterFeed&&(dn.value=t.filterFeed),e.filterKeywords&&fn.value!==t.filterKeywords&&(fn.value=t.filterKeywords),e.filterExpiry&&(yn.value=t.filterExpiry)},i:o,o:o,d(o){o&&(x(t),x(n),x(r),x(a),x(s),x(c),x(l),x(u),x(d),x(j),x(E),x(W),x(H)),e.$$binding_groups[1].splice(e.$$binding_groups[1].indexOf(wt),1),e.$$binding_groups[1].splice(e.$$binding_groups[1].indexOf(Pt),1),o&&(x(St),x(Rt),x(It),x(Ut),x(At),x(Ot),x(Lt),x(jt),x(Et),x(Wt)),N(Fn,o),Rn&&Rn.d(),o&&(x(qt),x(Bt),x(Dt),x(zt)),e.$$binding_groups[0].splice(e.$$binding_groups[0].indexOf(Vt),1),e.$$binding_groups[0].splice(e.$$binding_groups[0].indexOf(Zt),1),o&&(x(kn),x(wn),x(xn),x($n),x(Nn),x(_n),x(Cn),x(Pn)),i(Tn)}}}function po(e,t,n){let o={},r="",a=Oo("limit",10),s=Oo("columnSize","short");document.title="Patchfox - Settings";let c=Oo("showTypeUnknown",!1),i=Oo("showTypeAbout",!0),l=Oo("showTypeBlog",!0),u=Oo("showTypeChannel",!0),d=Oo("showTypeContact",!0),m=Oo("showTypePost",!0),h=Oo("showTypePrivate",!0),p=Oo("showTypePub",!0),f=Oo("showTypeVote",!0),g=ge(),b="",v="",y="",k="",w="";const x=e=>{console.log("saved data from settings",e),n("remote",r=e.remote||""),e.keys?n("keys",o=JSON.stringify(e.keys,null,2)):n("keys",o="")};browser.storage.local.get().then(x,e=>{console.error("error on settings",e)});return{keys:o,remote:r,limit:a,columnSize:s,showTypeUnknown:c,showTypeAbout:i,showTypeBlog:l,showTypeChannel:u,showTypeContact:d,showTypePost:m,showTypePrivate:h,showTypePub:p,showTypeVote:f,currentFilters:g,filterFeed:b,filterChannel:v,filterKeywords:y,filterExpiry:k,filterAction:w,saveConfiguration:e=>{Lo({remote:r,keys:JSON.parse(o),manifest:manifest}),Fo("/public"),location.reload()},selectedFile:e=>{const t=e.target.files[0],o=new FileReader;o.onload=function(e){console.log(e.target.result);let t=e.target.result.split("\n").filter(function(e){return 0!=e.indexOf("#")});t=JSON.parse(t.join("\n")),n("remote",r=`ws://localhost:8989~shs:${t.id.slice(0,t.id.indexOf("=")+1)}`),x({keys:t,remote:r})},o.readAsText(t)},addNewFilter:()=>{let e=y.split(",").map(e=>e.trim()).filter(e=>0!==e.length),t={};t.action=0!==w.length&&w,t.feed=0!==b.length&&b,t.channel=0!==v.length&&v,t.keywords=e,t.expires=0!==k.length&&k,t.channel&&t.channel.startsWith("#")&&(t.channel=t.channel.slice(1)),t.action&&(t.feed||t.channel||t.keywords.length>0)?(be(t),n("currentFilters",g=ge()),console.dir("filters",g),n("filterFeed",b=""),n("filterChannel",v=""),n("filterKeywords",y=""),n("filterExpiry",k=""),n("filterAction",w="")):alert("Fill at least filter action and one of feed, channel or keywords")},input1_input_handler:function(){r=this.value,n("remote",r)},textarea_input_handler:function(){o=this.value,n("keys",o)},input2_input_handler:function(){var e;e=this.value,n("limit",a=""===e?void 0:+e)},change_handler:function(){return jo("limit",a)},input3_change_handler:function(){i=this.checked,n("showTypeAbout",i)},change_handler_1:function(e){jo("showTypeAbout",i)},input4_change_handler:function(){l=this.checked,n("showTypeBlog",l)},change_handler_2:function(e){jo("showTypeBlog",l)},input5_change_handler:function(){u=this.checked,n("showTypeChannel",u)},change_handler_3:function(e){jo("showTypeChannel",u)},input6_change_handler:function(){d=this.checked,n("showTypeContact",d)},change_handler_4:function(e){jo("showTypeContact",d)},input7_change_handler:function(){m=this.checked,n("showTypePost",m)},change_handler_5:function(e){jo("showTypePost",m)},input8_change_handler:function(){p=this.checked,n("showTypePub",p)},change_handler_6:function(e){jo("showTypePub",p)},input9_change_handler:function(){h=this.checked,n("showTypePrivate",h)},change_handler_7:function(e){jo("showTypePrivate",h)},input10_change_handler:function(){f=this.checked,n("showTypeVote",f)},change_handler_8:function(e){jo("showTypeVote",f)},input11_change_handler:function(){c=this.checked,n("showTypeUnknown",c)},change_handler_9:function(e){jo("showTypeUnknown",c)},input12_change_handler:function(){s=this.__value,n("columnSize",s)},change_handler_10:function(){return jo("columnSize",s)},input13_change_handler:function(){s=this.__value,n("columnSize",s)},change_handler_11:function(){return jo("columnSize",s)},click_handler:function({filter:e}){ve(e),g=ge(),n("currentFilters",g)},input14_change_handler:function(){w=this.__value,n("filterAction",w)},input15_change_handler:function(){w=this.__value,n("filterAction",w)},input16_input_handler:function(){v=this.value,n("filterChannel",v)},input17_input_handler:function(){b=this.value,n("filterFeed",b)},input18_input_handler:function(){y=this.value,n("filterKeywords",y)},input19_input_handler:function(){k=this.value,n("filterExpiry",k)},$$binding_groups:[[],[]]}}var fo=class extends he{constructor(e){super(),me(this,e,po,ho,u,[])}};function go(e,t,n){const o=Object.create(e);return o.msg=t[n],o}function bo(e){var t,n,o,r,a,s,c,l,u,d=[],m=new Map,h=e.msgs;const p=e=>e.msg.key;for(var f=0;f<h.length;f+=1){let t=go(e,h,f),n=p(t);m.set(n,d[f]=yo(n,t))}return{c(){for(f=0;f<d.length;f+=1)d[f].c();t=P(),n=_("ul"),o=_("li"),(r=_("a")).innerHTML='<div class="page-item-subtitle">Previous</div>',a=P(),s=_("li"),(c=_("a")).innerHTML='<div class="page-item-subtitle">Next</div>',r.href="#/public",o.className="page-item page-previous",c.href="#/public",s.className="page-item page-next",n.className="pagination",u=[M(r,"click",S(F(e.click_handler))),M(c,"click",S(F(e.click_handler_1)))]},m(e,i){for(f=0;f<d.length;f+=1)d[f].m(e,i);w(e,t,i),w(e,n,i),k(n,o),k(o,r),k(n,a),k(n,s),k(s,c),l=!0},p(e,n){const o=n.msgs;oe(),d=ie(d,e,p,1,n,o,m,t.parentNode,ce,yo,t,go),re()},i(e){if(!l){for(var t=0;t<h.length;t+=1)d[t].i();l=!0}},o(e){for(f=0;f<d.length;f+=1)d[f].o();l=!1},d(e){for(f=0;f<d.length;f+=1)d[f].d(e);e&&(x(t),x(n)),i(u)}}}function vo(e){var t;return{c(){(t=_("div")).className="loading loading-lg"},m(e,n){w(e,t,n)},p:o,i:o,o:o,d(e){e&&x(t)}}}function yo(e,t){var n,o,r=new jt({props:{msg:t.msg}});return{key:e,first:null,c(){n=T(),r.$$.fragment.c(),this.first=n},m(e,t){w(e,n,t),ue(r,e,t),o=!0},p(e,t){var n={};e.msgs&&(n.msg=t.msg),r.$set(n)},i(e){o||(r.$$.fragment.i(e),o=!0)},o(e){r.$$.fragment.o(e),o=!1},d(e){e&&x(n),r.$destroy(e)}}}function ko(e){var t,n,o,r,a,s,c=[vo,bo],i=[];function l(e){return 0===e.msgs.length?0:1}return o=l(e),r=i[o]=c[o](e),{c(){(t=_("div")).innerHTML='<div class="columns"><h4 class="column">Mentions</h4>\n\t\t\t    <div class="column"></div></div>',n=P(),r.c(),a=T(),t.className="container"},m(e,r){w(e,t,r),w(e,n,r),i[o].m(e,r),w(e,a,r),s=!0},p(e,t){var n=o;(o=l(t))===n?i[o].p(e,t):(oe(),ae(()=>{i[n].d(1),i[n]=null}),r.o(1),re(),(r=i[o])||(r=i[o]=c[o](t)).c(),r.i(1),r.m(a.parentNode,a))},i(e){s||(r&&r.i(),s=!0)},o(e){r&&r.o(),s=!1},d(e){e&&(x(t),x(n)),i[o].d(e),e&&x(a)}}}function wo(e,t,n){let o,r=[];document.title="Patchfox - Mentions";let a=!1;hermiebox.modules.pullStream,hermiebox.sbot;var s;return s=()=>{o()},q().$$.on_destroy.push(s),B(()=>{o=To.subscribe(e=>{if(console.log("params changed.",a,e.lt),e.lt){let t=parseInt(e.lt);t!==a&&(a=t)}else a=!1;console.log("Loading mentions...",a),window.scrollTo(0,0),n("msgs",r=[]),ssb.mentions(ssb.feed,a).then(e=>{const t=r=e;return n("msgs",r),t})})}),{msgs:r,click_handler:function(){return history.back()},click_handler_1:function(){Fo("/mentions",{lt:r[r.length-1].rts})}}}var xo=class extends he{constructor(e){super(),me(this,e,wo,ko,u,[])}};let $o={};const No=()=>{return{data:Te.a.parse(window.location.search),location:window.location.hash.slice(1).replace("?","")}},_o=()=>{let e=No();if("/intercept"==e.location&&e.data.query){let t=e.data.query.replace("ssb:","");switch(t[0]){case"%":window.location=`/index.html?thread=${encodeURIComponent(t)}#/thread`;break;case"&":window.location=`http://localhost:8989/blobs/get/${t}`;break;case"@":window.location=`/index.html?feed=${encodeURIComponent(t)}#/profile`;break;case"#":window.location=`/index.html?channel=${t.replace("#","")}#/channel`}}},Co=pe(!1),Po=pe(No()),To=fe(Po,e=>e.data),Mo=fe(Po,e=>e.location),Fo=(e,t)=>{t=t||{},Po.set({location:e,data:t});let n=Te.a.stringify(t);history.pushState({location:e,data:t},`Patchfox - ${e}`,`/index.html?${n}#${e}`),console.log(`Navigate ${e}`,t)},So={"/thread":_n,"/public":Yt,"/compose":bn,"/profile":Ln,"/error":qn,"/channels":Jn,"/channel":ro,"/settings":fo,"/mentions":xo,"*":Kt},Ro=fe([Co,Po],([e,t])=>{let n=t.location;return e?So.hasOwnProperty(n)?So[n]:(console.log("didn't find",n),So["*"]):"/settings"===n?fo:So["*"]}),Io=async()=>{console.log("Connecting to sbot..."),window.ssb=new Ce;try{await ssb.connect($o.keys),Co.set(!0)}catch(e){throw console.error("can't connect",e),Co.set(!1),"Can't connect to sbot"}},Uo=()=>new Promise((e,t)=>{browser.storage.local.get().then(n=>{window.ssb=new Ce,ssb.connect(n.keys).then(t=>{console.log("connected"),Co.set(!0),e()}).catch(e=>{console.error("can't reconnect",e),t(e)})},t)}),Ao=()=>{let e=setInterval(()=>{hermiebox.sbot&&hermiebox.sbot.whoami((t,n)=>{t&&(console.error("can't call whoami",t),Uo().catch(t=>{console.error("can't reconnect"),clearInterval(e),Fo("/error",{error:t})}))})},5e3)},Oo=(e,t)=>$o.preferences&&$o.preferences.hasOwnProperty(e)?$o.preferences[e]:t,Lo=({keys:e,remote:t,manifest:n})=>{$o.keys=e,$o.remote=t,$o.manifest=n,browser.storage.local.set($o)},jo=(e,t)=>{$o.preferences=$o.preferences||{},$o.preferences[e]=t,browser.storage.local.set($o)};n(13);function Eo(e){var t,n,r,a,s,c,l,u,d,m,h,p,f,g,b,v,y,$,N,C,T,I,U,A,O,L,j,E,W,H,q,B,D,z,Y,V,K,J,G,Q,X,Z,ee,te,ne,oe,re,ae,se,ce,ie,le,ue,de,me,he,pe,fe,ge,be,ve,ye,ke,we,xe;return{c(){t=_("header"),n=_("section"),(r=_("a")).innerHTML='<i class="icon icon-minus text-black"></i>',a=P(),s=_("a"),c=_("figure"),l=_("img"),u=P(),d=_("i"),h=P(),(p=_("a")).textContent="Compose",f=P(),(g=_("a")).textContent="Public",b=P(),(v=_("a")).textContent="Mentions",y=P(),($=_("a")).textContent="Channels",N=P(),(C=_("a")).textContent="Settings",T=P(),(I=_("a")).textContent="Help",U=P(),A=_("section"),O=_("div"),L=_("input"),j=P(),(E=_("button")).textContent="Go",W=P(),H=_("section"),(q=_("button")).innerHTML='<i class="icon icon-back"></i>',B=P(),D=_("a"),z=_("figure"),Y=_("img"),V=P(),K=_("i"),G=P(),Q=_("div"),(X=_("a")).innerHTML='\n\t\t\t        Menu\n\t\t\t        <i class="icon icon-caret"></i>',Z=P(),ee=_("ul"),te=_("li"),(ne=_("a")).textContent="Compose",oe=P(),re=_("li"),(ae=_("a")).textContent="Public",se=P(),ce=_("li"),(ie=_("a")).textContent="Channels",le=P(),ue=_("li"),(de=_("a")).textContent="Mentions",me=P(),he=_("li"),(pe=_("a")).textContent="Settings",fe=P(),(ge=_("li")).innerHTML='<a href="/docs/index.html" class="btn btn-link">Help</a>',be=P(),ve=_("li"),(ye=_("a")).textContent="Open as a Tab",ke=P(),we=_("div"),r.href="#/sidebar",r.className="btn btn-link",l.src=e.avatar,l.alt="L",d.className=m="avatar-presence "+(e.$connected?"online":"offline")+" svelte-14egiim",c.className="avatar avatar-lg",s.href="#",s.className="navbar-brand mr-2 p-1",p.href="#/compose",p.className="btn btn-link",g.href="#/public",g.className="btn btn-link",v.href="#/mentions",v.className="btn btn-link",$.href="#/channels",$.className="btn btn-link",C.href="#/settings",C.className="btn btn-link",I.href="/docs/index.html",I.className="btn btn-link",n.className="navbar-section hide-sm",L.className="form-input",R(L,"type","text"),L.placeholder="search",E.className="btn btn-primary input-group-btn",O.className="input-group input-inline",A.className="navbar-section hide-sm",q.className="btn btn-link",Y.src=e.avatar,Y.alt="L",K.className=J="avatar-presence "+(e.$connected?"online":"offline")+" svelte-14egiim",z.className="avatar",D.href="...",D.className="navbar-brand mr-2 p-1",X.href="?",X.className="btn btn-link dropdown-toggle",X.tabIndex="0",ne.href="#/compose",ne.className="btn btn-link",te.className="menu-item",ae.href="#/public",ae.className="btn btn-link",re.className="menu-item",ie.href="#/channels",ie.className="btn btn-link",ce.className="menu-item",de.href="#/mentions",de.className="btn btn-link",ue.className="menu-item",pe.href="#/settings",pe.className="btn btn-link",he.className="menu-item",ge.className="menu-item",ye.href="#/sidebar",ye.className="btn btn-link",ve.className="menu-item",ee.className="menu",Q.className="dropdown float-right",H.className="navbar-section show-sm bg-gray above svelte-14egiim",we.className="blocker show-sm svelte-14egiim",t.className="navbar",xe=[M(r,"click",e.openSidebar),M(s,"click",e.openMyProfile),M(p,"click",S(F(e.goCompose))),M(g,"click",S(F(e.goPublic))),M(v,"click",S(F(e.goMentions))),M($,"click",S(F(e.goChannels))),M(C,"click",e.goSettings),M(L,"input",e.input_input_handler),M(E,"click",e.goSearch),M(q,"click",e.click_handler),M(X,"click",S(F(Wo))),M(ne,"click",S(F(e.goCompose))),M(ae,"click",S(F(e.goPublic))),M(ie,"click",S(F(e.goChannels))),M(de,"click",S(F(e.goMentions))),M(pe,"click",e.goSettings),M(ye,"click",e.closeSidebar)]},m(o,i){w(o,t,i),k(t,n),k(n,r),k(n,a),k(n,s),k(s,c),k(c,l),k(c,u),k(c,d),k(n,h),k(n,p),k(n,f),k(n,g),k(n,b),k(n,v),k(n,y),k(n,$),k(n,N),k(n,C),k(n,T),k(n,I),k(t,U),k(t,A),k(A,O),k(O,L),L.value=e.query,k(O,j),k(O,E),k(t,W),k(t,H),k(H,q),k(H,B),k(H,D),k(D,z),k(z,Y),k(z,V),k(z,K),k(H,G),k(H,Q),k(Q,X),k(Q,Z),k(Q,ee),k(ee,te),k(te,ne),k(ee,oe),k(ee,re),k(re,ae),k(ee,se),k(ee,ce),k(ce,ie),k(ee,le),k(ee,ue),k(ue,de),k(ee,me),k(ee,he),k(he,pe),k(ee,fe),k(ee,ge),k(ee,be),k(ee,ve),k(ve,ye),k(t,ke),k(t,we)},p(e,t){e.avatar&&(l.src=t.avatar),e.$connected&&m!==(m="avatar-presence "+(t.$connected?"online":"offline")+" svelte-14egiim")&&(d.className=m),e.query&&L.value!==t.query&&(L.value=t.query),e.avatar&&(Y.src=t.avatar),e.$connected&&J!==(J="avatar-presence "+(t.$connected?"online":"offline")+" svelte-14egiim")&&(K.className=J)},i:o,o:o,d(e){e&&x(t),i(xe)}}}function Wo(){return""}function Ho(e,t,n){let o;d(e,Co,e=>{n("$connected",o=e)});let r="/images/icon.png",a="";return e.$$.update=(e={$connected:1})=>{e.$connected&&o&&ssb.avatar(ssb.feed).then(e=>{n("avatar",r=`http://localhost:8989/blobs/get/${e.image}`)})},{avatar:r,query:a,goSettings:e=>Fo("/settings"),goCompose:()=>Fo("/compose"),goPublic:()=>Fo("/public"),goChannels:()=>Fo("/channels"),goMentions:()=>Fo("/mentions"),goSearch:()=>{Fo("/intercept",{query:a}),_o()},openSidebar:async e=>{let t=window.location.href;browser.sidebarAction.setPanel({panel:t}),browser.sidebarAction.open()},closeSidebar:async e=>{let t=await browser.sidebarAction.getPanel({});await browser.tabs.create({url:t}),await browser.sidebarAction.close()},openMyProfile:e=>{e.stopPropagation(),e.preventDefault(),ssb.feed&&Fo("/profile",{feed:ssb.feed})},$connected:o,input_input_handler:function(){a=this.value,n("query",a)},click_handler:function(){return history.back()}}}var qo=class extends he{constructor(e){super(),me(this,e,Ho,Eo,u,[])}};n(14);function Bo(e){var t,n,o,r,a,s,c=new qo({}),l=e.$currentView;if(l)var u=new l({});return{c(){t=_("div"),n=_("div"),o=_("div"),c.$$.fragment.c(),r=P(),u&&u.$$.fragment.c(),o.className="column svelte-1mwu09k",U(o,"reduced-line-length",e.useShortColumn),n.className="columns",t.className="container bg-gray",s=[M(window,"popstate",e.popState),M(window,"error",e.handleUncaughtException),M(window,"hashchange",e.hashChange)]},m(e,s){w(e,t,s),k(t,n),k(n,o),ue(c,o,null),k(o,r),u&&ue(u,o,null),a=!0},p(e,t){if(l!==(l=t.$currentView)){if(u){oe();const e=u;ae(()=>{e.$destroy()}),e.$$.fragment.o(1),re()}l?((u=new l({})).$$.fragment.c(),u.$$.fragment.i(1),ue(u,o,null)):u=null}e.useShortColumn&&U(o,"reduced-line-length",t.useShortColumn)},i(e){a||(c.$$.fragment.i(e),u&&u.$$.fragment.i(e),a=!0)},o(e){c.$$.fragment.o(e),u&&u.$$.fragment.o(e),a=!1},d(e){e&&x(t),c.$destroy(),u&&u.$destroy(),i(s)}}}function Do(e,t,n){let o,r;d(e,Mo,e=>{n("$routeLocation",o=e)}),d(e,Ro,e=>{n("$currentView",r=e)});let a="short"==Oo("columnSize","short");console.log("columnSize",a),B(async()=>{try{await Io(),Ao()}catch(e){switch(console.error("connect error",e),e){case"Can't connect to sbot":"/settings"!==o&&(window.location="/docs/index.html#/troubleshooting/no-connection");break;default:Fo("/error",{error:e})}}});return{useShortColumn:a,popState:e=>{if(null!==e.state){console.dir("pop",e.state);let{location:t,data:n}=e.state;Po.set({location:t,data:n})}},handleUncaughtException:e=>{console.error("Uncaught exception",e),Fo("/error",{error:e.message})},hashChange:e=>{console.dir("hash change",e)},$currentView:r}}var zo=class extends he{constructor(e){super(),me(this,e,Do,Bo,u,[])}};(async()=>{window.ssb=!1,_o();try{await(async()=>{console.log("Loading configuration...");try{let e=await browser.storage.local.get();if(!e.hasOwnProperty("keys"))throw"Configuration is missing";$o=e}catch(e){throw"Configuration is missing"}})()}catch(e){switch(console.error("initialization error",e),e){case"Configuration is missing":Fo("/settings");break;default:Fo("/error",{error:e})}}new zo({target:document.body})})()}]);