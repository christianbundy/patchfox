{"version":3,"file":"worker-contact-cache-bundle.js","sources":["../node_modules/svelte/internal.mjs","../node_modules/svelte/store.mjs","../src/abusePrevention.js","../src/ssb.js","../node_modules/strict-uri-encode/index.js","../node_modules/decode-uri-component/index.js","../node_modules/split-on-first/index.js","../node_modules/query-string/index.js","../src/messageTypes/PostMsg.svelte","../src/messageTypes/GenericMsg.svelte","../src/messageTypes/VoteMsg.svelte","../src/messageTypes/PrivateMsg.svelte","../src/messageTypes/ContactMsg.svelte","../src/messageTypes/ChannelMsg.svelte","../src/messageTypes/AboutMsg.svelte","../src/messageTypes/PubMsg.svelte","../src/messageTypes/BlogMsg.svelte","../src/parts/AvatarChip.svelte","../node_modules/timeago-simple/index.js","../src/parts/timestamp.js","../src/messageTypes/MessageRenderer.svelte","../src/views/Public.svelte","../node_modules/drag-and-drop-files/ondrop.js","../node_modules/svelte/easing.mjs","../node_modules/svelte/transition.mjs","../src/views/Compose.svelte","../src/views/Thread.svelte","../src/views/Profile.svelte","../src/views/ErrorView.svelte","../src/views/Channels.svelte","../src/views/Channel.svelte","../src/views/Settings.svelte","../src/views/Mentions.svelte","../src/utils.js","../src/workers/contactCache.js"],"sourcesContent":["function noop() { }\nconst identity = x => x;\nfunction assign(tar, src) {\n    for (const k in src)\n        tar[k] = src[k];\n    return tar;\n}\nfunction is_promise(value) {\n    return value && typeof value.then === 'function';\n}\nfunction add_location(element, file, line, column, char) {\n    element.__svelte_meta = {\n        loc: { file, line, column, char }\n    };\n}\nfunction run(fn) {\n    return fn();\n}\nfunction blank_object() {\n    return Object.create(null);\n}\nfunction run_all(fns) {\n    fns.forEach(run);\n}\nfunction is_function(thing) {\n    return typeof thing === 'function';\n}\nfunction safe_not_equal(a, b) {\n    return a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\nfunction not_equal(a, b) {\n    return a != a ? b == b : a !== b;\n}\nfunction validate_store(store, name) {\n    if (!store || typeof store.subscribe !== 'function') {\n        throw new Error(`'${name}' is not a store with a 'subscribe' method`);\n    }\n}\nfunction subscribe(component, store, callback) {\n    const unsub = store.subscribe(callback);\n    component.$$.on_destroy.push(unsub.unsubscribe\n        ? () => unsub.unsubscribe()\n        : unsub);\n}\nfunction create_slot(definition, ctx, fn) {\n    if (definition) {\n        const slot_ctx = get_slot_context(definition, ctx, fn);\n        return definition[0](slot_ctx);\n    }\n}\nfunction get_slot_context(definition, ctx, fn) {\n    return definition[1]\n        ? assign({}, assign(ctx.$$scope.ctx, definition[1](fn ? fn(ctx) : {})))\n        : ctx.$$scope.ctx;\n}\nfunction get_slot_changes(definition, ctx, changed, fn) {\n    return definition[1]\n        ? assign({}, assign(ctx.$$scope.changed || {}, definition[1](fn ? fn(changed) : {})))\n        : ctx.$$scope.changed || {};\n}\nfunction exclude_internal_props(props) {\n    const result = {};\n    for (const k in props)\n        if (k[0] !== '$')\n            result[k] = props[k];\n    return result;\n}\nconst is_client = typeof window !== 'undefined';\nlet now = is_client\n    ? () => window.performance.now()\n    : () => Date.now();\nlet raf = is_client ? requestAnimationFrame : noop;\n// used internally for testing\nfunction set_now(fn) {\n    now = fn;\n}\nfunction set_raf(fn) {\n    raf = fn;\n}\n\nconst tasks = new Set();\nlet running = false;\nfunction run_tasks() {\n    tasks.forEach(task => {\n        if (!task[0](now())) {\n            tasks.delete(task);\n            task[1]();\n        }\n    });\n    running = tasks.size > 0;\n    if (running)\n        raf(run_tasks);\n}\nfunction clear_loops() {\n    // for testing...\n    tasks.forEach(task => tasks.delete(task));\n    running = false;\n}\nfunction loop(fn) {\n    let task;\n    if (!running) {\n        running = true;\n        raf(run_tasks);\n    }\n    return {\n        promise: new Promise(fulfil => {\n            tasks.add(task = [fn, fulfil]);\n        }),\n        abort() {\n            tasks.delete(task);\n        }\n    };\n}\n\nfunction append(target, node) {\n    target.appendChild(node);\n}\nfunction insert(target, node, anchor) {\n    target.insertBefore(node, anchor || null);\n}\nfunction detach(node) {\n    node.parentNode.removeChild(node);\n}\nfunction detach_between(before, after) {\n    while (before.nextSibling && before.nextSibling !== after) {\n        before.parentNode.removeChild(before.nextSibling);\n    }\n}\nfunction detach_before(after) {\n    while (after.previousSibling) {\n        after.parentNode.removeChild(after.previousSibling);\n    }\n}\nfunction detach_after(before) {\n    while (before.nextSibling) {\n        before.parentNode.removeChild(before.nextSibling);\n    }\n}\nfunction destroy_each(iterations, detaching) {\n    for (let i = 0; i < iterations.length; i += 1) {\n        if (iterations[i])\n            iterations[i].d(detaching);\n    }\n}\nfunction element(name) {\n    return document.createElement(name);\n}\nfunction object_without_properties(obj, exclude) {\n    const target = {};\n    for (const k in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, k)\n            // @ts-ignore\n            && exclude.indexOf(k) === -1) {\n            // @ts-ignore\n            target[k] = obj[k];\n        }\n    }\n    return target;\n}\nfunction svg_element(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\nfunction text(data) {\n    return document.createTextNode(data);\n}\nfunction space() {\n    return text(' ');\n}\nfunction empty() {\n    return text('');\n}\nfunction listen(node, event, handler, options) {\n    node.addEventListener(event, handler, options);\n    return () => node.removeEventListener(event, handler, options);\n}\nfunction prevent_default(fn) {\n    return function (event) {\n        event.preventDefault();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction stop_propagation(fn) {\n    return function (event) {\n        event.stopPropagation();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction attr(node, attribute, value) {\n    if (value == null)\n        node.removeAttribute(attribute);\n    else\n        node.setAttribute(attribute, value);\n}\nfunction set_attributes(node, attributes) {\n    for (const key in attributes) {\n        if (key === 'style') {\n            node.style.cssText = attributes[key];\n        }\n        else if (key in node) {\n            node[key] = attributes[key];\n        }\n        else {\n            attr(node, key, attributes[key]);\n        }\n    }\n}\nfunction set_custom_element_data(node, prop, value) {\n    if (prop in node) {\n        node[prop] = value;\n    }\n    else {\n        attr(node, prop, value);\n    }\n}\nfunction xlink_attr(node, attribute, value) {\n    node.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\nfunction get_binding_group_value(group) {\n    const value = [];\n    for (let i = 0; i < group.length; i += 1) {\n        if (group[i].checked)\n            value.push(group[i].__value);\n    }\n    return value;\n}\nfunction to_number(value) {\n    return value === '' ? undefined : +value;\n}\nfunction time_ranges_to_array(ranges) {\n    const array = [];\n    for (let i = 0; i < ranges.length; i += 1) {\n        array.push({ start: ranges.start(i), end: ranges.end(i) });\n    }\n    return array;\n}\nfunction children(element) {\n    return Array.from(element.childNodes);\n}\nfunction claim_element(nodes, name, attributes, svg) {\n    for (let i = 0; i < nodes.length; i += 1) {\n        const node = nodes[i];\n        if (node.nodeName === name) {\n            for (let j = 0; j < node.attributes.length; j += 1) {\n                const attribute = node.attributes[j];\n                if (!attributes[attribute.name])\n                    node.removeAttribute(attribute.name);\n            }\n            return nodes.splice(i, 1)[0]; // TODO strip unwanted attributes\n        }\n    }\n    return svg ? svg_element(name) : element(name);\n}\nfunction claim_text(nodes, data) {\n    for (let i = 0; i < nodes.length; i += 1) {\n        const node = nodes[i];\n        if (node.nodeType === 3) {\n            node.data = data;\n            return nodes.splice(i, 1)[0];\n        }\n    }\n    return text(data);\n}\nfunction set_data(text, data) {\n    data = '' + data;\n    if (text.data !== data)\n        text.data = data;\n}\nfunction set_input_type(input, type) {\n    try {\n        input.type = type;\n    }\n    catch (e) {\n        // do nothing\n    }\n}\nfunction set_style(node, key, value) {\n    node.style.setProperty(key, value);\n}\nfunction select_option(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        if (option.__value === value) {\n            option.selected = true;\n            return;\n        }\n    }\n}\nfunction select_options(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        option.selected = ~value.indexOf(option.__value);\n    }\n}\nfunction select_value(select) {\n    const selected_option = select.querySelector(':checked') || select.options[0];\n    return selected_option && selected_option.__value;\n}\nfunction select_multiple_value(select) {\n    return [].map.call(select.querySelectorAll(':checked'), option => option.__value);\n}\nfunction add_resize_listener(element, fn) {\n    if (getComputedStyle(element).position === 'static') {\n        element.style.position = 'relative';\n    }\n    const object = document.createElement('object');\n    object.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;');\n    object.type = 'text/html';\n    let win;\n    object.onload = () => {\n        win = object.contentDocument.defaultView;\n        win.addEventListener('resize', fn);\n    };\n    if (/Trident/.test(navigator.userAgent)) {\n        element.appendChild(object);\n        object.data = 'about:blank';\n    }\n    else {\n        object.data = 'about:blank';\n        element.appendChild(object);\n    }\n    return {\n        cancel: () => {\n            win && win.removeEventListener && win.removeEventListener('resize', fn);\n            element.removeChild(object);\n        }\n    };\n}\nfunction toggle_class(element, name, toggle) {\n    element.classList[toggle ? 'add' : 'remove'](name);\n}\nfunction custom_event(type, detail) {\n    const e = document.createEvent('CustomEvent');\n    e.initCustomEvent(type, false, false, detail);\n    return e;\n}\n\nlet stylesheet;\nlet active = 0;\nlet current_rules = {};\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n    let hash = 5381;\n    let i = str.length;\n    while (i--)\n        hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n    return hash >>> 0;\n}\nfunction create_rule(node, a, b, duration, delay, ease, fn, uid = 0) {\n    const step = 16.666 / duration;\n    let keyframes = '{\\n';\n    for (let p = 0; p <= 1; p += step) {\n        const t = a + (b - a) * ease(p);\n        keyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n    }\n    const rule = keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n    const name = `__svelte_${hash(rule)}_${uid}`;\n    if (!current_rules[name]) {\n        if (!stylesheet) {\n            const style = element('style');\n            document.head.appendChild(style);\n            stylesheet = style.sheet;\n        }\n        current_rules[name] = true;\n        stylesheet.insertRule(`@keyframes ${name} ${rule}`, stylesheet.cssRules.length);\n    }\n    const animation = node.style.animation || '';\n    node.style.animation = `${animation ? `${animation}, ` : ``}${name} ${duration}ms linear ${delay}ms 1 both`;\n    active += 1;\n    return name;\n}\nfunction delete_rule(node, name) {\n    node.style.animation = (node.style.animation || '')\n        .split(', ')\n        .filter(name\n        ? anim => anim.indexOf(name) < 0 // remove specific animation\n        : anim => anim.indexOf('__svelte') === -1 // remove all Svelte animations\n    )\n        .join(', ');\n    if (name && !--active)\n        clear_rules();\n}\nfunction clear_rules() {\n    raf(() => {\n        if (active)\n            return;\n        let i = stylesheet.cssRules.length;\n        while (i--)\n            stylesheet.deleteRule(i);\n        current_rules = {};\n    });\n}\n\nfunction create_animation(node, from, fn, params) {\n    if (!from)\n        return noop;\n    const to = node.getBoundingClientRect();\n    if (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom)\n        return noop;\n    const { delay = 0, duration = 300, easing = identity, start: start_time = now() + delay, end = start_time + duration, tick = noop, css } = fn(node, { from, to }, params);\n    let running = true;\n    let started = false;\n    let name;\n    function start() {\n        if (css) {\n            name = create_rule(node, 0, 1, duration, delay, easing, css);\n        }\n        if (!delay) {\n            started = true;\n        }\n    }\n    function stop() {\n        if (css)\n            delete_rule(node, name);\n        running = false;\n    }\n    loop(now$$1 => {\n        if (!started && now$$1 >= start_time) {\n            started = true;\n        }\n        if (started && now$$1 >= end) {\n            tick(1, 0);\n            stop();\n        }\n        if (!running) {\n            return false;\n        }\n        if (started) {\n            const p = now$$1 - start_time;\n            const t = 0 + 1 * easing(p / duration);\n            tick(t, 1 - t);\n        }\n        return true;\n    });\n    start();\n    tick(0, 1);\n    return stop;\n}\nfunction fix_position(node) {\n    const style = getComputedStyle(node);\n    if (style.position !== 'absolute' && style.position !== 'fixed') {\n        const { width, height } = style;\n        const a = node.getBoundingClientRect();\n        node.style.position = 'absolute';\n        node.style.width = width;\n        node.style.height = height;\n        const b = node.getBoundingClientRect();\n        if (a.left !== b.left || a.top !== b.top) {\n            const style = getComputedStyle(node);\n            const transform = style.transform === 'none' ? '' : style.transform;\n            node.style.transform = `${transform} translate(${a.left - b.left}px, ${a.top - b.top}px)`;\n        }\n    }\n}\n\nlet current_component;\nfunction set_current_component(component) {\n    current_component = component;\n}\nfunction get_current_component() {\n    if (!current_component)\n        throw new Error(`Function called outside component initialization`);\n    return current_component;\n}\nfunction beforeUpdate(fn) {\n    get_current_component().$$.before_render.push(fn);\n}\nfunction onMount(fn) {\n    get_current_component().$$.on_mount.push(fn);\n}\nfunction afterUpdate(fn) {\n    get_current_component().$$.after_render.push(fn);\n}\nfunction onDestroy(fn) {\n    get_current_component().$$.on_destroy.push(fn);\n}\nfunction createEventDispatcher() {\n    const component = current_component;\n    return (type, detail) => {\n        const callbacks = component.$$.callbacks[type];\n        if (callbacks) {\n            // TODO are there situations where events could be dispatched\n            // in a server (non-DOM) environment?\n            const event = custom_event(type, detail);\n            callbacks.slice().forEach(fn => {\n                fn.call(component, event);\n            });\n        }\n    };\n}\nfunction setContext(key, context) {\n    get_current_component().$$.context.set(key, context);\n}\nfunction getContext(key) {\n    return get_current_component().$$.context.get(key);\n}\n// TODO figure out if we still want to support\n// shorthand events, or if we want to implement\n// a real bubbling mechanism\nfunction bubble(component, event) {\n    const callbacks = component.$$.callbacks[event.type];\n    if (callbacks) {\n        callbacks.slice().forEach(fn => fn(event));\n    }\n}\n\nconst dirty_components = [];\nconst intros = { enabled: false };\nconst resolved_promise = Promise.resolve();\nlet update_scheduled = false;\nconst binding_callbacks = [];\nconst render_callbacks = [];\nconst flush_callbacks = [];\nfunction schedule_update() {\n    if (!update_scheduled) {\n        update_scheduled = true;\n        resolved_promise.then(flush);\n    }\n}\nfunction tick() {\n    schedule_update();\n    return resolved_promise;\n}\nfunction add_binding_callback(fn) {\n    binding_callbacks.push(fn);\n}\nfunction add_render_callback(fn) {\n    render_callbacks.push(fn);\n}\nfunction add_flush_callback(fn) {\n    flush_callbacks.push(fn);\n}\nfunction flush() {\n    const seen_callbacks = new Set();\n    do {\n        // first, call beforeUpdate functions\n        // and update components\n        while (dirty_components.length) {\n            const component = dirty_components.shift();\n            set_current_component(component);\n            update(component.$$);\n        }\n        while (binding_callbacks.length)\n            binding_callbacks.shift()();\n        // then, once components are updated, call\n        // afterUpdate functions. This may cause\n        // subsequent updates...\n        while (render_callbacks.length) {\n            const callback = render_callbacks.pop();\n            if (!seen_callbacks.has(callback)) {\n                callback();\n                // ...so guard against infinite loops\n                seen_callbacks.add(callback);\n            }\n        }\n    } while (dirty_components.length);\n    while (flush_callbacks.length) {\n        flush_callbacks.pop()();\n    }\n    update_scheduled = false;\n}\nfunction update($$) {\n    if ($$.fragment) {\n        $$.update($$.dirty);\n        run_all($$.before_render);\n        $$.fragment.p($$.dirty, $$.ctx);\n        $$.dirty = null;\n        $$.after_render.forEach(add_render_callback);\n    }\n}\n\nlet promise;\nfunction wait() {\n    if (!promise) {\n        promise = Promise.resolve();\n        promise.then(() => {\n            promise = null;\n        });\n    }\n    return promise;\n}\nfunction dispatch(node, direction, kind) {\n    node.dispatchEvent(custom_event(`${direction ? 'intro' : 'outro'}${kind}`));\n}\nlet outros;\nfunction group_outros() {\n    outros = {\n        remaining: 0,\n        callbacks: []\n    };\n}\nfunction check_outros() {\n    if (!outros.remaining) {\n        run_all(outros.callbacks);\n    }\n}\nfunction on_outro(callback) {\n    outros.callbacks.push(callback);\n}\nfunction create_in_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = false;\n    let animation_name;\n    let task;\n    let uid = 0;\n    function cleanup() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick: tick$$1 = noop, css } = config;\n        if (css)\n            animation_name = create_rule(node, 0, 1, duration, delay, easing, css, uid++);\n        tick$$1(0, 1);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        if (task)\n            task.abort();\n        running = true;\n        task = loop(now$$1 => {\n            if (running) {\n                if (now$$1 >= end_time) {\n                    tick$$1(1, 0);\n                    cleanup();\n                    return running = false;\n                }\n                if (now$$1 >= start_time) {\n                    const t = easing((now$$1 - start_time) / duration);\n                    tick$$1(t, 1 - t);\n                }\n            }\n            return running;\n        });\n    }\n    let started = false;\n    return {\n        start() {\n            if (started)\n                return;\n            delete_rule(node);\n            if (typeof config === 'function') {\n                config = config();\n                wait().then(go);\n            }\n            else {\n                go();\n            }\n        },\n        invalidate() {\n            started = false;\n        },\n        end() {\n            if (running) {\n                cleanup();\n                running = false;\n            }\n        }\n    };\n}\nfunction create_out_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = true;\n    let animation_name;\n    const group = outros;\n    group.remaining += 1;\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick: tick$$1 = noop, css } = config;\n        if (css)\n            animation_name = create_rule(node, 1, 0, duration, delay, easing, css);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        loop(now$$1 => {\n            if (running) {\n                if (now$$1 >= end_time) {\n                    tick$$1(0, 1);\n                    if (!--group.remaining) {\n                        // this will result in `end()` being called,\n                        // so we don't need to clean up here\n                        run_all(group.callbacks);\n                    }\n                    return false;\n                }\n                if (now$$1 >= start_time) {\n                    const t = easing((now$$1 - start_time) / duration);\n                    tick$$1(1 - t, t);\n                }\n            }\n            return running;\n        });\n    }\n    if (typeof config === 'function') {\n        wait().then(() => {\n            config = config();\n            go();\n        });\n    }\n    else {\n        go();\n    }\n    return {\n        end(reset) {\n            if (reset && config.tick) {\n                config.tick(1, 0);\n            }\n            if (running) {\n                if (animation_name)\n                    delete_rule(node, animation_name);\n                running = false;\n            }\n        }\n    };\n}\nfunction create_bidirectional_transition(node, fn, params, intro) {\n    let config = fn(node, params);\n    let t = intro ? 0 : 1;\n    let running_program = null;\n    let pending_program = null;\n    let animation_name = null;\n    function clear_animation() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function init(program, duration) {\n        const d = program.b - t;\n        duration *= Math.abs(d);\n        return {\n            a: t,\n            b: program.b,\n            d,\n            duration,\n            start: program.start,\n            end: program.start + duration,\n            group: program.group\n        };\n    }\n    function go(b) {\n        const { delay = 0, duration = 300, easing = identity, tick: tick$$1 = noop, css } = config;\n        const program = {\n            start: now() + delay,\n            b\n        };\n        if (!b) {\n            // @ts-ignore todo: improve typings\n            program.group = outros;\n            outros.remaining += 1;\n        }\n        if (running_program) {\n            pending_program = program;\n        }\n        else {\n            // if this is an intro, and there's a delay, we need to do\n            // an initial tick and/or apply CSS animation immediately\n            if (css) {\n                clear_animation();\n                animation_name = create_rule(node, t, b, duration, delay, easing, css);\n            }\n            if (b)\n                tick$$1(0, 1);\n            running_program = init(program, duration);\n            add_render_callback(() => dispatch(node, b, 'start'));\n            loop(now$$1 => {\n                if (pending_program && now$$1 > pending_program.start) {\n                    running_program = init(pending_program, duration);\n                    pending_program = null;\n                    dispatch(node, running_program.b, 'start');\n                    if (css) {\n                        clear_animation();\n                        animation_name = create_rule(node, t, running_program.b, running_program.duration, 0, easing, config.css);\n                    }\n                }\n                if (running_program) {\n                    if (now$$1 >= running_program.end) {\n                        tick$$1(t = running_program.b, 1 - t);\n                        dispatch(node, running_program.b, 'end');\n                        if (!pending_program) {\n                            // we're done\n                            if (running_program.b) {\n                                // intro — we can tidy up immediately\n                                clear_animation();\n                            }\n                            else {\n                                // outro — needs to be coordinated\n                                if (!--running_program.group.remaining)\n                                    run_all(running_program.group.callbacks);\n                            }\n                        }\n                        running_program = null;\n                    }\n                    else if (now$$1 >= running_program.start) {\n                        const p = now$$1 - running_program.start;\n                        t = running_program.a + running_program.d * easing(p / running_program.duration);\n                        tick$$1(t, 1 - t);\n                    }\n                }\n                return !!(running_program || pending_program);\n            });\n        }\n    }\n    return {\n        run(b) {\n            if (typeof config === 'function') {\n                wait().then(() => {\n                    config = config();\n                    go(b);\n                });\n            }\n            else {\n                go(b);\n            }\n        },\n        end() {\n            clear_animation();\n            running_program = pending_program = null;\n        }\n    };\n}\n\nfunction handle_promise(promise, info) {\n    const token = info.token = {};\n    function update(type, index, key, value) {\n        if (info.token !== token)\n            return;\n        info.resolved = key && { [key]: value };\n        const child_ctx = assign(assign({}, info.ctx), info.resolved);\n        const block = type && (info.current = type)(child_ctx);\n        if (info.block) {\n            if (info.blocks) {\n                info.blocks.forEach((block, i) => {\n                    if (i !== index && block) {\n                        group_outros();\n                        on_outro(() => {\n                            block.d(1);\n                            info.blocks[i] = null;\n                        });\n                        block.o(1);\n                        check_outros();\n                    }\n                });\n            }\n            else {\n                info.block.d(1);\n            }\n            block.c();\n            if (block.i)\n                block.i(1);\n            block.m(info.mount(), info.anchor);\n            flush();\n        }\n        info.block = block;\n        if (info.blocks)\n            info.blocks[index] = block;\n    }\n    if (is_promise(promise)) {\n        promise.then(value => {\n            update(info.then, 1, info.value, value);\n        }, error => {\n            update(info.catch, 2, info.error, error);\n        });\n        // if we previously had a then/catch block, destroy it\n        if (info.current !== info.pending) {\n            update(info.pending, 0);\n            return true;\n        }\n    }\n    else {\n        if (info.current !== info.then) {\n            update(info.then, 1, info.value, promise);\n            return true;\n        }\n        info.resolved = { [info.value]: promise };\n    }\n}\n\nfunction destroy_block(block, lookup) {\n    block.d(1);\n    lookup.delete(block.key);\n}\nfunction outro_and_destroy_block(block, lookup) {\n    on_outro(() => {\n        destroy_block(block, lookup);\n    });\n    block.o(1);\n}\nfunction fix_and_outro_and_destroy_block(block, lookup) {\n    block.f();\n    outro_and_destroy_block(block, lookup);\n}\nfunction update_keyed_each(old_blocks, changed, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, next, get_context) {\n    let o = old_blocks.length;\n    let n = list.length;\n    let i = o;\n    const old_indexes = {};\n    while (i--)\n        old_indexes[old_blocks[i].key] = i;\n    const new_blocks = [];\n    const new_lookup = new Map();\n    const deltas = new Map();\n    i = n;\n    while (i--) {\n        const child_ctx = get_context(ctx, list, i);\n        const key = get_key(child_ctx);\n        let block = lookup.get(key);\n        if (!block) {\n            block = create_each_block(key, child_ctx);\n            block.c();\n        }\n        else if (dynamic) {\n            block.p(changed, child_ctx);\n        }\n        new_lookup.set(key, new_blocks[i] = block);\n        if (key in old_indexes)\n            deltas.set(key, Math.abs(i - old_indexes[key]));\n    }\n    const will_move = new Set();\n    const did_move = new Set();\n    function insert(block) {\n        if (block.i)\n            block.i(1);\n        block.m(node, next);\n        lookup.set(block.key, block);\n        next = block.first;\n        n--;\n    }\n    while (o && n) {\n        const new_block = new_blocks[n - 1];\n        const old_block = old_blocks[o - 1];\n        const new_key = new_block.key;\n        const old_key = old_block.key;\n        if (new_block === old_block) {\n            // do nothing\n            next = new_block.first;\n            o--;\n            n--;\n        }\n        else if (!new_lookup.has(old_key)) {\n            // remove old block\n            destroy(old_block, lookup);\n            o--;\n        }\n        else if (!lookup.has(new_key) || will_move.has(new_key)) {\n            insert(new_block);\n        }\n        else if (did_move.has(old_key)) {\n            o--;\n        }\n        else if (deltas.get(new_key) > deltas.get(old_key)) {\n            did_move.add(new_key);\n            insert(new_block);\n        }\n        else {\n            will_move.add(old_key);\n            o--;\n        }\n    }\n    while (o--) {\n        const old_block = old_blocks[o];\n        if (!new_lookup.has(old_block.key))\n            destroy(old_block, lookup);\n    }\n    while (n)\n        insert(new_blocks[n - 1]);\n    return new_blocks;\n}\nfunction measure(blocks) {\n    const rects = {};\n    let i = blocks.length;\n    while (i--)\n        rects[blocks[i].key] = blocks[i].node.getBoundingClientRect();\n    return rects;\n}\n\nfunction get_spread_update(levels, updates) {\n    const update = {};\n    const to_null_out = {};\n    const accounted_for = { $$scope: 1 };\n    let i = levels.length;\n    while (i--) {\n        const o = levels[i];\n        const n = updates[i];\n        if (n) {\n            for (const key in o) {\n                if (!(key in n))\n                    to_null_out[key] = 1;\n            }\n            for (const key in n) {\n                if (!accounted_for[key]) {\n                    update[key] = n[key];\n                    accounted_for[key] = 1;\n                }\n            }\n            levels[i] = n;\n        }\n        else {\n            for (const key in o) {\n                accounted_for[key] = 1;\n            }\n        }\n    }\n    for (const key in to_null_out) {\n        if (!(key in update))\n            update[key] = undefined;\n    }\n    return update;\n}\n\nconst invalid_attribute_name_character = /[\\s'\">/=\\u{FDD0}-\\u{FDEF}\\u{FFFE}\\u{FFFF}\\u{1FFFE}\\u{1FFFF}\\u{2FFFE}\\u{2FFFF}\\u{3FFFE}\\u{3FFFF}\\u{4FFFE}\\u{4FFFF}\\u{5FFFE}\\u{5FFFF}\\u{6FFFE}\\u{6FFFF}\\u{7FFFE}\\u{7FFFF}\\u{8FFFE}\\u{8FFFF}\\u{9FFFE}\\u{9FFFF}\\u{AFFFE}\\u{AFFFF}\\u{BFFFE}\\u{BFFFF}\\u{CFFFE}\\u{CFFFF}\\u{DFFFE}\\u{DFFFF}\\u{EFFFE}\\u{EFFFF}\\u{FFFFE}\\u{FFFFF}\\u{10FFFE}\\u{10FFFF}]/u;\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n// https://infra.spec.whatwg.org/#noncharacter\nfunction spread(args) {\n    const attributes = Object.assign({}, ...args);\n    let str = '';\n    Object.keys(attributes).forEach(name => {\n        if (invalid_attribute_name_character.test(name))\n            return;\n        const value = attributes[name];\n        if (value === undefined)\n            return;\n        if (value === true)\n            str += \" \" + name;\n        const escaped = String(value)\n            .replace(/\"/g, '&#34;')\n            .replace(/'/g, '&#39;');\n        str += \" \" + name + \"=\" + JSON.stringify(escaped);\n    });\n    return str;\n}\nconst escaped = {\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;'\n};\nfunction escape(html) {\n    return String(html).replace(/[\"'&<>]/g, match => escaped[match]);\n}\nfunction each(items, fn) {\n    let str = '';\n    for (let i = 0; i < items.length; i += 1) {\n        str += fn(items[i], i);\n    }\n    return str;\n}\nconst missing_component = {\n    $$render: () => ''\n};\nfunction validate_component(component, name) {\n    if (!component || !component.$$render) {\n        if (name === 'svelte:component')\n            name += ' this={...}';\n        throw new Error(`<${name}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);\n    }\n    return component;\n}\nfunction debug(file, line, column, values) {\n    console.log(`{@debug} ${file ? file + ' ' : ''}(${line}:${column})`); // eslint-disable-line no-console\n    console.log(values); // eslint-disable-line no-console\n    return '';\n}\nlet on_destroy;\nfunction create_ssr_component(fn) {\n    function $$render(result, props, bindings, slots) {\n        const parent_component = current_component;\n        const $$ = {\n            on_destroy,\n            context: new Map(parent_component ? parent_component.$$.context : []),\n            // these will be immediately discarded\n            on_mount: [],\n            before_render: [],\n            after_render: [],\n            callbacks: blank_object()\n        };\n        set_current_component({ $$ });\n        const html = fn(result, props, bindings, slots);\n        set_current_component(parent_component);\n        return html;\n    }\n    return {\n        render: (props = {}, options = {}) => {\n            on_destroy = [];\n            const result = { head: '', css: new Set() };\n            const html = $$render(result, props, {}, options);\n            run_all(on_destroy);\n            return {\n                html,\n                css: {\n                    code: Array.from(result.css).map(css => css.code).join('\\n'),\n                    map: null // TODO\n                },\n                head: result.head\n            };\n        },\n        $$render\n    };\n}\nfunction get_store_value(store) {\n    let value;\n    store.subscribe(_ => value = _)();\n    return value;\n}\n\nfunction bind(component, name, callback) {\n    if (component.$$.props.indexOf(name) === -1)\n        return;\n    component.$$.bound[name] = callback;\n    callback(component.$$.ctx[name]);\n}\nfunction mount_component(component, target, anchor) {\n    const { fragment, on_mount, on_destroy, after_render } = component.$$;\n    fragment.m(target, anchor);\n    // onMount happens after the initial afterUpdate. Because\n    // afterUpdate callbacks happen in reverse order (inner first)\n    // we schedule onMount callbacks before afterUpdate callbacks\n    add_render_callback(() => {\n        const new_on_destroy = on_mount.map(run).filter(is_function);\n        if (on_destroy) {\n            on_destroy.push(...new_on_destroy);\n        }\n        else {\n            // Edge case - component was destroyed immediately,\n            // most likely as a result of a binding initialising\n            run_all(new_on_destroy);\n        }\n        component.$$.on_mount = [];\n    });\n    after_render.forEach(add_render_callback);\n}\nfunction destroy(component, detaching) {\n    if (component.$$) {\n        run_all(component.$$.on_destroy);\n        component.$$.fragment.d(detaching);\n        // TODO null out other refs, including component.$$ (but need to\n        // preserve final state?)\n        component.$$.on_destroy = component.$$.fragment = null;\n        component.$$.ctx = {};\n    }\n}\nfunction make_dirty(component, key) {\n    if (!component.$$.dirty) {\n        dirty_components.push(component);\n        schedule_update();\n        component.$$.dirty = blank_object();\n    }\n    component.$$.dirty[key] = true;\n}\nfunction init(component, options, instance, create_fragment, not_equal$$1, prop_names) {\n    const parent_component = current_component;\n    set_current_component(component);\n    const props = options.props || {};\n    const $$ = component.$$ = {\n        fragment: null,\n        ctx: null,\n        // state\n        props: prop_names,\n        update: noop,\n        not_equal: not_equal$$1,\n        bound: blank_object(),\n        // lifecycle\n        on_mount: [],\n        on_destroy: [],\n        before_render: [],\n        after_render: [],\n        context: new Map(parent_component ? parent_component.$$.context : []),\n        // everything else\n        callbacks: blank_object(),\n        dirty: null\n    };\n    let ready = false;\n    $$.ctx = instance\n        ? instance(component, props, (key, value) => {\n            if ($$.ctx && not_equal$$1($$.ctx[key], $$.ctx[key] = value)) {\n                if ($$.bound[key])\n                    $$.bound[key](value);\n                if (ready)\n                    make_dirty(component, key);\n            }\n        })\n        : props;\n    $$.update();\n    ready = true;\n    run_all($$.before_render);\n    $$.fragment = create_fragment($$.ctx);\n    if (options.target) {\n        if (options.hydrate) {\n            $$.fragment.l(children(options.target));\n        }\n        else {\n            $$.fragment.c();\n        }\n        if (options.intro && component.$$.fragment.i)\n            component.$$.fragment.i();\n        mount_component(component, options.target, options.anchor);\n        flush();\n    }\n    set_current_component(parent_component);\n}\nlet SvelteElement;\nif (typeof HTMLElement !== 'undefined') {\n    SvelteElement = class extends HTMLElement {\n        constructor() {\n            super();\n            this.attachShadow({ mode: 'open' });\n        }\n        connectedCallback() {\n            // @ts-ignore todo: improve typings\n            for (const key in this.$$.slotted) {\n                // @ts-ignore todo: improve typings\n                this.appendChild(this.$$.slotted[key]);\n            }\n        }\n        attributeChangedCallback(attr$$1, oldValue, newValue) {\n            this[attr$$1] = newValue;\n        }\n        $destroy() {\n            destroy(this, true);\n            this.$destroy = noop;\n        }\n        $on(type, callback) {\n            // TODO should this delegate to addEventListener?\n            const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n            callbacks.push(callback);\n            return () => {\n                const index = callbacks.indexOf(callback);\n                if (index !== -1)\n                    callbacks.splice(index, 1);\n            };\n        }\n        $set() {\n            // overridden by instance, if it has props\n        }\n    };\n}\nclass SvelteComponent {\n    $destroy() {\n        destroy(this, true);\n        this.$destroy = noop;\n    }\n    $on(type, callback) {\n        const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n        callbacks.push(callback);\n        return () => {\n            const index = callbacks.indexOf(callback);\n            if (index !== -1)\n                callbacks.splice(index, 1);\n        };\n    }\n    $set() {\n        // overridden by instance, if it has props\n    }\n}\nclass SvelteComponentDev extends SvelteComponent {\n    constructor(options) {\n        if (!options || (!options.target && !options.$$inline)) {\n            throw new Error(`'target' is a required option`);\n        }\n        super();\n    }\n    $destroy() {\n        super.$destroy();\n        this.$destroy = () => {\n            console.warn(`Component was already destroyed`); // eslint-disable-line no-console\n        };\n    }\n}\n\nexport { create_animation, fix_position, handle_promise, append, insert, detach, detach_between, detach_before, detach_after, destroy_each, element, object_without_properties, svg_element, text, space, empty, listen, prevent_default, stop_propagation, attr, set_attributes, set_custom_element_data, xlink_attr, get_binding_group_value, to_number, time_ranges_to_array, children, claim_element, claim_text, set_data, set_input_type, set_style, select_option, select_options, select_value, select_multiple_value, add_resize_listener, toggle_class, custom_event, destroy_block, outro_and_destroy_block, fix_and_outro_and_destroy_block, update_keyed_each, measure, current_component, set_current_component, beforeUpdate, onMount, afterUpdate, onDestroy, createEventDispatcher, setContext, getContext, bubble, clear_loops, loop, dirty_components, intros, schedule_update, tick, add_binding_callback, add_render_callback, add_flush_callback, flush, get_spread_update, invalid_attribute_name_character, spread, escaped, escape, each, missing_component, validate_component, debug, create_ssr_component, get_store_value, group_outros, check_outros, on_outro, create_in_transition, create_out_transition, create_bidirectional_transition, noop, identity, assign, is_promise, add_location, run, blank_object, run_all, is_function, safe_not_equal, not_equal, validate_store, subscribe, create_slot, get_slot_context, get_slot_changes, exclude_internal_props, now, raf, set_now, set_raf, bind, mount_component, init, SvelteElement, SvelteComponent, SvelteComponentDev };\n","import { noop, safe_not_equal, run_all, is_function } from './internal';\n\n/**\n * Creates a `Readable` store that allows reading by subscription.\n * @param value initial value\n * @param {StartStopNotifier}start start and stop notifications for subscriptions\n */\nfunction readable(value, start) {\n    return {\n        subscribe: writable(value, start).subscribe,\n    };\n}\n/**\n * Create a `Writable` store that allows both updating and reading by subscription.\n * @param {*=}value initial value\n * @param {StartStopNotifier=}start start and stop notifications for subscriptions\n */\nfunction writable(value, start = noop) {\n    let stop;\n    const subscribers = [];\n    function set(new_value) {\n        if (safe_not_equal(value, new_value)) {\n            value = new_value;\n            if (!stop) {\n                return; // not ready\n            }\n            subscribers.forEach((s) => s[1]());\n            subscribers.forEach((s) => s[0](value));\n        }\n    }\n    function update(fn) {\n        set(fn(value));\n    }\n    function subscribe(run, invalidate = noop) {\n        const subscriber = [run, invalidate];\n        subscribers.push(subscriber);\n        if (subscribers.length === 1) {\n            stop = start(set) || noop;\n        }\n        run(value);\n        return () => {\n            const index = subscribers.indexOf(subscriber);\n            if (index !== -1) {\n                subscribers.splice(index, 1);\n            }\n            if (subscribers.length === 0) {\n                stop();\n            }\n        };\n    }\n    return { set, update, subscribe };\n}\n/**\n * Derived value store by synchronizing one or more readable stores and\n * applying an aggregation function over its input values.\n * @param {Stores} stores input stores\n * @param {function(Stores=, function(*)=):*}fn function callback that aggregates the values\n * @param {*=}initial_value when used asynchronously\n */\nfunction derived(stores, fn, initial_value) {\n    const single = !Array.isArray(stores);\n    const stores_array = single\n        ? [stores]\n        : stores;\n    const auto = fn.length < 2;\n    return readable(initial_value, (set) => {\n        let inited = false;\n        const values = [];\n        let pending = 0;\n        let cleanup = noop;\n        const sync = () => {\n            if (pending) {\n                return;\n            }\n            cleanup();\n            const result = fn(single ? values[0] : values, set);\n            if (auto) {\n                set(result);\n            }\n            else {\n                cleanup = is_function(result) ? result : noop;\n            }\n        };\n        const unsubscribers = stores_array.map((store, i) => store.subscribe((value) => {\n            values[i] = value;\n            pending &= ~(1 << i);\n            if (inited) {\n                sync();\n            }\n        }, () => {\n            pending |= (1 << i);\n        }));\n        inited = true;\n        sync();\n        return function stop() {\n            run_all(unsubscribers);\n            cleanup();\n        };\n    });\n}\n/**\n * Get the current value from a store by subscribing and immediately unsubscribing.\n * @param store readable\n */\nfunction get(store) {\n    let value;\n    store.subscribe((_) => value = _)();\n    return value;\n}\n\nexport { readable, writable, derived, get };\n","import { getPref, setPref } from \"./utils.js\"\r\n\r\nexport const getFilters = () => getPref(\"filters\", [])\r\n\r\nexport const addFilter = (filter) => {\r\n    let currentFilters = getFilters()\r\n\r\n    currentFilters.push(filter)\r\n\r\n    setPref(\"filters\", currentFilters)\r\n}\r\n\r\nexport const deleteFilter = (filter) => {\r\n    let currentFilters = getFilters()\r\n\r\n    setPref(\"filters\", currentFilters.filter(f => f !== filter))\r\n}\r\n\r\nexport const isMessageBlured = (msg) => {\r\n    let currentFilters = getFilters().filter(f => f.action == \"blur\")\r\n    if (currentFilters.length > 0) {\r\n        let res = currentFilters.map((f) => isMessageFiltered(msg, f, \"blur\"))\r\n        return !res.some(r => r)\r\n    } else {\r\n        return false\r\n    }\r\n}\r\n\r\n\r\nexport const isMessageHidden = (msg) => {\r\n    let currentFilters = getFilters().filter(f => f.action == \"hide\")\r\n    if (currentFilters.length > 0) {\r\n        let res = currentFilters.map((f) => isMessageFiltered(msg, f, \"hide\"))\r\n        return res.some(r => r)\r\n    } else {\r\n        return true // true because it is used by a pull.filter()\r\n    }\r\n}\r\n\r\nexport const isMessageFiltered = (msg, filter, action) => {\r\n    let filterResults = []\r\n    if (filter.action !== action) {\r\n        return true\r\n    }\r\n\r\n    if (filter.expires) {\r\n        let expirationDate = new Date(filter.expires)\r\n        let today = new Date()\r\n\r\n        if (today > expirationDate) {\r\n            return true\r\n        }\r\n    }\r\n\r\n    if (filter.feed) {\r\n        if (filter.feed == msg.value.author) {\r\n            console.log(\"filtered due to feed\")\r\n            filterResults.push(true)\r\n        } else {\r\n            filterResults.push(false)\r\n        }\r\n    }\r\n\r\n    if (filter.channel) {\r\n        console.log(\"filtered due to channel\")\r\n        if (msg.value.content.channel && filter.channel == msg.value.content.channel) {\r\n            filterResults.push(true)\r\n        } else {\r\n            filterResults.push(false)\r\n        }\r\n    }\r\n\r\n    if (filter.keywords.length > 0 && msg.value.content.type == \"post\" && msg.value.content.text) {\r\n        let keywords = filter.keywords\r\n        let content = msg.value.content.text.toLowerCase()\r\n\r\n        let res = keywords.map(k => content.includes(k.toLowerCase())).some(r => r)\r\n        if (res) console.log(\"filtered due to keywords\")\r\n        filterResults.push(res)\r\n    }\r\n\r\n    console.log(\"res\", !filterResults.some(n => n == true))\r\n    return !filterResults.some(n => n == true)\r\n}","/**\r\n * SSB\r\n *\r\n * TL;DR: SSB API for Patchfox using Hermiebox.\r\n *\r\n * OBJECTIVE:\r\n * The SSB is in flux right now. There are many approaches being played with which might\r\n * affect how this WebExtension connect to sbot. Some of the experiments being tried out are:\r\n *\r\n * - lessbot/nobot: each app maintain its own database and index but post through a shared sbot.\r\n * - graphql: export a GraphQL server which offers SSB features.\r\n * - json-rpc: export a JSON-RPC server offering SSB features.\r\n *\r\n * This driver folder will contain the various adapters to use these modes of connection as they\r\n * become available. For now, we'll use hermiebox.\r\n *\r\n * **Important: Each driver should export the exact same API to Patchfox**. This way we can\r\n * switch drivers without having to refactor the add-on.\r\n *\r\n * HOW IT WORKS:\r\n * Hermiebox is a browserified fat package of common NodeJS modules from our community and also\r\n * few highlevel API methods for common tasks. It uses WebSockets to connect to a running sbot\r\n * using muxrpc and shs stuff, so it needs your `secret` to be available.\r\n * \r\n * ATTENTION:\r\n * This is a legacy from when Patchfox was vanilla JS. I'm gonna need to refactor this a lot\r\n * \r\n * TODO: Refactor to use `ssb-query`\r\n */\r\n\r\nimport { getPref } from \"./utils.js\"\r\nimport { isMessageHidden } from \"./abusePrevention.js\"\r\n\r\nconst pull = hermiebox.modules.pullStream\r\nconst sort = hermiebox.modules.ssbSort\r\n\r\nlet sbot = false\r\n\r\nlet avatarCache = {}\r\n\r\nexport class SSB {\r\n\r\n  log(pMsg, pVal = \"\") {\r\n    console.log(`[SSB API] - ${pMsg}`, pVal)\r\n  }\r\n\r\n  async connect(pKeys) {\r\n    var server = await hermiebox.api.connect(pKeys)\r\n    this.log(\"you are\", server.id)\r\n    this.feed = server.id\r\n    sbot = server\r\n  }\r\n\r\n  filterLimit() {\r\n    let limit = getPref(\"limit\", 10)\r\n    return pull.take(limit)\r\n  }\r\n\r\n  filterWithUserFilters() {\r\n    return pull.filter(m => isMessageHidden(m))\r\n  }\r\n\r\n  filterTypes() {\r\n    let knownMessageTypes = {\r\n      \"post\": \"showTypePost\",\r\n      \"about\": \"showTypeAbout\",\r\n      \"vote\": \"showTypeVote\",\r\n      \"contact\": \"showTypeContact\",\r\n      \"pub\": \"showTypePub\",\r\n      \"blog\": \"showTypeBlog\",\r\n      \"channel\": \"showTypeChannel\"\r\n    }\r\n\r\n    let showUnknown = getPref(\"showTypeUnknown\", false)\r\n\r\n    if (showUnknown) {\r\n      return pull.filter(() => true);\r\n    }\r\n\r\n    return pull.filter(msg => {\r\n      let type = msg.value.content.type\r\n\r\n      if (typeof type == \"string\" && knownMessageTypes[type]) {\r\n        return getPref(knownMessageTypes[type], true)\r\n      }\r\n      return getPref(\"showTypeUnknown\", false)\r\n    })\r\n  }\r\n\r\n  \r\n\r\n  public(opts) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      opts = opts || {}\r\n      opts.reverse = opts.reverse || true\r\n\r\n      console.log(\"opts\", opts)\r\n\r\n      pull(\r\n        sbot.createFeedStream(opts),\r\n        pull.filter(msg => msg && msg.value && msg.value.content),\r\n        this.filterTypes(),\r\n        this.filterWithUserFilters(),\r\n        this.filterLimit(),\r\n        pull.collect((err, msgs) => {\r\n          console.log(\"msgs\", msgs)\r\n          if (err) {\r\n            reject(err)\r\n          }\r\n\r\n          resolve(msgs)\r\n        })\r\n      )\r\n    })\r\n  }\r\n\r\n  thread(id) {\r\n    return new Promise((resolve, reject) => {\r\n      sbot.get(id, (err, value) => {\r\n        if (err) return cb(err)\r\n        var rootMsg = { key: id, value: value }\r\n        pull(\r\n          sbot.backlinks && sbot.backlinks.read ? sbot.backlinks.read({\r\n            query: [\r\n              {\r\n                $filter: {\r\n                  dest: id,\r\n                  value: {\r\n                    content: {\r\n\r\n                      root: id\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            ]\r\n          }) : pull(\r\n            sbot.links({ dest: id, values: true, rel: 'root' }),\r\n            pull.filter(function (msg) {\r\n              var c = msg && msg.value && msg.value.content\r\n              return c && c.type === 'post' && c.root === id\r\n            }),\r\n            pull.unique('key')\r\n          ),\r\n          this.filterTypes(),\r\n          this.filterWithUserFilters(),\r\n          this.filterLimit(),\r\n          pull.collect((err, msgs) => {\r\n            if (err) reject(err)\r\n            resolve(sort([rootMsg].concat(msgs)))\r\n          })\r\n        )\r\n      })\r\n    })\r\n  }\r\n\r\n  mentions(feed, lt) {\r\n    return new Promise((resolve, reject) => {\r\n      const createBacklinkStream = id => {\r\n        var filterQuery = {\r\n          $filter: {\r\n            dest: id\r\n          }\r\n        };\r\n    \r\n        if (lt) {\r\n          filterQuery.$filter.value = { timestamp: { $lt: lt } };\r\n        }\r\n    \r\n        return sbot.backlinks.read({\r\n          query: [filterQuery],\r\n          index: \"DTA\", // use asserted timestamps\r\n          reverse: true,\r\n        });\r\n      };\r\n    \r\n      const uniqueRoots = msg => {\r\n        return pull.filter(msg => {\r\n          let msgKey = msg.key;\r\n          if (msg.value.content.type !== \"post\") {\r\n            return true;\r\n          }\r\n          let rootKey = msg.value.content.root || false;\r\n          if (rootKey) {\r\n            if (msgs.some(m => m.value.content.root === rootKey)) {\r\n              return false;\r\n            }\r\n          }\r\n          return true;\r\n        });\r\n      };\r\n    \r\n      const mentionUser = msg => {\r\n        return pull.filter(msg => {\r\n          if (msg.value.content.type !== \"post\") {\r\n            return true;\r\n          }\r\n          let mentions = msg.value.content.mentions || [];\r\n          if (mentions.some(m => m.link == sbot.id)) {\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n      };\r\n\r\n      pull(\r\n        createBacklinkStream(sbot.id),\r\n        this.filterTypes(),\r\n        this.filterWithUserFilters(),\r\n        this.filterLimit(),\r\n        pull.collect((err, msgs) => {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msgs)\r\n          }\r\n        })\r\n      );\r\n    })\r\n  }\r\n\r\n  async profile(feedid) {\r\n    try {\r\n      var user = await hermiebox.api.profile(feedid)\r\n      return user\r\n\r\n    } catch (n) {\r\n      console.error(n)\r\n      return false\r\n    }\r\n  }\r\n\r\n  async get(msgid) {\r\n    var msg = await hermiebox.api.get(msgid)\r\n    return msg\r\n  }\r\n\r\n  async setAvatarCache(feed, data) {\r\n    let s = {}\r\n    s[`avatar-${feed}`] = data\r\n    return browser.storage.local.set(s)\r\n  }\r\n\r\n  async getCachedAvatar(feed) {\r\n    return browser.storage.local.get(`avatar-${feed}`)\r\n  }\r\n\r\n  async avatar(feed) {\r\n    if (avatarCache[feed]) {\r\n      return avatarCache[feed]\r\n    }\r\n    try {\r\n      let avatar = await hermiebox.api.avatar(feed)\r\n      // await this.setAvatarCache(feed, avatar)\r\n      avatarCache[feed] = avatar\r\n      return avatar\r\n    } catch (n) {\r\n      throw n\r\n    }\r\n\r\n  }\r\n\r\n  async blurbFromMsg(msgid, howManyChars) {\r\n    let retVal = msgid\r\n\r\n    try {\r\n      let data = await ssb.get(msgid)\r\n\r\n      if (data.content.type == \"post\") {\r\n        retVal = this.plainTextFromMarkdown(data.content.text.slice(0, howManyChars) + \"...\")\r\n      }\r\n      return retVal\r\n    } catch (n) {\r\n      return retVal\r\n    }\r\n  }\r\n  plainTextFromMarkdown(text) {\r\n    // TODO: this doesn't belong here\r\n    let html = this.markdown(text)\r\n    let div = document.createElement(\"div\")\r\n    div.innerHTML = html\r\n    return div.innerText\r\n  }\r\n\r\n  markdown(text) {\r\n\r\n    function replaceMsgID(match, id, offset, string) {\r\n      let eid = encodeURIComponent(`%${id}`);\r\n\r\n      return `<a class=\"thread-link\" href=\"?thread=${eid}#/thread`;\r\n    }\r\n\r\n    function replaceChannel(match, id, offset, string) {\r\n      let eid = encodeURIComponent(id);\r\n\r\n      return `<a class=\"channel-link\" href=\"?channel=${eid}#/channel`;\r\n    }\r\n\r\n\r\n    function replaceFeedID(match, id, offset, string) {\r\n      let eid = encodeURIComponent(`@${id}`);\r\n      return \"<a class=\\\"profile-link\\\" href=\\\"?feed=\" + eid + \"#/profile\";\r\n    }\r\n\r\n\r\n    function replaceImageLinks(match, id, offset, string) {\r\n      return \"<a class=\\\"image-link\\\" target=\\\"_blank\\\" href=\\\"http://localhost:8989/blobs/get/&\" + encodeURIComponent(id);\r\n    }\r\n\r\n\r\n    function replaceImages(match, id, offset, string) {\r\n      return \"<img class=\\\"is-image-from-blob\\\" src=\\\"http://localhost:8989/blobs/get/&\" + encodeURIComponent(id);\r\n    }\r\n\r\n    let html = hermiebox.modules.ssbMarkdown.block(text)\r\n    html = html\r\n      .replace(/<pre>/gi, \"<pre class=\\\"code\\\">\")\r\n      .replace(/<a href=\"#([^\"]*)/gi, replaceChannel)\r\n      .replace(/<a href=\"@([^\"]*)/gi, replaceFeedID)\r\n      .replace(/target=\"_blank\"/gi, \"\")\r\n      .replace(/<a href=\"%([^\"]*)/gi, replaceMsgID)\r\n      .replace(/<img src=\"&([^\"]*)/gi, replaceImages)\r\n      .replace(/<a href=\"&([^\"]*)/gi, replaceImageLinks)\r\n\r\n    return html\r\n  }\r\n\r\n  ref() {\r\n    return hermiebox.modules.ssbRef\r\n  }\r\n\r\n  getTimestamp(msg) {\r\n    const arrivalTimestamp = msg.timestamp;\r\n    const declaredTimestamp = msg.value.timestamp;\r\n    return Math.min(arrivalTimestamp, declaredTimestamp);\r\n  }\r\n\r\n  getRootMsgId(msg) {\r\n    if (msg && msg.value && msg.value.content) {\r\n      const root = msg.value.content.root;\r\n      if (hermiebox.modules.ssbRef.isMsgId(root)) {\r\n        return root;\r\n      }\r\n    }\r\n  }\r\n\r\n  newPost(data) {\r\n    return new Promise((resolve, reject) => {\r\n      let msgToPost = { type: \"post\", text: data.text }\r\n\r\n      const commonFields = [\r\n        \"root\",\r\n        \"branch\",\r\n        \"channel\",\r\n        \"fork\",\r\n        \"contentWarning\"\r\n      ]\r\n\r\n      commonFields.forEach(f => {\r\n        if (typeof data[f] !== \"undefined\") {\r\n          msgToPost[f] = data[f]\r\n        }\r\n      })\r\n\r\n      msgToPost.mentions = hermiebox.modules.ssbMentions(msgToPost.text) || []\r\n      msgToPost.mentions = msgToPost.mentions.filter(n => n) // prevent null elements...\r\n\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      console.log(\"post\", msgToPost)\r\n\r\n      if (sbot) {\r\n        sbot.publish(msgToPost, function (err, msg) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      } else {\r\n        reject(\"There is no sbot connection\")\r\n      }\r\n    })\r\n  }\r\n\r\n  follow(userId) {\r\n    return new Promise((resolve, reject) => {\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      if (sbot) {\r\n        sbot.publish({\r\n          type: \"contact\",\r\n          contact: userId,\r\n          following: true\r\n        }, (err, msg) => {\r\n          // 'msg' includes the hash-id and headers\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n  getBlob(blobid) {\r\n    return hermiebox.api.getBlob(blobid)\r\n  }\r\n\r\n  votes(msgid) {\r\n    return new Promise((resolve, reject) => {\r\n      let pull = hermiebox.modules.pullStream\r\n      let sbot = hermiebox.sbot\r\n\r\n      if (sbot) {\r\n        pull(\r\n          sbot.links({ dest: msgid, rel: \"vote\", values: true }),\r\n          pull.collect((err, msgs) => {\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              resolve(msgs)\r\n            }\r\n          })\r\n        )\r\n      }\r\n    })\r\n  }\r\n\r\n  like(msgid) {\r\n    return new Promise((resolve, reject) => {\r\n\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      const msgToPost = {\r\n        \"type\": \"vote\",\r\n        \"vote\": {\r\n          \"link\": msgid,\r\n          \"value\": 1,\r\n          \"expression\": \"Like\"\r\n        }\r\n      }\r\n\r\n      if (sbot) {\r\n        sbot.publish(msgToPost, function (err, msg) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  unlike(msgid) {\r\n    return new Promise((resolve, reject) => {\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      const msgToPost = {\r\n        \"type\": \"vote\",\r\n        \"vote\": {\r\n          \"link\": msgid,\r\n          \"value\": 0,\r\n          \"expression\": \"Unlike\"\r\n        }\r\n      }\r\n\r\n      if (sbot) {\r\n        sbot.publish(msgToPost, function (err, msg) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  channels() {\r\n    return new Promise((resolve, reject) => {\r\n      let pull = hermiebox.modules.pullStream\r\n      let sbot = hermiebox.sbot || false\r\n\r\n      if (sbot) {\r\n        console.log(\"querying channels\")\r\n        pull(\r\n          sbot.query.read({\r\n            query: [\r\n              { \"$filter\": { \"value\": { \"content\": { \"channel\": { \"$is\": \"string\" }, \"type\": \"post\" } } } },\r\n              {\r\n                \"$reduce\": {\r\n                  \"channel\": [\"value\", \"content\", \"channel\"],\r\n                  \"count\": { \"$count\": true },\r\n                  \"timestamp\": { \"$max\": [\"value\", \"timestamp\"] }\r\n                }\r\n              },\r\n              { \"$sort\": [[\"timestamp\"], [\"count\"]] }\r\n            ],\r\n            limit: 20\r\n          }),\r\n          pull.collect(function (err, data) {\r\n            console.log(\"channels\", data)\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              resolve(data)\r\n            }\r\n          })\r\n        )\r\n      } else {\r\n        reject(\"no sbot\")\r\n      }\r\n    })\r\n  }\r\n\r\n  channel(channel, opts) {\r\n    return new Promise((resolve, reject) => {\r\n      let pull = hermiebox.modules.pullStream\r\n      let sbot = hermiebox.sbot || false\r\n      let query = {\r\n        \"$filter\": {\r\n          value: {\r\n            content: { channel }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (opts.lt) {\r\n        query.$filter.value.timestamp = { $lt: opts.lt }\r\n      }\r\n\r\n      if (sbot) {\r\n        pull(\r\n          sbot.query.read({\r\n            query: [\r\n              query\r\n            ],\r\n            reverse: true\r\n          }),\r\n          this.filterTypes(),\r\n          this.filterWithUserFilters(),\r\n          this.filterLimit(),\r\n          pull.collect(function (err, data) {\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              resolve(data)\r\n            }\r\n          })\r\n        )\r\n      } else {\r\n        reject(\"no sbot\")\r\n      }\r\n    })\r\n  }\r\n\r\n  channelSubscribe(channel) {\r\n    return new Promise((resolve, reject) => {\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      const msgToPost = {\r\n        \"type\": \"channel\",\r\n        \"channel\": channel,\r\n        \"subscribed\": true\r\n      }\r\n\r\n      if (sbot) {\r\n        sbot.publish(msgToPost, function (err, msg) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  channelUnsubscribe(channel) {\r\n    return new Promise((resolve, reject) => {\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      const msgToPost = {\r\n        \"type\": \"channel\",\r\n        \"channel\": channel,\r\n        \"subscribed\": false\r\n      }\r\n\r\n      if (sbot) {\r\n        sbot.publish(msgToPost, function (err, msg) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  channelSubscribed(channel, feed) {\r\n    return new Promise((resolve, reject) => {\r\n      let pull = hermiebox.modules.pullStream\r\n      let sbot = hermiebox.sbot || false\r\n\r\n      if (sbot) {\r\n        if (!feed) {\r\n          feed = sbot.id\r\n        }\r\n\r\n        let query = {\r\n          \"$filter\": {\r\n            value: {\r\n              author: feed,\r\n              content: {\r\n                type: \"channel\",\r\n                channel\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n\r\n        pull(\r\n          sbot.query.read({\r\n            query: [\r\n              query\r\n            ],\r\n            reverse: true\r\n          }),\r\n          pull.collect(function (err, data) {\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              if (data.length > 0) {\r\n                resolve(data[0].value.content.subscribed || false)\r\n              } else {\r\n                resolve(false)\r\n              }\r\n            }\r\n          })\r\n        )\r\n      } else {\r\n        reject(\"no sbot\")\r\n      }\r\n    })\r\n  }\r\n\r\n  subscribedChannels(channel, feed) {\r\n    return new Promise((resolve, reject) => {\r\n      let pull = hermiebox.modules.pullStream\r\n      let sbot = hermiebox.sbot || false\r\n\r\n      if (sbot) {\r\n        if (!feed) {\r\n          feed = sbot.id\r\n        }\r\n\r\n        let query = {\r\n          \"$filter\": {\r\n            value: {\r\n              author: feed,\r\n              content: {\r\n                type: \"channel\"\r\n              }\r\n            }\r\n          },\r\n          \"$map\": {\r\n            channel: [\"value\", \"content\", \"channel\"],\r\n            subscribed: [\"value\", \"content\", \"subscribed\"]\r\n          },\r\n          \"$sort\": [[\"value\", \"timestamp\"]]\r\n        }\r\n\r\n\r\n        pull(\r\n          sbot.query.read({\r\n            query: [\r\n              query\r\n            ],\r\n            reverse: true\r\n          }),\r\n          pull.collect(function (err, data) {\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              resolve(data)\r\n            }\r\n          })\r\n        )\r\n      } else {\r\n        reject(\"no sbot\")\r\n      }\r\n    })\r\n  }\r\n\r\n  follow(feed) {\r\n    return new Promise((resolve, reject) => {\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      const msgToPost = {\r\n        \"type\": \"contact\",\r\n        \"contact\": feed,\r\n        \"following\": true\r\n      }\r\n\r\n      if (sbot) {\r\n        sbot.publish(msgToPost, function (err, msg) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  unfollow(feed) {\r\n    return new Promise((resolve, reject) => {\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      const msgToPost = {\r\n        \"type\": \"contact\",\r\n        \"contact\": feed,\r\n        \"following\": false\r\n      }\r\n\r\n      if (sbot) {\r\n        sbot.publish(msgToPost, function (err, msg) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  block(feed) {\r\n    return new Promise((resolve, reject) => {\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      const msgToPost = {\r\n        \"type\": \"contact\",\r\n        \"contact\": feed,\r\n        \"blocking\": true\r\n      }\r\n\r\n      if (sbot) {\r\n        sbot.publish(msgToPost, function (err, msg) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  unblock(feed) {\r\n    return new Promise((resolve, reject) => {\r\n      const sbot = hermiebox.sbot || false\r\n\r\n      const msgToPost = {\r\n        \"type\": \"contact\",\r\n        \"contact\": feed,\r\n        \"blocking\": false\r\n      }\r\n\r\n      if (sbot) {\r\n        sbot.publish(msgToPost, function (err, msg) {\r\n          if (err) {\r\n            reject(err)\r\n          } else {\r\n            resolve(msg)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  following(feed, byWhom) {\r\n    return new Promise((resolve, reject) => {\r\n      let pull = hermiebox.modules.pullStream\r\n      let sbot = hermiebox.sbot || false\r\n\r\n      if (sbot) {\r\n        if (!byWhom) {\r\n          byWhom = sbot.id\r\n        }\r\n\r\n        let query = {\r\n          \"$filter\": {\r\n            value: {\r\n              author: byWhom,\r\n              content: {\r\n                type: \"contact\",\r\n                contact: feed,\r\n                following: { $is: \"boolean\" }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n\r\n        pull(\r\n          sbot.query.read({\r\n            query: [\r\n              query\r\n            ],\r\n            reverse: true\r\n          }),\r\n          pull.collect(function (err, data) {\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              if (data.length > 0) {\r\n                resolve(data[0].value.content.following || false)\r\n              } else {\r\n                resolve(false)\r\n              }\r\n            }\r\n          })\r\n        )\r\n      } else {\r\n        reject(\"no sbot\")\r\n      }\r\n    })\r\n  }\r\n\r\n  blocking(feed, byWhom) {\r\n    return new Promise((resolve, reject) => {\r\n      let pull = hermiebox.modules.pullStream\r\n      let sbot = hermiebox.sbot || false\r\n\r\n      if (sbot) {\r\n        if (!byWhom) {\r\n          byWhom = sbot.id\r\n        }\r\n\r\n        let query = {\r\n          \"$filter\": {\r\n            value: {\r\n              author: byWhom,\r\n              content: {\r\n                type: \"contact\",\r\n                contact: feed,\r\n                blocking: { $is: \"boolean\" }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n\r\n        pull(\r\n          sbot.query.read({\r\n            query: [\r\n              query\r\n            ],\r\n            reverse: true\r\n          }),\r\n          pull.collect(function (err, data) {\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              if (data.length > 0) {\r\n                resolve(data[0].value.content.blocking || false)\r\n              } else {\r\n                resolve(false)\r\n              }\r\n            }\r\n          })\r\n        )\r\n      } else {\r\n        reject(\"no sbot\")\r\n      }\r\n    })\r\n  }\r\n\r\n  query(filter, reverse, map, reduce) {\r\n    return new Promise((resolve, reject) => {\r\n      if (sbot) {\r\n\r\n        let query = {\r\n          \"$filter\": filter\r\n        }\r\n\r\n        if (map) {\r\n          query.$map = map\r\n        }\r\n\r\n        if (reduce) {\r\n          query.$reduce = reduce\r\n        }\r\n\r\n        if (typeof reverse == \"undefined\") {\r\n          reverse = true\r\n        }\r\n\r\n        pull(\r\n          sbot.query.read({\r\n            query: [\r\n              query\r\n            ],\r\n            reverse: reverse\r\n          }),\r\n          this.filterTypes(),\r\n          this.filterLimit(),\r\n          pull.collect( (err, data) => {\r\n            if (err) {\r\n              reject(err)\r\n            } else {\r\n              resolve(data)\r\n            }\r\n          })\r\n        )\r\n      } else {\r\n        reject(\"no sbot\")\r\n      }\r\n    })\r\n  }\r\n}\r\n","'use strict';\nmodule.exports = str => encodeURIComponent(str).replace(/[!'()*]/g, x => `%${x.charCodeAt(0).toString(16).toUpperCase()}`);\n","'use strict';\nvar token = '%[a-f0-9]{2}';\nvar singleMatcher = new RegExp(token, 'gi');\nvar multiMatcher = new RegExp('(' + token + ')+', 'gi');\n\nfunction decodeComponents(components, split) {\n\ttry {\n\t\t// Try to decode the entire string first\n\t\treturn decodeURIComponent(components.join(''));\n\t} catch (err) {\n\t\t// Do nothing\n\t}\n\n\tif (components.length === 1) {\n\t\treturn components;\n\t}\n\n\tsplit = split || 1;\n\n\t// Split the array in 2 parts\n\tvar left = components.slice(0, split);\n\tvar right = components.slice(split);\n\n\treturn Array.prototype.concat.call([], decodeComponents(left), decodeComponents(right));\n}\n\nfunction decode(input) {\n\ttry {\n\t\treturn decodeURIComponent(input);\n\t} catch (err) {\n\t\tvar tokens = input.match(singleMatcher);\n\n\t\tfor (var i = 1; i < tokens.length; i++) {\n\t\t\tinput = decodeComponents(tokens, i).join('');\n\n\t\t\ttokens = input.match(singleMatcher);\n\t\t}\n\n\t\treturn input;\n\t}\n}\n\nfunction customDecodeURIComponent(input) {\n\t// Keep track of all the replacements and prefill the map with the `BOM`\n\tvar replaceMap = {\n\t\t'%FE%FF': '\\uFFFD\\uFFFD',\n\t\t'%FF%FE': '\\uFFFD\\uFFFD'\n\t};\n\n\tvar match = multiMatcher.exec(input);\n\twhile (match) {\n\t\ttry {\n\t\t\t// Decode as big chunks as possible\n\t\t\treplaceMap[match[0]] = decodeURIComponent(match[0]);\n\t\t} catch (err) {\n\t\t\tvar result = decode(match[0]);\n\n\t\t\tif (result !== match[0]) {\n\t\t\t\treplaceMap[match[0]] = result;\n\t\t\t}\n\t\t}\n\n\t\tmatch = multiMatcher.exec(input);\n\t}\n\n\t// Add `%C2` at the end of the map to make sure it does not replace the combinator before everything else\n\treplaceMap['%C2'] = '\\uFFFD';\n\n\tvar entries = Object.keys(replaceMap);\n\n\tfor (var i = 0; i < entries.length; i++) {\n\t\t// Replace all decoded components\n\t\tvar key = entries[i];\n\t\tinput = input.replace(new RegExp(key, 'g'), replaceMap[key]);\n\t}\n\n\treturn input;\n}\n\nmodule.exports = function (encodedURI) {\n\tif (typeof encodedURI !== 'string') {\n\t\tthrow new TypeError('Expected `encodedURI` to be of type `string`, got `' + typeof encodedURI + '`');\n\t}\n\n\ttry {\n\t\tencodedURI = encodedURI.replace(/\\+/g, ' ');\n\n\t\t// Try the built in decoder first\n\t\treturn decodeURIComponent(encodedURI);\n\t} catch (err) {\n\t\t// Fallback to a more advanced decoder\n\t\treturn customDecodeURIComponent(encodedURI);\n\t}\n};\n","'use strict';\n\nmodule.exports = (string, separator) => {\n\tif (!(typeof string === 'string' && typeof separator === 'string')) {\n\t\tthrow new TypeError('Expected the arguments to be of type `string`');\n\t}\n\n\tif (separator === '') {\n\t\treturn [string];\n\t}\n\n\tconst separatorIndex = string.indexOf(separator);\n\n\tif (separatorIndex === -1) {\n\t\treturn [string];\n\t}\n\n\treturn [\n\t\tstring.slice(0, separatorIndex),\n\t\tstring.slice(separatorIndex + separator.length)\n\t];\n};\n","'use strict';\nconst strictUriEncode = require('strict-uri-encode');\nconst decodeComponent = require('decode-uri-component');\nconst splitOnFirst = require('split-on-first');\n\nfunction encoderForArrayFormat(options) {\n\tswitch (options.arrayFormat) {\n\t\tcase 'index':\n\t\t\treturn key => (result, value) => {\n\t\t\t\tconst index = result.length;\n\t\t\t\tif (value === undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\n\t\t\t\tif (value === null) {\n\t\t\t\t\treturn [...result, [encode(key, options), '[', index, ']'].join('')];\n\t\t\t\t}\n\n\t\t\t\treturn [\n\t\t\t\t\t...result,\n\t\t\t\t\t[encode(key, options), '[', encode(index, options), ']=', encode(value, options)].join('')\n\t\t\t\t];\n\t\t\t};\n\n\t\tcase 'bracket':\n\t\t\treturn key => (result, value) => {\n\t\t\t\tif (value === undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\n\t\t\t\tif (value === null) {\n\t\t\t\t\treturn [...result, [encode(key, options), '[]'].join('')];\n\t\t\t\t}\n\n\t\t\t\treturn [...result, [encode(key, options), '[]=', encode(value, options)].join('')];\n\t\t\t};\n\n\t\tcase 'comma':\n\t\t\treturn key => (result, value, index) => {\n\t\t\t\tif (value === null || value === undefined || value.length === 0) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\n\t\t\t\tif (index === 0) {\n\t\t\t\t\treturn [[encode(key, options), '=', encode(value, options)].join('')];\n\t\t\t\t}\n\n\t\t\t\treturn [[result, encode(value, options)].join(',')];\n\t\t\t};\n\n\t\tdefault:\n\t\t\treturn key => (result, value) => {\n\t\t\t\tif (value === undefined) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\n\t\t\t\tif (value === null) {\n\t\t\t\t\treturn [...result, encode(key, options)];\n\t\t\t\t}\n\n\t\t\t\treturn [...result, [encode(key, options), '=', encode(value, options)].join('')];\n\t\t\t};\n\t}\n}\n\nfunction parserForArrayFormat(options) {\n\tlet result;\n\n\tswitch (options.arrayFormat) {\n\t\tcase 'index':\n\t\t\treturn (key, value, accumulator) => {\n\t\t\t\tresult = /\\[(\\d*)\\]$/.exec(key);\n\n\t\t\t\tkey = key.replace(/\\[\\d*\\]$/, '');\n\n\t\t\t\tif (!result) {\n\t\t\t\t\taccumulator[key] = value;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (accumulator[key] === undefined) {\n\t\t\t\t\taccumulator[key] = {};\n\t\t\t\t}\n\n\t\t\t\taccumulator[key][result[1]] = value;\n\t\t\t};\n\n\t\tcase 'bracket':\n\t\t\treturn (key, value, accumulator) => {\n\t\t\t\tresult = /(\\[\\])$/.exec(key);\n\t\t\t\tkey = key.replace(/\\[\\]$/, '');\n\n\t\t\t\tif (!result) {\n\t\t\t\t\taccumulator[key] = value;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (accumulator[key] === undefined) {\n\t\t\t\t\taccumulator[key] = [value];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\taccumulator[key] = [].concat(accumulator[key], value);\n\t\t\t};\n\n\t\tcase 'comma':\n\t\t\treturn (key, value, accumulator) => {\n\t\t\t\tconst isArray = typeof value === 'string' && value.split('').indexOf(',') > -1;\n\t\t\t\tconst newValue = isArray ? value.split(',') : value;\n\t\t\t\taccumulator[key] = newValue;\n\t\t\t};\n\n\t\tdefault:\n\t\t\treturn (key, value, accumulator) => {\n\t\t\t\tif (accumulator[key] === undefined) {\n\t\t\t\t\taccumulator[key] = value;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\taccumulator[key] = [].concat(accumulator[key], value);\n\t\t\t};\n\t}\n}\n\nfunction encode(value, options) {\n\tif (options.encode) {\n\t\treturn options.strict ? strictUriEncode(value) : encodeURIComponent(value);\n\t}\n\n\treturn value;\n}\n\nfunction decode(value, options) {\n\tif (options.decode) {\n\t\treturn decodeComponent(value);\n\t}\n\n\treturn value;\n}\n\nfunction keysSorter(input) {\n\tif (Array.isArray(input)) {\n\t\treturn input.sort();\n\t}\n\n\tif (typeof input === 'object') {\n\t\treturn keysSorter(Object.keys(input))\n\t\t\t.sort((a, b) => Number(a) - Number(b))\n\t\t\t.map(key => input[key]);\n\t}\n\n\treturn input;\n}\n\nfunction removeHash(input) {\n\tconst hashStart = input.indexOf('#');\n\tif (hashStart !== -1) {\n\t\tinput = input.slice(0, hashStart);\n\t}\n\n\treturn input;\n}\n\nfunction extract(input) {\n\tinput = removeHash(input);\n\tconst queryStart = input.indexOf('?');\n\tif (queryStart === -1) {\n\t\treturn '';\n\t}\n\n\treturn input.slice(queryStart + 1);\n}\n\nfunction parse(input, options) {\n\toptions = Object.assign({\n\t\tdecode: true,\n\t\tarrayFormat: 'none'\n\t}, options);\n\n\tconst formatter = parserForArrayFormat(options);\n\n\t// Create an object with no prototype\n\tconst ret = Object.create(null);\n\n\tif (typeof input !== 'string') {\n\t\treturn ret;\n\t}\n\n\tinput = input.trim().replace(/^[?#&]/, '');\n\n\tif (!input) {\n\t\treturn ret;\n\t}\n\n\tfor (const param of input.split('&')) {\n\t\tlet [key, value] = splitOnFirst(param.replace(/\\+/g, ' '), '=');\n\n\t\t// Missing `=` should be `null`:\n\t\t// http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters\n\t\tvalue = value === undefined ? null : decode(value, options);\n\n\t\tformatter(decode(key, options), value, ret);\n\t}\n\n\treturn Object.keys(ret).sort().reduce((result, key) => {\n\t\tconst value = ret[key];\n\t\tif (Boolean(value) && typeof value === 'object' && !Array.isArray(value)) {\n\t\t\t// Sort object keys, not values\n\t\t\tresult[key] = keysSorter(value);\n\t\t} else {\n\t\t\tresult[key] = value;\n\t\t}\n\n\t\treturn result;\n\t}, Object.create(null));\n}\n\nexports.extract = extract;\nexports.parse = parse;\n\nexports.stringify = (object, options) => {\n\tif (!object) {\n\t\treturn '';\n\t}\n\n\toptions = Object.assign({\n\t\tencode: true,\n\t\tstrict: true,\n\t\tarrayFormat: 'none'\n\t}, options);\n\n\tconst formatter = encoderForArrayFormat(options);\n\tconst keys = Object.keys(object);\n\n\tif (options.sort !== false) {\n\t\tkeys.sort(options.sort);\n\t}\n\n\treturn keys.map(key => {\n\t\tconst value = object[key];\n\n\t\tif (value === undefined) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (value === null) {\n\t\t\treturn encode(key, options);\n\t\t}\n\n\t\tif (Array.isArray(value)) {\n\t\t\treturn value\n\t\t\t\t.reduce(formatter(key), [])\n\t\t\t\t.join('&');\n\t\t}\n\n\t\treturn encode(key, options) + '=' + encode(value, options);\n\t}).filter(x => x.length > 0).join('&');\n};\n\nexports.parseUrl = (input, options) => {\n\treturn {\n\t\turl: removeHash(input).split('?')[0] || '',\n\t\tquery: parse(extract(input), options)\n\t};\n};\n","<script>\r\n  import { navigate } from \"../utils.js\";\r\n\r\n  export let msg;\r\n\r\n  let content = ssb.markdown(msg.value.content.text);\r\n  let liked = false;\r\n  let hasContentWarning = msg.value.content.contentWarning || false;\r\n  let showContentWarning = true;\r\n\r\n  ssb.votes(msg.key).then(ms => {\r\n    ms.forEach(m => {\r\n      let author = m.value.author;\r\n      if (author === ssb.feed && m.value.content.vote.value === 1) {\r\n        liked = true;\r\n      }\r\n    });\r\n  });\r\n\r\n  const likeChanged = ev => {\r\n    let v = ev.target.checked;\r\n    if (v) {\r\n      ssb\r\n        .like(msg.key)\r\n        .then(() => console.log(\"liked\", msg.key))\r\n        .catch(() => (liked = false));\r\n    } else {\r\n      ssb\r\n        .unlike(msg.key)\r\n        .then(() => console.log(\"unliked\", msg.key))\r\n        .catch(() => (liked = true));\r\n    }\r\n  };\r\n\r\n  const reply = ev => {\r\n    let root = msg.value.content.root || msg.key;\r\n    let channel = msg.value.content.channel;\r\n    let replyfeed = msg.value.author;\r\n    navigate(\"/compose\", { root, branch: msg.key, channel, replyfeed });\r\n  };\r\n\r\n  const fork = ev => {\r\n    let originalRoot = msg.value.content.root || msg.key;\r\n    let channel = msg.value.content.channel;\r\n    let replyfeed = msg.value.author;\r\n    navigate(\"/compose\", {\r\n      root: msg.key,\r\n      branch: msg.key,\r\n      fork: originalRoot,\r\n      channel,\r\n      replyfeed\r\n    });\r\n  };\r\n\r\n  const goRoot = ev => {\r\n    let rootId = msg.value.content.root || msg.key;\r\n    navigate(\"/thread\", { thread: rootId });\r\n  };\r\n\r\n  const goBranch = ev => {\r\n    let branchId = msg.value.content.branch || msg.key;\r\n    navigate(\"/thread\", { thread: branchId });\r\n  };\r\n</script>\r\n\r\n<style>\r\n  div img.is-image-from-blob {\r\n    max-width: 90%;\r\n  }\r\n\r\n  .card-body {\r\n    overflow-wrap: break-word;\r\n  }\r\n</style>\r\n\r\n<div class=\"card-body\">\r\n  {#if hasContentWarning && showContentWarning}\r\n    <p>{msg.value.content.contentWarning}</p>\r\n    <button\r\n      class=\"btn\"\r\n      on:click={() => (showContentWarning = !showContentWarning)}>\r\n      Show Message\r\n    </button>\r\n  {:else}\r\n    {#if hasContentWarning}\r\n      <div class=\"toast toast-warning\">\r\n        <p>\r\n          <b>Content Warning:</b>\r\n          {msg.value.content.contentWarning}\r\n          <button\r\n            class=\"btn btn-sm float-right\"\r\n            on:click={() => (showContentWarning = !showContentWarning)}>\r\n            Hide Message\r\n          </button>\r\n        </p>\r\n      </div>\r\n    {/if}\r\n    {@html content}\r\n  {/if}\r\n</div>\r\n<div class=\"card-footer\">\r\n  <div class=\"columns col-gapless\">\r\n    <div class=\"column col-6\">\r\n      <label class=\"form-switch d-inline\">\r\n        <input type=\"checkbox\" on:change={likeChanged} checked={liked} />\r\n        <i class=\"form-icon\" />\r\n        Like\r\n      </label>\r\n      {#if msg.value.content.root}\r\n        <span>\r\n          <a\r\n            href=\"?thread={encodeURIComponent(msg.value.content.root)}#/thread\"\r\n            on:click|preventDefault={goRoot}>\r\n            (root)\r\n          </a>\r\n        </span>\r\n      {/if}\r\n      {#if msg.value.content.branch}\r\n        <span>\r\n          <a\r\n            href=\"?thread={encodeURIComponent(msg.value.content.branch)}#/thread\"\r\n            on:click|preventDefault={goBranch}>\r\n            (in reply to)\r\n          </a>\r\n        </span>\r\n      {/if}\r\n    </div>\r\n\r\n    {#if !msg.value.private}\r\n      <div class=\"column col-6 text-right\">\r\n        <button class=\"btn\" on:click={fork}>Fork</button>\r\n\r\n        <button class=\"btn\" on:click={reply}>Reply</button>\r\n      </div>\r\n    {/if}\r\n  </div>\r\n\r\n</div>\r\n","<script>\r\n  export let msg;\r\n\r\n  let rawContent = JSON.stringify(msg, null, 2);\r\n</script>\r\n<style>\r\npre.code {\r\n    overflow: scroll;\r\n}\r\n</style>\r\n\r\n<div class=\"card-body\">\r\n  <pre class=\"code\">\r\n    <code> {rawContent} </code>\r\n  </pre>\r\n</div>\r\n","<script>\r\n  import { navigate } from \"../utils.js\";\r\n  export let msg;\r\n\r\n  let expression = msg.value.content.vote.expression;\r\n  let msgid = msg.value.content.vote.link;\r\n  let encodedid = encodeURIComponent(msgid);\r\n  let label = msgid;\r\n  let person = msg.value.author;\r\n\r\n  ssb.blurbFromMsg(msgid, 100).then(blurb => {\r\n    label = blurb;\r\n  });\r\n\r\n  ssb.avatar(msg.value.author).then(data => (person = data.name));\r\n\r\n  const goThread = ev => {\r\n    ev.stopPropagation();\r\n    ev.preventDefault();\r\n    if (ev.ctrlKey) {\r\n      window.open(`?thread=${encodeURIComponent(msgid)}#/thread`);\r\n    } else {\r\n      navigate(\"/thread\", { thread: msgid });\r\n    }\r\n  };\r\n</script>\r\n\r\n<div class=\"card-body\">\r\n   {person} {expression}\r\n  <a href=\"/index.html?thread={encodedid}#/thread\" on:click={goThread}>\r\n     {label}\r\n  </a>\r\n</div>\r\n","<script>\r\n  export let msg;\r\n</script>\r\n\r\n<div class=\"card-body\">\r\n<p>🔒 PRIVATE</p>\r\n</div>\r\n","<script>\r\n  import { navigate } from \"../utils.js\";\r\n\r\n  export let msg;\r\n\r\n  let person = msg.value.author;\r\n  let otherPersonFeed = encodeURIComponent(msg.value.content.contact);\r\n  let otherPersonName = otherPersonFeed;\r\n  let verb = msg.value.content.following ? \"followed\" : \"unfollowed\";\r\n\r\n  if (msg.value.content.blocking) {\r\n    verb = \"blocked\";\r\n  }\r\n\r\n  ssb.avatar(msg.value.author).then(data => (person = data.name));\r\n  ssb\r\n    .avatar(msg.value.content.contact)\r\n    .then(data => {\r\n      otherPersonName = data.name;\r\n    })\r\n    .catch(n => console.log(n));\r\n\r\n  const goProfile = ev => {\r\n    ev.stopPropagation();\r\n    ev.preventDefault();\r\n    navigate(\"/profile\", { feed: msg.value.content.contact });\r\n  };\r\n</script>\r\n\r\n<div class=\"card-body\">\r\n   {person} {verb}\r\n  <a href=\"?feed={otherPersonFeed}#/profile\" on:click={goProfile}>\r\n     {otherPersonName}\r\n  </a>\r\n</div>\r\n","<script>\r\n  import { navigate } from \"../utils.js\";\r\n\r\n  export let msg;\r\n\r\n  let person = msg.value.author;\r\n  let verb = msg.value.content.subscribed ? \"subscribed\" : \"unsubscribed\";\r\n  let channel = encodeURIComponent(msg.value.content.channel);\r\n\r\n  ssb.avatar(msg.value.author).then(data => (person = data.name));\r\n\r\n   const goChannel = ev => {\r\n    ev.stopPropagation();\r\n    ev.preventDefault();\r\n    navigate(\"/channel\", { channel: msg.value.content.channel });\r\n  };\r\n</script>\r\n\r\n<div class=\"card-body\">\r\n   {person} {verb}\r\n  <a href=\"?channel={channel}#/channel\" on:click={goChannel}>#{channel}</a>\r\n</div>\r\n","<script>\r\n  export let msg;\r\n\r\n  let person = msg.value.author;\r\n  let otherLink = encodeURIComponent(msg.value.content.about);\r\n  let otherName = msg.value.content.name || msg.value.content.about;\r\n  let isThisAboutFeeds = true;\r\n  let verb =\r\n    msg.value.content.about === msg.value.author\r\n      ? \"self-identifies\"\r\n      : \"identifies\";\r\n\r\n  ssb.avatar(msg.value.author).then(data => (person = data.name));\r\n\r\n  if (otherName === msg.value.content.about) {\r\n    ssb.avatar(msg.value.content.about).then(data => (otherName = data.name));\r\n  }\r\n\r\n  let image = msg.value.content.image\r\n    ? `http://localhost:8989/blobs/get/${encodeURIComponent(\r\n        msg.value.content.image\r\n      )}`\r\n    : false;\r\n\r\n  if (msg.value.content.description) {\r\n    verb += \" with description\";\r\n  }\r\n\r\n  if (msg.value.content.about.startsWith(\"%\")) {\r\n    isThisAboutFeeds = false; // this appear to be a gathering\r\n  }\r\n</script>\r\n\r\n<div class=\"card-body\">\r\n  {#if isThisAboutFeeds}\r\n    {person} {verb}\r\n    <a href=\"?feed={otherLink}#/profile\">\r\n      {#if image}\r\n        <div class=\"chip\">\r\n          <img src={image} class=\"avatar avatar-sm\" alt={otherName} />\r\n           {otherName}\r\n        </div>\r\n      {:else}\r\n        <span class=\"chip\">{otherName}</span>\r\n      {/if}\r\n    </a>\r\n    {#if msg.value.content.description}\r\n      <blockquote>\r\n        {@html ssb.markdown(msg.value.content.description)}\r\n      </blockquote>\r\n    {/if}\r\n  {:else}\r\n    <div class=\"toast\">\r\n       {person} is doing something related to a gathering but gatherings are not\r\n      supported yet, sorry.\r\n    </div>\r\n  {/if}\r\n</div>\r\n","<script>\r\n  import { navigate } from \"../utils.js\";\r\n\r\n  export let msg;\r\n\r\n  let encodedid = encodeURIComponent(msg.value.content.address.key);\r\n  let person = msg.value.author;\r\n  let host = msg.value.content.address.host\r\n  let port = msg.value.content.address.port\r\n\r\n  ssb.avatar(msg.value.author).then(data => (person = data.name));\r\n\r\n  \r\n  const goProfile = ev => {\r\n    ev.stopPropagation();\r\n    ev.preventDefault();\r\n    navigate(\"/profile\", { feed: msg.value.content.address.key });\r\n  };\r\n</script>\r\n\r\n<div class=\"card-body\">\r\n   {person} announced pub\r\n  <a href=\"/index.html?feed={encodedid}#/profile\" on:click={goProfile}>{host}:{port}</a>\r\n</div>\r\n","<script>\r\n  import { navigate, routeLocation } from \"../utils.js\";\r\n\r\n  export let msg;\r\n\r\n  let content = msg.value.content;\r\n\r\n  let summary = ssb.markdown(content.summary);\r\n  let thumbnail = content.thumbnail || false;\r\n  let title = content.title || false;\r\n  let showBlogpost = false;\r\n  let loading = false;\r\n  let toast = false;\r\n  let toastMsg = \"\";\r\n  let post = summary;\r\n\r\n  let liked = false;\r\n\r\n  ssb.votes(msg.key).then(ms => {\r\n    ms.forEach(m => {\r\n      let author = m.value.author;\r\n      if ((author === ssb.feed && m.value.content.vote.value === 1)) {\r\n        liked = true;\r\n      }\r\n    });\r\n  });\r\n\r\n  const likeChanged = ev => {\r\n    let v = ev.target.checked;\r\n    if (v) {\r\n      ssb\r\n        .like(msg.key)\r\n        .then(() => console.log(\"liked\", msg.key))\r\n        .catch(() => (liked = false));\r\n    } else {\r\n      ssb\r\n        .unlike(msg.key)\r\n        .then(() => console.log(\"unliked\", msg.key))\r\n        .catch(() => (liked = true));\r\n    }\r\n  };\r\n\r\n  const displayBlogPost = ev => {\r\n    loading = true;\r\n    console.log(\"loading blogpost\", content.blog);\r\n\r\n    ssb\r\n      .getBlob(content.blog)\r\n      .then(data => {\r\n        post = ssb.markdown(data);\r\n        showBlogpost = true;\r\n      })\r\n      .catch(err => {\r\n        console.error(\"can't load blog post\", err);\r\n        toast = true;\r\n        toastMsg = err;\r\n      });\r\n  };\r\n\r\n  const reply = ev => {\r\n    let rootId = msg.value.content.root || msg.key;\r\n    let channel = msg.value.content.channel;\r\n    navigate(\"/compose\", { root: rootId, branch: msg.key, channel });\r\n  };\r\n\r\n  const goRoot = ev => {\r\n    let rootId = msg.value.content.root || msg.key;\r\n    navigate(\"/thread\", { thread: rootId });\r\n  };\r\n\r\n  const goBranch = ev => {\r\n    let branchId = msg.value.content.branch || msg.key;\r\n    navigate(\"/thread\", { thread: branchId });\r\n  };\r\n\r\n  if ($routeLocation == \"/thread\") {\r\n    setTimeout(displayBlogPost, 100);\r\n  }\r\n</script>\r\n\r\n<style>\r\n  div img.is-image-from-blob {\r\n    max-width: 90%;\r\n  }\r\n</style>\r\n\r\n{#if thumbnail}\r\n  <div class=\"card-image\">\r\n    <img\r\n      src=\"http://localhost:8989/blobs/get/{encodeURIComponent(thumbnail)}\"\r\n      class=\"img-responsive\"\r\n      alt={title} />\r\n  </div>\r\n{/if}\r\n<div class=\"card-body\">\r\n  {#if title}\r\n    <h1 class=\"card-title h5\">{title}</h1>\r\n  {/if}\r\n\r\n  {#if toast}\r\n    <div class=\"toast toast-error\">Can't load blogpost: {toastMsg}</div>\r\n  {/if}\r\n  {#if showBlogpost}\r\n    {@html post}\r\n  {:else}\r\n    {@html summary}\r\n  {/if}\r\n</div>\r\n<div class=\"card-footer\">\r\n  <div class=\"columns col-gapless\">\r\n    <div class=\"column col-6\">\r\n      <label class=\"form-switch d-inline\">\r\n        <input type=\"checkbox\" on:change={likeChanged} checked={liked} />\r\n        <i class=\"form-icon\" />\r\n        Like\r\n      </label>\r\n      {#if msg.value.content.root}\r\n        <span>\r\n          <a\r\n            href=\"?thread={encodeURIComponent(msg.value.content.root)}#/thread\"\r\n            on:click|preventDefault={goRoot}>\r\n            (root)\r\n          </a>\r\n        </span>\r\n      {/if}\r\n      {#if msg.value.content.branch}\r\n        <span>\r\n          <a\r\n            href=\"?thread={encodeURIComponent(msg.value.content.branch)}#/thread\"\r\n            on:click|preventDefault={goBranch}>\r\n            (in reply to)\r\n          </a>\r\n        </span>\r\n      {/if}\r\n    </div>\r\n    <div class=\"column col-6 text-right\">\r\n      <button class=\"btn\" on:click={reply}>Reply</button>\r\n      {#if !showBlogpost}\r\n        <button\r\n          class=\"btn btn-primary\"\r\n          class:locating={loading}\r\n          on:click={displayBlogPost}>\r\n          Read Blogpost\r\n        </button>\r\n      {:else}\r\n        <button\r\n          class=\"btn btn-primary\"\r\n          class:locating={loading}\r\n          on:click={() => (showBlogpost = false)}>\r\n          Close Blogpost\r\n        </button>\r\n      {/if}\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n","<script>\r\n  import { createEventDispatcher } from \"svelte\";\r\n  export let feed;\r\n\r\n  let image = false;\r\n  let name = feed;\r\n  const dispatch = createEventDispatcher();\r\n\r\n  ssb.avatar(feed).then(data => {\r\n    if (data.image !== null) {\r\n      image = `http://localhost:8989/blobs/get/${data.image}`;\r\n    }\r\n    name = data.name;\r\n  });\r\n\r\n  function avatarClick() {\r\n    dispatch(\"avatarClick\", {\r\n      feed,\r\n      name\r\n    });\r\n  }\r\n</script>\r\n\r\n{#if image}\r\n  <div class=\"chip\" on:click={avatarClick}>\r\n    <img src={image} class=\"avatar avatar-sm\" />\r\n     {name}\r\n  </div>\r\n{:else}\r\n  <span class=\"chip\" on:click={avatarClick}> {name} </span>\r\n{/if}\r\n","var timeago = function(){};\n\ntimeago.prototype.simple = function(date_time) {\n    // today date and time in milliseconds \n    var today = Date.now();\n    var dateParse = Date.parse(date_time);\n    \n    //We will perform some test - if there is error, we will throw error to console and exit, no change will be on the data.\n    try {\n        // We need to check if we able to parse the Date (if the result is NaN, this is an issue)\n        if(dateParse !== dateParse) throw \"timeago-simple: Please check date and time format! Unable to parse the date & time: \" + date_time;\n    }\n    catch(err) {\n        console.error(err);\n        return (date_time);\n    }\n    \n    if((dateParse - today) < 0) {\n\t\treturn pastCalc(date_time);\n\t} else {\n\t\treturn futureCalc(date_time);\n\t}\n};\n\n\n// General help functions for time calculations\nfunction pastCalc(timeData){\n\n    // today date and time in milliseconds \n    var today = Date.now();\n        \n    // parsing post date and time into milliseconds format\n    timeData = Date.parse(timeData);\n\n    var seconds = (today - timeData) / 1000;\n    var minutes = (seconds / 60);\n    var hours = (seconds / 3600);\n    if(seconds < 60 && minutes < 1) {\n        return (seconds === 1 ? Math.round(seconds) + \" second ago\" : Math.round(seconds) + \" seconds ago\");\n    }\n    if(minutes < 60 && hours < 1) {\n        return (minutes === 1 ? Math.round(minutes) + \" minute ago\" : Math.round(minutes) + \" minutes ago\");\n    }\n    if(hours > 24){\n        var days = hours / 24;\n        if (days > 30) {\n            var month = days / 30;\n            if (month > 12) {\n                var years = month / 12;\n                if (years > 0) {\n                    return (years === 1 ? Math.ceil(years) + \" year ago\" : Math.ceil(years) + \" years ago\");\n                }\n            }\n            return (Math.round(month) + \" month ago\");\n        }\n        return (days === 1 ? Math.round(days) + \" day ago\" : Math.round(days) + \" days ago\");\n    } else {\n        return (hours === 1 ? Math.round(hours) + \" hour ago\" : Math.round(hours) + \" hours ago\");\n    }\n        \n}\n\nfunction futureCalc(timeData){\n\n    // today date and time in milliseconds \n    var today = Date.now();\n     \n    // parsing post date and time into milliseconds format\n    timeData = Date.parse(timeData);\n    var seconds = (timeData - today) / 1000;\n    var minutes = (seconds / 60);\n    var hours = (seconds / 3600);\n    if(seconds < 60 && minutes < 1) {\n        return (seconds === 1 ? \"in \" + Math.round(seconds) + \" second\" : \"in \" + Math.round(seconds) + \" seconds\");\n    }\n    if(minutes < 60 && hours < 1) {\n        return (minutes === 1 ? \"in \" + Math.round(minutes) + \" minute\" : \"in \" + Math.round(minutes) + \" minutes\");\n    }\n    if(hours > 24){\n        var days = hours / 24;\n        if (days > 30) {\n            var month = days / 30;\n            if (month > 12) {\n                var years = month / 12;\n                if (years > 0) {\n                    return (years === 1 ? \"in \" + Math.ceil(years) + \" year\" : \"in \" + Math.ceil(years) + \" years\"); \n                }\n            }\n           return (\"in \" + Math.round(month) + \" month\"); \n        }\n        return (days === 1 ? \"in \" + Math.round(days) + \" day\" : \"in \" + Math.round(days) + \" days\");\n    } else {\n        return (hours === 1 ? \"in \" + Math.round(hours) + \" hour\" : \"in \" + Math.round(hours) + \" hours\");\n    }\n}\n\n// Future calculation\ntimeago.prototype.future = function(timeData) {\n    console.warn(\"timeago-simple: .future function is depricated! Please use .simple for both past and future dates.\");\n    // today date and time in milliseconds \n    var today = Date.now();\n\n    //We will perform some test - if there is error, we will throw error to console and exit, no change will be on the data.\n    try {\n        // We need to check if we able to parse the Date (if the result is NaN, this is an issue)\n        if(Date.parse(timeData) !== Date.parse(timeData)) throw \"timeago-simple: Please check date and time format! Unable to parse the date & time: \" + timeData;\n        // Need to check if it's really future date to parse\n        if((Date.parse(timeData) - today) < 0) throw \"timeago-simple: Looks like it's more relevant case for timeago.simple\"; \n    }\n    catch(err) {\n        console.error(err);\n        return (timeData);\n    }\n  \n    // parsing post date and time into milliseconds format\n    timeData = Date.parse(timeData);\n    var seconds = (timeData - today) / 1000;\n    var minutes = (seconds / 60);\n    var hours = (seconds / 3600);\n    /* istanbul ignore if */\n    if(seconds < 60 && minutes < 1) {\n        return (seconds === 1 ? \"in \" + Math.round(seconds) + \" second\" : \"in \" + Math.round(seconds) + \" seconds\");\n    }\n    /* istanbul ignore if */\n    if(minutes < 60 && hours < 1) {\n    \treturn (minutes === 1 ? \"in \" + Math.round(minutes) + \" minute\" : \"in \" + Math.round(minutes) + \" minutes\");\n    }\n    /* istanbul ignore if */\n    if(hours > 24){\n        var days = hours / 24;\n        if (days > 30) {\n            var month = days / 30;\n            if (month > 12) {\n                var years = month / 12;\n                if (years > 0) {\n                    return (years === 1 ? \"in \" + Math.ceil(years) + \" year\" : \"in \" + Math.ceil(years) + \" years\");\n                }\n            }\n\t        return (\"in \" + Math.round(month) + \" month\");\n        }\n        return (days === 1 ? \"in \" + Math.round(days) + \" day\" : \"in \" + Math.round(days) + \" days\");\n    }\n    return (hours === 1 ? \"in \" + Math.round(hours) + \" hour\" : \"in \" + Math.round(hours) + \" hours\");\n};\n\n\nmodule.exports = new timeago();","import timeago from \"timeago-simple\";\r\n\r\nconst timestamp = t => {\r\n\r\n    return timeago.simple(new Date(t))\r\n}\r\n\r\nexport default timestamp;\r\n","<script>\r\n  import PostMsg from \"./PostMsg.svelte\";\r\n  import GenericMsg from \"./GenericMsg.svelte\";\r\n  import VoteMsg from \"./VoteMsg.svelte\";\r\n  import PrivateMsg from \"./PrivateMsg.svelte\";\r\n  import ContactMsg from \"./ContactMsg.svelte\";\r\n  import ChannelMsg from \"./ChannelMsg.svelte\";\r\n  import AboutMsg from \"./AboutMsg.svelte\";\r\n  import PubMsg from \"./PubMsg.svelte\";\r\n  import BlogMsg from \"./BlogMsg.svelte\";\r\n  import AvatarChip from \"../parts/AvatarChip.svelte\";\r\n  import timestamp from \"../parts/timestamp.js\";\r\n  import { navigate } from \"../utils.js\";\r\n  import { isMessageBlured } from \"../abusePrevention.js\";\r\n\r\n  export let msg;\r\n\r\n  let type;\r\n  let feed = msg.value.author;\r\n  let showRaw = false;\r\n  let rawContent = JSON.stringify(msg, null, 2);\r\n  let dropdownActive = false;\r\n  let privateMsgForYou = false;\r\n\r\n  let messageTypes = {\r\n    \"*\": GenericMsg,\r\n    post: PostMsg,\r\n    vote: VoteMsg,\r\n    private: PrivateMsg,\r\n    contact: ContactMsg,\r\n    channel: ChannelMsg,\r\n    about: AboutMsg,\r\n    pub: PubMsg,\r\n    blog: BlogMsg\r\n  };\r\n\r\n  let selectedRenderer;\r\n\r\n  if (typeof msg.value.content === \"string\") {\r\n    type = \"private\";\r\n  } else {\r\n    type = msg.value.content.type;\r\n  }\r\n\r\n  if (msg.value.private) {\r\n    privateMsgForYou = true;\r\n  }\r\n\r\n  if (messageTypes.hasOwnProperty(type)) {\r\n    selectedRenderer = messageTypes[type];\r\n  } else {\r\n    selectedRenderer = messageTypes[\"*\"];\r\n  }\r\n\r\n  let image = \"images/icon.png\";\r\n  let name = feed;\r\n  let blured = isMessageBlured(msg);\r\n\r\n  ssb.avatar(feed).then(data => {\r\n    if (data.image !== null) {\r\n      image = `http://localhost:8989/blobs/get/${data.image}`;\r\n    }\r\n    name = data.name;\r\n  });\r\n\r\n  const toggleRawMessage = () => {\r\n    showRaw = !showRaw;\r\n    dropdownActive = false;\r\n  };\r\n\r\n  const copyPermalink = () => {\r\n    navigator.clipboard\r\n      .writeText(`ssb:${msg.key}`)\r\n      .then(() => console.log(\"permalink copied\"))\r\n      .catch(err => console.error(\"can't copy permalink\", err));\r\n\r\n    dropdownActive = false;\r\n  };\r\n\r\n  const copyHash = () => {\r\n    navigator.clipboard\r\n      .writeText(`${msg.key}`)\r\n      .then(() => console.log(\"hash copied\"))\r\n      .catch(err => console.error(\"can't copy hash\", err));\r\n\r\n    dropdownActive = false;\r\n  };\r\n\r\n  const goProfile = ev => {\r\n    if (ev.ctrlKey) {\r\n      window.open(`?feed=${encodeURIComponent(feed)}#/profile`);\r\n    } else {\r\n      navigate(\"/profile\", { feed });\r\n    }\r\n  };\r\n</script>\r\n\r\n<style>\r\n  .blured img {\r\n    filter: blur(20px) !important;\r\n  }\r\n\r\n  .blured {\r\n    border: solid 2px red;\r\n  }\r\n  .raw-content {\r\n    width: 50%;\r\n  }\r\n\r\n  .feed-display {\r\n    cursor: pointer;\r\n  }\r\n\r\n  .channel-display {\r\n    cursor: pointer;\r\n  }\r\n\r\n  .menu-right {\r\n    right: 0px;\r\n    left: unset;\r\n    min-width: 300px;\r\n  }\r\n\r\n  .private {\r\n    border: solid 2px orange;\r\n  }\r\n</style>\r\n\r\n<div class=\"card m-2\" class:private={privateMsgForYou} class:blured>\r\n  <div class=\"card-header\">\r\n    <div class=\"float-left\">\r\n      <div class=\"card-title\">\r\n        <div class=\"tile tile-centered feed-display\" on:click={goProfile}>\r\n          <div class=\"tile-icon\">\r\n            <div class=\"example-tile-icon\">\r\n              <img src={image} class=\"avatar avatar-lg\" alt={feed} />\r\n            </div>\r\n          </div>\r\n          <div class=\"tile-content\">\r\n            <div class=\"tile-title\">{name}</div>\r\n            <small class=\"tile-subtitle text-gray\">\r\n               {timestamp(msg.value.timestamp)}\r\n            </small>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    {#if privateMsgForYou}\r\n      <span class=\"label\">PRIVATE</span>\r\n    {/if}\r\n    <div class=\"float-right\">\r\n      <span\r\n        class=\"text-gray channel-display\"\r\n        on:click={() => navigate('/channel', {\r\n            channel: msg.value.content.channel\r\n          })}>\r\n        {#if msg.value.content.channel}#{msg.value.content.channel}{/if}\r\n      </span>\r\n      <div class=\"dropdown\">\r\n        <span\r\n          class=\"btn btn-link dropdown-toggle\"\r\n          tabindex=\"0\"\r\n          class:active={dropdownActive}\r\n          on:click={() => (dropdownActive = !dropdownActive)}>\r\n          <i class=\"icon icon-more-vert\" />\r\n        </span>\r\n        <ul class=\"menu menu-right\">\r\n          <li class=\"menu-item\">\r\n\r\n            <a\r\n              href=\"?thread={encodeURIComponent(msg.key)}#/thread\"\r\n              target=\"_blank\">\r\n              <i class=\"icon icon-share\" />\r\n              Open in new tab\r\n            </a>\r\n          </li>\r\n          <li class=\"menu-item\">\r\n            <a href=\"#\" on:click|preventDefault={copyPermalink}>\r\n              <i class=\"icon icon-copy\" />\r\n              Copy permalink to clipboard\r\n            </a>\r\n          </li>\r\n          <li class=\"menu-item\">\r\n            <a href=\"#\" on:click|preventDefault={copyHash}>\r\n              <i class=\"icon icon-copy\" />\r\n              Copy message id to clipboard\r\n            </a>\r\n          </li>\r\n          <li class=\"divider\" data-content=\"FOR THE CURIOUS\" />\r\n          <li class=\"menu-item\">\r\n            <a href=\"#\" on:click|preventDefault={toggleRawMessage}>\r\n              <i class=\"icon icon-message\" />\r\n              {#if !showRaw}Show raw message{:else}Close raw message{/if}\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  {#if !showRaw}\r\n    <svelte:component this={selectedRenderer} {msg} />\r\n  {:else}\r\n    <div class=\"card-body\">\r\n      <div class=\"columns\">\r\n        <div class=\"column col-9\">\r\n          <pre class=\"code\">\r\n            <code>{rawContent}</code>\r\n          </pre>\r\n        </div>\r\n        <div class=\"column col-3\">\r\n          <p>\r\n            This is a message of type\r\n            <em>{type}</em>\r\n            .\r\n          </p>\r\n          <p>\r\n            To learn more about it, go to\r\n            <a target=\"_blank\" href=\"/docs/index.html#/message_types/{type}\">\r\n              the documentation about messages with type {type}\r\n            </a>\r\n            .\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  {/if}\r\n</div>\r\n","<script>\r\n  import MessageRenderer from \"../messageTypes/MessageRenderer.svelte\";\r\n  import { navigate, routeParams, getPref } from \"../utils.js\";\r\n  import { onMount } from \"svelte\";\r\n\r\n  let msgs = false;\r\n  let error = $routeParams.error || false;\r\n  let dropdownActive = false;\r\n\r\n  let opts = {};\r\n\r\n  // todo: move back into using stores.\r\n  $: {\r\n    Object.assign(opts, $routeParams);\r\n\r\n    document.title = `Patchfox - Public`;\r\n\r\n    if (opts.hasOwnProperty(\"lt\")) {\r\n      opts.lt = parseInt(opts.lt);\r\n    }\r\n\r\n    if (opts.hasOwnProperty(\"limit\")) {\r\n      opts.limit = parseInt(opts.limit);\r\n    }\r\n\r\n    let promise = ssb\r\n      .public(opts)\r\n      .then(ms => {\r\n        msgs = ms;\r\n        window.scrollTo(0, 0);\r\n      })\r\n      .catch(n => {\r\n        if (!error) {\r\n          console.error(\"errrrooooor\", n);\r\n        }\r\n      });\r\n  }\r\n\r\n  const goNext = () => {\r\n    navigate(\"/public\", {\r\n      lt: msgs[msgs.length - 1].value.timestamp\r\n    });\r\n  };\r\n  const goPrevious = () => {\r\n    history.back();\r\n  };\r\n</script>\r\n\r\n<style>\r\n  .menu-right {\r\n    right: 0px;\r\n    left: unset;\r\n    min-width: 300px;\r\n  }\r\n</style>\r\n\r\n<div class=\"container\">\r\n  <div class=\"columns\">\r\n    <h4 class=\"column\">Public Feed</h4>\r\n    <div class=\"column\" />\r\n  </div>\r\n</div>\r\n{#if error}\r\n  <div class=\"toast toast-error\">Error: {error}</div>\r\n{/if}\r\n{#if !msgs}\r\n  <div class=\"loading loading-lg\" />\r\n{:else}\r\n  {#each msgs as msg (msg.key)}\r\n    <MessageRenderer {msg} />\r\n  {/each}\r\n  <ul class=\"pagination\">\r\n    <li class=\"page-item page-previous\">\r\n      <a href=\"#/public\" on:click|stopPropagation|preventDefault={goPrevious}>\r\n        <div class=\"page-item-subtitle\">Previous</div>\r\n      </a>\r\n    </li>\r\n    <li class=\"page-item page-next\">\r\n      <a href=\"#/public\" on:click|stopPropagation|preventDefault={goNext}>\r\n        <div class=\"page-item-subtitle\">Next</div>\r\n      </a>\r\n    </li>\r\n  </ul>\r\n{/if}\r\n","\"use strict\"\n\nfunction handleDrop(callback, event) {\n  event.stopPropagation()\n  event.preventDefault()\n  callback(Array.prototype.slice.call(event.dataTransfer.files))\n}\n\nfunction killEvent(e) {\n  e.stopPropagation()\n  e.preventDefault()\n  return false\n}\n\nfunction addDragDropListener(element, callback) {\n  element.addEventListener(\"dragenter\", killEvent, false)\n  element.addEventListener(\"dragover\", killEvent, false)\n  element.addEventListener(\"drop\", handleDrop.bind(undefined, callback), false)\n}\n\nmodule.exports = addDragDropListener","export { identity as linear } from './internal';\n\n/*\nAdapted from https://github.com/mattdesl\nDistributed under MIT License https://github.com/mattdesl/eases/blob/master/LICENSE.md\n*/\nfunction backInOut(t) {\n    const s = 1.70158 * 1.525;\n    if ((t *= 2) < 1)\n        return 0.5 * (t * t * ((s + 1) * t - s));\n    return 0.5 * ((t -= 2) * t * ((s + 1) * t + s) + 2);\n}\nfunction backIn(t) {\n    const s = 1.70158;\n    return t * t * ((s + 1) * t - s);\n}\nfunction backOut(t) {\n    const s = 1.70158;\n    return --t * t * ((s + 1) * t + s) + 1;\n}\nfunction bounceOut(t) {\n    const a = 4.0 / 11.0;\n    const b = 8.0 / 11.0;\n    const c = 9.0 / 10.0;\n    const ca = 4356.0 / 361.0;\n    const cb = 35442.0 / 1805.0;\n    const cc = 16061.0 / 1805.0;\n    const t2 = t * t;\n    return t < a\n        ? 7.5625 * t2\n        : t < b\n            ? 9.075 * t2 - 9.9 * t + 3.4\n            : t < c\n                ? ca * t2 - cb * t + cc\n                : 10.8 * t * t - 20.52 * t + 10.72;\n}\nfunction bounceInOut(t) {\n    return t < 0.5\n        ? 0.5 * (1.0 - bounceOut(1.0 - t * 2.0))\n        : 0.5 * bounceOut(t * 2.0 - 1.0) + 0.5;\n}\nfunction bounceIn(t) {\n    return 1.0 - bounceOut(1.0 - t);\n}\nfunction circInOut(t) {\n    if ((t *= 2) < 1)\n        return -0.5 * (Math.sqrt(1 - t * t) - 1);\n    return 0.5 * (Math.sqrt(1 - (t -= 2) * t) + 1);\n}\nfunction circIn(t) {\n    return 1.0 - Math.sqrt(1.0 - t * t);\n}\nfunction circOut(t) {\n    return Math.sqrt(1 - --t * t);\n}\nfunction cubicInOut(t) {\n    return t < 0.5 ? 4.0 * t * t * t : 0.5 * Math.pow(2.0 * t - 2.0, 3.0) + 1.0;\n}\nfunction cubicIn(t) {\n    return t * t * t;\n}\nfunction cubicOut(t) {\n    const f = t - 1.0;\n    return f * f * f + 1.0;\n}\nfunction elasticInOut(t) {\n    return t < 0.5\n        ? 0.5 *\n            Math.sin(((+13.0 * Math.PI) / 2) * 2.0 * t) *\n            Math.pow(2.0, 10.0 * (2.0 * t - 1.0))\n        : 0.5 *\n            Math.sin(((-13.0 * Math.PI) / 2) * (2.0 * t - 1.0 + 1.0)) *\n            Math.pow(2.0, -10.0 * (2.0 * t - 1.0)) +\n            1.0;\n}\nfunction elasticIn(t) {\n    return Math.sin((13.0 * t * Math.PI) / 2) * Math.pow(2.0, 10.0 * (t - 1.0));\n}\nfunction elasticOut(t) {\n    return (Math.sin((-13.0 * (t + 1.0) * Math.PI) / 2) * Math.pow(2.0, -10.0 * t) + 1.0);\n}\nfunction expoInOut(t) {\n    return t === 0.0 || t === 1.0\n        ? t\n        : t < 0.5\n            ? +0.5 * Math.pow(2.0, 20.0 * t - 10.0)\n            : -0.5 * Math.pow(2.0, 10.0 - t * 20.0) + 1.0;\n}\nfunction expoIn(t) {\n    return t === 0.0 ? t : Math.pow(2.0, 10.0 * (t - 1.0));\n}\nfunction expoOut(t) {\n    return t === 1.0 ? t : 1.0 - Math.pow(2.0, -10.0 * t);\n}\nfunction quadInOut(t) {\n    t /= 0.5;\n    if (t < 1)\n        return 0.5 * t * t;\n    t--;\n    return -0.5 * (t * (t - 2) - 1);\n}\nfunction quadIn(t) {\n    return t * t;\n}\nfunction quadOut(t) {\n    return -t * (t - 2.0);\n}\nfunction quartInOut(t) {\n    return t < 0.5\n        ? +8.0 * Math.pow(t, 4.0)\n        : -8.0 * Math.pow(t - 1.0, 4.0) + 1.0;\n}\nfunction quartIn(t) {\n    return Math.pow(t, 4.0);\n}\nfunction quartOut(t) {\n    return Math.pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;\n}\nfunction quintInOut(t) {\n    if ((t *= 2) < 1)\n        return 0.5 * t * t * t * t * t;\n    return 0.5 * ((t -= 2) * t * t * t * t + 2);\n}\nfunction quintIn(t) {\n    return t * t * t * t * t;\n}\nfunction quintOut(t) {\n    return --t * t * t * t * t + 1;\n}\nfunction sineInOut(t) {\n    return -0.5 * (Math.cos(Math.PI * t) - 1);\n}\nfunction sineIn(t) {\n    const v = Math.cos(t * Math.PI * 0.5);\n    if (Math.abs(v) < 1e-14)\n        return 1;\n    else\n        return 1 - v;\n}\nfunction sineOut(t) {\n    return Math.sin((t * Math.PI) / 2);\n}\n\nexport { backInOut, backIn, backOut, bounceOut, bounceInOut, bounceIn, circInOut, circIn, circOut, cubicInOut, cubicIn, cubicOut, elasticInOut, elasticIn, elasticOut, expoInOut, expoIn, expoOut, quadInOut, quadIn, quadOut, quartInOut, quartIn, quartOut, quintInOut, quintIn, quintOut, sineInOut, sineIn, sineOut };\n","import { cubicOut, cubicInOut } from './easing';\nimport { is_function, assign } from './internal';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\n\nfunction fade(node, { delay = 0, duration = 400 }) {\n    const o = +getComputedStyle(node).opacity;\n    return {\n        delay,\n        duration,\n        css: t => `opacity: ${t * o}`\n    };\n}\nfunction fly(node, { delay = 0, duration = 400, easing = cubicOut, x = 0, y = 0, opacity = 0 }) {\n    const style = getComputedStyle(node);\n    const target_opacity = +style.opacity;\n    const transform = style.transform === 'none' ? '' : style.transform;\n    const od = target_opacity * (1 - opacity);\n    return {\n        delay,\n        duration,\n        easing,\n        css: (t, u) => `\n\t\t\ttransform: ${transform} translate(${(1 - t) * x}px, ${(1 - t) * y}px);\n\t\t\topacity: ${target_opacity - (od * u)}`\n    };\n}\nfunction slide(node, { delay = 0, duration = 400, easing = cubicOut }) {\n    const style = getComputedStyle(node);\n    const opacity = +style.opacity;\n    const height = parseFloat(style.height);\n    const padding_top = parseFloat(style.paddingTop);\n    const padding_bottom = parseFloat(style.paddingBottom);\n    const margin_top = parseFloat(style.marginTop);\n    const margin_bottom = parseFloat(style.marginBottom);\n    const border_top_width = parseFloat(style.borderTopWidth);\n    const border_bottom_width = parseFloat(style.borderBottomWidth);\n    return {\n        delay,\n        duration,\n        easing,\n        css: t => `overflow: hidden;` +\n            `opacity: ${Math.min(t * 20, 1) * opacity};` +\n            `height: ${t * height}px;` +\n            `padding-top: ${t * padding_top}px;` +\n            `padding-bottom: ${t * padding_bottom}px;` +\n            `margin-top: ${t * margin_top}px;` +\n            `margin-bottom: ${t * margin_bottom}px;` +\n            `border-top-width: ${t * border_top_width}px;` +\n            `border-bottom-width: ${t * border_bottom_width}px;`\n    };\n}\nfunction scale(node, { delay = 0, duration = 400, easing = cubicOut, start = 0, opacity = 0 }) {\n    const style = getComputedStyle(node);\n    const target_opacity = +style.opacity;\n    const transform = style.transform === 'none' ? '' : style.transform;\n    const sd = 1 - start;\n    const od = target_opacity * (1 - opacity);\n    return {\n        delay,\n        duration,\n        easing,\n        css: (t, u) => `\n\t\t\ttransform: ${transform} scale(${1 - (sd * u)});\n\t\t\topacity: ${target_opacity - (od * u)}\n\t\t`\n    };\n}\nfunction draw(node, { delay = 0, speed, duration, easing = cubicInOut }) {\n    const len = node.getTotalLength();\n    if (duration === undefined) {\n        if (speed === undefined) {\n            duration = 800;\n        }\n        else {\n            duration = len / speed;\n        }\n    }\n    else if (typeof duration === 'function') {\n        duration = duration(len);\n    }\n    return {\n        delay,\n        duration,\n        easing,\n        css: (t, u) => `stroke-dasharray: ${t * len} ${u * len}`\n    };\n}\nfunction crossfade(_a) {\n    var { fallback } = _a, defaults = __rest(_a, [\"fallback\"]);\n    const to_receive = new Map();\n    const to_send = new Map();\n    function crossfade(from, node, params) {\n        const { delay = 0, duration = d => Math.sqrt(d) * 30, easing = cubicOut } = assign(assign({}, defaults), params);\n        const to = node.getBoundingClientRect();\n        const dx = from.left - to.left;\n        const dy = from.top - to.top;\n        const d = Math.sqrt(dx * dx + dy * dy);\n        const style = getComputedStyle(node);\n        const transform = style.transform === 'none' ? '' : style.transform;\n        const opacity = +style.opacity;\n        return {\n            delay,\n            duration: is_function(duration) ? duration(d) : duration,\n            easing,\n            css: (t, u) => `\n\t\t\t\topacity: ${t * opacity};\n\t\t\t\ttransform: ${transform} translate(${u * dx}px,${u * dy}px);\n\t\t\t`\n        };\n    }\n    function transition(items, counterparts, intro) {\n        return (node, params) => {\n            items.set(params.key, {\n                rect: node.getBoundingClientRect()\n            });\n            return () => {\n                if (counterparts.has(params.key)) {\n                    const { rect } = counterparts.get(params.key);\n                    counterparts.delete(params.key);\n                    return crossfade(rect, node, params);\n                }\n                // if the node is disappearing altogether\n                // (i.e. wasn't claimed by the other list)\n                // then we need to supply an outro\n                items.delete(params.key);\n                return fallback && fallback(node, params, intro);\n            };\n        };\n    }\n    return [\n        transition(to_send, to_receive, false),\n        transition(to_receive, to_send, true)\n    ];\n}\n\nexport { fade, fly, slide, scale, draw, crossfade };\n","<script>\r\n  import { onMount } from \"svelte\";\r\n  import drop from \"drag-and-drop-files\";\r\n  import { slide } from \"svelte/transition\";\r\n  import { navigate, routeParams, reconnect, getPref } from \"../utils.js\";\r\n  import AvatarChip from \"../parts/AvatarChip.svelte\";\r\n\r\n  let showPreview = false;\r\n  let msg = false;\r\n  let error = false;\r\n  let posting = false;\r\n\r\n  let root = $routeParams.root;\r\n  let branch = $routeParams.branch;\r\n  let channel = $routeParams.channel || \"\";\r\n  let content = $routeParams.content || \"\";\r\n  let replyfeed = $routeParams.replyfeed || false;\r\n  let fork = $routeParams.fork;\r\n  let fileOnTop = false;\r\n  let pull = hermiebox.modules.pullStream;\r\n  let fileReader = hermiebox.modules.pullFileReader;\r\n  let sbot = hermiebox.sbot;\r\n  let ipfsDaemonRunning = false;\r\n\r\n  document.title = `Patchfox - compose`;\r\n\r\n  onMount(() => {\r\n    error = false;\r\n    msg = \"\";\r\n\r\n    // this code could be in some better/smarter place.\r\n    // e.dataTransfer.getData('url'); from images in the browser window\r\n\r\n    drop(document.getElementById(\"content\"), files => readFileAndAttach(files));\r\n    checkIpfsDaemon();\r\n  });\r\n\r\n  const checkIpfsDaemon = () => {\r\n    let port = getPref(\"ipfsPort\", 5001);\r\n    fetch(`http://127.0.0.1:${port}/api/v0/config/show`).then(data => {\r\n      ipfsDaemonRunning = true;\r\n    });\r\n  };\r\n\r\n  const readFileAndAttach = files => {\r\n    error = false;\r\n    msg = \"\";\r\n\r\n    if (files.length == 0) {\r\n      fileOnTop = false;\r\n      console.log(\"this is not a file\");\r\n      return false;\r\n    }\r\n\r\n    var first = files[0];\r\n    console.log(first);\r\n\r\n    if (!first.type.startsWith(\"image\")) {\r\n      error = true;\r\n      msg = `You can only drag & drop image, this file is a ${first.type}`;\r\n      return false;\r\n    }\r\n\r\n    if (first.size >= 5000000) {\r\n      error = true;\r\n      msg = `File too large: ${Math.floor(\r\n        first.size / 1048576,\r\n        2\r\n      )}mb when max size is 5mb`;\r\n      return false;\r\n    }\r\n\r\n    pull(\r\n      fileReader(first),\r\n      sbot.blobs.add(function(err, hash) {\r\n        // 'hash' is the hash-id of the blob\r\n        if (err) {\r\n          error = true;\r\n          msg = \"Couldn't attach file: \" + err;\r\n        } else {\r\n          content += ` ![${first.name}](${hash})`;\r\n        }\r\n        fileOnTop = false;\r\n      })\r\n    );\r\n  };\r\n\r\n  const post = async ev => {\r\n    ev.stopPropagation();\r\n    ev.preventDefault();\r\n\r\n    if (!posting) {\r\n      posting = true;\r\n\r\n      if (channel.startsWith(\"#\")) {\r\n        channel = channel.slice(1);\r\n      }\r\n\r\n      try {\r\n        msg = await ssb.newPost({\r\n          text: content,\r\n          channel,\r\n          root,\r\n          branch,\r\n          fork,\r\n          contentWarning: contentWarning.length > 0 ? contentWarning : undefined\r\n        });\r\n        posting = false;\r\n        console.log(\"posted\", msg);\r\n        window.scrollTo(0, 0);\r\n      } catch (n) {\r\n        error = true;\r\n        msg = `Couldn't post your message: ${n}`;\r\n        window.scrollTo(0, 0);\r\n\r\n        if (msg.message == \"stream is closed\") {\r\n          msg += \". We lost connection to sbot. We'll try to restablish it...\";\r\n\r\n          reconnect()\r\n            .then(() => {\r\n              showPreview = false;\r\n              posting = false;\r\n              error = false;\r\n              msg = \"Connection to sbot reestablished. Try posting again\";\r\n            })\r\n            .catch(err => {\r\n              window.location.search = `?root=${encodeURIComponent(\r\n                root\r\n              )}&branch=${encodeURIComponent(\r\n                branch\r\n              )}&content=${encodeURIComponent(\r\n                content\r\n              )}&channel=${encodeURIComponent(channel)}`;\r\n              msg = `Sorry, couldn't reconnect to sbot:${err}. Try reloading the page. Your content has been saved to the URL`;\r\n            });\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const preview = ev => {\r\n    showPreview = true;\r\n  };\r\n\r\n  const saveToURL = ev => {\r\n    window.location.search = `?root=${encodeURIComponent(\r\n      root\r\n    )}&branch=${encodeURIComponent(branch)}&content=${encodeURIComponent(\r\n      content\r\n    )}&channel=${encodeURIComponent(channel)}`;\r\n  };\r\n\r\n  const avatarClick = ev => {\r\n    let feed = ev.detail.feed;\r\n    let name = ev.detail.name;\r\n\r\n    if (content.length > 0) {\r\n      content += ` [${name}](${feed})`;\r\n    } else {\r\n      content = `[${name}](${feed})`;\r\n    }\r\n  };\r\n\r\n  const dragOver = ev => {\r\n    fileOnTop = true;\r\n  };\r\n\r\n  const dragLeave = ev => {\r\n    fileOnTop = false;\r\n  };\r\n\r\n  const attachFileTrigger = () => {\r\n    document.getElementById(\"fileInput\").click();\r\n  };\r\n\r\n  const attachFileIPFSTrigger = () => {\r\n    document.getElementById(\"fileInputIPFS\").click();\r\n  };\r\n\r\n  const attachFile = ev => {\r\n    const files = ev.target.files;\r\n    readFileAndAttach(files);\r\n  };\r\n\r\n  const attachFileIPFS = ev => {\r\n    const files = ev.target.files;\r\n    readFileAndAttachIPFS(files);\r\n  };\r\n\r\n  const readFileAndAttachIPFS = async files => {\r\n    error = false;\r\n    msg = \"\";\r\n\r\n    var ipfs = window.IpfsHttpClient(\"127.0.0.1\", \"5001\");\r\n    const results = await ipfs.add(files[0]);\r\n\r\n    console.log(\"added via IPFS\", results);\r\n    content += ` [${results[0].path}](ipfs://${results[0].hash})`;\r\n  };\r\n\r\n  let showContentWarningField = false;\r\n\r\n  const toggleContentWarning = () =>\r\n    (showContentWarningField = !showContentWarningField);\r\n\r\n  let contentWarning = \"\";\r\n</script>\r\n\r\n<style>\r\n  .file-on-top {\r\n    border: solid 2px rgb(26, 192, 11);\r\n  }\r\n\r\n  input[type=\"file\"] {\r\n    display: none;\r\n  }\r\n</style>\r\n\r\n<div class=\"container\">\r\n  <div class=\"columns\">\r\n    <div class=\"column\">\r\n      {#if fork}\r\n        <div class=\"toast toast-warning\">You are forking: {fork}</div>\r\n      {/if}\r\n      {#if msg}\r\n        {#if error}\r\n          <div class=\"toast toast-error\">{msg}</div>\r\n        {:else}\r\n          <div class=\"toast toast-success\">\r\n            Your message has been posted. Do you want to\r\n            <a\r\n              target=\"_blank\"\r\n              href=\"?thread={encodeURIComponent(msg.key)}#/thread\">\r\n              Check it out?\r\n            </a>\r\n          </div>\r\n        {/if}\r\n      {/if}\r\n      {#if !showPreview}\r\n        <div class=\"form-group\" in:slide out:slide>\r\n          <label class=\"form-label\" for=\"channel\">Channel</label>\r\n          <input\r\n            class=\"form-input\"\r\n            type=\"text\"\r\n            id=\"channel\"\r\n            placeholder=\"channel\"\r\n            bind:value={channel} />\r\n\r\n          {#if branch}\r\n            <label class=\"form-label\" for=\"reply-to\">In reply to</label>\r\n            <input\r\n              class=\"form-input\"\r\n              type=\"text\"\r\n              id=\"reply-to\"\r\n              placeholder=\"in reply to\"\r\n              bind:value={branch} />\r\n          {/if}\r\n\r\n          {#if replyfeed}\r\n            <div class=\"mt-2\">\r\n              <span>\r\n                Click the avatar to add a link to the message:\r\n                <AvatarChip feed={replyfeed} on:avatarClick={avatarClick} />\r\n              </span>\r\n            </div>\r\n          {/if}\r\n          <label class=\"form-label\" for=\"content\">Message</label>\r\n          <textarea\r\n            class=\"form-input\"\r\n            id=\"content\"\r\n            placeholder=\"Type in your post\"\r\n            rows=\"10\"\r\n            on:dragover|preventDefault|stopPropagation={dragOver}\r\n            on:dragleave|preventDefault|stopPropagation={dragLeave}\r\n            class:file-on-top={fileOnTop}\r\n            bind:value={content} />\r\n          <div class=\"d-block m-2\">\r\n            <button class=\"btn btn-link\" on:click={toggleContentWarning}>\r\n              CW\r\n            </button>\r\n            {#if showContentWarningField}\r\n              <input\r\n                type=\"text\"\r\n                size=\"50\"\r\n                bind:value={contentWarning}\r\n                placeholder=\"Describe your content warning (leave empty to no use it)\" />\r\n            {/if}\r\n          </div>\r\n          <input type=\"file\" on:input={attachFile} id=\"fileInput\" />\r\n          <button class=\"btn\" on:click={attachFileTrigger}>Attach File</button>\r\n          {#if ipfsDaemonRunning}\r\n            <input type=\"file\" on:input={attachFileIPFS} id=\"fileInputIPFS\" />\r\n            <button class=\"btn\" on:click={attachFileIPFSTrigger}>\r\n              Attach File using IPFS\r\n            </button>\r\n          {/if}\r\n          <button class=\"btn btn-primary float-right\" on:click={preview}>\r\n            Preview\r\n          </button>\r\n        </div>\r\n      {:else}\r\n        <div class=\"column col-md-12\">\r\n          <h2>Post preview</h2>\r\n          {#if channel || root || branch || contentWarning.length > 0}\r\n            <blockquote>\r\n              {#if channel}\r\n                <p>\r\n                  <b>Channel:</b>\r\n                  {channel.startsWith('#') ? channel.slice(1) : channel}\r\n                </p>\r\n              {/if}\r\n              {#if root}\r\n                <p>\r\n                  <b>Root:</b>\r\n                  {root}\r\n                </p>\r\n              {/if}\r\n              {#if branch}\r\n                <p>\r\n                  <b>In Reply To:</b>\r\n                  {branch}\r\n                </p>\r\n              {/if}\r\n              {#if contentWarning.length > 0}\r\n                <p>\r\n                  <b>Content Warning:</b>\r\n                  {contentWarning}\r\n                </p>\r\n              {/if}\r\n            </blockquote>\r\n          {/if}\r\n          {@html ssb.markdown(content)}\r\n\r\n          <div class=\"divider\" />\r\n          <div class=\"columns\">\r\n            <div class=\"column col-md-12 col-lg-10\">\r\n              <span class=\"label label-warning\">\r\n                This message will be public and can't be edited or deleted\r\n              </span>\r\n            </div>\r\n            <div class=\"column col-md-12 col-lg-2\">\r\n              <button class=\"btn\" on:click={() => (showPreview = false)}>\r\n                Go Back\r\n              </button>\r\n              <button\r\n                class=\"btn btn-primary\"\r\n                class:loading={posting}\r\n                on:click={post}>\r\n                Post\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      {/if}\r\n    </div>\r\n  </div>\r\n</div>\r\n","<script>\r\n  import MessageRenderer from \"../messageTypes/MessageRenderer.svelte\";\r\n  import { navigate, routeParams } from \"../utils.js\";\r\n  let msgs = false;\r\n  let error = false;\r\n  let msgid;\r\n\r\n  // todo: move back into using stores.\r\n  $: {\r\n    msgid = $routeParams.thread;\r\n    if (msgid.startsWith(\"ssb:\")) {\r\n      msgid = msgid.replace(\"ssb:\", \"\");\r\n    }\r\n    document.title = `Patchfox - Thread: ${msgid}`;\r\n\r\n    let promise = ssb\r\n      .thread(msgid)\r\n      .then(ms => {\r\n        msgs = ms;\r\n        window.scrollTo(0, 0);\r\n      })\r\n      .catch(n => {\r\n        console.dir(n);\r\n        error = n.message;\r\n      });\r\n  }\r\n\r\n</script>\r\n\r\n<div class=\"container\">\r\n  <h4>\r\n    Thread\r\n    <small class=\"label hide-sm\">{msgid}</small>\r\n  </h4>\r\n</div>\r\n{#if error}\r\n  <div class=\"toast toast-error\">\r\n    Couldn't load thead\r\n    <a href=\"?thread={msgid}#/thread\">{msgid}</a>\r\n    : {error}\r\n  </div>\r\n{/if}\r\n{#if !msgs && !error}\r\n  <div class=\"loading loading-lg\" />\r\n{:else}\r\n  {#each msgs as msg (msg.key)}\r\n    <MessageRenderer {msg} />\r\n  {/each}\r\n{/if}\r\n","<script>\r\n  import MessageRenderer from \"../messageTypes/MessageRenderer.svelte\";\r\n  import { navigate, routeParams } from \"../utils.js\";\r\n  let profile = false;\r\n\r\n  let description = false;\r\n  let following = false;\r\n  let blocking = false;\r\n  let image,\r\n    feed,\r\n    lastMsgs = [],\r\n    lastAbout;\r\n\r\n  // todo: move back into using stores.\r\n  feed = $routeParams.feed;\r\n\r\n  if (!feed) {\r\n    feed = ssb.feed;\r\n  }\r\n\r\n  let name = feed;\r\n\r\n  document.title = `Patchfox - Feed: ${feed}`;\r\n\r\n  console.log(\"fetching\", feed);\r\n\r\n  let avatarPromise = ssb.avatar(feed).then(data => {\r\n    name = data.name;\r\n    image = data.image;\r\n    document.title = `Patchfox - Feed: ${name}`;\r\n  });\r\n\r\n  let aboutPromise = ssb.profile(feed).then(data => {\r\n    lastAbout = data.about.reverse().find(m => {\r\n      let a = m.value.content;\r\n      return a.hasOwnProperty(\"description\");\r\n    });\r\n    try {\r\n      description = lastAbout.value.content.description;\r\n    } catch (n) {\r\n      description = \"\";\r\n    }\r\n    window.scrollTo(0, 0);\r\n  });\r\n\r\n  let messagePromise = ssb\r\n    .query(\r\n      {\r\n        value: {\r\n          author: feed \r\n        }\r\n      },\r\n      10\r\n    )\r\n    .then(msgs => {\r\n      lastMsgs = msgs;\r\n\r\n      window.scrollTo(0, 0);\r\n    });\r\n\r\n  if (feed !== ssb.feed) {\r\n    ssb.following(feed).then(f => (following = f));\r\n    ssb.blocking(feed).then(f => (blocking = f));\r\n  }\r\n\r\n  const blockingChanged = ev => {\r\n    let v = ev.target.checked;\r\n    if (v) {\r\n      ssb.block(feed).catch(() => (blocking = false));\r\n    } else {\r\n      ssb.unblock(feed).catch(() => (blocking = true));\r\n    }\r\n  };\r\n\r\n  const followingChanged = ev => {\r\n    let v = ev.target.checked;\r\n    if (v) {\r\n      ssb.follow(feed).catch(() => (following = false));\r\n    } else {\r\n      ssb.unfollow(feed).catch(() => (following = true));\r\n    }\r\n  };\r\n\r\n  // todo: refactor navigation here. This is a hack it shouldn't hide and show values which are\r\n  // not reloading.\r\n  const loadMoreMessages = lt => {\r\n    messagePromise = ssb\r\n      .query(\r\n        {\r\n          value: {\r\n            author: feed,\r\n            timestamp: { $lt: lt }\r\n          }\r\n        }\r\n      )\r\n      .then(msgs => {\r\n        lastMsgs = msgs;\r\n        window.scrollTo(0, 0);\r\n      });\r\n  };\r\n</script>\r\n\r\n<div class=\"container\">\r\n  {#await aboutPromise && avatarPromise}\r\n    <div class=\"loading loading-lg\" />\r\n  {:then}\r\n    <div class=\"columns\">\r\n\r\n      <div class=\"column col-6\">\r\n        <div class=\"container\">\r\n          <img\r\n            class=\"img-responsive\"\r\n            src=\"http://localhost:8989/blobs/get/{image}\"\r\n            alt={feed} />\r\n        </div>\r\n      </div>\r\n      <div class=\"column col-6\">\r\n        <h1>{name}</h1>\r\n        <pre>{feed}</pre>\r\n        {#if feed !== ssb.feed}\r\n          <div class=\"container\">\r\n            <div class=\"divider\" />\r\n            <div class=\"form-group\">\r\n              <label class=\"form-switch form-inline\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  on:change={followingChanged}\r\n                  bind:checked={following} />\r\n                <i class=\"form-icon\" />\r\n                following\r\n              </label>\r\n              <label class=\"form-switch form-inline\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  on:change={blockingChanged}\r\n                  bind:checked={blocking} />\r\n                <i class=\"form-icon\" />\r\n                blocking\r\n              </label>\r\n            </div>\r\n            <div class=\"divider\" />\r\n          </div>\r\n        {/if}\r\n        <p>\r\n          {@html ssb.markdown(description)}\r\n        </p>\r\n      </div>\r\n    </div>\r\n\r\n    <div>\r\n      {#await messagePromise}\r\n        <div class=\"loading\" />\r\n      {:then data}\r\n        {#each lastMsgs as msg (msg.key)}\r\n          <MessageRenderer {msg} />\r\n        {/each}\r\n        <ul class=\"pagination\">\r\n\r\n          <li class=\"page-item page-next\">\r\n            <a\r\n              href=\"#/public\"\r\n              on:click|stopPropagation|preventDefault={() => {\r\n                loadMoreMessages(lastMsgs[lastMsgs.length - 1].value.timestamp);\r\n              }}>\r\n              <div class=\"page-item-subtitle\">Load More</div>\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      {:catch n}\r\n        <p>Error fetching messages: {n.message}</p>\r\n\r\n      {/await}\r\n\r\n    </div>\r\n  {:catch n}\r\n    <p>Error: {n.message}</p>\r\n  {/await}\r\n</div>\r\n","<script>\r\n  import { navigate, routeParams, reconnect } from \"../utils.js\";\r\n\r\n  document.title = `Patchfox - Error`;\r\n\r\n  let error = $routeParams.error;\r\n  let errorObj = {};\r\n  let toastClass = \"\";\r\n  let toast = false;\r\n  let msg;\r\n  let cta = false;\r\n\r\n  console.dir(error);\r\n  if (typeof error == \"object\") {\r\n    errorObj = error;\r\n    error = errorObj.message;\r\n  }\r\n\r\n  const tryReconnect = () => {\r\n    toast = true;\r\n    toastClass = \"toast-warning\";\r\n    msg = \"Attempting to reconnect to sbot...\";\r\n    reconnect()\r\n      .then(() => {\r\n        toastClass = \"toast-success\";\r\n        toast = true;\r\n        msg =\r\n          \"Connection to sbot reestablished. Try going to your public feed.\";\r\n      })\r\n      .catch(n => {\r\n        toastClass = \"toast-error\";\r\n        toast = true;\r\n        msg = \"Couldn't reconnect. Try reloading the page.\";\r\n      });\r\n  };\r\n\r\n  let errorMapping = {\r\n    \"Error: stream is closed\": {\r\n      label: \"Want to try to reconnect?\",\r\n      action: tryReconnect\r\n    }\r\n  };\r\n\r\n  if (errorMapping.hasOwnProperty(error)) {\r\n    cta = errorMapping[error];\r\n  }\r\n</script>\r\n\r\n<div class=\"container\">\r\n  <h1>😿 An Error Has Occurred, sorry 😭</h1>\r\n  {#if toast}\r\n    <div class=\"toast {toastClass}\">{msg}</div>\r\n  {/if}\r\n  <h4>This is what we know about it</h4>\r\n  <pre class=\"code\">\r\n    <code>{error}</code>\r\n  </pre>\r\n  <p>You might want to:</p>\r\n  <ul>\r\n    {#if cta}\r\n      <li>\r\n        <a href=\"#\" on:click|stopPropagation|preventDefault={cta.action}>\r\n           {cta.label}\r\n        </a>\r\n      </li>\r\n    {/if}\r\n    <li>\r\n      <a href=\"/docs/index.html#/troubleshooting/\" target=\"_blank\">\r\n        Open our troubleshooting documentation.\r\n      </a>\r\n    </li>\r\n    <li>\r\n      <a href=\"https://github.com/soapdog/patchfox/issues\" target=\"_blank\">\r\n        Add an issue\r\n      </a>\r\n      to the Patchfox repository.\r\n    </li>\r\n  </ul>\r\n</div>\r\n","<script>\r\n  // NOTICE:\r\n  // I've removed this view from the navigation.\r\n  //\r\n  // it is too slow, it takes about 60 seconds to query.\r\n  //\r\n\r\n  import { navigate } from \"../utils.js\";\r\n\r\n  let activeChannels = [];\r\n  let subscribedChannels = [];\r\n\r\n  let loading = true;\r\n\r\n  let pull = hermiebox.modules.pullStream;\r\n  let sbot = hermiebox.sbot;\r\n\r\n  const loadSubscribedChannels = () => {\r\n    let query = {\r\n      $filter: {\r\n        value: {\r\n          author: sbot.id,\r\n          content: {\r\n            type: \"channel\"\r\n          }\r\n        }\r\n      },\r\n      $sort: [[\"value\", \"timestamp\"]]\r\n    };\r\n    pull(\r\n      sbot.query.read({\r\n        query: [query],\r\n        live: true,\r\n        reverse: true,\r\n        limit: 500\r\n      }),\r\n      //pull.filter(c => {\r\n      //  !subscribedChannels.some(sc => sc.channel == c.channel);\r\n      //}),\r\n      pull.drain(c => {\r\n        if (c.sync) {\r\n          console.log(\"finished loading\");\r\n          loading = false;\r\n        } else {\r\n          if (c.value.content.subscribed) {\r\n            subscribedChannels.push(c.value.content.channel);\r\n            subscribedChannels = subscribedChannels;\r\n          }\r\n        }\r\n      })\r\n    );\r\n  };\r\n\r\n  loadSubscribedChannels();\r\n</script>\r\n\r\n<style>\r\n  .channel {\r\n    cursor: pointer;\r\n  }\r\n</style>\r\n\r\n<h4>Subscribed Channels</h4>\r\n\r\n{#if subscribedChannels.length == 0}\r\n  <div class=\"loading\" />\r\n\r\n  <p>This is a complex query, it might take a while... Channels will appear as we find them</p>\r\n{:else}\r\n  {#each subscribedChannels as c}\r\n    <span\r\n      class=\"channel label label-secondary m-1\"\r\n      on:click={() => navigate('/channel', { channel: c })}>\r\n       #{c}\r\n    </span>\r\n  {/each}\r\n{/if}\r\n","<script>\r\n  import MessageRenderer from \"../messageTypes/MessageRenderer.svelte\";\r\n  import { navigate, routeParams, getPref } from \"../utils.js\";\r\n  import { onMount, onDestroy } from \"svelte\";\r\n\r\n  let msgs = false;\r\n  let error = $routeParams.error || false;\r\n  let channel = $routeParams.channel || false;\r\n  let subscribed = false;\r\n\r\n  if (!channel) {\r\n    console.log(\"can't navigate to unnamed channel, going back to public\");\r\n    location = \"index.html#/public\"; // force reload.\r\n  }\r\n\r\n  let opts = {\r\n    limit: $routeParams.limit || getPref(\"limit\", 10),\r\n    reverse: true\r\n  };\r\n\r\n  ssb.channelSubscribed(channel).then(s => (subscribed = s));\r\n\r\n  // todo: move back into using stores.\r\n  $: {\r\n    Object.assign(opts, $routeParams);\r\n\r\n    document.title = `Patchfox - #${channel}`;\r\n\r\n    if (opts.hasOwnProperty(\"lt\")) {\r\n      opts.lt = parseInt(opts.lt);\r\n    }\r\n\r\n    if (opts.hasOwnProperty(\"limit\")) {\r\n      opts.limit = parseInt(opts.limit);\r\n    }\r\n\r\n    let promise = ssb\r\n      .channel(channel, opts)\r\n      .then(ms => {\r\n        console.log(\"msg\", ms);\r\n        msgs = ms;\r\n        window.scrollTo(0, 0);\r\n      })\r\n      .catch(n => {\r\n        if (!error) {\r\n          console.error(\"errrrooooor\", n);\r\n        }\r\n      });\r\n  }\r\n\r\n  const subscriptionChanged = ev => {\r\n    let v = ev.target.checked;\r\n    if (v) {\r\n      ssb.channelSubscribe(channel).catch(() => (subscribed = false));\r\n    } else {\r\n      ssb.channelUnsubscribe(channel).catch(() => (subscribed = true));\r\n    }\r\n  };\r\n\r\n  const goNext = () => {\r\n    navigate(\"/channel\", {\r\n      channel,\r\n      lt: msgs[msgs.length - 1].rts\r\n    });\r\n  };\r\n  const goPrevious = () => {\r\n    history.back();\r\n  };\r\n</script>\r\n\r\n<style>\r\n  .menu-right {\r\n    right: 0px;\r\n    left: unset;\r\n    min-width: 300px;\r\n  }\r\n</style>\r\n\r\n<div class=\"container\">\r\n  <div class=\"columns\">\r\n    <div class=\"column\">\r\n      <h4>Channel: #{channel} </h4>\r\n    </div>\r\n    <div class=\"column\">\r\n      <label class=\"form-switch float-right\">\r\n        <input\r\n          type=\"checkbox\"\r\n          on:change={subscriptionChanged}\r\n          bind:checked={subscribed} />\r\n        <i class=\"form-icon\" />\r\n        Subscribe\r\n      </label>\r\n      <button\r\n        class=\"btn btn-link float-right\"\r\n        href=\"?channel={channel}#/compose\"\r\n        on:click|preventDefault={() => navigate('/compose', { channel })}>\r\n        New Post\r\n      </button>\r\n    </div>\r\n  </div>\r\n</div>\r\n{#if error}\r\n  <div class=\"toast toast-error\">Error: {error}</div>\r\n{/if}\r\n{#if !msgs}\r\n  <div class=\"loading loading-lg\" />\r\n{:else}\r\n  {#each msgs as msg (msg.key)}\r\n    <MessageRenderer {msg} />\r\n  {:else}\r\n    <p>No messages.</p>\r\n  {/each}\r\n  <ul class=\"pagination\">\r\n    <li class=\"page-item page-previous\">\r\n      <a href=\"#/public\" on:click|stopPropagation|preventDefault={goPrevious}>\r\n        <div class=\"page-item-subtitle\">Previous</div>\r\n      </a>\r\n    </li>\r\n    <li class=\"page-item page-next\">\r\n      <a href=\"#/public\" on:click|stopPropagation|preventDefault={goNext}>\r\n        <div class=\"page-item-subtitle\">Next</div>\r\n      </a>\r\n    </li>\r\n  </ul>\r\n{/if}\r\n","<script>\r\n  import { onMount } from \"svelte\";\r\n  import {\r\n    getPref,\r\n    setPref,\r\n    setConnectionConfiguration,\r\n    navigate\r\n  } from \"../utils.js\";\r\n  import { getFilters, addFilter, deleteFilter } from \"../abusePrevention.js\";\r\n \r\n  let keys = {};\r\n  let remote = \"\";\r\n  let limit = getPref(\"limit\", 10);\r\n  let columnSize = getPref(\"columnSize\", \"short\");\r\n\r\n  document.title = \"Patchfox - Settings\";\r\n\r\n  // message type filters\r\n  let showTypeUnknown = getPref(\"showTypeUnknown\", false);\r\n  let showTypeAbout = getPref(\"showTypeAbout\", true);\r\n  let showTypeBlog = getPref(\"showTypeBlog\", true);\r\n  let showTypeChannel = getPref(\"showTypeChannel\", true);\r\n  let showTypeContact = getPref(\"showTypeContact\", true);\r\n  let showTypePost = getPref(\"showTypePost\", true);\r\n  let showTypePrivate = getPref(\"showTypePrivate\", true);\r\n  let showTypePub = getPref(\"showTypePub\", true);\r\n  let showTypeVote = getPref(\"showTypeVote\", true);\r\n\r\n  // Abuse Prevention - filters\r\n  let currentFilters = getFilters();\r\n  let filterFeed = \"\";\r\n  let filterChannel = \"\";\r\n  let filterKeywords = \"\";\r\n  let filterExpiry = \"\";\r\n  let filterAction = \"\";\r\n\r\n  const saveConfiguration = ev => {\r\n    setConnectionConfiguration({ remote, keys: JSON.parse(keys), manifest });\r\n    navigate(\"/public\");\r\n    location.reload();\r\n  };\r\n\r\n  const selectedFile = ev => {\r\n    const secretFile = ev.target.files[0];\r\n    const reader = new FileReader();\r\n    reader.onload = function(evt) {\r\n      console.log(evt.target.result);\r\n      const contents = evt.target.result;\r\n      let secret = contents.split(\"\\n\").filter(function(line) {\r\n        return line.indexOf(\"#\") != 0;\r\n      });\r\n      secret = JSON.parse(secret.join(\"\\n\"));\r\n      remote = `ws://localhost:8989~shs:${secret.id.slice(\r\n        0,\r\n        secret.id.indexOf(\"=\") + 1\r\n      )}`;\r\n      updateUI({ keys: secret, remote });\r\n    };\r\n    reader.readAsText(secretFile);\r\n  };\r\n\r\n  const updateUI = savedData => {\r\n    console.log(\"saved data from settings\", savedData);\r\n    remote = savedData.remote || \"\";\r\n    if (savedData.keys) {\r\n      keys = JSON.stringify(savedData.keys, null, 2);\r\n    } else {\r\n      keys = \"\";\r\n    }\r\n  };\r\n\r\n  const onError = error => {\r\n    console.error(\"error on settings\", error);\r\n  };\r\n\r\n  const gettingStoredSettings = browser.storage.local\r\n    .get()\r\n    .then(updateUI, onError);\r\n\r\n  const addNewFilter = () => {\r\n    let keywords = filterKeywords\r\n      .split(\",\")\r\n      .map(v => v.trim())\r\n      .filter(v => v.length !== 0);\r\n\r\n    let filter = {};\r\n    filter.action = filterAction.length !== 0 ? filterAction : false;\r\n    filter.feed = filterFeed.length !== 0 ? filterFeed : false;\r\n    filter.channel = filterChannel.length !== 0 ? filterChannel : false;\r\n    filter.keywords = keywords;\r\n    filter.expires = filterExpiry.length !== 0 ? filterExpiry : false;\r\n\r\n    if (filter.channel && filter.channel.startsWith(\"#\")) {\r\n      filter.channel = filter.channel.slice(1);\r\n    }\r\n\r\n    if (\r\n      filter.action &&\r\n      (filter.feed || filter.channel || filter.keywords.length > 0)\r\n    ) {\r\n      addFilter(filter);\r\n\r\n      currentFilters = getFilters();\r\n\r\n      console.dir(\"filters\", currentFilters);\r\n\r\n      filterFeed = \"\";\r\n      filterChannel = \"\";\r\n      filterKeywords = \"\";\r\n      filterExpiry = \"\";\r\n      filterAction = \"\";\r\n    } else {\r\n      alert(\"Fill at least filter action and one of feed, channel or keywords\");\r\n    }\r\n  };\r\n</script>\r\n\r\n<style>\r\n  .filter {\r\n    height: 300px;\r\n    margin-bottom: 0.4rem;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .feed {\r\n    max-width: 100%;\r\n    overflow: hidden;\r\n  }\r\n</style>\r\n\r\n<h1>Settings</h1>\r\n<p>\r\n  Settings changes are saved as you make them except for identity and connection\r\n  changes, those require a full page reload and thus you need to press a save\r\n  button. The reason behind this is that Patchfox needs to disconnect and\r\n  reconnect to the\r\n  <i>ssb-server</i>\r\n  using the new info.\r\n</p>\r\n<p>\r\n  <b>\r\n    You can't use Patchfox until you fill your\r\n    <i>Connection & Identity</i>\r\n    information.\r\n    <a\r\n      href=\"/docs/index.html#/troubleshooting/no-configuration\"\r\n      target=\"_blank\">\r\n      If you want more help regarding connection and configuration click here\r\n    </a>\r\n    .\r\n  </b>\r\n</p>\r\n\r\n<h4>Connection & Identity</h4>\r\n\r\n<form class=\"form-group\">\r\n  <label class=\"form-label\" for=\"secret-file\">\r\n    Patchfox can infer the values for both\r\n    <i>remote</i>\r\n    and\r\n    <i>secret</i>\r\n    from your\r\n    <code>~/.ssb/secret</code>\r\n    file. You can use the button below to browse for it.\r\n  </label>\r\n  <input\r\n    type=\"file\"\r\n    class=\"form-input\"\r\n    id=\"secret-file\"\r\n    on:change={selectedFile} />\r\n  <label class=\"form-label\" for=\"remote\">Remote</label>\r\n  <input\r\n    class=\"form-input\"\r\n    type=\"text\"\r\n    id=\"remote\"\r\n    placeholder=\"remote\"\r\n    bind:value={remote} />\r\n\r\n  <label class=\"form-label\" for=\"secret\">Secret</label>\r\n  <textarea\r\n    class=\"form-input\"\r\n    id=\"secret\"\r\n    placeholder=\"Your secret\"\r\n    rows=\"8\"\r\n    bind:value={keys} />\r\n  <br />\r\n  <button class=\"btn btn-primary float-right\" on:click={saveConfiguration}>\r\n    Save Identity & Remote\r\n  </button>\r\n  <p>Saving identity and remote will cause a full page refresh.</p>\r\n</form>\r\n\r\n<h4>Vieweing Experience</h4>\r\n<form class=\"form-group\">\r\n  <label class=\"form-label\" for=\"limit\">Messages per page</label>\r\n  <input\r\n    class=\"form-input\"\r\n    type=\"number\"\r\n    bind:value={limit}\r\n    on:change={() => setPref('limit', limit)} />\r\n\r\n  <br />\r\n  <span>\r\n    Which message types you want to see?\r\n    <a target=\"_blank\" href=\"/docs/index.html#/message_types/\">\r\n      Click here for more information about\r\n      <i>Message Types</i>\r\n    </a>\r\n  </span>\r\n  <label class=\"form-switch\">\r\n    <input\r\n      type=\"checkbox\"\r\n      bind:checked={showTypeAbout}\r\n      on:change={ev => {\r\n        setPref('showTypeAbout', showTypeAbout);\r\n      }} />\r\n    <i class=\"form-icon\" />\r\n    <b>About</b>\r\n    (aka people setting avatars and descriptions; gatherings)\r\n  </label>\r\n  <label class=\"form-switch\">\r\n    <input\r\n      type=\"checkbox\"\r\n      bind:checked={showTypeBlog}\r\n      on:change={ev => {\r\n        setPref('showTypeBlog', showTypeBlog);\r\n      }} />\r\n    <i class=\"form-icon\" />\r\n    <b>Blog</b>\r\n    (Longform text posts)\r\n  </label>\r\n  <label class=\"form-switch\">\r\n    <input\r\n      type=\"checkbox\"\r\n      bind:checked={showTypeChannel}\r\n      on:change={ev => {\r\n        setPref('showTypeChannel', showTypeChannel);\r\n      }} />\r\n    <i class=\"form-icon\" />\r\n    <b>Channel</b>\r\n    (People subscribing to channels)\r\n  </label>\r\n  <label class=\"form-switch\">\r\n    <input\r\n      type=\"checkbox\"\r\n      bind:checked={showTypeContact}\r\n      on:change={ev => {\r\n        setPref('showTypeContact', showTypeContact);\r\n      }} />\r\n    <i class=\"form-icon\" />\r\n    <b>Contact</b>\r\n    (People following each other)\r\n  </label>\r\n  <label class=\"form-switch\">\r\n    <input\r\n      type=\"checkbox\"\r\n      bind:checked={showTypePost}\r\n      on:change={ev => {\r\n        setPref('showTypePost', showTypePost);\r\n      }} />\r\n    <i class=\"form-icon\" />\r\n    <b>Posts</b>\r\n    (Common content post, leave this on or it is not that fun)\r\n  </label>\r\n  <label class=\"form-switch\">\r\n    <input\r\n      type=\"checkbox\"\r\n      bind:checked={showTypePub}\r\n      on:change={ev => {\r\n        setPref('showTypePub', showTypePub);\r\n      }} />\r\n    <i class=\"form-icon\" />\r\n    <b>Pub</b>\r\n    (Pub servers announcements)\r\n  </label>\r\n\r\n  <label class=\"form-switch\">\r\n    <input\r\n      type=\"checkbox\"\r\n      bind:checked={showTypePrivate}\r\n      on:change={ev => {\r\n        setPref('showTypePrivate', showTypePrivate);\r\n      }} />\r\n    <i class=\"form-icon\" />\r\n    <b>Private</b>\r\n    (Private messages; You won't be able to read them, but you'll see their\r\n    encrypted content passing by)\r\n  </label>\r\n\r\n  <label class=\"form-switch\">\r\n    <input\r\n      type=\"checkbox\"\r\n      bind:checked={showTypeVote}\r\n      on:change={ev => {\r\n        setPref('showTypeVote', showTypeVote);\r\n      }} />\r\n    <i class=\"form-icon\" />\r\n    <b>Vote</b>\r\n    (People liking/digging stuff)\r\n  </label>\r\n  <div class=\"divider\" />\r\n  <label class=\"form-switch\">\r\n    <input\r\n      type=\"checkbox\"\r\n      bind:checked={showTypeUnknown}\r\n      on:change={ev => {\r\n        setPref('showTypeUnknown', showTypeUnknown);\r\n      }} />\r\n    <i class=\"form-icon\" />\r\n    <b>Unknown</b>\r\n    (Show messages Patchfox doesn't understand as their raw content)\r\n  </label>\r\n  <br />\r\n  <label class=\"form-label\">\r\n    Feed column size. There is research that says that a short column size makes\r\n    for a more pleasant reading experience, still some users prefer to use the\r\n    full screen space. Your choice is between reading through long text lines or\r\n    short ones.\r\n  </label>\r\n  <label class=\"form-radio\">\r\n    <input\r\n      type=\"radio\"\r\n      name=\"column-size\"\r\n      bind:group={columnSize}\r\n      on:change={() => setPref('columnSize', columnSize)}\r\n      value=\"short\" />\r\n    <i class=\"form-icon\" />\r\n    Short column\r\n  </label>\r\n  <label class=\"form-radio\">\r\n    <input\r\n      type=\"radio\"\r\n      name=\"column-size\"\r\n      bind:group={columnSize}\r\n      on:change={() => setPref('columnSize', columnSize)}\r\n      value=\"long\" />\r\n    <i class=\"form-icon\" />\r\n    Long column\r\n  </label>\r\n</form>\r\n<h4>Abuse Prevention</h4>\r\n<p>\r\n  Use the features from this section to tailor your Patchfox experience to suit\r\n  your needs.\r\n</p>\r\n<h5>Filters</h5>\r\n<p>\r\n  Use filters to hide messages and blur images. Use any combination of channel,\r\n  feeds and keywords (separated by commas) to create your triggers and make SSB\r\n  the platform you want. Be aware that these filters are saved to your browser,\r\n  they are not shared on the feed, they don't affect gossiping, they only affect\r\n  the displaying of messages and images in Patchfox itself. If you create a\r\n  filter and open a different client, they won't be working there. If you want\r\n  to learn more about\r\n  <a href=\"/docs/index.html#/features/filter\">\r\n    filters, click here to go to the documentation.\r\n  </a>\r\n  You can create as many filters as you want.\r\n</p>\r\n<div class=\"container\">\r\n  <div class=\"columns\">\r\n    {#each currentFilters as filter}\r\n      <div class=\"column col-6\">\r\n        <div class=\"card filter\">\r\n          <div class=\"card-header\">\r\n            <div class=\"card-title h5\">{filter.action}</div>\r\n          </div>\r\n          <div class=\"card-body\">\r\n            <ul>\r\n              {#if filter.feed}\r\n                <li>From <a href=\"?feed={filter.feed}#/profile\" target=\"_blank\" class=\"feed\">{filter.feed}</a></li>\r\n              {/if}\r\n              {#if filter.channel}\r\n                <li>On channel <a href=\"?channel={filter.feed}#/channel\" target=\"_blank\" class=\"feed\">#{filter.channel}</a></li>\r\n              {/if}\r\n              {#if filter.keywords.length > 0}\r\n                <i>\r\n                  <li>Containing: {filter.keywords.join(', ')}</li>\r\n                </i>\r\n              {/if}\r\n              {#if filter.expires}\r\n                <li>Expiring in {filter.expires}</li>\r\n              {/if}\r\n            </ul>\r\n          </div>\r\n          <div class=\"card-footer\">\r\n            <button\r\n              class=\"btn\"\r\n              aria-label=\"Delete\"\r\n              on:click={() => {\r\n                deleteFilter(filter);\r\n                currentFilters = getFilters();\r\n              }}>\r\n              Delete\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    {:else}\r\n      <div class=\"column col-12\">\r\n        <p class=\"label\">You don't have any filter yet.</p>\r\n      </div>\r\n    {/each}\r\n  </div>\r\n</div>\r\n<h5>New Filter</h5>\r\n<form-group>\r\n  <label class=\"form-radio\">\r\n    <input\r\n      type=\"radio\"\r\n      name=\"filter-action\"\r\n      bind:group={filterAction}\r\n      value=\"hide\" />\r\n    <i class=\"form-icon\" />\r\n    Hide Message\r\n  </label>\r\n  <label class=\"form-radio\">\r\n    <input\r\n      type=\"radio\"\r\n      name=\"filter-action\"\r\n      bind:group={filterAction}\r\n      value=\"blur\" />\r\n    <i class=\"form-icon\" />\r\n    Blur Images\r\n  </label>\r\n  <label class=\"form-label\" for=\"remote\">Channel</label>\r\n  <input\r\n    class=\"form-input\"\r\n    type=\"text\"\r\n    placeholder=\"Channel\"\r\n    bind:value={filterChannel} />\r\n  <label class=\"form-label\" for=\"remote\">Feed</label>\r\n  <input\r\n    class=\"form-input\"\r\n    type=\"text\"\r\n    placeholder=\"Feed\"\r\n    bind:value={filterFeed} />\r\n  <label class=\"form-label\" for=\"remote\">Keywords</label>\r\n  <input\r\n    class=\"form-input\"\r\n    type=\"text\"\r\n    placeholder=\"Keywords separated by commas\"\r\n    bind:value={filterKeywords} />\r\n  <label class=\"form-label\" for=\"remote\">Expiration Date</label>\r\n  <input\r\n    class=\"form-input\"\r\n    type=\"date\"\r\n    placeholder=\"When should this filter expiry\"\r\n    bind:value={filterExpiry} />\r\n</form-group>\r\n<br />\r\n<button class=\"btn btn-primary\" on:click={addNewFilter}>Add Filter</button>\r\n<br />\r\n<br />\r\n","<script>\r\n  import MessageRenderer from \"../messageTypes/MessageRenderer.svelte\";\r\n  import { navigate, routeParams, getPref } from \"../utils.js\";\r\n  import { onDestroy, onMount } from \"svelte\";\r\n\r\n  let msgs = [];\r\n  let unsub;\r\n\r\n  document.title = `Patchfox - Mentions`;\r\n\r\n  let lt = false;\r\n\r\n  const pull = hermiebox.modules.pullStream;\r\n  const sbot = hermiebox.sbot;\r\n  \r\n\r\n  const loadMentions = () => {\r\n    console.log(\"Loading mentions...\", lt);\r\n    window.scrollTo(0, 0);\r\n    msgs = [];\r\n    ssb.mentions(ssb.feed, lt).then(ms => msgs = ms)\r\n  }; \r\n\r\n  onDestroy(() => {\r\n    unsub();\r\n  });\r\n\r\n  onMount(() => {\r\n    unsub = routeParams.subscribe(params => {\r\n      console.log(\"params changed.\", lt, params.lt);\r\n      if (params.lt) {\r\n        let newlt = parseInt(params.lt);\r\n        if (newlt !== lt) {\r\n          lt = newlt;\r\n        }\r\n      } else {\r\n        lt = false;\r\n      }\r\n      loadMentions();\r\n    });\r\n  });\r\n</script>\r\n\r\n<style>\r\n  .menu-right {\r\n    right: 0px;\r\n    left: unset;\r\n    min-width: 300px;\r\n  }\r\n</style>\r\n\r\n<div class=\"container\">\r\n  <div class=\"columns\">\r\n    <h4 class=\"column\">Mentions</h4>\r\n    <div class=\"column\" />\r\n  </div>\r\n</div>\r\n{#if msgs.length === 0}\r\n  <div class=\"loading loading-lg\" />\r\n{:else}\r\n  {#each msgs as msg (msg.key)}\r\n    <MessageRenderer {msg} />\r\n  {/each}\r\n  <ul class=\"pagination\">\r\n    <li class=\"page-item page-previous\">\r\n      <a\r\n        href=\"#/public\"\r\n        on:click|stopPropagation|preventDefault={() => history.back()}>\r\n        <div class=\"page-item-subtitle\">Previous</div>\r\n      </a>\r\n    </li>\r\n    <li class=\"page-item page-next\">\r\n      <a\r\n        href=\"#/public\"\r\n        on:click|stopPropagation|preventDefault={() => {\r\n          navigate('/mentions', { lt: msgs[msgs.length - 1].rts });\r\n        }}>\r\n        <div class=\"page-item-subtitle\">Next</div>\r\n      </a>\r\n    </li>\r\n  </ul>\r\n{/if}\r\n","import { writable, derived } from \"svelte/store\";\r\nimport { SSB } from \"./ssb.js\";\r\n\r\nimport queryString from \"query-string\";\r\nimport Public from \"./views/Public.svelte\";\r\nimport Default from \"./views/Default.svelte\";\r\nimport Compose from \"./views/Compose.svelte\";\r\nimport Thread from \"./views/Thread.svelte\";\r\nimport Profile from \"./views/Profile.svelte\";\r\nimport ErrorView from \"./views/ErrorView.svelte\";\r\nimport Channels from \"./views/Channels.svelte\"\r\nimport Channel from \"./views/Channel.svelte\"\r\nimport Settings from \"./views/Settings.svelte\"\r\nimport Mentions from \"./views/Mentions.svelte\"\r\n\r\nlet savedData = {}\r\n\r\nexport const parseLocation = () => {\r\n  let data = queryString.parse(window.location.search)\r\n  let loc = window.location.hash.slice(1).replace(\"?\", \"\")\r\n  return { data, location: loc }\r\n};\r\n\r\nexport const intercept = () => {\r\n  let r = parseLocation()\r\n  if (r.location == \"/intercept\" && r.data.query) {\r\n    let hash = r.data.query.replace(\"ssb:\", \"\")\r\n    let sigil = hash[0]\r\n    switch (sigil) {\r\n      case \"%\":\r\n        window.location = `/index.html?thread=${encodeURIComponent(hash)}#/thread`\r\n        break\r\n      case \"&\":\r\n        window.location = `http://localhost:8989/blobs/get/${hash}`\r\n        break\r\n      case \"@\":\r\n        window.location = `/index.html?feed=${encodeURIComponent(hash)}#/profile`\r\n        break\r\n      case \"#\":\r\n        window.location = `/index.html?channel=${hash.replace(\"#\",\"\")}#/channel` \r\n        break\r\n    }\r\n  }\r\n}\r\n\r\nexport const connected = writable(false);\r\n\r\n// maybe in the future, migrate routing system to:\r\n// https://github.com/ItalyPaleAle/svelte-spa-router\r\nexport const route = writable(parseLocation());\r\nexport const routeParams = derived(route, $route => $route.data)\r\nexport const routeLocation = derived(route, $route => $route.location)\r\n\r\nexport const navigate = (location, data) => {\r\n  data = data || {}\r\n  route.set({ location, data });\r\n  let dataAsQuery = queryString.stringify(data);\r\n  history.pushState({ location, data }, `Patchfox - ${location}`, `/index.html?${dataAsQuery}#${location}`);\r\n  console.log(`Navigate ${location}`, data);\r\n};\r\n\r\n\r\nconst routes = {\r\n  \"/thread\": Thread,\r\n  \"/public\": Public,\r\n  \"/compose\": Compose,\r\n  \"/profile\": Profile,\r\n  \"/error\": ErrorView,\r\n  \"/channels\": Channels,\r\n  \"/channel\": Channel,\r\n  \"/settings\": Settings,\r\n  \"/mentions\": Mentions,\r\n  \"*\": Default\r\n};\r\n\r\n\r\n\r\nexport const currentView = derived([connected, route], ([$connected, $route]) => {\r\n  let r = $route.location\r\n  if ($connected) {\r\n    if (routes.hasOwnProperty(r)) {\r\n      return routes[r];\r\n    } else {\r\n      console.log(\"didn't find\", r);\r\n      return routes[\"*\"];\r\n    }\r\n  } else {\r\n    if (r === \"/settings\") {\r\n      return Settings\r\n    } else {\r\n      return routes[\"*\"];\r\n    }\r\n  }\r\n\r\n\r\n});\r\n\r\n\r\n/// connection stuff\r\n\r\nconst configurationMissing = () => {\r\n  console.log(\"config missing\");\r\n  window.location = \"/docs/index.html#/troubleshooting/no-configuration\";\r\n};\r\n\r\nconst cantConnect = () => {\r\n  console.log(\"config missing\");\r\n  window.location = \"/docs/index.html#/troubleshooting/no-connection\";\r\n};\r\n\r\nexport const loadConfiguration = async () => {\r\n  console.log(\"Loading configuration...\")\r\n  try {\r\n    let data = await browser.storage.local.get()\r\n\r\n    if (data.hasOwnProperty(\"keys\")) {\r\n      savedData = data\r\n    } else {\r\n      throw \"Configuration is missing\"\r\n    }\r\n  } catch (n) {\r\n    throw \"Configuration is missing\"\r\n  }\r\n}\r\n\r\nexport const connect = async () => {\r\n  console.log(\"Connecting to sbot...\")\r\n  window.ssb = new SSB();\r\n\r\n  try {\r\n    await ssb.connect(savedData.keys)\r\n    connected.set(true);\r\n  } catch (err) {\r\n    console.error(\"can't connect\", err);\r\n    connected.set(false)\r\n    throw \"Can't connect to sbot\"\r\n  }\r\n}\r\n\r\nexport const reconnect = () => {\r\n  return new Promise((resolve, reject) => {\r\n    const tryConnect = (data) => {\r\n      window.ssb = new SSB();\r\n\r\n      ssb\r\n        .connect(data.keys)\r\n        .then(data => {\r\n          console.log(\"connected\");\r\n          connected.set(true);\r\n          resolve()\r\n        })\r\n        .catch(err => {\r\n          console.error(\"can't reconnect\", err);\r\n          reject(err);\r\n        });\r\n    }\r\n\r\n    browser.storage.local\r\n      .get()\r\n      .then(tryConnect, reject);\r\n  })\r\n}\r\n\r\nexport const keepPinging = () => {\r\n  let interval = setInterval(() => {\r\n    if (hermiebox.sbot) {\r\n      hermiebox.sbot.whoami((err, v) => {\r\n        if (err) {\r\n          console.error(\"can't call whoami\", err);\r\n          reconnect().catch(n => {\r\n            console.error(\"can't reconnect\");\r\n            clearInterval(interval);\r\n            navigate(\"/error\", { error: n });\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }, 5000);\r\n}\r\n\r\n// Preferences\r\n\r\nexport const getPref = (key, defaultValue) => {\r\n  if (savedData.preferences) {\r\n    if (savedData.preferences.hasOwnProperty(key)) {\r\n      return savedData.preferences[key]\r\n    }\r\n  }\r\n  return defaultValue\r\n}\r\n\r\nexport const setConnectionConfiguration = ({ keys, remote, manifest }) => {\r\n  savedData.keys = keys\r\n  savedData.remote = remote\r\n  savedData.manifest = manifest\r\n\r\n  browser.storage.local.set(savedData)\r\n\r\n}\r\n\r\nexport const setPref = (key, value) => {\r\n  savedData.preferences = savedData.preferences || {}\r\n  savedData.preferences[key] = value\r\n\r\n  browser.storage.local.set(savedData)\r\n}\r\n","/**\r\n * This is the Contact Cache Shared Worker\r\n * \r\n * Its object is to traverse messages of type contact from\r\n * the user and targeting the user to assemble a cache of the social\r\n * graph.\r\n * \r\n * ---- SHARED WORKER NOTES ----\r\n * \r\n * Like all the other workers, it will establish its own WebSocket connection\r\n * to sbot.\r\n * \r\n * Remember to add all workers to the rollup config.\r\n */\r\n\r\nimport {\r\n    loadConfiguration,\r\n    connect,\r\n    keepPinging\r\n} from \"../utils\"\r\n\r\n\r\n\r\nonconnect = function (e) {\r\n    let port = e.ports[0];\r\n\r\n    // do not start on connect. Receive hermiebox as a message. Hope for the best\r\n\r\n  \r\n\r\n    const main = async () => {\r\n        port.postMessage(\"hi!\")\r\n    }\r\n\r\n    main()\r\n}"],"names":["noop","identity","x","assign","tar","src","k","run","fn","blank_object","Object","create","run_all","fns","forEach","is_function","thing","safe_not_equal","a","b","subscribe","component","store","callback","unsub","$$","on_destroy","push","unsubscribe","is_client","window","now","performance","Date","raf","requestAnimationFrame","tasks","Set","stylesheet","running","run_tasks","task","delete","size","loop","promise","Promise","fulfil","add","[object Object]","append","target","node","appendChild","insert","anchor","insertBefore","detach","parentNode","removeChild","detach_between","before","after","nextSibling","destroy_each","iterations","detaching","i","length","d","element","name","document","createElement","text","data","createTextNode","space","empty","listen","event","handler","options","addEventListener","removeEventListener","prevent_default","preventDefault","call","this","stop_propagation","stopPropagation","attr","attribute","value","removeAttribute","setAttribute","set_data","toggle_class","toggle","classList","current_component","active","current_rules","create_rule","duration","delay","ease","uid","step","keyframes","p","t","rule","str","hash","charCodeAt","style","head","sheet","insertRule","cssRules","animation","delete_rule","split","filter","anim","indexOf","join","deleteRule","set_current_component","get_current_component","Error","onMount","on_mount","createEventDispatcher","type","detail","callbacks","e","createEvent","initCustomEvent","custom_event","slice","dirty_components","resolved_promise","resolve","update_scheduled","binding_callbacks","render_callbacks","flush_callbacks","add_render_callback","flush","seen_callbacks","shift","update","pop","has","fragment","dirty","before_render","ctx","after_render","outros","wait","then","group_outros","remaining","check_outros","on_outro","handle_promise","info","token","index","key","resolved","child_ctx","block","current","blocks","o","c","m","mount","error","catch","pending","outro_and_destroy_block","lookup","destroy_block","update_keyed_each","old_blocks","changed","get_key","dynamic","list","destroy","create_each_block","next","get_context","n","old_indexes","new_blocks","new_lookup","Map","deltas","get","set","Math","abs","will_move","did_move","first","new_block","old_block","new_key","old_key","mount_component","new_on_destroy","map","make_dirty","init","instance","create_fragment","not_equal$$1","prop_names","parent_component","props","not_equal","bound","context","ready","hydrate","l","Array","from","childNodes","intro","SvelteComponent","$destroy","splice","writable","start","stop","subscribers","new_value","s","invalidate","subscriber","derived","stores","initial_value","single","isArray","stores_array","auto","inited","values","cleanup","sync","result","unsubscribers","getFilters","getPref","addFilter","currentFilters","setPref","deleteFilter","f","isMessageBlured","msg","action","isMessageFiltered","some","r","isMessageHidden","filterResults","expires","expirationDate","feed","author","console","log","channel","content","keywords","toLowerCase","res","includes","pull","hermiebox","modules","pullStream","sort","ssbSort","sbot","avatarCache","SSB","pMsg","pVal","pKeys","server","api","connect","id","limit","take","knownMessageTypes","post","about","vote","contact","pub","blog","opts","reject","reverse","createFeedStream","filterTypes","filterWithUserFilters","filterLimit","collect","err","msgs","cb","rootMsg","backlinks","read","query","$filter","dest","root","links","rel","unique","concat","lt","filterQuery","timestamp","$lt","createBacklinkStream","feedid","profile","msgid","browser","storage","local","avatar","howManyChars","retVal","ssb","plainTextFromMarkdown","html","markdown","div","innerHTML","innerText","ssbMarkdown","replace","match","offset","string","encodeURIComponent","ssbRef","arrivalTimestamp","declaredTimestamp","min","isMsgId","msgToPost","mentions","ssbMentions","publish","userId","following","blobid","getBlob","link","expression","$is","$reduce","count","$count","$max","$sort","subscribed","$map","blocking","byWhom","reduce","toString","toUpperCase","singleMatcher","RegExp","multiMatcher","decodeComponents","components","decodeURIComponent","left","right","prototype","decode","input","tokens","encodedURI","TypeError","replaceMap","%FE%FF","%FF%FE","exec","entries","keys","customDecodeURIComponent","separator","separatorIndex","encode","strict","strictUriEncode","decodeComponent","removeHash","hashStart","extract","queryStart","parse","formatter","arrayFormat","accumulator","undefined","newValue","parserForArrayFormat","ret","trim","param","splitOnFirst","Boolean","keysSorter","Number","object","encoderForArrayFormat","url","hasContentWarning","contentWarning","goRoot","branch","goBranch","fork","reply","showContentWarning","private","liked","likeChanged","votes","ms","ev","checked","like","unlike","replyfeed","navigate","originalRoot","rootId","thread","branchId","rawContent","JSON","stringify","person","label","encodedid","goThread","blurbFromMsg","blurb","ctrlKey","open","verb","otherPersonName","otherPersonFeed","goProfile","goChannel","image","otherLink","description","otherName","isThisAboutFeeds","startsWith","host","port","address","thumbnail","title","toastMsg","summary","loading","displayBlogPost","showBlogpost","toast","$routeLocation","setTimeout","avatarClick","dispatch","timeago","simple","date_time","today","dateParse","timeData","seconds","minutes","hours","round","days","month","years","ceil","pastCalc","futureCalc","future","warn","selectedRenderer","showRaw","dropdownActive","privateMsgForYou","blured","copyPermalink","copyHash","toggleRawMessage","messageTypes","*","GenericMsg","PostMsg","VoteMsg","PrivateMsg","ContactMsg","ChannelMsg","AboutMsg","PubMsg","BlogMsg","hasOwnProperty","navigator","clipboard","writeText","goPrevious","goNext","$routeParams","parseInt","public","scrollTo","history","back","killEvent","dataTransfer","files","bind","cubicOut","slide","easing","getComputedStyle","opacity","height","parseFloat","padding_top","paddingTop","padding_bottom","paddingBottom","margin_top","marginTop","margin_bottom","marginBottom","border_top_width","borderTopWidth","border_bottom_width","borderBottomWidth","css","posting","fileOnTop","dragOver","dragLeave","toggleContentWarning","attachFile","attachFileTrigger","preview","showContentWarningField","ipfsDaemonRunning","params","animation_name","config","go","tick","tick$$1","start_time","end_time","abort","now$$1","started","group","reset","attachFileIPFS","attachFileIPFSTrigger","showPreview","fileReader","pullFileReader","drop","getElementById","readFileAndAttach","checkIpfsDaemon","fetch","floor","blobs","readFileAndAttachIPFS","async","ipfs","IpfsHttpClient","results","path","newPost","message","reconnect","location","search","click","dir","messagePromise","followingChanged","blockingChanged","lastMsgs","aboutPromise","avatarPromise","lastAbout","find","loadMoreMessages","unblock","follow","unfollow","toastClass","cta","errorObj","errorMapping","Error: stream is closed","subscribedChannels","click_handler","live","drain","$$invalidate","loadSubscribedChannels","subscriptionChanged","channelSubscribed","channelSubscribe","channelUnsubscribe","rts","selectedFile","saveConfiguration","addNewFilter","remote","showTypeAbout","showTypeBlog","showTypeChannel","showTypeContact","showTypePost","showTypePub","showTypePrivate","showTypeVote","showTypeUnknown","columnSize","filterAction","filterChannel","filterFeed","filterKeywords","filterExpiry","updateUI","savedData","setConnectionConfiguration","manifest","reload","secretFile","reader","FileReader","onload","evt","secret","line","readAsText","v","alert","routeParams","newlt","connected","route","queryString","$route","routeLocation","dataAsQuery","pushState","routes","/thread","/public","/compose","/profile","/error","/channels","/channel","/settings","Settings","/mentions","$connected","defaultValue","preferences","onconnect","ports","postMessage","main"],"mappings":"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"}